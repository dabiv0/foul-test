{
  "version": 3,
  "sources": ["../../../server/chat-commands/room-settings.ts"],
  "sourcesContent": ["/**\r\n * Room settings commands\r\n * Pokemon Showdown - http://pokemonshowdown.com/\r\n *\r\n * Commands for settings relating to room setting filtering.\r\n *\r\n * @license MIT\r\n */\r\nimport { Utils } from '../../lib';\r\nimport type { EffectiveGroupSymbol, RoomPermission } from '../user-groups';\r\n\r\nconst RANKS = Config.groupsranking;\r\n\r\nconst SLOWCHAT_MINIMUM = 2;\r\nconst SLOWCHAT_MAXIMUM = 60;\r\nconst SLOWCHAT_USER_REQUIREMENT = 10;\r\n\r\nexport const sections = [\r\n\t'official', 'battleformats', 'languages', 'entertainment', 'gaming', 'lifehobbies', 'onsitegames',\r\n] as const;\r\n\r\nexport type RoomSection = typeof sections[number];\r\n\r\nexport const RoomSections: { sectionNames: { [k in RoomSection]: string }, sections: readonly RoomSection[] } = {\r\n\tsectionNames: {\r\n\t\tofficial: 'Official',\r\n\t\tbattleformats: 'Battle formats',\r\n\t\tlanguages: 'Languages',\r\n\t\tentertainment: 'Entertainment',\r\n\t\tgaming: 'Gaming',\r\n\t\tlifehobbies: 'Life & hobbies',\r\n\t\tonsitegames: 'On-site games',\r\n\t},\r\n\tsections,\r\n};\r\n\r\nexport const commands: Chat.ChatCommands = {\r\n\troomsetting: 'roomsettings',\r\n\troomsettings(target, room, user, connection) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (room.battle) throw new Chat.ErrorMessage(\"This command cannot be used in battle rooms.\");\r\n\t\tlet uhtml = 'uhtml';\r\n\r\n\t\tif (!target) {\r\n\t\t\troom.update();\r\n\t\t} else {\r\n\t\t\tvoid this.parse(`/${target}`);\r\n\t\t\tuhtml = 'uhtmlchange';\r\n\t\t}\r\n\r\n\t\tlet output = Utils.html`<div class=\"infobox\">Room Settings for ${room.title}<br />`;\r\n\t\tfor (const handler of Chat.roomSettings) {\r\n\t\t\tconst setting = handler(room, user, connection);\r\n\t\t\tif (typeof setting.permission === 'string') setting.permission = user.can(setting.permission, null, room);\r\n\r\n\t\t\toutput += `<strong>${setting.label}:</strong> <br />`;\r\n\r\n\t\t\tfor (const option of setting.options) {\r\n\t\t\t\t// disabled button\r\n\t\t\t\tif (option[1] === true) {\r\n\t\t\t\t\toutput += Utils.html`<button class=\"button disabled\" style=\"font-weight:bold;color:#575757;` +\r\n\t\t\t\t\t\t`background:#d3d3d3;\">${option[0]}</button> `;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// only show proper buttons if we have the permissions to use them\r\n\t\t\t\t\tif (!setting.permission) continue;\r\n\r\n\t\t\t\t\toutput += Utils.html`<button class=\"button\" name=\"send\" value=\"/roomsetting ${option[1]}\">${option[0]}</button> `;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\toutput += `<br />`;\r\n\t\t}\r\n\t\toutput += '</div>';\r\n\t\tuser.sendTo(room, `|${uhtml}|roomsettings|${output}`);\r\n\t},\r\n\troomsettingshelp: [`/roomsettings - Shows current room settings with buttons to change them (if you can).`],\r\n\r\n\tmodchat(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\tconst modchatSetting = (room.settings.modchat || \"OFF\");\r\n\t\t\treturn this.sendReply(`Moderated chat is currently set to: ${modchatSetting}`);\r\n\t\t}\r\n\t\tif (user.locked) { // would put this below but it behaves weird if there's no modchat set\r\n\t\t\tthrow new Chat.ErrorMessage(`/modchat - Access denied.`);\r\n\t\t} else {\r\n\t\t\tthis.checkCan('modchat', null, room);\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\troom.settings.modchat && room.settings.modchat.length <= 1 &&\r\n\t\t\t!room.auth.atLeast(user, room.settings.modchat) &&\r\n\t\t\t// Upper Staff should probably be able to set /modchat ~ in secret rooms\r\n\t\t\t!user.can('bypassall')\r\n\t\t) {\r\n\t\t\tthrow new Chat.ErrorMessage(`/modchat - Access denied for changing a setting currently at ${room.settings.modchat}.`);\r\n\t\t}\r\n\t\tif ((room as any).requestModchat) {\r\n\t\t\tconst error = (room as GameRoom).requestModchat(user);\r\n\t\t\tif (error) throw new Chat.ErrorMessage(error);\r\n\t\t}\r\n\r\n\t\t// only admins can force modchat on a forced public battle\r\n\t\tif (room.battle?.forcedSettings.modchat && !user.can('rangeban')) {\r\n\t\t\tthrow new Chat.ErrorMessage(\r\n\t\t\t\t`This battle is required to have modchat on due to one of the players having a username that starts with ` +\r\n\t\t\t\t`${room.battle.forcedSettings.modchat}.`\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\ttarget = target.toLowerCase().trim();\r\n\t\tconst currentModchat = room.settings.modchat;\r\n\t\tswitch (target) {\r\n\t\tcase 'off':\r\n\t\tcase 'false':\r\n\t\tcase 'no':\r\n\t\tcase 'disable':\r\n\t\t\troom.settings.modchat = null;\r\n\t\t\tbreak;\r\n\t\tcase 'ac':\r\n\t\tcase 'autoconfirmed':\r\n\t\t\troom.settings.modchat = 'autoconfirmed';\r\n\t\t\tbreak;\r\n\t\tcase 'trusted':\r\n\t\t\troom.settings.modchat = 'trusted';\r\n\t\t\tbreak;\r\n\t\tcase 'player':\r\n\t\t\ttarget = Users.PLAYER_SYMBOL;\r\n\t\t\t/* falls through */\r\n\t\tdefault:\r\n\t\t\tif (!Users.Auth.isAuthLevel(target) || ['\u203D', '!'].includes(target)) {\r\n\t\t\t\tthis.errorReply(`The rank '${target}' was unrecognized as a modchat level.`);\r\n\t\t\t\treturn this.parse('/help modchat');\r\n\t\t\t}\r\n\t\t\t// Users shouldn't be able to set modchat above their own rank (except for ROs who are also Upper Staff)\r\n\t\t\tconst modchatLevelHigherThanUserRank = !room.auth.atLeast(user, target) && !user.can('bypassall');\r\n\t\t\tif (modchatLevelHigherThanUserRank || !Users.Auth.hasPermission(user, 'modchat', target as GroupSymbol, room)) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`/modchat - Access denied for setting to ${target}.`);\r\n\t\t\t}\r\n\t\t\troom.settings.modchat = target;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif (currentModchat === room.settings.modchat) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Modchat is already set to ${currentModchat || 'off'}.`);\r\n\t\t}\r\n\t\tif (!room.settings.modchat) {\r\n\t\t\tthis.add(\"|raw|<div class=\\\"broadcast-blue\\\"><strong>Moderated chat was disabled!</strong><br />Anyone may talk now.</div>\");\r\n\t\t} else {\r\n\t\t\tconst modchatSetting = Utils.escapeHTML(room.settings.modchat);\r\n\t\t\tthis.add(`|raw|<div class=\"broadcast-red\"><strong>Moderated chat was set to ${modchatSetting}!</strong><br />Only users of rank ${modchatSetting} and higher can talk.</div>`);\r\n\t\t}\r\n\t\tif ((room as GameRoom).requestModchat && !room.settings.modchat) (room as GameRoom).requestModchat(null);\r\n\t\tthis.privateModAction(`${user.name} set modchat to ${room.settings.modchat || \"off\"}`);\r\n\t\tthis.modlog('MODCHAT', null, `to ${room.settings.modchat || \"false\"}`);\r\n\r\n\t\troom.saveSettings();\r\n\t},\r\n\tmodchathelp: [\r\n\t\t`/modchat [off/autoconfirmed/trusted/+/%/@/*/player/#/~] - Set the level of moderated chat. Requires: % \\u2606 for off/autoconfirmed/+/player options, * @ # ~ for all the options`,\r\n\t],\r\n\r\n\tautomodchat(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\tif (!room.settings.autoModchat) return this.sendReply(`This room has automodchat OFF.`);\r\n\t\t\tconst { rank: curRank, time: curTime } = room.settings.autoModchat;\r\n\t\t\treturn this.sendReply(`Automodchat is currently set to set modchat to ${curRank} after ${curTime} minutes.`);\r\n\t\t}\r\n\t\tthis.checkCan('declare', null, room);\r\n\t\tif (this.meansNo(toID(target))) {\r\n\t\t\tif (!room.settings.autoModchat) throw new Chat.ErrorMessage(`Auto modchat is not set.`);\r\n\t\t\tdelete room.settings.autoModchat;\r\n\t\t\troom.saveSettings();\r\n\t\t\tif (room.modchatTimer) clearTimeout(room.modchatTimer); // fallback just in case (should never happen)\r\n\t\t\tthis.privateModAction(`${user.name} turned off automatic modchat.`);\r\n\t\t\treturn this.modlog(`AUTOMODCHAT`, null, 'OFF');\r\n\t\t}\r\n\t\tlet [rawTime, rank] = Utils.splitFirst(target, ',').map(i => i.trim()) as [string, GroupSymbol];\r\n\t\tif (!rawTime) {\r\n\t\t\treturn this.parse(`/help automodchat`);\r\n\t\t}\r\n\t\tif (!rank) {\r\n\t\t\tif (room.settings.autoModchat) {\r\n\t\t\t\trank = room.settings.autoModchat.rank;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.parse(`/help automodchat`);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst validGroups = [...Config.groupsranking as string[], 'trusted', 'autoconfirmed'];\r\n\t\tif (!validGroups.includes(rank)) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Invalid rank.`);\r\n\t\t}\r\n\t\tconst time = parseInt(rawTime);\r\n\t\tif (isNaN(time) || time > 480 || time < 5) {\r\n\t\t\tthrow new Chat.ErrorMessage(\"Invalid duration. Choose a number under 480 (in minutes) and over 5 minutes.\");\r\n\t\t}\r\n\t\troom.settings.autoModchat = {\r\n\t\t\trank, time, active: false,\r\n\t\t};\r\n\t\tthis.privateModAction(`${user.name} set automodchat to rank ${rank} and timeout ${time} minutes.`);\r\n\t\tthis.modlog(`AUTOMODCHAT`, null, `${rank}: ${time} minutes`);\r\n\t\troom.saveSettings();\r\n\t},\r\n\tautomodchathelp: [\r\n\t\t`/automodchat [number], [rank] - Sets modchat [rank] to automatically turn on after [number] minutes with no staff.`,\r\n\t\t`[number] must be between 5 and 480. Requires: # ~`,\r\n\t\t`/automodchat off - Turns off automodchat.`,\r\n\t],\r\n\r\n\tionext() {\r\n\t\tthrow new Chat.ErrorMessage([\r\n\t\t\t`\"ionext\" is an outdated feature. Hidden battles now have password-protected URLs, making them fully secure against eavesdroppers.`,\r\n\t\t\t`You probably want to switch from /ionext to /hidenext, and from /ioo to /hideroom`,\r\n\t\t]);\r\n\t},\r\n\tioo() {\r\n\t\tthrow new Chat.ErrorMessage([\r\n\t\t\t`\"ioo\" is an outdated feature. Hidden battles now have password-protected URLs, making them fully secure against eavesdroppers.`,\r\n\t\t\t`You probably want to switch from /ioo to /hideroom`,\r\n\t\t]);\r\n\t},\r\n\r\n\tinviteonlynext(target, room, user) {\r\n\t\tconst groupConfig = Config.groups[Users.PLAYER_SYMBOL];\r\n\t\tif (!groupConfig?.editprivacy) throw new Chat.ErrorMessage(`/ionext - Access denied.`);\r\n\t\tif (this.meansNo(target)) {\r\n\t\t\tuser.battleSettings.inviteOnly = false;\r\n\t\t\tuser.update();\r\n\t\t\tthis.sendReply(\"Your next battle will be publicly visible.\");\r\n\t\t} else {\r\n\t\t\tuser.battleSettings.inviteOnly = true;\r\n\t\t\tuser.update();\r\n\t\t\tthis.sendReply(`Your next battle will be invite-only${Rooms.RoomBattle.battleForcedSetting(user, 'privacy') ? `, unless it is rated` : ``}.`);\r\n\t\t}\r\n\t},\r\n\tinviteonlynexthelp: [\r\n\t\t`/inviteonlynext - Sets your next battle to be invite-only.`,\r\n\t\t`/inviteonlynext off - Sets your next battle to be publicly visible.`,\r\n\t],\r\n\r\n\tinviteonly(target, room, user, connection, cmd) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) return this.parse('/help inviteonly');\r\n\t\tif (this.meansYes(target)) {\r\n\t\t\treturn this.parse(\"/modjoin %\");\r\n\t\t} else {\r\n\t\t\treturn this.parse(`/modjoin ${target}`);\r\n\t\t}\r\n\t},\r\n\tinviteonlyhelp: [\r\n\t\t`/inviteonly [on|off] - Sets modjoin %. Users can't join unless invited with /invite. Requires: # ~`,\r\n\t\t`/ioo - Shortcut for /inviteonly on`,\r\n\t\t`/inviteonlynext OR /ionext - Sets your next battle to be invite-only.`,\r\n\t\t`/ionext off - Sets your next battle to be publicly visible.`,\r\n\t],\r\n\r\n\tmodjoin(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\tconst modjoinSetting = room.settings.modjoin === true ? \"SYNC\" : room.settings.modjoin || \"OFF\";\r\n\t\t\treturn this.sendReply(`Modjoin is currently set to: ${modjoinSetting}`);\r\n\t\t}\r\n\t\tif (room.battle) {\r\n\t\t\tthis.checkCan('editprivacy', null, room);\r\n\t\t\tif (room.battle.forcedSettings.privacy) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(\r\n\t\t\t\t\t`This battle is required to be public due to a player having a name prefixed by '${room.battle.forcedSettings.privacy}'.`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif (room.battle.inviteOnlySetter && !user.can('mute', null, room) && room.battle.inviteOnlySetter !== user.id) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`Only the person who set this battle to be invite-only can turn it off.`);\r\n\t\t\t}\r\n\t\t\troom.battle.inviteOnlySetter = user.id;\r\n\t\t} else if (room.settings.isPersonal) {\r\n\t\t\tthis.checkCan('editroom', null, room);\r\n\t\t} else {\r\n\t\t\tthis.checkCan('makeroom');\r\n\t\t}\r\n\t\tif (room.tour && !room.tour.allowModjoin) {\r\n\t\t\tthrow new Chat.ErrorMessage(`You can't do this in tournaments where modjoin is prohibited.`);\r\n\t\t}\r\n\t\tif (target === 'player') target = Users.PLAYER_SYMBOL;\r\n\t\tif (this.meansNo(target)) {\r\n\t\t\tif (!room.settings.modjoin) throw new Chat.ErrorMessage(`Modjoin is already turned off in this room.`);\r\n\t\t\troom.settings.modjoin = null;\r\n\t\t\tthis.add(`|raw|<div class=\"broadcast-blue\"><strong>This room is no longer invite only!</strong><br />Anyone may now join.</div>`);\r\n\t\t\tthis.addModAction(`${user.name} turned off modjoin.`);\r\n\t\t\tthis.modlog('MODJOIN', null, 'OFF');\r\n\t\t\tif (room.battle) room.battle.inviteOnlySetter = null;\r\n\t\t\troom.saveSettings();\r\n\t\t\treturn;\r\n\t\t} else if (target === 'sync') {\r\n\t\t\tif (room.settings.modjoin === true) throw new Chat.ErrorMessage(`Modjoin is already set to sync modchat in this room.`);\r\n\t\t\troom.settings.modjoin = true;\r\n\t\t\tthis.add(`|raw|<div class=\"broadcast-red\"><strong>Moderated join is set to sync with modchat!</strong><br />Only users who can speak in modchat can join.</div>`);\r\n\t\t\tthis.addModAction(`${user.name} set modjoin to sync with modchat.`);\r\n\t\t\tthis.modlog('MODJOIN SYNC');\r\n\t\t} else if (target === 'ac' || target === 'autoconfirmed') {\r\n\t\t\tif (room.settings.modjoin === 'autoconfirmed') throw new Chat.ErrorMessage(`Modjoin is already set to autoconfirmed.`);\r\n\t\t\troom.settings.modjoin = 'autoconfirmed';\r\n\t\t\tthis.add(`|raw|<div class=\"broadcast-red\"><strong>Moderated join is set to autoconfirmed!</strong><br />Users must be rank autoconfirmed or invited with <code>/invite</code> to join</div>`);\r\n\t\t\tthis.addModAction(`${user.name} set modjoin to autoconfirmed.`);\r\n\t\t\tthis.modlog('MODJOIN', null, 'autoconfirmed');\r\n\t\t} else if (Users.Auth.isAuthLevel(target) && !['\u203D', '!'].includes(target)) {\r\n\t\t\tif (room.battle && !user.can('makeroom') && !'+%'.includes(target)) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`/modjoin - Access denied from setting modjoin past % in battles.`);\r\n\t\t\t}\r\n\t\t\tif (room.settings.isPersonal && !user.can('makeroom') && !'+%'.includes(target)) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`/modjoin - Access denied from setting modjoin past % in group chats.`);\r\n\t\t\t}\r\n\t\t\tif (room.settings.modjoin === target) throw new Chat.ErrorMessage(`Modjoin is already set to ${target} in this room.`);\r\n\t\t\troom.settings.modjoin = target;\r\n\t\t\tthis.add(`|raw|<div class=\"broadcast-red\"><strong>This room is now invite only!</strong><br />Users must be rank ${target} or invited with <code>/invite</code> to join</div>`);\r\n\t\t\tthis.addModAction(`${user.name} set modjoin to ${target}.`);\r\n\t\t\tthis.modlog('MODJOIN', null, target);\r\n\t\t} else {\r\n\t\t\tthis.errorReply(`Unrecognized modjoin setting.`);\r\n\t\t\tvoid this.parse('/help modjoin');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\troom.saveSettings();\r\n\t\tif (target === 'sync' && !room.settings.modchat) {\r\n\t\t\tconst lowestGroup = Config.groupsranking.find(group => {\r\n\t\t\t\tconst groupInfo = Users.Auth.getGroup(group);\r\n\t\t\t\treturn (\r\n\t\t\t\t\tgroupInfo.symbol !== Users.Auth.defaultSymbol() &&\r\n\t\t\t\t\troom.auth.atLeast(user, group) &&\r\n\t\t\t\t\tUsers.Auth.isValidSymbol(groupInfo.symbol)\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t\tif (lowestGroup) void this.parse(`/modchat ${lowestGroup}`);\r\n\t\t}\r\n\t\tif (!room.settings.isPrivate) return this.parse('/hiddenroom');\r\n\t},\r\n\tmodjoinhelp: [\r\n\t\t`/modjoin [+|%|@|*|player|~|#|off] - Sets modjoin. Users lower than the specified rank can't join this room unless they have a room rank. Requires: \\u2606 # ~`,\r\n\t\t`/modjoin [sync|off] - Sets modjoin. Only users who can speak in modchat can join this room. Requires: \\u2606 # ~`,\r\n\t],\r\n\r\n\troomlanguage(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\treturn this.sendReply(`This room's primary language is ${Chat.languages.get(room.settings.language || '') || 'English'}`);\r\n\t\t}\r\n\t\tthis.checkCan('editroom', null, room);\r\n\r\n\t\tconst targetLanguage = toID(target);\r\n\t\tif (!Chat.languages.has(targetLanguage)) throw new Chat.ErrorMessage(`\"${target}\" is not a supported language.`);\r\n\r\n\t\troom.settings.language = targetLanguage === 'english' ? false : targetLanguage;\r\n\r\n\t\troom.saveSettings();\r\n\t\tthis.modlog(`LANGUAGE`, null, Chat.languages.get(targetLanguage));\r\n\t\tthis.sendReply(`The room's language has been set to ${Chat.languages.get(targetLanguage)}`);\r\n\t},\r\n\troomlanguagehelp: [\r\n\t\t`/roomlanguage [language] - Sets the the language for the room, which changes language of a few commands. Requires # ~`,\r\n\t\t`Supported Languages: English, Spanish, Italian, French, Simplified Chinese, Traditional Chinese, Japanese, Hindi, Turkish, Dutch, German.`,\r\n\t],\r\n\r\n\tslowchat(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\tconst slowchatSetting = (room.settings.slowchat || \"OFF\");\r\n\t\t\treturn this.sendReply(`Slow chat is currently set to: ${slowchatSetting}`);\r\n\t\t}\r\n\t\tthis.checkChat();\r\n\t\tthis.checkCan('modchat', null, room);\r\n\r\n\t\tlet targetInt = parseInt(target);\r\n\t\tif (this.meansNo(target)) {\r\n\t\t\tif (!room.settings.slowchat) throw new Chat.ErrorMessage(`Slow chat is already disabled in this room.`);\r\n\t\t\troom.settings.slowchat = false;\r\n\t\t} else if (targetInt) {\r\n\t\t\tif (!user.can('bypassall') && room.userCount < SLOWCHAT_USER_REQUIREMENT) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`This room must have at least ${SLOWCHAT_USER_REQUIREMENT} users to set slowchat; it only has ${room.userCount} right now.`);\r\n\t\t\t}\r\n\t\t\tif (room.settings.slowchat === targetInt) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`Slow chat is already set to ${room.settings.slowchat} seconds in this room.`);\r\n\t\t\t}\r\n\t\t\tif (targetInt < SLOWCHAT_MINIMUM) targetInt = SLOWCHAT_MINIMUM;\r\n\t\t\tif (targetInt > SLOWCHAT_MAXIMUM) targetInt = SLOWCHAT_MAXIMUM;\r\n\t\t\troom.settings.slowchat = targetInt;\r\n\t\t} else {\r\n\t\t\treturn this.parse(\"/help slowchat\");\r\n\t\t}\r\n\t\tconst slowchatSetting = (room.settings.slowchat || \"OFF\");\r\n\t\tthis.privateModAction(`${user.name} set slowchat to ${slowchatSetting}`);\r\n\t\tthis.modlog('SLOWCHAT', null, `${slowchatSetting}`);\r\n\t\troom.saveSettings();\r\n\t},\r\n\tslowchathelp: [\r\n\t\t`/slowchat [number] - Sets a limit on how often users in the room can send messages, between 2 and 60 seconds. Requires % @ # ~`,\r\n\t\t`/slowchat off - Disables slowchat in the room. Requires % @ # ~`,\r\n\t],\r\n\tpermission: 'permissions',\r\n\tpermissions: {\r\n\t\tclear: 'set',\r\n\t\tset(target, room, user) {\r\n\t\t\tconst [perm, displayRank] = this.splitOne(target);\r\n\t\t\troom = this.requireRoom();\r\n\t\t\tlet rank = displayRank;\r\n\t\t\tif (rank === 'default') rank = '';\r\n\t\t\tif (rank === 'all users') rank = Users.Auth.defaultSymbol();\r\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(`This room does not allow customizing permissions.`);\r\n\t\t\tif (!target || !perm) return this.parse(`/permissions help`);\r\n\t\t\tif (rank && rank !== 'whitelist' && !Config.groupsranking.includes(rank as EffectiveGroupSymbol)) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`${rank} is not a valid rank.`);\r\n\t\t\t}\r\n\t\t\tconst validPerms = Users.Auth.supportedRoomPermissions(room);\r\n\t\t\tconst sanitizedPerm = perm.replace('!', '/'); // handles ! commands so we don't have to add commands to the array twice\r\n\t\t\tif (!validPerms.some(p => (\r\n\t\t\t\t// we need to check the raw permissions also because broadcast permissions are listed with the !\r\n\t\t\t\tp === sanitizedPerm || p === perm ||\r\n\t\t\t\tp.startsWith(`${sanitizedPerm} `) || p.startsWith(`${perm} `)\r\n\t\t\t))) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`${perm} is not a valid room permission.`);\r\n\t\t\t}\r\n\t\t\tif (!room.auth.atLeast(user, '#')) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`/permissions set - You must be at least a Room Owner to set permissions.`);\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\tUsers.Auth.ROOM_PERMISSIONS.includes(perm as RoomPermission) &&\r\n\t\t\t\t!Users.Auth.hasPermission(user, perm, null, room)\r\n\t\t\t) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`/permissions set - You can't set the permission \"${perm}\" because you don't have it.`);\r\n\t\t\t}\r\n\r\n\t\t\tconst currentPermissions = room.settings.permissions || {};\r\n\t\t\tif (currentPermissions[perm] === (rank || undefined)) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`${perm} is already set to ${displayRank || 'default'}.`);\r\n\t\t\t}\r\n\r\n\t\t\tif (rank) {\r\n\t\t\t\tcurrentPermissions[perm] = rank as GroupSymbol;\r\n\t\t\t\troom.settings.permissions = currentPermissions;\r\n\t\t\t} else {\r\n\t\t\t\tdelete currentPermissions[perm];\r\n\t\t\t\tif (!Object.keys(currentPermissions).length) delete room.settings.permissions;\r\n\t\t\t}\r\n\t\t\troom.saveSettings();\r\n\r\n\t\t\tthis.modlog(`SETPERMISSION`, null, `${perm}: ${displayRank}`);\r\n\t\t\tthis.refreshPage(`permissions-${room.roomid}`);\r\n\t\t\treturn this.privateModAction(`${user.name} set the required rank for ${perm} to ${displayRank}.`);\r\n\t\t},\r\n\t\tsethelp: [\r\n\t\t\t`/permissions set [command], [rank symbol] - sets the required permission to use the command [command] to [rank]. Requires: # ~`,\r\n\t\t\t`/permissions clear [command] - resets the required permission to use the command [command] to the default. Requires: # ~`,\r\n\t\t],\r\n\t\tview(target, room, user) {\r\n\t\t\troom = this.requireRoom();\r\n\t\t\treturn this.parse(`/join view-permissions-${room.roomid}`);\r\n\t\t},\r\n\r\n\t\thelp: '',\r\n\t\t''(target, room, user) {\r\n\t\t\troom = this.requireRoom();\r\n\r\n\t\t\tconst allPermissions = Users.Auth.supportedRoomPermissions(room);\r\n\t\t\tconst permissionGroups = allPermissions.filter(perm => !perm.startsWith('/') && !perm.startsWith('!'));\r\n\t\t\tconst permissions = allPermissions.filter(perm => {\r\n\t\t\t\tconst handler = Chat.parseCommand(perm)?.handler;\r\n\t\t\t\tif (handler?.isPrivate && !user.can('lock')) return false;\r\n\t\t\t\treturn (perm.startsWith('/') || perm.startsWith('!')) && !perm.includes(' ');\r\n\t\t\t});\r\n\t\t\tconst subPermissions = allPermissions\r\n\t\t\t\t.filter(perm => (perm.startsWith('/') || perm.startsWith('!')) && perm.includes(' '))\r\n\t\t\t\t.filter(perm => {\r\n\t\t\t\t\tconst handler = Chat.parseCommand(perm)?.handler;\r\n\t\t\t\t\tif (handler?.isPrivate && !user.can('lock')) return false;\r\n\t\t\t\t\treturn (perm.startsWith('/') || perm.startsWith('!')) && perm.includes(' ');\r\n\t\t\t\t});\r\n\t\t\tconst subPermissionsByNamespace: { [k: string]: string[] } = {};\r\n\t\t\tfor (const perm of subPermissions) {\r\n\t\t\t\tconst [namespace] = perm.split(' ', 1);\r\n\t\t\t\tif (!subPermissionsByNamespace[namespace]) subPermissionsByNamespace[namespace] = [];\r\n\t\t\t\tsubPermissionsByNamespace[namespace].push(perm);\r\n\t\t\t}\r\n\r\n\t\t\tlet buffer = `<strong>Room permissions help:</strong><hr />`;\r\n\t\t\tbuffer += `<p><strong>Usage: </strong><br />`;\r\n\t\t\tbuffer += `<code>/permissions set [permission], [rank symbol]</code><br />`;\r\n\t\t\tbuffer += `<code>/permissions clear [permission]</code><br />`;\r\n\t\t\tbuffer += `<code>/permissions view</code></p>`;\r\n\t\t\tbuffer += `<p><strong>Group permissions:</strong> (will affect multiple commands or part of one command)<br />`;\r\n\t\t\tbuffer += `<code>` + permissionGroups.join(`</code> <code>`) + `</code></p>`;\r\n\t\t\tbuffer += `<p><details class=\"readmore\"><summary><strong>Single-command permissions:</strong> (will affect one command)</summary>`;\r\n\t\t\tbuffer += `Permissions starting with <code>!</code> are for broadcasting the command, not using it.<br />`;\r\n\t\t\tbuffer += `<code>` + permissions.join(`</code> <code>`) + `</code></details></p>`;\r\n\t\t\tbuffer += `<p><details class=\"readmore\"><summary><strong>Sub-commands:</strong> (will affect one sub-command, like /roomevents view)</summary>`;\r\n\t\t\tfor (const subPerms of Object.values(subPermissionsByNamespace)) {\r\n\t\t\t\tbuffer += `<br /><code>` + subPerms.join(`</code> <code>`) + `</code><br />`;\r\n\t\t\t}\r\n\t\t\tbuffer += `</details></p>`;\r\n\t\t\treturn this.sendReplyBox(buffer);\r\n\t\t},\r\n\t},\r\n\tstretching: 'stretchfilter',\r\n\tstretchingfilter: 'stretchfilter',\r\n\tstretchfilter(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\tconst stretchSetting = (room.settings.filterStretching ? \"ON\" : \"OFF\");\r\n\t\t\treturn this.sendReply(`This room's stretch filter is currently: ${stretchSetting}`);\r\n\t\t}\r\n\t\tthis.checkChat();\r\n\t\tthis.checkCan('editroom', null, room);\r\n\r\n\t\tif (this.meansYes(target)) {\r\n\t\t\tif (room.settings.filterStretching) throw new Chat.ErrorMessage(`This room's stretch filter is already ON`);\r\n\t\t\troom.settings.filterStretching = true;\r\n\t\t} else if (this.meansNo(target)) {\r\n\t\t\tif (!room.settings.filterStretching) throw new Chat.ErrorMessage(`This room's stretch filter is already OFF`);\r\n\t\t\troom.settings.filterStretching = false;\r\n\t\t} else {\r\n\t\t\treturn this.parse(\"/help stretchfilter\");\r\n\t\t}\r\n\t\tconst stretchSetting = (room.settings.filterStretching ? \"ON\" : \"OFF\");\r\n\t\tthis.privateModAction(`${user.name} turned the stretch filter ${stretchSetting}`);\r\n\t\tthis.modlog('STRETCH FILTER', null, stretchSetting);\r\n\t\troom.saveSettings();\r\n\t},\r\n\tstretchfilterhelp: [\r\n\t\t`/stretchfilter [on/off] - Toggles filtering messages in the room for stretchingggggggg. Requires # ~`,\r\n\t],\r\n\r\n\tcapitals: 'capsfilter',\r\n\tcapitalsfilter: 'capsfilter',\r\n\tcapsfilter(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\tconst capsSetting = (room.settings.filterCaps ? \"ON\" : \"OFF\");\r\n\t\t\treturn this.sendReply(`This room's caps filter is currently: ${capsSetting}`);\r\n\t\t}\r\n\t\tthis.checkChat();\r\n\t\tthis.checkCan('editroom', null, room);\r\n\r\n\t\tif (this.meansYes(target)) {\r\n\t\t\tif (room.settings.filterCaps) throw new Chat.ErrorMessage(`This room's caps filter is already ON`);\r\n\t\t\troom.settings.filterCaps = true;\r\n\t\t} else if (this.meansNo(target)) {\r\n\t\t\tif (!room.settings.filterCaps) throw new Chat.ErrorMessage(`This room's caps filter is already OFF`);\r\n\t\t\troom.settings.filterCaps = false;\r\n\t\t} else {\r\n\t\t\treturn this.parse(\"/help capsfilter\");\r\n\t\t}\r\n\t\tconst capsSetting = (room.settings.filterCaps ? \"ON\" : \"OFF\");\r\n\t\tthis.privateModAction(`${user.name} turned the caps filter ${capsSetting}`);\r\n\t\tthis.modlog('CAPS FILTER', null, capsSetting);\r\n\r\n\t\troom.saveSettings();\r\n\t},\r\n\tcapsfilterhelp: [`/capsfilter [on/off] - Toggles filtering messages in the room for EXCESSIVE CAPS. Requires # ~`],\r\n\r\n\temojis: 'emojifilter',\r\n\temoji: 'emojifilter',\r\n\temojifilter(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\tconst emojiSetting = (room.settings.filterEmojis ? \"ON\" : \"OFF\");\r\n\t\t\treturn this.sendReply(`This room's emoji filter is currently: ${emojiSetting}`);\r\n\t\t}\r\n\t\tthis.checkChat();\r\n\t\tthis.checkCan('editroom', null, room);\r\n\r\n\t\tif (this.meansYes(target)) {\r\n\t\t\tif (room.settings.filterEmojis) throw new Chat.ErrorMessage(`This room's emoji filter is already ON`);\r\n\t\t\troom.settings.filterEmojis = true;\r\n\t\t} else if (this.meansNo(target)) {\r\n\t\t\tif (!room.settings.filterEmojis) throw new Chat.ErrorMessage(`This room's emoji filter is already OFF`);\r\n\t\t\troom.settings.filterEmojis = false;\r\n\t\t} else {\r\n\t\t\treturn this.parse(\"/help emojifilter\");\r\n\t\t}\r\n\t\tconst emojiSetting = (room.settings.filterEmojis ? \"ON\" : \"OFF\");\r\n\t\tthis.privateModAction(`${user.name} turned the emoji filter ${emojiSetting}`);\r\n\t\tthis.modlog('EMOJI FILTER', null, emojiSetting);\r\n\r\n\t\troom.saveSettings();\r\n\t},\r\n\temojifilterhelp: [`/emojifilter [on/off] - Toggles filtering messages in the room for emojis. Requires # ~`],\r\n\r\n\tlinkfilter(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\treturn this.sendReply(\r\n\t\t\t\t`This room's link filter is currently: ${room.settings.filterEmojis ? \"ON\" : \"OFF\"}`\r\n\t\t\t);\r\n\t\t}\r\n\t\tthis.checkChat();\r\n\t\tthis.checkCan('editroom', null, room);\r\n\r\n\t\tif (this.meansYes(target)) {\r\n\t\t\tif (room.settings.filterLinks) throw new Chat.ErrorMessage(`This room's link filter is already ON`);\r\n\t\t\troom.settings.filterLinks = true;\r\n\t\t} else if (this.meansNo(target)) {\r\n\t\t\tif (!room.settings.filterLinks) throw new Chat.ErrorMessage(`This room's link filter is already OFF`);\r\n\t\t\troom.settings.filterLinks = false;\r\n\t\t} else {\r\n\t\t\treturn this.parse(\"/help linkfilter\");\r\n\t\t}\r\n\t\tconst setting = (room.settings.filterLinks ? \"ON\" : \"OFF\");\r\n\t\tthis.privateModAction(`${user.name} turned the link filter ${setting}`);\r\n\t\tthis.modlog('LINK FILTER', null, setting);\r\n\r\n\t\troom.saveSettings();\r\n\t},\r\n\tlinkfilterhelp: [`/linkfilter [on/off] - Toggles filtering messages in the room for links. Requires # ~`],\r\n\r\n\tbanwords: 'banword',\r\n\tbanword: {\r\n\t\tregexadd: 'add',\r\n\t\taddregex: 'add',\r\n\t\tadd(target, room, user, connection, cmd) {\r\n\t\t\troom = this.requireRoom();\r\n\t\t\tif (!target || target === ' ') return this.parse('/help banword');\r\n\t\t\tthis.checkCan('declare', null, room);\r\n\r\n\t\t\tconst regex = cmd.includes('regex');\r\n\t\t\tif (regex && !user.can('makeroom')) throw new Chat.ErrorMessage(\"Regex banwords are only allowed for administrators.\");\r\n\t\t\tif (!room.settings.banwords) room.settings.banwords = [];\r\n\t\t\t// Most of the regex code is copied from the client. TODO: unify them?\r\n\t\t\t// Regex banwords can have commas in the {1,5} pattern\r\n\t\t\tlet words = (regex ? target.match(/[^,]+(,\\d*}[^,]*)?/g)! : target.split(','))\r\n\t\t\t\t.map(word => word.replace(/\\n/g, '').trim()).filter(word => word.length > 0);\r\n\t\t\tif (!words || words.length === 0) return this.parse('/help banword');\r\n\r\n\t\t\t// Escape any character with a special meaning in regex\r\n\t\t\tif (!regex) {\r\n\t\t\t\twords = words.map(word => {\r\n\t\t\t\t\tif (/[\\\\^$*+?()|{}[\\]]/.test(word) && user.can('rangeban')) {\r\n\t\t\t\t\t\tthis.errorReply(`\"${word}\" might be a regular expression, did you mean \"/banword addregex\"?`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn Utils.escapeRegex(word);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t// PS adds a preamble to the banword regex that's 32 chars long\r\n\t\t\tlet banwordRegexLen = (room.banwordRegex instanceof RegExp) ? room.banwordRegex.source.length : 32;\r\n\t\t\tfor (const word of words) {\r\n\t\t\t\tChat.validateRegex(word);\r\n\t\t\t\tif (room.settings.banwords.includes(word)) throw new Chat.ErrorMessage(`${word} is already a banned phrase.`);\r\n\r\n\t\t\t\t// Banword strings are joined, so account for the first string not having the prefix\r\n\t\t\t\tbanwordRegexLen += (banwordRegexLen === 32) ? word.length : `|${word}`.length;\r\n\t\t\t\t// RegExp instances whose source is greater than or equal to\r\n\t\t\t\t// v8's RegExpMacroAssembler::kMaxRegister in length will crash\r\n\t\t\t\t// the server on compile. In this case, that would happen each\r\n\t\t\t\t// time a chat message gets tested for any banned phrases.\r\n\t\t\t\tif (banwordRegexLen >= (1 << 16 - 1)) {\r\n\t\t\t\t\tthrow new Chat.ErrorMessage(\"This room has too many banned phrases to add the ones given.\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (const word of words) {\r\n\t\t\t\troom.settings.banwords.push(word);\r\n\t\t\t}\r\n\t\t\troom.banwordRegex = null;\r\n\t\t\tif (words.length > 1) {\r\n\t\t\t\tthis.privateModAction(`The banwords ${words.map(w => `'${w}'`).join(', ')} were added by ${user.name}.`);\r\n\t\t\t\tthis.modlog('BANWORD', null, words.map(w => `'${w}'`).join(', '));\r\n\t\t\t\tthis.sendReply(`Banned phrases successfully added.`);\r\n\t\t\t} else {\r\n\t\t\t\tthis.privateModAction(`The banword '${words[0]}' was added by ${user.name}.`);\r\n\t\t\t\tthis.modlog('BANWORD', null, words[0]);\r\n\t\t\t\tthis.sendReply(`Banned phrase successfully added.`);\r\n\t\t\t}\r\n\t\t\tthis.sendReply(`The list is currently: ${room.settings.banwords.join(', ')}`);\r\n\t\t\troom.saveSettings();\r\n\t\t},\r\n\r\n\t\tdelete(target, room, user) {\r\n\t\t\troom = this.requireRoom();\r\n\t\t\tif (!target) return this.parse('/help banword');\r\n\t\t\tthis.checkCan('declare', null, room);\r\n\r\n\t\t\tif (!room.settings.banwords) throw new Chat.ErrorMessage(\"This room has no banned phrases.\");\r\n\r\n\t\t\tconst regexMatch = target.match(/[^,]+(,\\d*}[^,]*)?/g);\r\n\t\t\tif (!regexMatch) return this.parse('/help banword');\r\n\r\n\t\t\tconst words = regexMatch.map(word => word.replace(/\\n/g, '').trim()).filter(word => word.length > 0);\r\n\r\n\t\t\tfor (const word of words) {\r\n\t\t\t\tif (!room.settings.banwords.includes(word)) throw new Chat.ErrorMessage(`${word} is not a banned phrase in this room.`);\r\n\t\t\t}\r\n\r\n\t\t\troom.settings.banwords = room.settings.banwords.filter(w => !words.includes(w));\r\n\t\t\troom.banwordRegex = null;\r\n\t\t\tif (words.length > 1) {\r\n\t\t\t\tthis.privateModAction(`The banwords ${words.map(w => `'${w}'`).join(', ')} were removed by ${user.name}.`);\r\n\t\t\t\tthis.modlog('UNBANWORD', null, words.map(w => `'${w}'`).join(', '));\r\n\t\t\t\tthis.sendReply(`Banned phrases successfully deleted.`);\r\n\t\t\t} else {\r\n\t\t\t\tthis.privateModAction(`The banword '${words[0]}' was removed by ${user.name}.`);\r\n\t\t\t\tthis.modlog('UNBANWORD', null, words[0]);\r\n\t\t\t\tthis.sendReply(`Banned phrase successfully deleted.`);\r\n\t\t\t}\r\n\t\t\tif (!room.settings.banwords.length) room.settings.banwords = undefined;\r\n\t\t\tthis.sendReply(\r\n\t\t\t\troom.settings.banwords ?\r\n\t\t\t\t\t`The list is now: ${room.settings.banwords.join(', ')}` :\r\n\t\t\t\t\t`The list is now empty.`\r\n\t\t\t);\r\n\t\t\troom.saveSettings();\r\n\t\t},\r\n\r\n\t\tlist(target, room, user) {\r\n\t\t\troom = this.requireRoom();\r\n\t\t\tthis.checkCan('mute', null, room);\r\n\r\n\t\t\tif (!room.settings.banwords?.length) {\r\n\t\t\t\treturn this.sendReply(\"This room has no banned phrases.\");\r\n\t\t\t}\r\n\t\t\treturn this.sendReply(`Banned phrases in room ${room.roomid}: ${room.settings.banwords.join(', ')}`);\r\n\t\t},\r\n\r\n\t\t\"\"(target, room, user) {\r\n\t\t\treturn this.parse(\"/help banword\");\r\n\t\t},\r\n\t},\r\n\tbanwordhelp: [\r\n\t\t`/banword add [words] - Adds the comma-separated list of phrases to the banword list of the current room. Requires: # ~`,\r\n\t\t`/banword addregex [words] - Adds the comma-separated list of regular expressions to the banword list of the current room. Requires ~`,\r\n\t\t`/banword delete [words] - Removes the comma-separated list of phrases from the banword list. Requires: # ~`,\r\n\t\t`/banword list - Shows the list of banned words in the current room. Requires: % @ # ~`,\r\n\t],\r\n\r\n\tshowapprovals(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tthis.checkCan('declare', null, room);\r\n\t\ttarget = toID(target);\r\n\t\tif (!target) {\r\n\t\t\treturn this.sendReply(`Approvals are currently ${room.settings.requestShowEnabled ? `ENABLED` : `DISABLED`} for ${room}.`);\r\n\t\t}\r\n\t\tif (this.meansNo(target)) {\r\n\t\t\tif (!room.settings.requestShowEnabled) throw new Chat.ErrorMessage(`Approvals are already disabled.`);\r\n\t\t\troom.settings.requestShowEnabled = undefined;\r\n\t\t\tthis.privateModAction(`${user.name} disabled approvals in this room.`);\r\n\t\t} else if (this.meansYes(target)) {\r\n\t\t\tif (room.settings.requestShowEnabled) throw new Chat.ErrorMessage(`Approvals are already enabled.`);\r\n\t\t\troom.settings.requestShowEnabled = true;\r\n\t\t\tthis.privateModAction(`${user.name} enabled the use of media approvals in this room.`);\r\n\t\t\tif (!room.settings.permissions || room.settings.permissions['/show'] === '@') {\r\n\t\t\t\tthis.privateModAction(\r\n\t\t\t\t\t`Note: Due to this room's settings, Drivers aren't allowed to use /show directly, ` +\r\n\t\t\t\t\t`but will be able to request and approve each other's /requestshow`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthrow new Chat.ErrorMessage(`Unrecognized setting for approvals. Use 'on' or 'off'.`);\r\n\t\t}\r\n\t\troom.saveSettings();\r\n\t\treturn this.modlog(`SHOWAPPROVALS`, null, `${this.meansYes(target) ? `ON` : `OFF`}`);\r\n\t},\r\n\tshowapprovalshelp: [\r\n\t\t`/showapprovals [setting] - Enable or disable the use of media approvals in the current room.`,\r\n\t\t`Requires: # ~`,\r\n\t],\r\n\r\n\tshowmedia(target, room, user) {\r\n\t\tthis.errorReply(`/showmedia has been deprecated. Use /permissions instead.`);\r\n\t\treturn this.parse(`/help permissions`);\r\n\t},\r\n\r\n\thightraffic(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\treturn this.sendReply(`This room is: ${room.settings.highTraffic ? 'high' : 'low'} traffic`);\r\n\t\t}\r\n\t\tthis.checkCan('makeroom');\r\n\r\n\t\tif (this.meansYes(target)) {\r\n\t\t\troom.settings.highTraffic = true;\r\n\t\t} else if (this.meansNo(target)) {\r\n\t\t\troom.settings.highTraffic = undefined;\r\n\t\t} else {\r\n\t\t\treturn this.parse('/help hightraffic');\r\n\t\t}\r\n\t\troom.saveSettings();\r\n\t\tthis.modlog(`HIGHTRAFFIC`, null, `${!!room.settings.highTraffic}`);\r\n\t\tthis.addModAction(`This room was marked as ${room.settings.highTraffic ? 'high' : 'low'} traffic by ${user.name}.`);\r\n\t},\r\n\thightraffichelp: [\r\n\t\t`/hightraffic [on|off] - (Un)marks a room as a high traffic room. Requires ~`,\r\n\t\t`When a room is marked as high-traffic, PS requires all messages sent to that room to contain at least 2 letters.`,\r\n\t],\r\n\r\n\t/*********************************************************\r\n\t * Room management\r\n\t *********************************************************/\r\n\r\n\tmakeprivatechatroom: 'makechatroom',\r\n\tmakepublicchatroom: 'makechatroom',\r\n\tmakechatroom(target, room, user, connection, cmd) {\r\n\t\troom = this.requireRoom();\r\n\t\tthis.checkCan('makeroom');\r\n\t\tconst id = toID(target);\r\n\t\tif (!id || this.cmd === 'makechatroom') return this.parse('/help makechatroom');\r\n\t\tif (!Rooms.global.addChatRoom(target)) {\r\n\t\t\tthrow new Chat.ErrorMessage(`The room '${target}' already exists or it is using an invalid title.`);\r\n\t\t}\r\n\r\n\t\tconst targetRoom = Rooms.search(target);\r\n\t\tif (!targetRoom) throw new Error(`Error in room creation.`);\r\n\t\tif (cmd === 'makeprivatechatroom') {\r\n\t\t\tif (!targetRoom.persist) throw new Error(`Private chat room created without settings.`);\r\n\t\t\ttargetRoom.setPrivate(true);\r\n\t\t\tconst upperStaffRoom = Rooms.get('upperstaff');\r\n\t\t\tif (upperStaffRoom) {\r\n\t\t\t\tupperStaffRoom.add(`|raw|<div class=\"broadcast-green\">Private chat room created: <b>${Utils.escapeHTML(target)}</b></div>`).update();\r\n\t\t\t}\r\n\t\t\tthis.sendReply(`The private chat room '${target}' was created.`);\r\n\t\t} else {\r\n\t\t\tconst staffRoom = Rooms.get('staff');\r\n\t\t\tif (staffRoom) {\r\n\t\t\t\tstaffRoom.add(`|raw|<div class=\"broadcast-green\">Public chat room created: <b>${Utils.escapeHTML(target)}</b></div>`).update();\r\n\t\t\t}\r\n\t\t\tconst upperStaffRoom = Rooms.get('upperstaff');\r\n\t\t\tif (upperStaffRoom) {\r\n\t\t\t\tupperStaffRoom.add(`|raw|<div class=\"broadcast-green\">Public chat room created: <b>${Utils.escapeHTML(target)}</b></div>`).update();\r\n\t\t\t}\r\n\t\t\tthis.sendReply(`The chat room '${target}' was created.`);\r\n\t\t}\r\n\t},\r\n\tmakechatroomhelp: [\r\n\t\t`/makeprivatechatroom [roomname] - Creates a new private room named [roomname]. Requires: ~`,\r\n\t\t`/makepublicchatroom [roomname] - Creates a new public room named [roomname]. Requires: ~`,\r\n\t],\r\n\r\n\tsubroomgroupchat: 'makegroupchat',\r\n\tsrgc: 'makegroupchat',\r\n\tmgc: 'makegroupchat',\r\n\tmakegroupchat(target, room, user, connection, cmd) {\r\n\t\troom = this.requireRoom();\r\n\t\tthis.checkChat();\r\n\t\tif (!user.trusted) {\r\n\t\t\tthrow new Chat.ErrorMessage(\"You must be trusted (public room driver or global voice) to make a groupchat.\");\r\n\t\t}\r\n\r\n\t\tconst groupchatbanned = Punishments.isGroupchatBanned(user);\r\n\t\tif (groupchatbanned) {\r\n\t\t\tconst expireText = Punishments.checkPunishmentExpiration(groupchatbanned);\r\n\t\t\tthrow new Chat.ErrorMessage(`You are banned from using groupchats ${expireText}.`);\r\n\t\t}\r\n\r\n\t\tif (cmd === 'subroomgroupchat' || cmd === 'srgc') {\r\n\t\t\tif (!user.can('mute', null, room)) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(\"You can only create subroom groupchats for rooms you're staff in.\");\r\n\t\t\t}\r\n\t\t\tif (room.battle) throw new Chat.ErrorMessage(\"You cannot create a subroom of a battle.\");\r\n\t\t\tif (room.settings.isPersonal) throw new Chat.ErrorMessage(\"You cannot create a subroom of a groupchat.\");\r\n\t\t}\r\n\t\tconst parent = cmd === 'subroomgroupchat' || cmd === 'srgc' ? room.roomid : null;\r\n\t\t// this.checkCan('makegroupchat');\r\n\r\n\t\t// Title defaults to a random 8-digit number.\r\n\t\tlet title = target.trim();\r\n\t\tif (title.length >= 32) {\r\n\t\t\tthrow new Chat.ErrorMessage(\"Title must be under 32 characters long.\");\r\n\t\t} else if (!title) {\r\n\t\t\ttitle = (`${Math.floor(Math.random() * 100000000)}`);\r\n\t\t} else if (this.filter(title) !== title) {\r\n\t\t\tthrow new Chat.ErrorMessage(\"Invalid title.\");\r\n\t\t}\r\n\t\t// `,` is a delimiter used by a lot of /commands\r\n\t\t// `|` and `[` are delimiters used by the protocol\r\n\t\t// `-` has special meaning in roomids\r\n\t\tif (title.includes(',') || title.includes('|') || title.includes('[') || title.includes('-')) {\r\n\t\t\tthrow new Chat.ErrorMessage(\"Room titles can't contain any of: ,|[-\");\r\n\t\t}\r\n\r\n\t\t// Even though they're different namespaces, to cut down on confusion, you\r\n\t\t// can't share names with registered chatrooms.\r\n\t\tconst existingRoom = Rooms.search(toID(title));\r\n\t\tif (existingRoom && !existingRoom.settings.modjoin) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Your group chat name is too similar to existing chat room '${title}'.`);\r\n\t\t}\r\n\t\t// Room IDs for groupchats are groupchat-TITLEID\r\n\t\tlet titleid = toID(title);\r\n\t\tif (!titleid) {\r\n\t\t\ttitleid = `${Math.floor(Math.random() * 100000000)}` as ID;\r\n\t\t}\r\n\t\tconst roomid = `groupchat-${parent || user.id}-${titleid}` as RoomID;\r\n\t\t// Titles must be unique.\r\n\t\tif (Rooms.search(roomid)) throw new Chat.ErrorMessage(`A group chat named '${title}' already exists.`);\r\n\t\t// Tab title is prefixed with '[G]' to distinguish groupchats from\r\n\t\t// registered chatrooms\r\n\r\n\t\tif (Monitor.countGroupChat(connection.ip)) {\r\n\t\t\tthrow new Chat.ErrorMessage(\"Due to high load, you are limited to creating 4 group chats every hour.\");\r\n\t\t}\r\n\r\n\t\tconst titleMsg = Utils.html`Welcome to ${parent ? room.title : user.name}'s` +\r\n\t\t\tUtils.html`${!/^[0-9]+$/.test(title) ? ` ${title}` : ''}${parent ? ' subroom' : ''} groupchat!`;\r\n\t\tconst targetRoom = Rooms.createChatRoom(roomid, `[G] ${title}`, {\r\n\t\t\tisPersonal: true,\r\n\t\t\tisPrivate: 'hidden',\r\n\t\t\tcreationTime: Date.now(),\r\n\t\t\tmodjoin: parent ? null : '+',\r\n\t\t\tparentid: parent,\r\n\t\t\tauth: {},\r\n\t\t\tintroMessage: `` +\r\n\t\t\t\t`<div style=\"text-align: center\"><table style=\"margin:auto;\"><tr><td><img src=\"//${Config.routes.client}/fx/groupchat.png\" width=120 height=100></td><td><h2>${titleMsg}</h2><p>Follow the <a href=\"/rules\">Pok\u00E9mon Showdown Global Rules</a>!<br>Don't be disruptive to the rest of the site.</p></td></tr></table></div>`,\r\n\t\t\tstaffMessage: `` +\r\n\t\t\t\t`<p>Groupchats are temporary rooms, and will expire if there hasn't been any activity in 40 minutes.</p><p>You can invite new users using <code>/invite</code>. Be careful with who you invite!</p><p>Commands: <button class=\"button\" name=\"send\" value=\"/roomhelp\">Room Management</button> | <button class=\"button\" name=\"send\" value=\"/roomsettings\">Room Settings</button> | <button class=\"button\" name=\"send\" value=\"/tournaments help\">Tournaments</button></p><p>As creator of this groupchat, <u>you are entirely responsible for what occurs in this chatroom</u>. Global rules apply at all times.</p><p>If this room is used to break global rules or disrupt other areas of the server, <strong>you as the creator will be held accountable and punished</strong>.</p>`,\r\n\t\t});\r\n\t\tif (!targetRoom) {\r\n\t\t\tthrow new Chat.ErrorMessage(`An unknown error occurred while trying to create the room '${title}'.`);\r\n\t\t}\r\n\t\t// The creator is a Room Owner in subroom groupchats and a Host otherwise..\r\n\t\ttargetRoom.auth.set(user.id, parent ? '#' : Users.HOST_SYMBOL);\r\n\t\t// Join after creating room. No other response is given.\r\n\t\tuser.joinRoom(targetRoom.roomid);\r\n\t\tuser.popup(`You've just made a groupchat; it is now your responsibility, regardless of whether or not you actively partake in the room. For more info, read your groupchat's staff intro.`);\r\n\t\tif (parent) this.modlog('SUBROOMGROUPCHAT', null, title);\r\n\t},\r\n\tmakegroupchathelp: [\r\n\t\t`/makegroupchat [roomname] - Creates an invite-only group chat named [roomname].`,\r\n\t\t`/subroomgroupchat [roomname] - Creates a subroom groupchat of the current room. Can only be used in a public room you have staff in.`,\r\n\t\t`Only users who are staff in a public room or global auth can make groupchats.`,\r\n\t],\r\n\tgroupchatuptime: 'roomuptime',\r\n\troomuptime(target, room, user, connection, cmd) {\r\n\t\tif (!this.runBroadcast()) return;\r\n\t\tif (!room) throw new Chat.ErrorMessage(`Can only be used in a room.`);\r\n\r\n\t\t// for hotpatching\r\n\t\tif (!room.settings.creationTime) room.settings.creationTime = Date.now();\r\n\t\tconst uptime = Chat.toDurationString(Date.now() - room.settings.creationTime);\r\n\t\tthis.sendReplyBox(`Room uptime: <b>${uptime}</b>`);\r\n\t},\r\n\troomuptimehelp: [`/roomuptime - Displays the uptime of the room.`],\r\n\r\n\tderegisterchatroom(target, room, user) {\r\n\t\tthis.checkCan('makeroom');\r\n\t\tthis.errorReply(\"NOTE: You probably want to use `/deleteroom` now that it exists.\");\r\n\t\tconst id = toID(target);\r\n\t\tif (!id) return this.parse('/help deregisterchatroom');\r\n\t\tconst targetRoom = Rooms.search(id);\r\n\t\tif (!targetRoom) throw new Chat.ErrorMessage(`The room '${target}' doesn't exist.`);\r\n\t\ttarget = targetRoom.title || targetRoom.roomid;\r\n\t\tconst isPrivate = targetRoom.settings.isPrivate;\r\n\t\tconst staffRoom = Rooms.get('staff');\r\n\t\tconst upperStaffRoom = Rooms.get('upperstaff');\r\n\t\tif (Rooms.global.deregisterChatRoom(id)) {\r\n\t\t\tthis.sendReply(`The room '${target}' was deregistered.`);\r\n\t\t\tthis.sendReply(\"It will be deleted as of the next server restart.\");\r\n\t\t\ttarget = Utils.escapeHTML(target);\r\n\t\t\tif (isPrivate) {\r\n\t\t\t\tif (upperStaffRoom) {\r\n\t\t\t\t\tupperStaffRoom.add(`|raw|<div class=\"broadcast-red\">Private chat room deregistered by ${user.id}: <b>${target}</b></div>`).update();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (staffRoom) {\r\n\t\t\t\t\tstaffRoom.add(`|raw|<div class=\"broadcast-red\">Public chat room deregistered: <b>${target}</b></div>`).update();\r\n\t\t\t\t}\r\n\t\t\t\tif (upperStaffRoom) {\r\n\t\t\t\t\tupperStaffRoom.add(`|raw|<div class=\"broadcast-red\">Public chat room deregistered by ${user.id}: <b>${target}</b></div>`).update();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthrow new Chat.ErrorMessage(`The room \"${target}\" isn't registered.`);\r\n\t},\r\n\tderegisterchatroomhelp: [\r\n\t\t`/deregisterchatroom [roomname] - Deletes room [roomname] after the next server restart. Requires: ~`,\r\n\t],\r\n\r\n\tdeletechatroom: 'deleteroom',\r\n\tdeletegroupchat: 'deleteroom',\r\n\tdgc: 'deleteroom',\r\n\tdeleteroom(target, room, user, connection, cmd) {\r\n\t\troom = this.requireRoom();\r\n\t\tconst roomid = target.trim();\r\n\t\tif (!roomid) {\r\n\t\t\t// allow deleting personal rooms without typing out the room name\r\n\t\t\tif (!room.settings.isPersonal || !['deletegroupchat', 'dgc'].includes(cmd)) {\r\n\t\t\t\treturn this.parse(`/help deleteroom`);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst targetRoom = Rooms.search(roomid);\r\n\t\t\tif (targetRoom !== room) {\r\n\t\t\t\treturn this.parse(`/help deleteroom`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (room.roomid.startsWith('groupchat-')) {\r\n\t\t\tthis.checkCan('gamemanagement', null, room);\r\n\t\t} else {\r\n\t\t\tthis.checkCan('makeroom');\r\n\t\t}\r\n\r\n\t\tconst title = room.title || room.roomid;\r\n\r\n\t\tif (room.persist) {\r\n\t\t\tif (room.settings.isPrivate) {\r\n\t\t\t\tconst upperStaffRoom = Rooms.get('upperstaff');\r\n\t\t\t\tif (upperStaffRoom) {\r\n\t\t\t\t\tupperStaffRoom.add(\r\n\t\t\t\t\t\tUtils.html`|raw|<div class=\"broadcast-red\">Private chat room ` +\r\n\t\t\t\t\t\t`deleted by ${user.id}: <b>${title}</b></div>`\r\n\t\t\t\t\t).update();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst staffRoom = Rooms.get('staff');\r\n\t\t\t\tif (staffRoom) {\r\n\t\t\t\t\tstaffRoom.add(Utils.html`|raw|<div class=\"broadcast-red\">Public chat room deleted: <b>${title}</b></div>`).update();\r\n\t\t\t\t}\r\n\t\t\t\tconst upperStaffRoom = Rooms.get('upperstaff');\r\n\t\t\t\tif (upperStaffRoom) {\r\n\t\t\t\t\tupperStaffRoom.add(\r\n\t\t\t\t\t\tUtils.html`|raw|<div class=\"broadcast-red\">Public chat ` +\r\n\t\t\t\t\t\t`room deleted by ${user.id}: <b>${title}</b></div>`\r\n\t\t\t\t\t).update();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\troom.add(`|raw|<div class=\"broadcast-red\"><b>This room has been deleted.</b></div>`);\r\n\t\troom.update();\r\n\t\troom.send(`|expire|This room has been deleted.`);\r\n\t\troom.destroy();\r\n\t},\r\n\tdeleteroomhelp: [\r\n\t\t`/deleteroom [roomname] - Deletes room [roomname]. Must be typed in the room to delete. Requires: ~`,\r\n\t\t`/deletegroupchat - Deletes the current room, if it's a groupchat. Requires: \u2605 # ~`,\r\n\t],\r\n\r\n\trename() {\r\n\t\tthrow new Chat.ErrorMessage(\"Did you mean /renameroom?\");\r\n\t},\r\n\trenamegroupchat: 'renameroom',\r\n\trenameroom(target, room, user, connection, cmd) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (room.game || room.minorActivity || room.tour) {\r\n\t\t\tthrow new Chat.ErrorMessage(\"Cannot rename room while a tour/poll/game is running.\");\r\n\t\t}\r\n\t\tif (room.battle) {\r\n\t\t\tthrow new Chat.ErrorMessage(\"Cannot rename battle rooms.\");\r\n\t\t}\r\n\t\tconst oldTitle = room.title;\r\n\t\tconst isGroupchat = cmd === 'renamegroupchat';\r\n\t\tif (!toID(target)) return this.parse(\"/help renameroom\");\r\n\t\tif (room.persist && isGroupchat) throw new Chat.ErrorMessage(`This isn't a groupchat.`);\r\n\t\tif (!room.persist && !isGroupchat) throw new Chat.ErrorMessage(`Use /renamegroupchat instead.`);\r\n\t\tif (isGroupchat) {\r\n\t\t\tif (!user.can('lock')) this.checkCan('declare', null, room);\r\n\t\t\tconst existingRoom = Rooms.search(toID(target));\r\n\t\t\tif (existingRoom && !existingRoom.settings.modjoin) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`Your groupchat name is too similar to existing chat room '${existingRoom.title}'.`);\r\n\t\t\t}\r\n\t\t\tif (this.filter(target) !== target) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(\"Invalid title.\");\r\n\t\t\t}\r\n\t\t\t// `,` is a delimiter used by a lot of /commands\r\n\t\t\t// `|` and `[` are delimiters used by the protocol\r\n\t\t\t// `-` has special meaning in roomids\r\n\t\t\tif (target.includes(',') || target.includes('|') || target.includes('[') || target.includes('-')) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(\"Room titles can't contain any of: ,|[-\");\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.checkCan('makeroom');\r\n\t\t}\r\n\t\tconst creatorID = room.roomid.split('-')[1];\r\n\t\tconst id = isGroupchat ? `groupchat-${creatorID}-${toID(target)}` as RoomID : undefined;\r\n\t\tconst title = isGroupchat ? `[G] ${target}` : target;\r\n\t\tconst oldID = room.roomid;\r\n\r\n\t\troom.rename(title, id);\r\n\r\n\t\tChat.handleRoomRename(oldID, id || toID(target) as RoomID, room);\r\n\r\n\t\tthis.modlog(`RENAME${isGroupchat ? 'GROUPCHAT' : 'ROOM'}`, null, `from ${oldTitle}`);\r\n\t\tconst privacy = room.settings.isPrivate === true ? \"Private\" :\r\n\t\t\t!room.settings.isPrivate ? \"Public\" :\r\n\t\t\t`${room.settings.isPrivate.charAt(0).toUpperCase()}${room.settings.isPrivate.slice(1)}`;\r\n\t\tif (!isGroupchat) {\r\n\t\t\tRooms.global.notifyRooms(\r\n\t\t\t\troom.settings.isPrivate === true ? ['upperstaff'] : ['upperstaff', 'staff'],\r\n\t\t\t\tUtils.html`|raw|<div class=\"broadcast-green\">${privacy} chat room <b>${oldTitle}</b> renamed to <b>${target}</b></div>`\r\n\t\t\t);\r\n\t\t}\r\n\t\troom.add(Utils.html`|raw|<div class=\"broadcast-green\">The room has been renamed to <b>${target}</b></div>`).update();\r\n\t},\r\n\trenameroomhelp: [`/renameroom [new title] - Renames the current room to [new title]. Case-sensitive. Requires ~`],\r\n\r\n\thideroom: 'privateroom',\r\n\thiddenroom: 'privateroom',\r\n\tsecretroom: 'privateroom',\r\n\tpublicroom: 'privateroom',\r\n\tunlistroom: 'privateroom',\r\n\tprivateroom(target, room, user, connection, cmd) {\r\n\t\troom = this.requireRoom();\r\n\t\tconst battle = room.battle || room.bestOf;\r\n\t\tif (battle) {\r\n\t\t\tthis.checkCan('editprivacy', null, room);\r\n\t\t\tif (battle.forcedSettings.privacy) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`This battle is required to be public because a player has a name prefixed by '${battle.forcedSettings.privacy}'.`);\r\n\t\t\t}\r\n\t\t\tif (room.tour?.forcePublic) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`This battle can't be hidden, because the tournament is set to be forced public.`);\r\n\t\t\t}\r\n\t\t} else if (room.settings.isPersonal) {\r\n\t\t\tthis.checkCan('editroom', null, room);\r\n\t\t} else {\r\n\t\t\t// registered chatrooms show up on the room list and so require\r\n\t\t\t// higher permissions to modify privacy settings\r\n\t\t\tthis.checkCan('makeroom');\r\n\t\t}\r\n\t\tlet setting: boolean | 'hidden' | 'unlisted';\r\n\t\tswitch (cmd) {\r\n\t\tcase 'privateroom':\r\n\t\t\treturn this.parse('/help privateroom');\r\n\t\tcase 'publicroom':\r\n\t\t\tsetting = false;\r\n\t\t\tbreak;\r\n\t\tcase 'secretroom':\r\n\t\t\tthis.checkCan('rangeban');\r\n\t\t\tsetting = true;\r\n\t\t\tbreak;\r\n\t\tcase 'unlistroom':\r\n\t\t\tthis.checkCan('rangeban');\r\n\t\t\tsetting = 'unlisted';\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tif (room.settings.isPrivate === true && target !== 'force') {\r\n\t\t\t\treturn this.sendReply(`This room is a secret room. Use \"/publicroom\" to make it public, or \"/hiddenroom force\" to force it hidden.`);\r\n\t\t\t}\r\n\t\t\tsetting = 'hidden';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif (this.meansNo(target)) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Please specify what privacy setting you want for this room: /hiddenroom, /secretroom, or /publicroom`);\r\n\t\t}\r\n\r\n\t\tif (!setting) {\r\n\t\t\tif (!room.settings.isPrivate) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`This room is already public.`);\r\n\t\t\t}\r\n\t\t\tif (room.parent?.settings.isPrivate) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`This room's parent ${room.parent.title} must be public for this room to be public.`);\r\n\t\t\t}\r\n\t\t\tif (room.settings.isPersonal && !battle) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`This room can't be made public.`);\r\n\t\t\t}\r\n\t\t\tif (room.privacySetter && user.can('nooverride', null, room) && !user.can('makeroom')) {\r\n\t\t\t\tif (!room.privacySetter.has(user.id)) {\r\n\t\t\t\t\tconst privacySetters = [...room.privacySetter].join(', ');\r\n\t\t\t\t\tthrow new Chat.ErrorMessage(`You can't make the room public since you didn't make it private - only ${privacySetters} can.`);\r\n\t\t\t\t}\r\n\t\t\t\troom.privacySetter.delete(user.id);\r\n\t\t\t\tif (room.privacySetter.size) {\r\n\t\t\t\t\tconst privacySetters = [...room.privacySetter].join(', ');\r\n\t\t\t\t\treturn this.sendReply(`You are no longer forcing the room to stay private, but ${privacySetters} also need${Chat.plural(room.privacySetter, \"\", \"s\")} to use /publicroom to make the room public.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\troom.privacySetter = null;\r\n\t\t\tthis.addModAction(`${user.name} made this room public.`);\r\n\t\t\tthis.modlog('PUBLICROOM');\r\n\t\t\troom.setPrivate(false);\r\n\t\t} else {\r\n\t\t\tconst settingName = (setting === true ? 'secret' : setting);\r\n\t\t\tif (room.subRooms && !room.bestOf) {\r\n\t\t\t\tif (settingName === 'secret') throw new Chat.ErrorMessage(\"Secret rooms cannot have subrooms.\");\r\n\t\t\t\tfor (const subRoom of room.subRooms.values()) {\r\n\t\t\t\t\tif (!subRoom.settings.isPrivate) {\r\n\t\t\t\t\t\tthrow new Chat.ErrorMessage(`Subroom ${subRoom.title} must be private to make this room private.`);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (room.settings.isPrivate === setting) {\r\n\t\t\t\tif (room.privacySetter && !room.privacySetter.has(user.id)) {\r\n\t\t\t\t\troom.privacySetter.add(user.id);\r\n\t\t\t\t\treturn this.sendReply(`This room is already ${settingName}, but is now forced to stay that way until you use /publicroom.`);\r\n\t\t\t\t}\r\n\t\t\t\tthrow new Chat.ErrorMessage(`This room is already ${settingName}.`);\r\n\t\t\t}\r\n\t\t\tthis.addModAction(`${user.name} made this room ${settingName}.`);\r\n\t\t\tthis.modlog(`${settingName.toUpperCase()}ROOM`);\r\n\t\t\tif (!room.settings.isPersonal && !battle) room.setSection();\r\n\t\t\troom.setPrivate(setting);\r\n\t\t\troom.privacySetter = new Set([user.id]);\r\n\t\t}\r\n\t},\r\n\tprivateroomhelp: [\r\n\t\t`/secretroom - Makes a room secret. Secret rooms are visible to ~ and up. Requires: ~`,\r\n\t\t`/hiddenroom [on/off] - Makes a room hidden. Hidden rooms are visible to % and up, and inherit global ranks. Requires: \\u2606 ~`,\r\n\t\t`/publicroom - Makes a room public. Requires: \\u2606 ~`,\r\n\t],\r\n\r\n\thidenext(target, room, user) {\r\n\t\tconst groupConfig = Config.groups[Users.PLAYER_SYMBOL];\r\n\t\tif (!groupConfig?.editprivacy) throw new Chat.ErrorMessage(`/hidenext - Access denied.`);\r\n\t\tif (this.meansNo(target)) {\r\n\t\t\tuser.battleSettings.hidden = false;\r\n\t\t\tuser.update();\r\n\t\t\tthis.sendReply(\"Your next battle will be publicly visible.\");\r\n\t\t} else {\r\n\t\t\tuser.battleSettings.hidden = true;\r\n\t\t\tuser.update();\r\n\t\t\tthis.sendReply(`Your next battle will be hidden${Rooms.RoomBattle.battleForcedSetting(user, 'privacy') ? `, unless it is rated` : ``}.`);\r\n\t\t}\r\n\t},\r\n\thidenexthelp: [\r\n\t\t`/hidenext - Sets your next battle to be hidden.`,\r\n\t\t`/hidenext off - Sets your next battle to be publicly visible.`,\r\n\t],\r\n\r\n\tofficialchatroom: 'officialroom',\r\n\tofficialroom() {\r\n\t\tthis.parse(`/setroomsection official`);\r\n\t},\r\n\r\n\troomspotlight(target, room, user) {\r\n\t\tthis.checkCan('makeroom');\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) return this.parse(`/help roomspotlight`);\r\n\t\tif (!room.persist) {\r\n\t\t\tthrow new Chat.ErrorMessage(`/roomspotlight - You can't spotlight this room.`);\r\n\t\t}\r\n\t\tif (this.meansNo(target)) {\r\n\t\t\tif (!room.settings.spotlight) throw new Chat.ErrorMessage(`This chatroom is not being spotlighted.`);\r\n\t\t\tthis.addModAction(`${user.name} removed this chatroom from the spotlight.`);\r\n\t\t\tthis.globalModlog('UNSPOTLIGHT');\r\n\t\t\tdelete room.settings.spotlight;\r\n\t\t\troom.saveSettings();\r\n\t\t} else {\r\n\t\t\tif (room.settings.spotlight === target) throw new Chat.ErrorMessage(\"This chat room is already spotlighted.\");\r\n\t\t\tthis.addModAction(`${user.name} spotlighted this room with the message \"${target}\".`);\r\n\t\t\tthis.globalModlog('SPOTLIGHT');\r\n\t\t\troom.settings.spotlight = target;\r\n\t\t\troom.saveSettings();\r\n\t\t}\r\n\t},\r\n\troomspotlighthelp: [\r\n\t\t`/roomspotlight [spotlight] - Makes the room this command is used in a spotlight room for the [spotlight] category on the roomlist. Requires: ~`,\r\n\t\t`/roomspotlight off - Removes the room this command is used in from the list of spotlight rooms. Requires: ~`,\r\n\t],\r\n\r\n\tsetsubroom: 'subroom',\r\n\tsubroom(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!user.can('makeroom')) throw new Chat.ErrorMessage(`/subroom - Access denied. Did you mean /subrooms?`);\r\n\t\tif (!target) return this.parse('/help subroom');\r\n\r\n\t\tif (!room.persist) throw new Chat.ErrorMessage(`Temporary rooms cannot be subrooms.`);\r\n\t\tif (room.parent) {\r\n\t\t\tthrow new Chat.ErrorMessage(`This room is already a subroom. To change which room this subroom belongs to, remove the subroom first.`);\r\n\t\t}\r\n\t\tif (room.subRooms) {\r\n\t\t\tthrow new Chat.ErrorMessage(`This room is already a parent room, and a parent room cannot be made as a subroom.`);\r\n\t\t}\r\n\r\n\t\tconst parent = Rooms.search(target);\r\n\r\n\t\tif (!parent) throw new Chat.ErrorMessage(`The room '${target}' does not exist.`);\r\n\t\tif (parent.type !== 'chat') throw new Chat.ErrorMessage(`Parent room '${target}' must be a chat room.`);\r\n\t\tif (parent.parent) throw new Chat.ErrorMessage(`Subrooms cannot have subrooms.`);\r\n\t\tif (parent.settings.isPrivate === true) throw new Chat.ErrorMessage(`Only public and hidden rooms can have subrooms.`);\r\n\t\tif (parent.settings.isPrivate && !room.settings.isPrivate) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Private rooms cannot have public subrooms.`);\r\n\t\t}\r\n\t\tif (!parent.persist) throw new Chat.ErrorMessage(`Temporary rooms cannot be parent rooms.`);\r\n\t\tif (room === parent) throw new Chat.ErrorMessage(`You cannot set a room to be a subroom of itself.`);\r\n\r\n\t\tconst settingsList = Rooms.global.settingsList;\r\n\r\n\t\tconst parentIndex = settingsList.findIndex(r => r.title === parent.title);\r\n\t\tconst index = settingsList.findIndex(r => r.title === room.title);\r\n\r\n\t\t// Ensure that the parent room gets loaded before the subroom.\r\n\t\tif (parentIndex > index) {\r\n\t\t\t[settingsList[parentIndex], settingsList[index]] = [settingsList[index], settingsList[parentIndex]];\r\n\t\t}\r\n\r\n\t\troom.setParent(parent);\r\n\r\n\t\tthis.modlog('SUBROOM', null, `of ${parent.title}`);\r\n\t\treturn this.addModAction(`This room was set as a subroom of ${parent.title} by ${user.name}.`);\r\n\t},\r\n\r\n\tremovesubroom: 'unsubroom',\r\n\tdesubroom: 'unsubroom',\r\n\tunsubroom(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tthis.checkCan('makeroom');\r\n\t\tif (!room.parent || !room.persist) {\r\n\t\t\tthrow new Chat.ErrorMessage(`This room is not currently a subroom of a public room.`);\r\n\t\t}\r\n\r\n\t\troom.setParent(null);\r\n\r\n\t\tthis.modlog('UNSUBROOM');\r\n\t\treturn this.addModAction(`This room was unset as a subroom by ${user.name}.`);\r\n\t},\r\n\tunsubroomhelp: [`/unsubroom - Unmarks the current room as a subroom. Requires: ~`],\r\n\r\n\tparentroom: 'subrooms',\r\n\tsubrooms(target, room, user, connection, cmd) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (cmd === 'parentroom') {\r\n\t\t\tif (!room.parent) throw new Chat.ErrorMessage(`This room is not a subroom.`);\r\n\t\t\treturn this.sendReply(`This is a subroom of ${room.parent.title}.`);\r\n\t\t}\r\n\t\tif (!room.persist) throw new Chat.ErrorMessage(`Temporary rooms cannot have subrooms.`);\r\n\r\n\t\tif (!this.runBroadcast()) return;\r\n\r\n\t\tconst showSecret = !this.broadcasting && user.can('mute', null, room);\r\n\r\n\t\tconst subRooms = room.getSubRooms(showSecret);\r\n\r\n\t\tif (!subRooms.length) return this.sendReply(`This room doesn't have any subrooms.`);\r\n\r\n\t\tconst subRoomText = subRooms.map(\r\n\t\t\tsubRoom =>\r\n\t\t\t\tUtils.html`<a href=\"/${subRoom.roomid}\">${subRoom.title}</a><br/><small>${subRoom.settings.desc}</small>`\r\n\t\t);\r\n\r\n\t\treturn this.sendReplyBox(`<p style=\"font-weight:bold;\">${Utils.escapeHTML(room.title)}'s subroom${Chat.plural(subRooms)}:</p><ul><li>${subRoomText.join('</li><br/><li>')}</li></ul></strong>`);\r\n\t},\r\n\r\n\tsubroomhelp: [\r\n\t\t`/subroom [room] - Marks the current room as a subroom of [room]. Requires: ~`,\r\n\t\t`/unsubroom - Unmarks the current room as a subroom. Requires: ~`,\r\n\t\t`/subrooms - Displays the current room's subrooms.`,\r\n\t\t`/parentroom - Displays the current room's parent room.`,\r\n\t],\r\n\r\n\troomdesc(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\tif (!this.runBroadcast()) return;\r\n\t\t\tif (!room.settings.desc) return this.sendReply(`This room does not have a description set.`);\r\n\t\t\tthis.sendReplyBox(Utils.html`The room description is: ${room.settings.desc}`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.checkCan('makeroom');\r\n\t\tif (target.length > 80) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Error: Room description is too long (must be at most 80 characters).`);\r\n\t\t}\r\n\t\tconst normalizedTarget = ' ' + target.toLowerCase().replace(/[^a-z0-9]+/g, ' ').trim() + ' ';\r\n\r\n\t\tif (normalizedTarget.includes(' welcome ')) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Error: Room description must not contain the word \"welcome\".`);\r\n\t\t}\r\n\t\tif (normalizedTarget.startsWith(' discuss ')) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Error: Room description must not start with the word \"discuss\".`);\r\n\t\t}\r\n\t\tif (normalizedTarget.startsWith(' talk about ') || normalizedTarget.startsWith(' talk here about ')) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Error: Room description must not start with the phrase \"talk about\".`);\r\n\t\t}\r\n\r\n\t\troom.settings.desc = target;\r\n\t\tthis.sendReply(`(The room description is now: ${target})`);\r\n\r\n\t\tthis.privateModAction(`${user.name} changed the roomdesc to: \"${target}\".`);\r\n\t\tthis.modlog('ROOMDESC', null, `to \"${target}\"`);\r\n\t\troom.saveSettings();\r\n\t},\r\n\troomdeschelp: [`/roomdesc [description] - Sets the [description] of the current room. Requires: ~`],\r\n\r\n\ttopic: 'roomintro',\r\n\troomintro(target, room, user, connection, cmd) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\tif (!this.runBroadcast()) return;\r\n\t\t\tif (!room.settings.introMessage) return this.sendReply(\"This room does not have an introduction set.\");\r\n\t\t\tthis.sendReply('|raw|<div class=\"infobox infobox-limited\">' + room.settings.introMessage.replace(/\\n/g, '') + '</div>');\r\n\t\t\tif (!this.broadcasting && user.can('declare', null, room, 'roomintro') && cmd !== 'topic') {\r\n\t\t\t\tconst code = Utils.escapeHTML(room.settings.introMessage).replace(/\\n/g, '<br />');\r\n\t\t\t\tthis.sendReplyBox(`<details open><summary>Source:</summary><code style=\"white-space: pre-wrap; display: table; tab-size: 3\">/roomintro ${code}</code></details>`);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.checkCan('editroom', null, room);\r\n\t\tif (this.meansNo(target) || target === 'delete') throw new Chat.ErrorMessage('Did you mean \"/deleteroomintro\"?');\r\n\t\tthis.checkHTML(target);\r\n\t\tif (!target.includes(\"<\")) {\r\n\t\t\t// not HTML, do some simple URL linking\r\n\t\t\tconst re = /(https?:\\/\\/(([\\w.-]+)+(:\\d+)?(\\/([\\w/_.]*(\\?\\S+)?)?)?))/g;\r\n\t\t\ttarget = target.replace(re, '<a href=\"$1\">$1</a>');\r\n\t\t}\r\n\t\tif (target.substr(0, 11) === '/roomintro ') target = target.substr(11);\r\n\r\n\t\troom.settings.introMessage = target.replace(/\\r/g, '');\r\n\t\tthis.sendReply(\"(The room introduction has been changed to:)\");\r\n\t\tthis.sendReply(`|raw|<div class=\"infobox infobox-limited\">${room.settings.introMessage.replace(/\\n/g, '')}</div>`);\r\n\r\n\t\tthis.privateModAction(`${user.name} changed the roomintro.`);\r\n\t\tthis.modlog('ROOMINTRO');\r\n\t\tthis.roomlog(room.settings.introMessage.replace(/\\n/g, ''));\r\n\r\n\t\troom.saveSettings();\r\n\t},\r\n\troomintrohelp: [\r\n\t\t`/roomintro - Display the room introduction of the current room.`,\r\n\t\t`/roomintro [content] - Set an introduction for the room. Requires: # ~`,\r\n\t],\r\n\r\n\tdeletetopic: 'deleteroomintro',\r\n\tdeleteroomintro(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tthis.checkCan('declare', null, room);\r\n\t\tif (!room.settings.introMessage) throw new Chat.ErrorMessage(\"This room does not have a introduction set.\");\r\n\r\n\t\tthis.privateModAction(`${user.name} deleted the roomintro.`);\r\n\t\tthis.modlog('DELETEROOMINTRO');\r\n\t\tthis.roomlog(target);\r\n\t\tdelete room.settings.introMessage;\r\n\t\troom.saveSettings();\r\n\t},\r\n\tdeleteroomintrohelp: [`/deleteroomintro - Deletes the current room's introduction. Requires: # ~`],\r\n\r\n\tstafftopic: 'staffintro',\r\n\tstaffintro(target, room, user, connection, cmd) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\tthis.checkCan('mute', null, room);\r\n\t\t\tif (!room.settings.staffMessage) return this.sendReply(\"This room does not have a staff introduction set.\");\r\n\t\t\tthis.sendReply(`|raw|<div class=\"infobox\">${room.settings.staffMessage.replace(/\\n/g, ``)}</div>`);\r\n\t\t\tif (user.can('ban', null, room, 'staffintro') && cmd !== 'stafftopic') {\r\n\t\t\t\tconst code = Utils.escapeHTML(room.settings.staffMessage).replace(/\\n/g, '<br />');\r\n\t\t\t\tthis.sendReplyBox(`<details open><summary>Source:</summary><code style=\"white-space: pre-wrap; display: table; tab-size: 3\">/staffintro ${code}</code></details>`);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.checkCan('ban', null, room);\r\n\t\tthis.checkChat();\r\n\t\tif (this.meansNo(target) || target === 'delete') throw new Chat.ErrorMessage('Did you mean \"/deletestaffintro\"?');\r\n\t\tthis.checkHTML(target);\r\n\t\tif (!target.includes(\"<\")) {\r\n\t\t\t// not HTML, do some simple URL linking\r\n\t\t\tconst re = /(https?:\\/\\/(([\\w.-]+)+(:\\d+)?(\\/([\\w/_.]*(\\?\\S+)?)?)?))/g;\r\n\t\t\ttarget = target.replace(re, '<a href=\"$1\">$1</a>');\r\n\t\t}\r\n\t\tif (target.substr(0, 12) === '/staffintro ') target = target.substr(12);\r\n\r\n\t\troom.settings.staffMessage = target.replace(/\\r/g, '');\r\n\t\tthis.sendReply(\"(The staff introduction has been changed to:)\");\r\n\t\tthis.sendReply(`|raw|<div class=\"infobox\">${target.replace(/\\n/g, ``)}</div>`);\r\n\r\n\t\tthis.privateModAction(`${user.name} changed the staffintro.`);\r\n\t\tthis.modlog('STAFFINTRO');\r\n\t\tthis.roomlog(room.settings.staffMessage.replace(/\\n/g, ``));\r\n\t\troom.saveSettings();\r\n\t},\r\n\tstaffintrohelp: [`/staffintro [content] - Set an introduction for staff members. Requires: @ # ~`],\r\n\r\n\tdeletestafftopic: 'deletestaffintro',\r\n\tdeletestaffintro(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tthis.checkCan('ban', null, room);\r\n\t\tif (!room.settings.staffMessage) throw new Chat.ErrorMessage(\"This room does not have a staff introduction set.\");\r\n\r\n\t\tthis.privateModAction(`${user.name} deleted the staffintro.`);\r\n\t\tthis.modlog('DELETESTAFFINTRO');\r\n\t\tthis.roomlog(target);\r\n\t\tdelete room.settings.staffMessage;\r\n\t\troom.saveSettings();\r\n\t},\r\n\tdeletestaffintrohelp: [`/deletestaffintro - Deletes the current room's staff introduction. Requires: @ # ~`],\r\n\r\n\troomalias(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!target) {\r\n\t\t\tif (!this.runBroadcast()) return;\r\n\t\t\tif (!room.settings.aliases) return this.sendReplyBox(\"This room does not have any aliases.\");\r\n\t\t\treturn this.sendReplyBox(`This room has the following aliases: ${room.settings.aliases.join(\", \")}`);\r\n\t\t}\r\n\t\tthis.checkCan('makeroom');\r\n\t\tif (target.includes(',')) {\r\n\t\t\tthis.errorReply(`Invalid room alias: ${target.trim()}`);\r\n\t\t\treturn this.parse('/help roomalias');\r\n\t\t}\r\n\r\n\t\tconst alias = toID(target);\r\n\t\tif (!alias.length) throw new Chat.ErrorMessage(\"Only alphanumeric characters are valid in an alias.\");\r\n\t\tif (Rooms.get(alias) || Rooms.aliases.has(alias)) {\r\n\t\t\tthrow new Chat.ErrorMessage(\"You cannot set an alias to an existing room or alias.\");\r\n\t\t}\r\n\t\tif (room.settings.isPersonal) throw new Chat.ErrorMessage(\"Personal rooms can't have aliases.\");\r\n\r\n\t\tRooms.aliases.set(alias, room.roomid);\r\n\t\tthis.privateModAction(`${user.name} added the room alias '${alias}'.`);\r\n\t\tthis.modlog('ROOMALIAS', null, alias);\r\n\r\n\t\tif (!room.settings.aliases) room.settings.aliases = [];\r\n\t\troom.settings.aliases.push(alias);\r\n\t\troom.saveSettings();\r\n\t},\r\n\troomaliashelp: [\r\n\t\t`/roomalias - displays a list of all room aliases of the room the command was entered in.`,\r\n\t\t`/roomalias [alias] - adds the given room alias to the room the command was entered in. Requires: ~`,\r\n\t\t`/removeroomalias [alias] - removes the given room alias of the room the command was entered in. Requires: ~`,\r\n\t],\r\n\r\n\tdeleteroomalias: 'removeroomalias',\r\n\tderoomalias: 'removeroomalias',\r\n\tunroomalias: 'removeroomalias',\r\n\tremoveroomalias(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!room.settings.aliases) throw new Chat.ErrorMessage(\"This room does not have any aliases.\");\r\n\t\tthis.checkCan('makeroom');\r\n\t\tif (target.includes(',')) {\r\n\t\t\tthis.errorReply(`Invalid room alias: ${target.trim()}`);\r\n\t\t\treturn this.parse('/help removeroomalias');\r\n\t\t}\r\n\r\n\t\tconst alias = toID(target);\r\n\t\tif (!alias || !Rooms.aliases.has(alias)) throw new Chat.ErrorMessage(\"Please specify an existing alias.\");\r\n\t\tif (Rooms.aliases.get(alias) !== room.roomid) {\r\n\t\t\tthrow new Chat.ErrorMessage(\"You may only remove an alias from the current room.\");\r\n\t\t}\r\n\r\n\t\tthis.privateModAction(`${user.name} removed the room alias '${alias}'.`);\r\n\t\tthis.modlog('REMOVEALIAS', null, alias);\r\n\r\n\t\tconst aliasIndex = room.settings.aliases.indexOf(alias);\r\n\t\tif (aliasIndex >= 0) {\r\n\t\t\troom.settings.aliases.splice(aliasIndex, 1);\r\n\t\t\tif (!room.settings.aliases.length) room.settings.aliases = undefined;\r\n\t\t\tRooms.aliases.delete(alias);\r\n\t\t\troom.saveSettings();\r\n\t\t}\r\n\t},\r\n\tremoveroomaliashelp: [\r\n\t\t`/removeroomalias [alias] - removes the given room alias of the room the command was entered in. Requires: ~`,\r\n\t],\r\n\r\n\tresettierdisplay: 'roomtierdisplay',\r\n\troomtierdisplay(target, room, user, connection, cmd) {\r\n\t\troom = this.requireRoom();\r\n\t\tconst resetTier = cmd === 'resettierdisplay';\r\n\t\tif (!target) {\r\n\t\t\tif (!this.runBroadcast()) return;\r\n\t\t\treturn this.sendReplyBox(\r\n\t\t\t\t`This room is currently displaying ${room.settings.dataCommandTierDisplay} as the tier when using /data.`\r\n\t\t\t);\r\n\t\t}\r\n\t\tthis.checkCan('declare', null, room);\r\n\r\n\t\tconst displayIDToName: { [k: string]: Room['settings']['dataCommandTierDisplay'] } = {\r\n\t\t\ttiers: 'tiers',\r\n\t\t\tdoublestiers: 'doubles tiers',\r\n\t\t\tnationaldextiers: 'National Dex tiers',\r\n\t\t\tnumbers: 'numbers',\r\n\t\t};\r\n\r\n\t\tif (!resetTier) {\r\n\t\t\tif (!(toID(target) in displayIDToName)) {\r\n\t\t\t\tthis.errorReply(`Invalid tier display: ${target.trim()}`);\r\n\t\t\t\treturn this.parse(`/help roomtierdisplay`);\r\n\t\t\t}\r\n\r\n\t\t\troom.settings.dataCommandTierDisplay = displayIDToName[toID(target)];\r\n\t\t\tthis.sendReply(`(The room's tier display is now: ${displayIDToName[toID(target)]})`);\r\n\r\n\t\t\tthis.privateModAction(`${user.name} changed the room's tier display to: ${displayIDToName[toID(target)]}.`);\r\n\t\t\tthis.modlog('ROOMTIERDISPLAY', null, `to ${displayIDToName[toID(target)]}`);\r\n\t\t} else {\r\n\t\t\troom.settings.dataCommandTierDisplay = 'tiers';\r\n\t\t\tthis.sendReply(`(The room's tier display is now: tiers)`);\r\n\r\n\t\t\tthis.privateModAction(`${user.name} reset the room's tier display.`);\r\n\t\t\tthis.modlog('RESETTIERDISPLAY', null, `to tiers`);\r\n\t\t}\r\n\r\n\t\troom.saveSettings();\r\n\t},\r\n\troomtierdisplayhelp: [\r\n\t\t`/roomtierdisplay - displays the current room's display.`,\r\n\t\t`/roomtierdisplay [option] - changes the current room's tier display. Valid options are: tiers, doubles tiers, numbers. Requires: # ~`,\r\n\t\t`/resettierdisplay - resets the current room's tier display. Requires: # ~`,\r\n\t],\r\n\r\n\tsetroomsection: 'roomsection',\r\n\troomsection(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tconst sectionNames = RoomSections.sectionNames;\r\n\t\tif (!target) {\r\n\t\t\tif (!this.runBroadcast()) return;\r\n\t\t\tthis.sendReplyBox(Utils.html`This room is ${room.settings.section ? `in the ${sectionNames[room.settings.section]} section` : `not in a section`}.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.checkCan('gdeclare');\r\n\t\tconst section = room.setSection(target);\r\n\t\tthis.sendReply(`The room section is now: ${section ? sectionNames[section] : 'none'}`);\r\n\r\n\t\tthis.privateGlobalModAction(`${user.name} changed the room section of ${room.title} to ${section ? sectionNames[section] : 'none'}.`);\r\n\t\tthis.globalModlog('ROOMSECTION', null, section || 'none');\r\n\t},\r\n\troomsectionhelp: [\r\n\t\t`/roomsection [section] - Sets the room this is used in to the specified [section]. Requires: ~`,\r\n\t\t`Valid sections: ${sections.join(', ')}`,\r\n\t],\r\n\r\n\troomdefaultformat(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tthis.checkCan('editroom', null, room);\r\n\r\n\t\tif (!target) {\r\n\t\t\tthis.checkBroadcast();\r\n\t\t\tif (room.settings.defaultFormat) {\r\n\t\t\t\tthis.sendReply(`This room's default format is ${room.settings.defaultFormat}.`);\r\n\t\t\t} else {\r\n\t\t\t\tthis.sendReply(`This room has no default format.`);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.meansNo(target)) {\r\n\t\t\tdelete room.settings.defaultFormat;\r\n\t\t\troom.saveSettings();\r\n\t\t\tthis.modlog(`DEFAULTFORMAT`, null, 'off');\r\n\t\t\tthis.privateModAction(`${user.name} removed this room's default format.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttarget = toID(target);\r\n\t\tconst format = Dex.formats.get(target);\r\n\t\tif (format.effectType === 'Format') {\r\n\t\t\ttarget = format.name;\r\n\t\t}\r\n\t\tconst { isMatch } = this.extractFormat(target);\r\n\t\tif (!isMatch) throw new Chat.ErrorMessage(`Unrecognized format or mod \"${target}\"`);\r\n\r\n\t\troom.settings.defaultFormat = target;\r\n\t\troom.saveSettings();\r\n\t\tthis.modlog(`DEFAULTFORMAT`, null, target);\r\n\t\tthis.privateModAction(`${user.name} set this room's default format to ${target}.`);\r\n\t},\r\n\troomdefaultformathelp: [\r\n\t\t`/roomdefaultformat [format] or [mod] or gen[number] - Sets this room's default format/mod. Requires: # ~`,\r\n\t\t`/roomdefaultformat off - Clears this room's default format/mod. Requires: # ~`,\r\n\t\t`Affected commands: /details, /coverage, /effectiveness, /weakness, /learn`,\r\n\t],\r\n};\r\n\r\nexport const roomSettings: Chat.SettingsHandler[] = [\r\n\t// modchat\r\n\t(room, user) => ({\r\n\t\tlabel: \"Modchat\",\r\n\t\tpermission: 'modchat',\r\n\t\toptions: [\r\n\t\t\t'off',\r\n\t\t\t'autoconfirmed',\r\n\t\t\t'trusted',\r\n\t\t\t...RANKS.slice(1).filter(symbol => Users.Auth.hasPermission(user, 'modchat', symbol, room)),\r\n\t\t].map(rank => [rank, rank === (room.settings.modchat || 'off') || `modchat ${rank || 'off'}`]),\r\n\t}),\r\n\t(room, user) => ({\r\n\t\tlabel: \"Modjoin\",\r\n\t\tpermission: room.settings.isPersonal ? user.can('editroom', null, room) : user.can('makeroom'),\r\n\t\toptions: [\r\n\t\t\t'off',\r\n\t\t\t'autoconfirmed',\r\n\t\t\t// groupchat ROs can set modjoin, but only to +\r\n\t\t\t// first rank is for modjoin off\r\n\t\t\t...RANKS.slice(1, room.settings.isPersonal && !user.can('makeroom') ? 2 : undefined),\r\n\t\t].map(rank => [rank, rank === (room.settings.modjoin || 'off') || `modjoin ${rank || 'off'}`]),\r\n\t}),\r\n\troom => ({\r\n\t\tlabel: \"Language\",\r\n\t\tpermission: 'editroom',\r\n\t\toptions: [...Chat.languages].map(\r\n\t\t\t([id, name]) => [name, id === (room.settings.language || 'english') || `roomlanguage ${id || 'off'}`]\r\n\t\t),\r\n\t}),\r\n\troom => ({\r\n\t\tlabel: \"Stretch filter\",\r\n\t\tpermission: 'editroom',\r\n\t\toptions: [\r\n\t\t\t[`off`, !room.settings.filterStretching || 'stretchfilter off'],\r\n\t\t\t[`on`, room.settings.filterStretching || 'stretchfilter on'],\r\n\t\t],\r\n\t}),\r\n\troom => ({\r\n\t\tlabel: \"Caps filter\",\r\n\t\tpermission: 'editroom',\r\n\t\toptions: [\r\n\t\t\t[`off`, !room.settings.filterCaps || 'capsfilter off'],\r\n\t\t\t[`on`, room.settings.filterCaps || 'capsfilter on'],\r\n\t\t],\r\n\t}),\r\n\troom => ({\r\n\t\tlabel: \"Emoji filter\",\r\n\t\tpermission: 'editroom',\r\n\t\toptions: [\r\n\t\t\t[`off`, !room.settings.filterEmojis || 'emojifilter off'],\r\n\t\t\t[`on`, room.settings.filterEmojis || 'emojifilter on'],\r\n\t\t],\r\n\t}),\r\n\troom => ({\r\n\t\tlabel: \"Link filter\",\r\n\t\tpermission: 'editroom',\r\n\t\toptions: [\r\n\t\t\t[`off`, !room.settings.filterLinks || 'linkfilter off'],\r\n\t\t\t[`on`, room.settings.filterLinks || 'linkfilter on'],\r\n\t\t],\r\n\t}),\r\n\troom => ({\r\n\t\tlabel: \"Slowchat\",\r\n\t\tpermission: room.userCount < SLOWCHAT_USER_REQUIREMENT ? 'bypassall' as any : 'editroom',\r\n\t\toptions: ['off', 5, 10, 20, 30, 60].map(\r\n\t\t\ttime => [`${time}`, time === (room.settings.slowchat || 'off') || `slowchat ${time || 'off'}`]\r\n\t\t),\r\n\t}),\r\n\troom => ({\r\n\t\tlabel: \"/data Tier display\",\r\n\t\tpermission: 'editroom',\r\n\t\toptions: [\r\n\t\t\t[`tiers`, (room.settings.dataCommandTierDisplay ?? 'tiers') === 'tiers' || `roomtierdisplay tiers`],\r\n\t\t\t[`doubles tiers`, room.settings.dataCommandTierDisplay === 'doubles tiers' || `roomtierdisplay doubles tiers`],\r\n\t\t\t[\r\n\t\t\t\t`National Dex tiers`,\r\n\t\t\t\troom.settings.dataCommandTierDisplay === 'National Dex tiers' || `roomtierdisplay National Dex tiers`,\r\n\t\t\t],\r\n\t\t\t[`numbers`, room.settings.dataCommandTierDisplay === 'numbers' || `roomtierdisplay numbers`],\r\n\t\t],\r\n\t}),\r\n\troom => ({\r\n\t\tlabel: \"/requestshow\",\r\n\t\tpermission: 'declare',\r\n\t\toptions: [\r\n\t\t\t[`off`, !room.settings.requestShowEnabled || `showapprovals off`],\r\n\t\t\t[`on`, room.settings.requestShowEnabled || `showapprovals on`],\r\n\t\t],\r\n\t}),\r\n];\r\n\r\nexport const pages: Chat.PageTable = {\r\n\tpermissions(args, user, connection) {\r\n\t\tthis.title = `[Permissions]`;\r\n\t\tconst room = this.requireRoom();\r\n\t\tthis.checkCan('mute', null, room);\r\n\r\n\t\tconst roomGroups = ['default', 'all users', ...Config.groupsranking.slice(1)];\r\n\t\tconst permissions = room.settings.permissions || {};\r\n\r\n\t\tlet buf = `<div class=\"pad\"><h2>Command permissions for ${room.title}</h2>`;\r\n\t\tbuf += `<div class=\"ladder\"><table>`;\r\n\t\tbuf += `<tr><th>Permission</th><th>Required rank</th></tr>`;\r\n\t\tlet atLeastOne = false;\r\n\t\tfor (const permission in permissions) {\r\n\t\t\tconst requiredRank = permissions[permission];\r\n\t\t\tatLeastOne = true;\r\n\t\t\tbuf += `<tr><td><strong>${permission}</strong></td><td>`;\r\n\t\t\tif (room.auth.atLeast(user, '#')) {\r\n\t\t\t\tbuf += roomGroups.map(group => (\r\n\t\t\t\t\trequiredRank === group ?\r\n\t\t\t\t\t\tUtils.html`<button class=\"button disabled\" style=\"font-weight:bold;color:#575757;background:#d3d3d3\">${group}</button>` :\r\n\t\t\t\t\t\tUtils.html`<button class=\"button\" name=\"send\" value=\"/msgroom ${room.roomid},/permissions set ${permission}, ${group}\">${group}</button>`\r\n\t\t\t\t)).join(' ');\r\n\t\t\t} else {\r\n\t\t\t\tbuf += Utils.html`<button class=\"button disabled\" style=\"font-weight:bold;color:#575757;background:#d3d3d3\">${requiredRank}</button>`;\r\n\t\t\t}\r\n\t\t\tbuf += `</td>`;\r\n\t\t}\r\n\t\tif (!atLeastOne) {\r\n\t\t\tbuf += `<tr><td colspan=\"2\">You don't have any permissions configured.</td></tr>`;\r\n\t\t}\r\n\t\tbuf += `</table></div>`;\r\n\t\tbuf += `<p>Use <code>/permissions</code> to add new permissions</p>`;\r\n\t\treturn buf;\r\n\t},\r\n};\r\n"],
  "mappings": "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",
  "names": ["slowchatSetting", "stretchSetting", "capsSetting", "emojiSetting"]
}
