{
  "version": 3,
  "sources": ["../../../server/chat-plugins/daily-spotlight.ts"],
  "sourcesContent": ["import { FS, Utils } from '../../lib';\r\n\r\nconst DAY = 24 * 60 * 60 * 1000;\r\nconst SPOTLIGHT_FILE = 'config/chat-plugins/spotlights.json';\r\nconst NUMBER_REGEX = /^\\s*[0-9]+\\s*$/;\r\n\r\ntype StoredImage = [string, number, number];\r\n\r\ninterface Spotlight {\r\n\t/** legacy - string = just url, arr is [url, width, height] */\r\n\timage?: StoredImage | string;\r\n\tdescription: string;\r\n\ttime: number;\r\n}\r\n\r\nexport let spotlights: {\r\n\t[roomid: string]: { [k: string]: Spotlight[] },\r\n} = {};\r\n\r\ntry {\r\n\tspotlights = JSON.parse(FS(SPOTLIGHT_FILE).readIfExistsSync() || \"{}\");\r\n\tfor (const roomid in spotlights) {\r\n\t\tfor (const k in spotlights[roomid]) {\r\n\t\t\tfor (const spotlight of spotlights[roomid][k]) {\r\n\t\t\t\tif (!spotlight.time) {\r\n\t\t\t\t\tspotlight.time = Date.now();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n} catch (e: any) {\r\n\tif (e.code !== 'MODULE_NOT_FOUND' && e.code !== 'ENOENT') throw e;\r\n}\r\nif (!spotlights || typeof spotlights !== 'object') spotlights = {};\r\n\r\nfunction saveSpotlights() {\r\n\tFS(SPOTLIGHT_FILE).writeUpdate(() => JSON.stringify(spotlights));\r\n}\r\n\r\nfunction nextDaily() {\r\n\tfor (const roomid in spotlights) {\r\n\t\tfor (const key in spotlights[roomid]) {\r\n\t\t\tif (spotlights[roomid][key].length > 1) {\r\n\t\t\t\tspotlights[roomid][key].shift();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsaveSpotlights();\r\n\ttimeout = setTimeout(nextDaily, DAY);\r\n}\r\n\r\nconst midnight = new Date();\r\nmidnight.setHours(24, 0, 0, 0);\r\nlet timeout = setTimeout(nextDaily, midnight.getTime() - Date.now());\r\n\r\nexport function renderSpotlight(roomid: RoomID, key: string, index = 0) {\r\n\tlet imgHTML = '', descHTML = '';\r\n\tconst { image, description } = spotlights[roomid][key][index];\r\n\r\n\tif (image) {\r\n\t\tif (Array.isArray(image)) {\r\n\t\t\timgHTML = `<td><img src=\"${image[0]}\" width=\"${image[1]}\" height=\"${image[2]}\" style=\"vertical-align:middle;\"></td>`;\r\n\t\t} else {\r\n\t\t\t// legacy\r\n\t\t\timgHTML = Chat.html`<td>Legacy image ${image}</td>`;\r\n\t\t}\r\n\t}\r\n\r\n\tif (description) {\r\n\t\tdescHTML = `<td style=\"padding-right:10px;\">${Chat.formatText(description, true)}</td>`;\r\n\t}\r\n\r\n\treturn `<table style=\"text-align:center;margin:auto\"><tr>${descHTML}${imgHTML}</tr></table>`;\r\n}\r\n\r\nexport const destroy = () => clearTimeout(timeout);\r\n\r\nexport const pages: Chat.PageTable = {\r\n\tspotlights(query, user, connection) {\r\n\t\tthis.title = 'Daily Spotlights';\r\n\t\tconst room = this.requireRoom();\r\n\t\tquery.shift(); // roomid\r\n\t\tconst sortType = toID(query.shift());\r\n\t\tif (sortType && !['time', 'alphabet'].includes(sortType)) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Invalid sorting type '${sortType}' - must be either 'time', 'alphabet', or not provided.`);\r\n\t\t}\r\n\r\n\t\tlet buf = `<div class=\"pad ladder\">`;\r\n\t\tbuf += `<div class=\"pad\">`;\r\n\t\tbuf += `<button style=\"float:right;\" class=\"button\" name=\"send\" value=\"/join view-spotlights-${room.roomid}${sortType ? '-' + sortType : ''}\">`;\r\n\t\tbuf += `<i class=\"fa fa-refresh\"></i> Refresh</button>`;\r\n\t\tbuf += `<h2>Daily Spotlights</h2>`;\r\n\t\t// for posterity, all these switches are futureproofing for more sort types\r\n\t\tif (sortType) {\r\n\t\t\tlet title = '';\r\n\t\t\tswitch (sortType) {\r\n\t\t\tcase 'time':\r\n\t\t\t\ttitle = 'latest time updated';\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\ttitle = 'alphabetical';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tbuf += `(sorted by ${title})<br />`;\r\n\t\t}\r\n\t\tif (!spotlights[room.roomid]) {\r\n\t\t\tbuf += `<p>This room has no daily spotlights.</p></div>`;\r\n\t\t\treturn buf;\r\n\t\t}\r\n\r\n\t\tconst sortedEntries = Utils.sortBy(Object.entries(spotlights[room.roomid]), ([key]) => {\r\n\t\t\tswitch (sortType) {\r\n\t\t\tcase 'time': {\r\n\t\t\t\t// find most recently added/updated spotlight in that name, sort all by that\r\n\t\t\t\tconst sortedSpotlights = Utils.sortBy(spotlights[room.roomid][key].slice(), k => -k.time);\r\n\t\t\t\treturn -sortedSpotlights[0].time;\r\n\t\t\t}\r\n\t\t\t// sort alphabetically by name otherwise\r\n\t\t\tdefault:\r\n\t\t\t\treturn key;\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst canManage = user.can('announce', null, room);\r\n\t\tfor (const [key, queue] of sortedEntries) {\r\n\t\t\tbuf += `<table style=\"margin-bottom:30px;\"><th colspan=\"2\"><h3>${key}:</h3></th>`;\r\n\t\t\tfor (const i of queue.keys()) {\r\n\t\t\t\tconst html = renderSpotlight(room.roomid, key, i);\r\n\t\t\t\tbuf += `<tr><td>${i || 'Current'}</td><td>${html}</td>`;\r\n\t\t\t\tif (canManage) {\r\n\t\t\t\t\tconst deleteCommand = `/msgroom ${room.roomid},/removedaily ${key}, ${i}`;\r\n\t\t\t\t\tbuf += `<td><button class=\"button\" name=\"send\" value=\"${deleteCommand}\">Delete</button></td>`;\r\n\t\t\t\t}\r\n\t\t\t\tbuf += `</tr>`;\r\n\t\t\t\tif (!canManage) break;\r\n\t\t\t}\r\n\t\t\tbuf += '</table>';\r\n\t\t}\r\n\t\treturn buf;\r\n\t},\r\n};\r\n\r\nexport const commands: Chat.ChatCommands = {\r\n\tremovedaily(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\r\n\t\tlet [key, rest] = target.split(',');\r\n\t\tkey = toID(key);\r\n\t\trest = toID(rest);\r\n\t\tif (!key) return this.parse('/help daily');\r\n\t\tif (!spotlights[room.roomid][key]) throw new Chat.ErrorMessage(`Cannot find a daily spotlight with name '${key}'`);\r\n\r\n\t\tthis.checkCan('announce', null, room);\r\n\t\tif (!rest || rest === 'current' || rest === '0' || rest === 'all') {\r\n\t\t\tspotlights[room.roomid][key].shift();\r\n\t\t\tif (!spotlights[room.roomid][key].length || rest === 'all') {\r\n\t\t\t\tdelete spotlights[room.roomid][key];\r\n\t\t\t\tthis.modlog(`DAILY REMOVE`, key);\r\n\t\t\t\tthis.privateModAction(`${user.name} removed the daily spotlight named '${key}'.`);\r\n\t\t\t} else {\r\n\t\t\t\tthis.modlog(`DAILY REMOVE`, `${key}[0]`);\r\n\t\t\t\tthis.privateModAction(`${user.name} removed the current entry from the queue of the daily spotlight named '${key}'.`);\r\n\t\t\t}\r\n\t\t\tsaveSpotlights();\r\n\t\t} else {\r\n\t\t\tconst queueNumber = parseInt(rest);\r\n\t\t\tif (isNaN(queueNumber) || queueNumber < 1) throw new Chat.ErrorMessage(\"Invalid queue number\");\r\n\t\t\tif (queueNumber >= spotlights[room.roomid][key].length) {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`Queue number must be between 1 and ${spotlights[room.roomid][key].length - 1}`);\r\n\t\t\t}\r\n\t\t\tspotlights[room.roomid][key].splice(queueNumber, 1);\r\n\t\t\tsaveSpotlights();\r\n\r\n\t\t\tthis.modlog(`DAILY REMOVE`, `${key}[${queueNumber}]`);\r\n\t\t\tthis.privateModAction(\r\n\t\t\t\t`${user.name} removed the ${queueNumber}th entry from the queue of the daily spotlight named '${key}'.`\r\n\t\t\t);\r\n\t\t}\r\n\t\tChat.refreshPageFor(`spotlights-${room.roomid}`, room);\r\n\t},\r\n\tswapdailies: 'swapdaily',\r\n\tswapdaily(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\r\n\t\tif (!spotlights[room.roomid]) throw new Chat.ErrorMessage(\"There are no dailies for this room.\");\r\n\t\tthis.checkCan('announce', null, room);\r\n\r\n\t\tconst [key, indexStringA, indexStringB] = target.split(',').map(index => toID(index));\r\n\t\tif (!indexStringB) return this.parse('/help daily');\r\n\t\tif (!spotlights[room.roomid][key]) throw new Chat.ErrorMessage(`Cannot find a daily spotlight with name '${key}'`);\r\n\t\tif (!(NUMBER_REGEX.test(indexStringA) && NUMBER_REGEX.test(indexStringB))) {\r\n\t\t\tthrow new Chat.ErrorMessage(\"Queue numbers must be numbers.\");\r\n\t\t}\r\n\t\tconst indexA = parseInt(indexStringA);\r\n\t\tconst indexB = parseInt(indexStringB);\r\n\t\tconst queueLength = spotlights[room.roomid][key].length;\r\n\t\tif (indexA < 1 || indexB < 1 || indexA >= queueLength || indexB >= queueLength) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Queue numbers must between 1 and the length of the queue (${queueLength}).`);\r\n\t\t}\r\n\r\n\t\tconst dailyA = spotlights[room.roomid][key][indexA];\r\n\t\tconst dailyB = spotlights[room.roomid][key][indexB];\r\n\t\tspotlights[room.roomid][key][indexA] = dailyB;\r\n\t\tspotlights[room.roomid][key][indexB] = dailyA;\r\n\r\n\t\tsaveSpotlights();\r\n\r\n\t\tthis.modlog(`DAILY QUEUE SWAP`, key, `${indexA} with ${indexB}`);\r\n\t\tthis.privateModAction(`${user.name} swapped the queued dailies for '${key}' at queue numbers ${indexA} and ${indexB}.`);\r\n\t\tChat.refreshPageFor(`spotlights-${room.roomid}`, room);\r\n\t},\r\n\tqueuedaily: 'setdaily',\r\n\tqueuedailyat: 'setdaily',\r\n\treplacedaily: 'setdaily',\r\n\tasync setdaily(target, room, user, connection, cmd) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\r\n\t\tlet key, indexString, rest;\r\n\t\tif (cmd.endsWith('at') || cmd === 'replacedaily') {\r\n\t\t\t[key, indexString, ...rest] = target.split(',');\r\n\t\t} else {\r\n\t\t\t[key, ...rest] = target.split(',');\r\n\t\t}\r\n\t\tkey = toID(key);\r\n\t\tif (!key) return this.parse('/help daily');\r\n\t\tif (key.length > 20) throw new Chat.ErrorMessage(\"Spotlight names can be a maximum of 20 characters long.\");\r\n\t\tif (key === 'constructor') return false;\r\n\t\tif (!spotlights[room.roomid]) spotlights[room.roomid] = {};\r\n\t\tconst queueLength = spotlights[room.roomid][key]?.length || 0;\r\n\r\n\t\tif (indexString && !NUMBER_REGEX.test(indexString)) throw new Chat.ErrorMessage(\"The queue number must be a number.\");\r\n\r\n\t\tconst index = (indexString ? parseInt(indexString) : queueLength);\r\n\t\tif (indexString && (index < 1 || index > queueLength)) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Queue numbers must be between 1 and the length of the queue (${queueLength}).`);\r\n\t\t}\r\n\r\n\t\tthis.checkCan('announce', null, room);\r\n\t\tif (!rest.length) return this.parse('/help daily');\r\n\t\tlet img: StoredImage | undefined;\r\n\t\tif (rest[0].trim().startsWith('http://') || rest[0].trim().startsWith('https://')) {\r\n\t\t\tconst url = rest.shift()!.trim();\r\n\t\t\ttry {\r\n\t\t\t\tconst [width, height] = await Chat.fitImage(url);\r\n\t\t\t\timg = [url, width, height];\r\n\t\t\t} catch {\r\n\t\t\t\tthrow new Chat.ErrorMessage(`Invalid image url: ${url}`);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst desc = rest.join(',');\r\n\t\tif (Chat.stripFormatting(desc).length > 500) {\r\n\t\t\tthrow new Chat.ErrorMessage(\"Descriptions can be at most 500 characters long.\");\r\n\t\t}\r\n\t\tconst obj = { image: img, description: desc, time: Date.now() };\r\n\t\tif (!spotlights[room.roomid][key]) spotlights[room.roomid][key] = [];\r\n\t\tif (cmd === 'setdaily') {\r\n\t\t\tspotlights[room.roomid][key].shift();\r\n\t\t\tspotlights[room.roomid][key].unshift(obj);\r\n\r\n\t\t\tthis.modlog('SETDAILY', key, `${img ? `${img}, ` : ''}${desc}`);\r\n\t\t\tthis.privateModAction(`${user.name} set the daily ${key}.`);\r\n\t\t} else if (cmd === 'queuedailyat') {\r\n\t\t\tspotlights[room.roomid][key].splice(index, 0, obj);\r\n\t\t\tthis.modlog('QUEUEDAILY', key, `queue number ${index}: ${img ? `${img}, ` : ''}${desc}`);\r\n\t\t\tthis.privateModAction(`${user.name} queued a daily ${key} at queue number ${index}.`);\r\n\t\t} else {\r\n\t\t\tspotlights[room.roomid][key][index] = obj;\r\n\t\t\tif (indexString) {\r\n\t\t\t\tthis.modlog('REPLACEDAILY', key, `queue number ${index}: ${img ? `${img}, ` : ''}${desc}`);\r\n\t\t\t\tthis.privateModAction(`${user.name} replaced the daily ${key} at queue number ${index}.`);\r\n\t\t\t} else {\r\n\t\t\t\tthis.modlog('QUEUEDAILY', key, `${img ? `${img}, ` : ''}${desc}`);\r\n\t\t\t\tthis.privateModAction(`${user.name} queued a daily ${key}.`);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsaveSpotlights();\r\n\t\tChat.refreshPageFor(`spotlights-${room.roomid}`, room);\r\n\t},\r\n\tdaily(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\r\n\t\tconst key = toID(target);\r\n\t\tif (!key) return this.parse('/help daily');\r\n\r\n\t\tif (!spotlights[room.roomid]?.[key]) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Cannot find a daily spotlight with name '${key}'`);\r\n\t\t}\r\n\r\n\t\tif (!this.runBroadcast()) return;\r\n\r\n\t\tconst { image, description } = spotlights[room.roomid][key][0];\r\n\t\tconst html = renderSpotlight(room.roomid, key);\r\n\r\n\t\tthis.sendReplyBox(html);\r\n\t\tif (!this.broadcasting && user.can('ban', null, room, 'setdaily')) {\r\n\t\t\tconst code = Utils.escapeHTML(description).replace(/\\n/g, '<br />');\r\n\t\t\tthis.sendReplyBox(`<details><summary>Source</summary><code style=\"white-space: pre-wrap; display: table; tab-size: 3\">/setdaily ${key},${image ? `${image},` : ''}${code}</code></details>`);\r\n\t\t}\r\n\t\troom.update();\r\n\t},\r\n\tvsl: 'viewspotlights',\r\n\tdailies: 'viewspotlights',\r\n\tviewspotlights(target, room, user) {\r\n\t\troom = this.requireRoom();\r\n\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\r\n\t\ttarget = toID(target);\r\n\t\treturn this.parse(`/join view-spotlights-${room.roomid}${target ? `-${target}` : ''}`);\r\n\t},\r\n\r\n\tdailyhelp() {\r\n\t\tthis.sendReply(\r\n\t\t\t`|html|<details class=\"readmore\"><summary><code>/daily [name]</code>: shows the daily spotlight.<br />` +\r\n\t\t\t`<code>!daily [name]</code>: shows the daily spotlight to everyone. Requires: + % @ # ~<br />` +\r\n\t\t\t`<code>/setdaily [name], [image], [description]</code>: sets the daily spotlight. Image can be left out. Requires: % @ # ~</summary>` +\r\n\t\t\t`<code>/queuedaily [name], [image], [description]</code>: queues a daily spotlight. At midnight, the spotlight with this name will automatically switch to the next queued spotlight. Image can be left out. Requires: % @ # ~<br />` +\r\n\t\t\t`<code>/queuedailyat [name], [queue number], [image], [description]</code>: inserts a daily spotlight into the queue at the specified number (starting from 1). Requires: % @ # ~<br />` +\r\n\t\t\t`<code>/replacedaily [name], [queue number], [image], [description]</code>: replaces the daily spotlight queued at the specified number. Requires: % @ # ~<br />` +\r\n\t\t\t`<code>/removedaily [name][, queue number]</code>: If no queue number is provided, the current spotlight is deleted (and tomorrow's, if it exists, is moved up). If a number is provided, removes a specific future spotlight from the queue. Requires: % @ # ~<br />` +\r\n\t\t\t`<code>/removedaily [name], all</code>: Deletes all current and queued spotlights with the given name. Requires: % @ # ~<br />` +\r\n\t\t\t`<code>/swapdaily [name], [queue number], [queue number]</code>: swaps the two queued spotlights at the given queue numbers. Requires: % @ # ~<br />` +\r\n\t\t\t`<code>/viewspotlights [sorter]</code>: shows all current spotlights in the room. For staff, also shows queued spotlights.` +\r\n\t\t\t`[sorter] can either be unset, 'time', or 'alphabet'. These sort by either the time added, or alphabetical order.` +\r\n\t\t\t`</details>`\r\n\t\t);\r\n\t},\r\n};\r\n\r\nexport const handlers: Chat.Handlers = {\r\n\tonRenameRoom(oldID, newID) {\r\n\t\tif (spotlights[oldID]) {\r\n\t\t\tif (!spotlights[newID]) spotlights[newID] = {};\r\n\t\t\tObject.assign(spotlights[newID], spotlights[oldID]);\r\n\t\t\tdelete spotlights[oldID];\r\n\t\t\tsaveSpotlights();\r\n\t\t}\r\n\t},\r\n};\r\n\r\nprocess.nextTick(() => {\r\n\tChat.multiLinePattern.register('/(queue|set|replace)daily(at | )');\r\n});\r\n"],
  "mappings": "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",
  "names": []
}
