{
  "version": 3,
  "sources": ["../../../server/chat-plugins/auction.ts"],
  "sourcesContent": ["/**\r\n * Chat plugin to run auctions for team tournaments.\r\n *\r\n * Based on the original Scrappie auction system\r\n * https://github.com/Hidden50/Pokemon-Showdown-Node-Bot/blob/master/commands/base-auctions.js\r\n * @author Karthik\r\n */\r\nimport { Net, Utils } from '../../lib';\r\n\r\ninterface Player {\r\n\tid: ID;\r\n\tname: string;\r\n\tteam?: Team;\r\n\tprice: number;\r\n\ttiersPlayed: string[];\r\n\ttiersNotPlayed: string[];\r\n}\r\n\r\ninterface Manager {\r\n\tid: ID;\r\n\tteam: Team;\r\n}\r\n\r\nclass Team {\r\n\tid: ID;\r\n\tname: string;\r\n\tplayers: Player[];\r\n\tcredits: number;\r\n\tsuspended: boolean;\r\n\tprivate auction: Auction;\r\n\tconstructor(name: string, auction: Auction) {\r\n\t\tthis.id = toID(name);\r\n\t\tthis.name = name;\r\n\t\tthis.players = [];\r\n\t\tthis.credits = auction.startingCredits;\r\n\t\tthis.suspended = false;\r\n\t\tthis.auction = auction;\r\n\t}\r\n\r\n\tgetManagers() {\r\n\t\treturn [...this.auction.managers.values()]\r\n\t\t\t.filter(m => m.team === this)\r\n\t\t\t.map(m => Users.getExact(m.id)?.name || m.id);\r\n\t}\r\n\r\n\taddPlayer(player: Player, price = 0) {\r\n\t\tplayer.team?.removePlayer(player);\r\n\t\tthis.players.push(player);\r\n\t\tthis.credits -= price;\r\n\t\tplayer.team = this;\r\n\t\tplayer.price = price;\r\n\t}\r\n\r\n\tremovePlayer(player: Player) {\r\n\t\tconst pIndex = this.players.indexOf(player);\r\n\t\tif (pIndex === -1) return;\r\n\t\tthis.players.splice(pIndex, 1);\r\n\t\tdelete player.team;\r\n\t\tplayer.price = 0;\r\n\t}\r\n\r\n\tisSuspended() {\r\n\t\treturn this.suspended || (\r\n\t\t\tthis.auction.type === 'snake' ?\r\n\t\t\t\tthis.players.length >= this.auction.minPlayers :\r\n\t\t\t\t(\r\n\t\t\t\t\tthis.credits < this.auction.minBid ||\r\n\t\t\t\t\t(this.auction.maxPlayers && this.players.length >= this.auction.maxPlayers)\r\n\t\t\t\t)\r\n\t\t);\r\n\t}\r\n\r\n\tmaxBid(credits = this.credits) {\r\n\t\treturn credits + this.auction.minBid * Math.min(0, this.players.length - this.auction.minPlayers + 1);\r\n\t}\r\n}\r\n\r\nfunction parseCredits(amount: string) {\r\n\tlet credits = Number(amount.replace(',', '.'));\r\n\tif (Math.abs(credits) < 500) credits *= 1000;\r\n\tif (!credits || credits % 500 !== 0) {\r\n\t\tthrow new Chat.ErrorMessage(`The amount of credits must be a multiple of 500.`);\r\n\t}\r\n\treturn credits;\r\n}\r\n\r\nexport class Auction extends Rooms.SimpleRoomGame {\r\n\toverride readonly gameid = 'auction' as ID;\r\n\towners = new Set<ID>();\r\n\tteams = new Map<string, Team>();\r\n\tmanagers = new Map<string, Manager>();\r\n\tauctionPlayers = new Map<string, Player>();\r\n\r\n\tstartingCredits: number;\r\n\tminBid = 3000;\r\n\tminPlayers = 10;\r\n\tmaxPlayers = 0;\r\n\ttype: 'auction' | 'blind' | 'snake' = 'auction';\r\n\r\n\tlastQueue: Team[] | null = null;\r\n\tqueue: Team[] = [];\r\n\tnomTimer: NodeJS.Timeout = null!;\r\n\tnomTimeLimit = 0;\r\n\tnomTimeRemaining = 0;\r\n\tbidTimer: NodeJS.Timeout = null!;\r\n\tbidTimeLimit = 10;\r\n\tbidTimeRemaining = 10;\r\n\tnominatingTeam: Team = null!;\r\n\tnominatedPlayer: Player = null!;\r\n\thighestBidder: Team = null!;\r\n\thighestBid = 0;\r\n\t/** Used for blind mode */\r\n\tbidsPlaced = new Map<Team, number>();\r\n\tstate: 'setup' | 'nom' | 'bid' = 'setup';\r\n\tconstructor(room: Room, startingCredits = 100000) {\r\n\t\tsuper(room);\r\n\t\tthis.title = 'Auction';\r\n\t\tthis.startingCredits = startingCredits;\r\n\t}\r\n\r\n\tsendMessage(message: string) {\r\n\t\tthis.room.add(`|c|~|${message}`).update();\r\n\t}\r\n\r\n\tsendHTMLBox(htmlContent: string) {\r\n\t\tthis.room.add(`|html|<div class=\"infobox\">${htmlContent}</div>`).update();\r\n\t}\r\n\r\n\tcheckOwner(user: User) {\r\n\t\tif (!this.owners.has(user.id) && !Users.Auth.hasPermission(user, 'declare', null, this.room)) {\r\n\t\t\tthrow new Chat.ErrorMessage(`You must be an auction owner to use this command.`);\r\n\t\t}\r\n\t}\r\n\r\n\taddOwners(users: string[]) {\r\n\t\tfor (const name of users) {\r\n\t\t\tconst user = Users.getExact(name);\r\n\t\t\tif (!user) throw new Chat.ErrorMessage(`User \"${name}\" not found.`);\r\n\t\t\tif (this.owners.has(user.id)) throw new Chat.ErrorMessage(`${user.name} is already an auction owner.`);\r\n\t\t\tthis.owners.add(user.id);\r\n\t\t}\r\n\t}\r\n\r\n\tremoveOwners(users: string[]) {\r\n\t\tfor (const name of users) {\r\n\t\t\tconst id = toID(name);\r\n\t\t\tif (!this.owners.has(id)) throw new Chat.ErrorMessage(`User \"${name}\" is not an auction owner.`);\r\n\t\t\tthis.owners.delete(id);\r\n\t\t}\r\n\t}\r\n\r\n\tgenerateUsernameList(players: (string | Player)[], max = players.length, clickable = false) {\r\n\t\tlet buf = `<span style=\"font-size: 85%\">`;\r\n\t\tbuf += players.slice(0, max).map(p => {\r\n\t\t\tif (typeof p === 'object') {\r\n\t\t\t\treturn `<username ${clickable ? ' class=\"username\"' : ''}>${Utils.escapeHTML(p.name)}</username>`;\r\n\t\t\t}\r\n\t\t\treturn `<username${clickable ? ' class=\"username\"' : ''}>${Utils.escapeHTML(p)}</username>`;\r\n\t\t}).join(', ');\r\n\t\tif (players.length > max) {\r\n\t\t\tbuf += ` <span title=\"${players.slice(max).map(p => Utils.escapeHTML(typeof p === 'object' ? p.name : p)).join(', ')}\">(+${players.length - max})</span>`;\r\n\t\t}\r\n\t\tbuf += `</span>`;\r\n\t\treturn buf;\r\n\t}\r\n\r\n\tgeneratePriceList() {\r\n\t\tconst players = Utils.sortBy(this.getDraftedPlayers(), p => -p.price);\r\n\t\tlet buf = '';\r\n\t\tlet smogonExport = '';\r\n\r\n\t\tfor (const team of this.teams.values()) {\r\n\t\t\tlet table = `<table>`;\r\n\t\t\tlet smogonTable = `[TABLE]`;\r\n\t\t\tfor (const player of players.filter(p => p.team === team)) {\r\n\t\t\t\ttable += Utils.html`<tr><td>${player.name}</td><td>${player.price}</td></tr>`;\r\n\t\t\t\tsmogonTable += `[TR][TD]${player.name}[/TD][TD]${player.price}[/TD][/TR]`;\r\n\t\t\t}\r\n\t\t\ttable += `</table>`;\r\n\t\t\tsmogonTable += `[/TABLE]`;\r\n\r\n\t\t\tbuf += `<details><summary>${Utils.escapeHTML(team.name)}</summary>${table}</details><br/>`;\r\n\t\t\tif (this.ended) smogonExport += `[SPOILER=\"${team.name}\"]${smogonTable}[/SPOILER]`;\r\n\t\t}\r\n\r\n\t\tlet table = `<table>`;\r\n\t\tlet smogonTable = `[TABLE]`;\r\n\t\tfor (const player of players) {\r\n\t\t\ttable += Utils.html`<tr><td>${player.name}</td><td>${player.price}</td><td>${player.team!.name}</td></tr>`;\r\n\t\t\tsmogonTable += `[TR][TD]${player.name}[/TD][TD]${player.price}[/TD][TD]${player.team!.name}[/TD][/TR]`;\r\n\t\t}\r\n\t\ttable += `</table>`;\r\n\t\tsmogonTable += `[/TABLE]`;\r\n\r\n\t\tbuf += `<details><summary>All</summary>${table}</details><br/>`;\r\n\t\tif (this.ended) {\r\n\t\t\tsmogonExport += `[SPOILER=\"All\"]${smogonTable}[/SPOILER]`;\r\n\t\t\tbuf += Utils.html`<copytext value=\"${smogonExport}\">Copy Smogon Export</copytext>`;\r\n\t\t}\r\n\r\n\t\treturn buf;\r\n\t}\r\n\r\n\tgenerateAuctionTable() {\r\n\t\tconst queue = this.queue.filter(team => !team.isSuspended());\r\n\t\tlet buf = `<div class=\"ladder pad\"><table style=\"width: 100%\"><tr>${!this.ended ? `<th colspan=2>Order</th>` : ''}<th>Team</th>${this.type !== 'snake' ? `<th>Credits</th>` : ''}<th style=\"width: 100%\">Players</th></tr>`;\r\n\t\tfor (const team of this.teams.values()) {\r\n\t\t\tbuf += `<tr>`;\r\n\t\t\tif (!this.ended) {\r\n\t\t\t\tlet i1 = queue.indexOf(team) + 1;\r\n\t\t\t\tlet i2 = queue.lastIndexOf(team) + 1;\r\n\t\t\t\tif (i1 > queue.length / 2) {\r\n\t\t\t\t\t[i1, i2] = [i2, i1];\r\n\t\t\t\t}\r\n\t\t\t\tbuf += `<td align=\"center\" style=\"width: 15px\">${i1 || '-'}</td><td align=\"center\" style=\"width: 15px\">${i2 || '-'}</td>`;\r\n\t\t\t}\r\n\t\t\tbuf += `<td style=\"white-space: nowrap\"><strong>${Utils.escapeHTML(team.name)}</strong><br/>${this.generateUsernameList(team.getManagers(), 2, true)}</td>`;\r\n\t\t\tif (this.type !== 'snake') {\r\n\t\t\t\tbuf += `<td style=\"white-space: nowrap\">${team.credits.toLocaleString()}${team.maxBid() >= this.minBid ? `<br/><span style=\"font-size: 90%\">Max bid: ${team.maxBid().toLocaleString()}</span>` : ''}</td>`;\r\n\t\t\t}\r\n\t\t\tbuf += `<td title=\"${team.players.map(p => Utils.escapeHTML(p.name)).join(', ')}\"><div style=\"min-height: 32px${!this.ended ? `; height: 32px; overflow: hidden; resize: vertical` : ''}\"><span style=\"float: right\">${team.players.length}</span>${this.generateUsernameList(team.players)}</div></td>`;\r\n\t\t\tbuf += `</tr>`;\r\n\t\t}\r\n\t\tbuf += `</table></div>`;\r\n\r\n\t\tconst players = Utils.sortBy(this.getUndraftedPlayers(), p => p.name);\r\n\t\tconst tierArrays = new Map<string, Player[]>();\r\n\t\tfor (const player of players) {\r\n\t\t\tfor (const tier of player.tiersPlayed) {\r\n\t\t\t\tif (!tierArrays.has(tier)) tierArrays.set(tier, []);\r\n\t\t\t\ttierArrays.get(tier)!.push(player);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst sortedTiers = [...tierArrays.keys()].sort();\r\n\t\tif (sortedTiers.length) {\r\n\t\t\tbuf += `<details><summary>Remaining Players (${players.length})</summary>`;\r\n\t\t\tbuf += `<details><summary>All</summary>${this.generateUsernameList(players)}</details>`;\r\n\t\t\tbuf += `<details><summary>Tiers</summary><ul style=\"list-style-type: none\">`;\r\n\t\t\tfor (const tier of sortedTiers) {\r\n\t\t\t\tconst tierPlayers = tierArrays.get(tier)!;\r\n\t\t\t\tbuf += `<li><details><summary>${Utils.escapeHTML(tier)} (${tierPlayers.length})</summary>${this.generateUsernameList(tierPlayers)}</details></li>`;\r\n\t\t\t}\r\n\t\t\tbuf += `</ul></details></details>`;\r\n\t\t} else {\r\n\t\t\tbuf += `<details><summary>Remaining Players (${players.length})</summary>${this.generateUsernameList(players)}</details>`;\r\n\t\t}\r\n\t\tbuf += `<details><summary>Auction Settings</summary>`;\r\n\t\tbuf += `- Minimum bid: <b>${this.minBid.toLocaleString()}</b><br/>`;\r\n\t\tbuf += `- Minimum players per team: <b>${this.minPlayers}</b><br/>`;\r\n\t\tif (this.type !== 'snake') buf += `- Maximum players per team: <b>${this.maxPlayers || 'N/A'}</b><br/>`;\r\n\t\tbuf += `- Nom timer: <b>${this.nomTimeLimit ? `${this.nomTimeLimit}s` : 'Off'}</b><br/>`;\r\n\t\tif (this.type !== 'snake') buf += `- Bid timer: <b>${this.bidTimeLimit}s</b><br/>`;\r\n\t\tbuf += `- Auction type: <b>${this.type}</b><br/>`;\r\n\t\tbuf += `</details>`;\r\n\t\treturn buf;\r\n\t}\r\n\r\n\tsendBidInfo() {\r\n\t\tif (this.type === 'blind') return;\r\n\t\tlet buf = `<div class=\"infobox\">`;\r\n\t\tbuf += Utils.html`Player: <username>${this.nominatedPlayer.name}</username> `;\r\n\t\tbuf += `Top bid: <b>${this.highestBid}</b> `;\r\n\t\tbuf += Utils.html`Top bidder: <b>${this.highestBidder.name}</b><br/>`;\r\n\t\tbuf += Utils.html`Tiers Played: <b>${this.nominatedPlayer.tiersPlayed.length ? `${this.nominatedPlayer.tiersPlayed.join(', ')}` : 'N/A'}</b><br/>`;\r\n\t\tbuf += Utils.html`Tiers Not Played: <b>${this.nominatedPlayer.tiersNotPlayed.length ? `${this.nominatedPlayer.tiersNotPlayed.join(', ')}` : 'N/A'}</b>`;\r\n\t\tbuf += `</div>`;\r\n\t\tthis.room.add(`|uhtml|bid-${this.nominatedPlayer.id}|${buf}`).update();\r\n\t}\r\n\r\n\tsendTimer(change = false, nom = false) {\r\n\t\tlet buf = `<div class=\"infobox message-error\">`;\r\n\t\tbuf += `<i class=\"fa fa-hourglass-start\"></i> ${Chat.toDurationString((nom ? this.nomTimeRemaining : this.bidTimeRemaining) * 1000, { hhmmss: true }).slice(1)}`;\r\n\t\tbuf += `</div>`;\r\n\t\tthis.room.add(`|uhtml${change ? 'change' : ''}|timer|${buf}`).update();\r\n\t}\r\n\r\n\tsetMinBid(amount: number) {\r\n\t\tif (this.state !== 'setup') {\r\n\t\t\tthrow new Chat.ErrorMessage(`The minimum bid cannot be changed after the auction has started.`);\r\n\t\t}\r\n\t\tif (amount > 500000) throw new Chat.ErrorMessage(`The minimum bid must not exceed 500,000.`);\r\n\t\tthis.minBid = amount;\r\n\t}\r\n\r\n\tsetMinPlayers(amount: number) {\r\n\t\tif (this.state !== 'setup') {\r\n\t\t\tthrow new Chat.ErrorMessage(`The minimum number of players cannot be changed after the auction has started.`);\r\n\t\t}\r\n\t\tif (!amount || amount > 30) {\r\n\t\t\tthrow new Chat.ErrorMessage(`The minimum number of players must be between 1 and 30.`);\r\n\t\t}\r\n\t\tthis.minPlayers = amount;\r\n\t}\r\n\r\n\tsetMaxPlayers(amount: number) {\r\n\t\tif (this.type === 'snake') throw new Chat.ErrorMessage(`You only need to set minplayers for snake drafts.`);\r\n\t\tif (this.state !== 'setup') {\r\n\t\t\tthrow new Chat.ErrorMessage(`The maximum number of players cannot be changed after the auction has started.`);\r\n\t\t}\r\n\t\tthis.maxPlayers = amount;\r\n\t}\r\n\r\n\tsetNomTimeLimit(seconds: number) {\r\n\t\tif (this.state !== 'setup') {\r\n\t\t\tthrow new Chat.ErrorMessage(`The nomination time limit cannot be changed after the auction has started.`);\r\n\t\t}\r\n\t\tif (isNaN(seconds) || (seconds && (seconds < 7 || seconds > 300))) {\r\n\t\t\tthrow new Chat.ErrorMessage(`The nomination time limit must be between 7 and 300 seconds.`);\r\n\t\t}\r\n\t\tthis.nomTimeLimit = this.nomTimeRemaining = seconds;\r\n\t}\r\n\r\n\tsetBidTimeLimit(seconds: number) {\r\n\t\tif (this.state !== 'setup') {\r\n\t\t\tthrow new Chat.ErrorMessage(`The bid time limit cannot be changed after the auction has started.`);\r\n\t\t}\r\n\t\tif (!seconds || seconds < 7 || seconds > 120) {\r\n\t\t\tthrow new Chat.ErrorMessage(`The bid time limit must be between 7 and 120 seconds.`);\r\n\t\t}\r\n\t\tthis.bidTimeLimit = this.bidTimeRemaining = seconds;\r\n\t}\r\n\r\n\tsetType(auctionType: string) {\r\n\t\tif (this.state !== 'setup') {\r\n\t\t\tthrow new Chat.ErrorMessage(`The auction type cannot be changed after the auction has started.`);\r\n\t\t}\r\n\t\tif (!['auction', 'blind', 'snake'].includes(toID(auctionType))) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Invalid auction type \"${auctionType}\". Valid types are \"auction\", \"blind\", and \"snake\".`);\r\n\t\t}\r\n\t\tthis.type = toID(auctionType) as 'auction' | 'blind' | 'snake';\r\n\t\tthis.nomTimeLimit = this.nomTimeRemaining = this.type === 'snake' ? 60 : 0;\r\n\t\tthis.bidTimeLimit = this.bidTimeRemaining = this.type === 'blind' ? 30 : 10;\r\n\t}\r\n\r\n\tgetUndraftedPlayers() {\r\n\t\treturn [...this.auctionPlayers.values()].filter(p => !p.team);\r\n\t}\r\n\r\n\tgetDraftedPlayers() {\r\n\t\treturn [...this.auctionPlayers.values()].filter(p => p.team);\r\n\t}\r\n\r\n\timportPlayers(data: string) {\r\n\t\tif (this.state !== 'setup') {\r\n\t\t\tthrow new Chat.ErrorMessage(`Player lists cannot be imported after the auction has started.`);\r\n\t\t}\r\n\t\tconst rows = data.replace('\\r', '').split('\\n');\r\n\t\tconst tierNames = rows.shift()!.split('\\t').slice(1);\r\n\t\tif (tierNames.some(tier => tier.length > 30)) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Tier names must be 30 characters or less.`);\r\n\t\t}\r\n\r\n\t\tconst playerList = new Map<string, Player>();\r\n\t\tfor (const row of rows) {\r\n\t\t\tconst tiersPlayed = [];\r\n\t\t\tconst tiersNotPlayed = [];\r\n\t\t\tconst [name, ...tierData] = row.split('\\t');\r\n\t\t\tfor (let i = 0; i < tierData.length; i++) {\r\n\t\t\t\tswitch (tierData[i].trim().toLowerCase()) {\r\n\t\t\t\tcase 'y':\r\n\t\t\t\t\tif (!tierNames[i]) throw new Chat.ErrorMessage(`Invalid tier data found in the pastebin.`);\r\n\t\t\t\t\ttiersPlayed.push(tierNames[i]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'n':\r\n\t\t\t\t\tif (!tierNames[i]) throw new Chat.ErrorMessage(`Invalid tier data found in the pastebin.`);\r\n\t\t\t\t\ttiersNotPlayed.push(tierNames[i]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (name.length > 25) throw new Chat.ErrorMessage(`Player names must be 25 characters or less.`);\r\n\t\t\tconst player: Player = {\r\n\t\t\t\tid: toID(name),\r\n\t\t\t\tname: name.trim(),\r\n\t\t\t\tprice: 0,\r\n\t\t\t\ttiersPlayed,\r\n\t\t\t\ttiersNotPlayed,\r\n\t\t\t};\r\n\t\t\tplayerList.set(player.id, player);\r\n\t\t}\r\n\t\tthis.auctionPlayers = playerList;\r\n\t}\r\n\r\n\taddAuctionPlayer(name: string, tiersPlayed: string[] = [], tiersNotPlayed: string[] = []) {\r\n\t\tif (this.state === 'bid') throw new Chat.ErrorMessage(`Players cannot be added during a nomination.`);\r\n\t\tif (name.length > 25) throw new Chat.ErrorMessage(`Player names must be 25 characters or less.`);\r\n\t\tif (tiersPlayed.some(tier => tier.length > 30) || tiersNotPlayed.some(tier => tier.length > 30)) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Tier names must be 30 characters or less.`);\r\n\t\t}\r\n\t\tconst player: Player = {\r\n\t\t\tid: toID(name),\r\n\t\t\tname,\r\n\t\t\tprice: 0,\r\n\t\t\ttiersPlayed,\r\n\t\t\ttiersNotPlayed,\r\n\t\t};\r\n\t\tthis.auctionPlayers.set(player.id, player);\r\n\t\treturn player;\r\n\t}\r\n\r\n\tremoveAuctionPlayer(name: string) {\r\n\t\tif (this.state === 'bid') throw new Chat.ErrorMessage(`Players cannot be removed during a nomination.`);\r\n\t\tconst player = this.auctionPlayers.get(toID(name));\r\n\t\tif (!player) throw new Chat.ErrorMessage(`Player \"${name}\" not found.`);\r\n\t\tplayer.team?.removePlayer(player);\r\n\t\tthis.auctionPlayers.delete(player.id);\r\n\t\tif (this.state !== 'setup' && !this.getUndraftedPlayers().length) {\r\n\t\t\tthis.end('The auction has ended because there are no players remaining in the draft pool.');\r\n\t\t}\r\n\t\treturn player;\r\n\t}\r\n\r\n\tassignPlayer(name: string, teamName?: string) {\r\n\t\tif (this.state === 'bid') throw new Chat.ErrorMessage(`Players cannot be assigned during a nomination.`);\r\n\t\tconst player = this.auctionPlayers.get(toID(name)) || this.addAuctionPlayer(name);\r\n\t\tif (teamName) {\r\n\t\t\tconst team = this.teams.get(toID(teamName));\r\n\t\t\tif (!team) throw new Chat.ErrorMessage(`Team \"${teamName}\" not found.`);\r\n\t\t\tteam.addPlayer(player);\r\n\t\t\tif (this.state !== 'setup' && !this.getUndraftedPlayers().length) {\r\n\t\t\t\treturn this.end('The auction has ended because there are no players remaining in the draft pool.');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tplayer.team?.removePlayer(player);\r\n\t\t}\r\n\t}\r\n\r\n\taddTeam(name: string) {\r\n\t\tif (this.state !== 'setup') throw new Chat.ErrorMessage(`Teams cannot be added after the auction has started.`);\r\n\t\tif (name.length > 40) throw new Chat.ErrorMessage(`Team names must be 40 characters or less.`);\r\n\t\tconst team = new Team(name, this);\r\n\t\tthis.teams.set(team.id, team);\r\n\t\tconst teams = [...this.teams.values()];\r\n\t\tthis.queue = teams.concat(teams.slice().reverse());\r\n\t\treturn team;\r\n\t}\r\n\r\n\tremoveTeam(name: string) {\r\n\t\tif (this.state !== 'setup') throw new Chat.ErrorMessage(`Teams cannot be removed after the auction has started.`);\r\n\t\tconst team = this.teams.get(toID(name));\r\n\t\tif (!team) throw new Chat.ErrorMessage(`Team \"${name}\" not found.`);\r\n\t\tthis.queue = this.queue.filter(t => t !== team);\r\n\t\tthis.teams.delete(team.id);\r\n\t\treturn team;\r\n\t}\r\n\r\n\tsuspendTeam(name: string) {\r\n\t\tif (this.state === 'bid') throw new Chat.ErrorMessage(`Teams cannot be suspended during a nomination.`);\r\n\t\tconst team = this.teams.get(toID(name));\r\n\t\tif (!team) throw new Chat.ErrorMessage(`Team \"${name}\" not found.`);\r\n\t\tif (team.suspended) throw new Chat.ErrorMessage(`Team ${name} is already suspended.`);\r\n\t\tif (this.nominatingTeam === team) throw new Chat.ErrorMessage(`The nominating team cannot be suspended.`);\r\n\t\tteam.suspended = true;\r\n\t\treturn team;\r\n\t}\r\n\r\n\tunsuspendTeam(name: string) {\r\n\t\tif (this.state === 'bid') throw new Chat.ErrorMessage(`Teams cannot be unsuspended during a nomination.`);\r\n\t\tconst team = this.teams.get(toID(name));\r\n\t\tif (!team) throw new Chat.ErrorMessage(`Team \"${name}\" not found.`);\r\n\t\tif (!team.suspended) throw new Chat.ErrorMessage(`Team ${name} is not suspended.`);\r\n\t\tteam.suspended = false;\r\n\t\treturn team;\r\n\t}\r\n\r\n\taddManagers(teamName: string, users: string[]) {\r\n\t\tconst team = this.teams.get(toID(teamName));\r\n\t\tif (!team) throw new Chat.ErrorMessage(`Team \"${teamName}\" not found.`);\r\n\t\tconst problemUsers = users.filter(user => !toID(user) || toID(user).length > 18);\r\n\t\tif (problemUsers.length) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Invalid usernames: ${problemUsers.join(', ')}`);\r\n\t\t}\r\n\t\tfor (const id of users.map(toID)) {\r\n\t\t\tconst manager = this.managers.get(id);\r\n\t\t\tif (!manager) {\r\n\t\t\t\tthis.managers.set(id, { id, team });\r\n\t\t\t} else {\r\n\t\t\t\tmanager.team = team;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn team;\r\n\t}\r\n\r\n\tremoveManagers(users: string[]) {\r\n\t\tconst problemUsers = users.filter(user => !this.managers.has(toID(user)));\r\n\t\tif (problemUsers.length) {\r\n\t\t\tthrow new Chat.ErrorMessage(`Invalid managers: ${problemUsers.join(', ')}`);\r\n\t\t}\r\n\t\tfor (const id of users.map(toID)) {\r\n\t\t\tthis.managers.delete(id);\r\n\t\t}\r\n\t}\r\n\r\n\taddCreditsToTeam(teamName: string, amount: number) {\r\n\t\tif (this.type === 'snake') throw new Chat.ErrorMessage(`Snake draft does not support credits.`);\r\n\t\tif (this.state === 'bid') throw new Chat.ErrorMessage(`Credits cannot be changed during a nomination.`);\r\n\t\tconst team = this.teams.get(toID(teamName));\r\n\t\tif (!team) throw new Chat.ErrorMessage(`Team \"${teamName}\" not found.`);\r\n\t\tconst newCredits = team.credits + amount;\r\n\t\tif (newCredits <= 0 || newCredits > 10000000) {\r\n\t\t\tthrow new Chat.ErrorMessage(`A team must have between 0 and 10,000,000 credits.`);\r\n\t\t}\r\n\t\tif (team.maxBid(newCredits) < this.minBid) {\r\n\t\t\tthrow new Chat.ErrorMessage(`A team must have enough credits to draft the minimum amount of players.`);\r\n\t\t}\r\n\t\tteam.credits = newCredits;\r\n\t\treturn team;\r\n\t}\r\n\r\n\tstart() {\r\n\t\tif (this.state !== 'setup') throw new Chat.ErrorMessage(`The auction has already started.`);\r\n\t\tif (this.teams.size < 2) throw new Chat.ErrorMessage(`The auction needs at least 2 teams to start.`);\r\n\t\tconst problemTeams = [...this.teams.values()].filter(t => t.maxBid() < this.minBid).map(t => t.name);\r\n\t\tif (problemTeams.length) {\r\n\t\t\tthrow new Chat.ErrorMessage(`The following teams do not have enough credits to draft the minimum amount of players: ${problemTeams.join(', ')}`);\r\n\t\t}\r\n\t\tthis.next();\r\n\t}\r\n\r\n\treset() {\r\n\t\tconst teams = [...this.teams.values()];\r\n\t\tfor (const team of teams) {\r\n\t\t\tteam.credits = this.startingCredits;\r\n\t\t\tteam.suspended = false;\r\n\t\t\tfor (const player of team.players) {\r\n\t\t\t\tdelete player.team;\r\n\t\t\t\tplayer.price = 0;\r\n\t\t\t}\r\n\t\t\tteam.players = [];\r\n\t\t}\r\n\t\tthis.lastQueue = null;\r\n\t\tthis.queue = teams.concat(teams.slice().reverse());\r\n\t\tthis.clearNomTimer();\r\n\t\tthis.clearBidTimer();\r\n\t\tthis.state = 'setup';\r\n\t\tthis.sendHTMLBox(this.generateAuctionTable());\r\n\t}\r\n\r\n\tnext() {\r\n\t\tthis.state = 'nom';\r\n\t\tif (!this.queue.filter(team => !team.isSuspended()).length) {\r\n\t\t\treturn this.end('The auction has ended because there are no teams remaining that can draft players.');\r\n\t\t}\r\n\t\tif (!this.getUndraftedPlayers().length) {\r\n\t\t\treturn this.end('The auction has ended because there are no players remaining in the draft pool.');\r\n\t\t}\r\n\t\tdo {\r\n\t\t\tthis.nominatingTeam = this.queue.shift()!;\r\n\t\t\tthis.queue.push(this.nominatingTeam);\r\n\t\t} while (this.nominatingTeam.isSuspended());\r\n\t\tthis.sendHTMLBox(this.generateAuctionTable());\r\n\t\tthis.sendMessage(`/html It is now <b>${Utils.escapeHTML(this.nominatingTeam.name)}</b>'s turn to nominate a player. Managers: ${this.nominatingTeam.getManagers().map(m => `<username class=\"username\">${Utils.escapeHTML(m)}</username>`).join(' ')}`);\r\n\t\tthis.startNomTimer();\r\n\t}\r\n\r\n\tnominate(user: User, target: string) {\r\n\t\tif (this.state !== 'nom') throw new Chat.ErrorMessage(`You cannot nominate players right now.`);\r\n\t\tconst manager = this.managers.get(user.id);\r\n\t\tif (!manager || manager.team !== this.nominatingTeam) this.checkOwner(user);\r\n\r\n\t\t// For undo\r\n\t\tthis.lastQueue = this.queue.slice();\r\n\t\tthis.lastQueue.unshift(this.lastQueue.pop()!);\r\n\r\n\t\tconst player = this.auctionPlayers.get(toID(target));\r\n\t\tif (!player) throw new Chat.ErrorMessage(`${target} is not a valid player.`);\r\n\t\tif (player.team) throw new Chat.ErrorMessage(`${player.name} has already been drafted.`);\r\n\t\tthis.clearNomTimer();\r\n\t\tthis.nominatedPlayer = player;\r\n\t\tif (this.type === 'snake') {\r\n\t\t\tthis.sendMessage(Utils.html`/html <b>${this.nominatingTeam.name}</b> drafted <username>${this.nominatedPlayer.name}</username>!`);\r\n\t\t\tthis.nominatingTeam.addPlayer(this.nominatedPlayer);\r\n\t\t\tthis.next();\r\n\t\t} else {\r\n\t\t\tthis.state = 'bid';\r\n\t\t\tthis.highestBid = this.minBid;\r\n\t\t\tthis.highestBidder = this.nominatingTeam;\r\n\t\t\tthis.sendMessage(Utils.html`/html <username class=\"username\">${user.name}</username> from team <b>${this.nominatingTeam.name}</b> has nominated <username>${player.name}</username> for auction!`);\r\n\t\t\tconst notifyMsg = Utils.html`|notify|${this.room.title} Auction|${player.name} has been nominated!`;\r\n\t\t\tfor (const currManager of this.managers.values()) {\r\n\t\t\t\tif (currManager.team === this.nominatingTeam) continue;\r\n\t\t\t\tconst curUser = Users.getExact(currManager.id);\r\n\t\t\t\tcurUser?.sendTo(this.room, notifyMsg);\r\n\t\t\t\tcurUser?.sendTo(this.room,\r\n\t\t\t\t\t`|raw|Send a message with the amount you want to bid (e.g. <code>.5</code> or <code>5</code> will place a bid of 5000)!`);\r\n\t\t\t}\r\n\t\t\tthis.sendBidInfo();\r\n\t\t\tthis.startBidTimer();\r\n\t\t}\r\n\t}\r\n\r\n\tbid(user: User, bid: number) {\r\n\t\tif (this.state !== 'bid') throw new Chat.ErrorMessage(`There are no players up for auction right now.`);\r\n\t\tconst team = this.managers.get(user.id)?.team;\r\n\t\tif (!team) throw new Chat.ErrorMessage(`Only managers can bid on players.`);\r\n\t\tif (team.isSuspended()) throw new Chat.ErrorMessage(`Your team is suspended and cannot place bids.`);\r\n\r\n\t\tif (bid > team.maxBid()) throw new Chat.ErrorMessage(`Your team cannot afford to bid that much.`);\r\n\r\n\t\tif (this.type === 'blind') {\r\n\t\t\tif (this.bidsPlaced.has(team)) throw new Chat.ErrorMessage(`Your team has already placed a bid.`);\r\n\t\t\tif (bid <= this.minBid) throw new Chat.ErrorMessage(`Your bid must be higher than the minimum bid.`);\r\n\r\n\t\t\tconst msg = `|c:|${Math.floor(Date.now() / 1000)}|&|/html Your team placed a bid of <b>${bid}</b> on <username>${Utils.escapeHTML(this.nominatedPlayer.name)}</username>.`;\r\n\t\t\tfor (const manager of this.managers.values()) {\r\n\t\t\t\tif (manager.team !== team) continue;\r\n\t\t\t\tUsers.getExact(manager.id)?.sendTo(this.room, msg);\r\n\t\t\t}\r\n\r\n\t\t\tif (bid > this.highestBid) {\r\n\t\t\t\tthis.highestBid = bid;\r\n\t\t\t\tthis.highestBidder = team;\r\n\t\t\t}\r\n\t\t\tthis.bidsPlaced.set(team, bid);\r\n\t\t\tif (this.bidsPlaced.size === this.teams.size) {\r\n\t\t\t\tthis.finishCurrentNom();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (bid <= this.highestBid) throw new Chat.ErrorMessage(`Your bid must be higher than the current bid.`);\r\n\t\t\tthis.highestBid = bid;\r\n\t\t\tthis.highestBidder = team;\r\n\t\t\t// this.sendMessage(Utils.html`/html <username class=\"username\">${user.name}</username>[${team.name}]: <b>${bid}</b>`);\r\n\t\t\tthis.sendBidInfo();\r\n\t\t\tthis.startBidTimer();\r\n\t\t}\r\n\t}\r\n\r\n\toverride onChatMessage(message: string, user: User) {\r\n\t\tif (this.state !== 'bid' || this.type !== 'blind') return;\r\n\t\tif (message.startsWith('.')) message = message.slice(1);\r\n\t\tif (Number(message.replace(',', '.'))) {\r\n\t\t\tthis.bid(user, parseCredits(message));\r\n\t\t\treturn '';\r\n\t\t}\r\n\t}\r\n\r\n\toverride onLogMessage(message: string, user: User) {\r\n\t\tif (this.state !== 'bid' || this.type === 'blind') return;\r\n\t\tif (message.startsWith('.')) message = message.slice(1);\r\n\t\tif (Number(message.replace(',', '.'))) {\r\n\t\t\tthis.room.update();\r\n\t\t\ttry {\r\n\t\t\t\tthis.bid(user, parseCredits(message));\r\n\t\t\t} catch (e: any) {\r\n\t\t\t\tif (e.name?.endsWith('ErrorMessage')) {\r\n\t\t\t\t\tuser.sendTo(this.room, Utils.html`|raw|<span class=\"message-error\">${e.message}</span>`);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuser.sendTo(this.room, `|raw|<span class=\"message-error\">An unexpected error occurred while placing your bid.</span>`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tskipNom() {\r\n\t\tif (this.state !== 'nom') throw new Chat.ErrorMessage(`Nominations cannot be skipped right now.`);\r\n\t\tthis.nominatedPlayer = null!;\r\n\t\tthis.sendMessage(`**${this.nominatingTeam.name}**'s nomination turn has been skipped!`);\r\n\t\tthis.clearNomTimer();\r\n\t\tthis.next();\r\n\t}\r\n\r\n\tfinishCurrentNom() {\r\n\t\tif (this.type === 'blind') {\r\n\t\t\tlet buf = `<div class=\"ladder pad\"><table><tr><th>Team</th><th>Bid</th></tr>`;\r\n\t\t\tif (!this.bidsPlaced.has(this.nominatingTeam)) {\r\n\t\t\t\tbuf += Utils.html`<tr><td>${this.nominatingTeam.name}</td><td>${this.minBid}</td></tr>`;\r\n\t\t\t}\r\n\t\t\tfor (const [team, bid] of this.bidsPlaced) {\r\n\t\t\t\tbuf += Utils.html`<tr><td>${team.name}</td><td>${bid}</td></tr>`;\r\n\t\t\t}\r\n\t\t\tbuf += `</table></div>`;\r\n\t\t\tthis.sendHTMLBox(buf);\r\n\t\t\tthis.bidsPlaced.clear();\r\n\t\t}\r\n\t\tthis.sendMessage(Utils.html`/html <b>${this.highestBidder.name}</b> bought <username>${this.nominatedPlayer.name}</username> for <b>${this.highestBid}</b> credits!`);\r\n\t\tthis.highestBidder.addPlayer(this.nominatedPlayer, this.highestBid);\r\n\t\tthis.clearBidTimer();\r\n\t\tthis.next();\r\n\t}\r\n\r\n\tundoLastNom() {\r\n\t\tif (this.state !== 'nom') throw new Chat.ErrorMessage(`Nominations cannot be undone right now.`);\r\n\t\tif (!this.lastQueue) throw new Chat.ErrorMessage(`Only one nomination can be undone at a time.`);\r\n\t\tthis.queue = this.lastQueue;\r\n\t\tthis.lastQueue = null;\r\n\t\tif (this.nominatedPlayer) {\r\n\t\t\tthis.highestBidder.removePlayer(this.nominatedPlayer);\r\n\t\t\tthis.highestBidder.credits += this.highestBid;\r\n\t\t}\r\n\t\tthis.next();\r\n\t}\r\n\r\n\tclearNomTimer() {\r\n\t\tclearInterval(this.nomTimer);\r\n\t\tthis.nomTimeRemaining = this.nomTimeLimit;\r\n\t\tthis.room.add('|uhtmlchange|timer|');\r\n\t}\r\n\r\n\tstartNomTimer() {\r\n\t\tif (!this.nomTimeLimit) return;\r\n\t\tthis.clearNomTimer();\r\n\t\tthis.sendTimer(false, true);\r\n\t\tthis.nomTimer = setInterval(() => this.pokeNomTimer(), 1000);\r\n\t}\r\n\r\n\tclearBidTimer() {\r\n\t\tclearInterval(this.bidTimer);\r\n\t\tthis.bidTimeRemaining = this.bidTimeLimit;\r\n\t\tthis.room.add('|uhtmlchange|timer|');\r\n\t}\r\n\r\n\tstartBidTimer() {\r\n\t\tif (!this.bidTimeLimit) return;\r\n\t\tthis.clearBidTimer();\r\n\t\tthis.sendTimer();\r\n\t\tthis.bidTimer = setInterval(() => this.pokeBidTimer(), 1000);\r\n\t}\r\n\r\n\tpokeNomTimer() {\r\n\t\tthis.nomTimeRemaining--;\r\n\t\tif (!this.nomTimeRemaining) {\r\n\t\t\tthis.skipNom();\r\n\t\t} else {\r\n\t\t\tthis.sendTimer(true, true);\r\n\t\t\tif (this.nomTimeRemaining % 30 === 0 || [20, 10, 5].includes(this.nomTimeRemaining)) {\r\n\t\t\t\tthis.sendMessage(`/html <span class=\"message-error\">${this.nomTimeRemaining} seconds left!</span>`);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpokeBidTimer() {\r\n\t\tthis.bidTimeRemaining--;\r\n\t\tif (!this.bidTimeRemaining) {\r\n\t\t\tthis.finishCurrentNom();\r\n\t\t} else {\r\n\t\t\tthis.sendTimer(true);\r\n\t\t\tif (this.bidTimeRemaining % 30 === 0 || [20, 10, 5].includes(this.bidTimeRemaining)) {\r\n\t\t\t\tthis.sendMessage(`/html <span class=\"message-error\">${this.bidTimeRemaining} seconds left!</span>`);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tend(message?: string) {\r\n\t\tthis.setEnded();\r\n\t\tthis.sendHTMLBox(this.generateAuctionTable());\r\n\t\tthis.sendHTMLBox(this.generatePriceList());\r\n\t\tif (message) this.sendMessage(message);\r\n\t\tthis.destroy();\r\n\t}\r\n\r\n\toverride destroy() {\r\n\t\tthis.clearNomTimer();\r\n\t\tthis.clearBidTimer();\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n\r\nexport const commands: Chat.ChatCommands = {\r\n\tauction: {\r\n\t\tcreate(target, room, user) {\r\n\t\t\troom = this.requireRoom();\r\n\t\t\tthis.checkCan('minigame', null, room);\r\n\t\t\tif (room.game) throw new Chat.ErrorMessage(`There is already a game of ${room.game.title} in progress in this room.`);\r\n\t\t\tif (room.settings.auctionDisabled) throw new Chat.ErrorMessage('Auctions are currently disabled in this room.');\r\n\r\n\t\t\tlet startingCredits;\r\n\t\t\tif (target) {\r\n\t\t\t\tstartingCredits = parseCredits(target);\r\n\t\t\t\tif (startingCredits < 10000 || startingCredits > 10000000) {\r\n\t\t\t\t\tthrow new Chat.ErrorMessage(`Starting credits must be between 10,000 and 10,000,000.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst auction = new Auction(room, startingCredits);\r\n\t\t\tauction.addOwners([user.id]);\r\n\t\t\troom.game = auction;\r\n\t\t\tthis.addModAction(`An auction was created by ${user.name}.`);\r\n\t\t\tthis.modlog(`AUCTION CREATE`);\r\n\t\t},\r\n\t\tcreatehelp: [\r\n\t\t\t`/auction create [startingcredits] - Creates an auction. Requires: % @ # ~`,\r\n\t\t],\r\n\t\tstart(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tauction.start();\r\n\t\t\tthis.addModAction(`The auction was started by ${user.name}.`);\r\n\t\t\tthis.modlog(`AUCTION START`);\r\n\t\t},\r\n\t\treset(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tauction.reset();\r\n\t\t\tthis.addModAction(`The auction was reset by ${user.name}.`);\r\n\t\t\tthis.modlog(`AUCTION RESET`);\r\n\t\t},\r\n\t\tdelete: 'end',\r\n\t\tstop: 'end',\r\n\t\tend(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tauction.end();\r\n\t\t\tthis.addModAction(`The auction was ended by ${user.name}.`);\r\n\t\t\tthis.modlog('AUCTION END');\r\n\t\t},\r\n\t\tinfo: 'display',\r\n\t\tdisplay(target, room, user) {\r\n\t\t\tthis.runBroadcast();\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tthis.sendReplyBox(auction.generateAuctionTable());\r\n\t\t},\r\n\t\tpricelist(target, room, user) {\r\n\t\t\tthis.runBroadcast();\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tthis.sendReplyBox(auction.generatePriceList());\r\n\t\t},\r\n\t\tminbid(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tif (!target) return this.parse('/help auction minbid');\r\n\t\t\tconst amount = parseCredits(target);\r\n\t\t\tauction.setMinBid(amount);\r\n\t\t\tthis.addModAction(`${user.name} set the minimum bid to ${amount}.`);\r\n\t\t\tthis.modlog('AUCTION MINBID', null, `${amount}`);\r\n\t\t},\r\n\t\tminbidhelp: [\r\n\t\t\t`/auction minbid [amount] - Sets the minimum bid. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tminplayers(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tif (!target) return this.parse('/help auction minplayers');\r\n\t\t\tconst amount = parseInt(target);\r\n\t\t\tauction.setMinPlayers(amount);\r\n\t\t\tthis.addModAction(`${user.name} set the minimum number of players to ${amount}.`);\r\n\t\t},\r\n\t\tminplayershelp: [\r\n\t\t\t`/auction minplayers [amount] - Sets the minimum number of players. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tmaxplayers(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tif (!target) return this.parse('/help auction maxplayers');\r\n\t\t\tconst amount = parseInt(target);\r\n\t\t\tauction.setMaxPlayers(amount);\r\n\t\t\tthis.addModAction(`${user.name} set the maximum number of players to ${amount}.`);\r\n\t\t},\r\n\t\tmaxplayershelp: [\r\n\t\t\t`/auction maxplayers [amount] - Sets the maximum number of players. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tnomtimer(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tif (!target) return this.parse('/help auction nomtimer');\r\n\t\t\tconst seconds = this.meansNo(target) ? 0 : parseInt(target);\r\n\t\t\tauction.setNomTimeLimit(seconds);\r\n\t\t\tthis.addModAction(`${user.name} set the nomination timer to ${seconds} seconds.`);\r\n\t\t},\r\n\t\tnomtimerhelp: [\r\n\t\t\t`/auction nomtimer [seconds/off] - Sets the nomination timer to [seconds] seconds or disables it. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tbidtimer(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tif (!target) return this.parse('/help auction settimer');\r\n\t\t\tconst seconds = parseInt(target);\r\n\t\t\tauction.setBidTimeLimit(seconds);\r\n\t\t\tthis.addModAction(`${user.name} set the bid timer to ${seconds} seconds.`);\r\n\t\t},\r\n\t\tbidtimerhelp: [\r\n\t\t\t`/auction timer [seconds] - Sets the bid timer to [seconds] seconds. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tsettype(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tif (!target) return this.parse('/help auction settype');\r\n\t\t\tauction.setType(target);\r\n\t\t\tthis.addModAction(`${user.name} set the auction type to ${toID(target)}.`);\r\n\t\t},\r\n\t\tsettypehelp: [\r\n\t\t\t`/auction settype [auction|blind|snake] - Sets the auction type. Requires: # ~ auction owner`,\r\n\t\t\t`- auction: Standard auction with credits and bidding.`,\r\n\t\t\t`- blind: Same as auction, but bids are hidden until the end of the nomination.`,\r\n\t\t\t`- snake: Standard snake draft with no credits or bidding.`,\r\n\t\t],\r\n\t\taddowner: 'addowners',\r\n\t\taddowners(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tconst owners = target.split(',').map(x => x.trim());\r\n\t\t\tif (!owners.length) return this.parse('/help auction addowners');\r\n\t\t\tauction.addOwners(owners);\r\n\t\t\tthis.addModAction(`${user.name} added ${Chat.toListString(owners.map(o => Users.getExact(o)!.name))} as auction owner${Chat.plural(owners.length)}.`);\r\n\t\t},\r\n\t\taddownershelp: [\r\n\t\t\t`/auction addowners [user1], [user2], ... - Adds users as auction owners. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tremoveowner: 'removeowners',\r\n\t\tremoveowners(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tconst owners = target.split(',').map(x => x.trim());\r\n\t\t\tif (!owners.length) return this.parse('/help auction removeowners');\r\n\t\t\tauction.removeOwners(owners);\r\n\t\t\tthis.addModAction(`${user.name} removed ${Chat.toListString(owners.map(o => Users.getExact(o)?.name || o))} as auction owner${Chat.plural(owners.length)}.`);\r\n\t\t},\r\n\t\tremoveownershelp: [\r\n\t\t\t`/auction removeowners [user1], [user2], ... - Removes users as auction owners. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tasync importplayers(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tif (!target) return this.parse('/help auction importplayers');\r\n\t\t\tif (!/^https?:\\/\\/pastebin\\.com\\/[a-zA-Z0-9]+$/.test(target)) {\r\n\t\t\t\tthrow new Chat.ErrorMessage('Invalid pastebin URL.');\r\n\t\t\t}\r\n\t\t\tlet data = '';\r\n\t\t\ttry {\r\n\t\t\t\tdata = await Net(`https://pastebin.com/raw/${target.split('/').pop()}`).get();\r\n\t\t\t} catch {}\r\n\t\t\tif (!data) throw new Chat.ErrorMessage('Error fetching data from pastebin.');\r\n\r\n\t\t\tauction.importPlayers(data);\r\n\t\t\tthis.addModAction(`${user.name} imported the player list from ${target}.`);\r\n\t\t},\r\n\t\timportplayershelp: [\r\n\t\t\t`/auction importplayers [pastebin url] - Imports a list of players from a pastebin. Requires: # ~ auction owner`,\r\n\t\t\t`The pastebin should be a list of tab-separated values with the first row containing tier names and subsequent rows containing the player names and either a 'y' or an 'n' in the column corresponding to the tier they prefer or do not play respectively.`,\r\n\t\t\t`See https://pastebin.com/jPTbJBva for an example.`,\r\n\t\t],\r\n\t\taddplayer(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tconst [playedPart, notPlayedPart] = target.split(\";\");\r\n\t\t\tconst tiersPlayed = playedPart.split(\",\").map(item => item.trim());\r\n\t\t\tconst tiersNotPlayed = notPlayedPart ? notPlayedPart.split(\",\").map(item => item.trim()) : [];\r\n\t\t\tconst name = tiersPlayed.shift();\r\n\r\n\t\t\tif (!name) return this.parse('/help auction addplayer');\r\n\t\t\tconst player = auction.addAuctionPlayer(name, tiersPlayed, tiersNotPlayed);\r\n\t\t\tthis.addModAction(`${user.name} added player ${player.name} to the auction.`);\r\n\t\t},\r\n\t\taddplayerhelp: [\r\n\t\t\t`/auction addplayer [name], [tierPlayed1], [tierPlayed2], ... ; [tierNotPlayed1], [tierNotPlayed2], ... - Adds a player to the auction. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tremoveplayer(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tif (!target) return this.parse('/help auction removeplayer');\r\n\t\t\tconst player = auction.removeAuctionPlayer(target);\r\n\t\t\tthis.addModAction(`${user.name} removed player ${player.name} from the auction.`);\r\n\t\t},\r\n\t\tremoveplayerhelp: [\r\n\t\t\t`/auction removeplayer [name] - Removes a player from the auction. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tassignplayer(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tconst [player, team] = target.split(',').map(x => x.trim());\r\n\t\t\tif (!player) return this.parse('/help auction assignplayer');\r\n\t\t\tif (team) {\r\n\t\t\t\tauction.assignPlayer(player, team);\r\n\t\t\t\tthis.addModAction(`${user.name} assigned player ${player} to team ${team}.`);\r\n\t\t\t} else {\r\n\t\t\t\tauction.assignPlayer(player);\r\n\t\t\t\tthis.sendReply(`${user.name} returned player ${player} to the draft pool.`);\r\n\t\t\t}\r\n\t\t},\r\n\t\tassignplayerhelp: [\r\n\t\t\t`/auction assignplayer [player], [team] - Assigns a player to a team. If team is blank, returns player to draft pool. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\taddteam(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tconst [name, ...managerNames] = target.split(',').map(x => x.trim());\r\n\t\t\tif (!name) return this.parse('/help auction addteam');\r\n\t\t\tconst team = auction.addTeam(name);\r\n\t\t\tthis.addModAction(`${user.name} added team ${team.name} to the auction.`);\r\n\t\t\tauction.addManagers(team.name, managerNames);\r\n\t\t},\r\n\t\taddteamhelp: [\r\n\t\t\t`/auction addteam [name], [manager1], [manager2], ... - Adds a team to the auction. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tremoveteam(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tif (!target) return this.parse('/help auction removeteam');\r\n\t\t\tconst team = auction.removeTeam(target);\r\n\t\t\tthis.addModAction(`${user.name} removed team ${team.name} from the auction.`);\r\n\t\t},\r\n\t\tremoveteamhelp: [\r\n\t\t\t`/auction removeteam [team] - Removes a team from the auction. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tsuspendteam(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tif (!target) return this.parse('/help auction suspendteam');\r\n\t\t\tconst team = auction.suspendTeam(target);\r\n\t\t\tthis.addModAction(`${user.name} suspended team ${team.name}.`);\r\n\t\t},\r\n\t\tsuspendteamhelp: [\r\n\t\t\t`/auction suspendteam [team] - Suspends a team from the auction. Requires: # ~ auction owner`,\r\n\t\t\t`Suspended teams have their nomination turns skipped and are not allowed to place bids.`,\r\n\t\t],\r\n\t\tunsuspendteam(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tif (!target) return this.parse('/help auction unsuspendteam');\r\n\t\t\tconst team = auction.unsuspendTeam(target);\r\n\t\t\tthis.addModAction(`${user.name} unsuspended team ${team.name}.`);\r\n\t\t},\r\n\t\tunsuspendteamhelp: [\r\n\t\t\t`/auction unsuspendteam [team] - Unsuspends a team from the auction. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\taddmanager: 'addmanagers',\r\n\t\taddmanagers(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tconst [teamName, ...managerNames] = target.split(',').map(x => x.trim());\r\n\t\t\tif (!teamName || !managerNames.length) return this.parse('/help auction addmanagers');\r\n\t\t\tconst team = auction.addManagers(teamName, managerNames);\r\n\t\t\tconst managers = managerNames.map(m => Users.getExact(m)?.name || toID(m));\r\n\t\t\tthis.addModAction(`${user.name} added ${Chat.toListString(managers)} as manager${Chat.plural(managers.length)} for team ${team.name}.`);\r\n\t\t},\r\n\t\taddmanagershelp: [\r\n\t\t\t`/auction addmanagers [team], [user1], [user2], ... - Adds users as managers to a team. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tremovemanager: 'removemanagers',\r\n\t\tremovemanagers(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tif (!target) return this.parse('/help auction removemanagers');\r\n\t\t\tconst managerNames = target.split(',').map(x => x.trim());\r\n\t\t\tauction.removeManagers(managerNames);\r\n\t\t\tconst managers = managerNames.map(m => Users.getExact(m)?.name || toID(m));\r\n\t\t\tthis.addModAction(`${user.name} removed ${Chat.toListString(managers)} as manager${Chat.plural(managers.length)}.`);\r\n\t\t},\r\n\t\tremovemanagershelp: [\r\n\t\t\t`/auction removemanagers [user1], [user2], ... - Removes users as managers. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\taddcredits(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tconst [teamName, amount] = target.split(',').map(x => x.trim());\r\n\t\t\tif (!teamName || !amount) return this.parse('/help auction addcredits');\r\n\t\t\tconst credits = parseCredits(amount);\r\n\t\t\tconst team = auction.addCreditsToTeam(teamName, credits);\r\n\t\t\tthis.addModAction(`${user.name} ${credits < 0 ? 'removed' : 'added'} ${Math.abs(credits)} credits ${credits < 0 ? 'from' : 'to'} team ${team.name}.`);\r\n\t\t},\r\n\t\taddcreditshelp: [\r\n\t\t\t`/auction addcredits [team], [amount] - Adds credits to a team. Requires: # ~ auction owner`,\r\n\t\t],\r\n\t\tnom: 'nominate',\r\n\t\tnominate(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tif (!target) return this.parse('/help auction nominate');\r\n\t\t\tauction.nominate(user, target);\r\n\t\t},\r\n\t\tnominatehelp: [\r\n\t\t\t`/auction nominate OR /nom [player] - Nominates a player for auction.`,\r\n\t\t],\r\n\t\tskip: 'skipnom',\r\n\t\tskipnom(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tauction.skipNom();\r\n\t\t\tthis.addModAction(`${user.name} skipped the previous nomination.`);\r\n\t\t},\r\n\t\tundo(target, room, user) {\r\n\t\t\tconst auction = this.requireGame(Auction);\r\n\t\t\tauction.checkOwner(user);\r\n\r\n\t\t\tauction.undoLastNom();\r\n\t\t\tthis.addModAction(`${user.name} undid the last nomination.`);\r\n\t\t},\r\n\t\tdisable(target, room) {\r\n\t\t\troom = this.requireRoom();\r\n\t\t\tthis.checkCan('gamemanagement', null, room);\r\n\t\t\tif (room.settings.auctionDisabled) {\r\n\t\t\t\tthrow new Chat.ErrorMessage('Auctions are already disabled.');\r\n\t\t\t}\r\n\t\t\troom.settings.auctionDisabled = true;\r\n\t\t\troom.saveSettings();\r\n\t\t\tthis.sendReply('Auctions have been disabled for this room.');\r\n\t\t},\r\n\t\tenable(target, room) {\r\n\t\t\troom = this.requireRoom();\r\n\t\t\tthis.checkCan('gamemanagement', null, room);\r\n\t\t\tif (!room.settings.auctionDisabled) {\r\n\t\t\t\tthrow new Chat.ErrorMessage('Auctions are already enabled.');\r\n\t\t\t}\r\n\t\t\tdelete room.settings.auctionDisabled;\r\n\t\t\troom.saveSettings();\r\n\t\t\tthis.sendReply('Auctions have been enabled for this room.');\r\n\t\t},\r\n\t\tongoing: 'running',\r\n\t\trunning() {\r\n\t\t\tif (!this.runBroadcast()) return;\r\n\t\t\tconst runningAuctions = [...Rooms.rooms.values()].filter(r => r.getGame(Auction)).map(r => r.title);\r\n\t\t\tthis.sendReply(`Running auctions: ${runningAuctions.join(', ') || 'None'}`);\r\n\t\t},\r\n\t\t'': 'help',\r\n\t\thelp() {\r\n\t\t\tthis.parse('/help auction');\r\n\t\t},\r\n\t},\r\n\tauctionhelp() {\r\n\t\tif (!this.runBroadcast()) return;\r\n\t\tthis.sendReplyBox(\r\n\t\t\t`Auction commands<br/>` +\r\n\t\t\t`- create [startingcredits]: Creates an auction.<br/>` +\r\n\t\t\t`- start: Starts the auction.<br/>` +\r\n\t\t\t`- reset: Resets the auction.<br/>` +\r\n\t\t\t`- end: Ends the auction.<br/>` +\r\n\t\t\t`- running: Shows a list of rooms with running auctions.<br/>` +\r\n\t\t\t`- display: Displays the current state of the auction.<br/>` +\r\n\t\t\t`- pricelist: Displays the current prices of players by team.<br/>` +\r\n\t\t\t`- nom [player]: Nominates a player for auction.<br/>` +\r\n\t\t\t`You may use /nom directly without the /auction prefix.<br/>` +\r\n\t\t\t`During the bidding phase, all numbers that are sent in the chat will be treated as bids.<br/><br/>` +\r\n\t\t\t`<details class=\"readmore\"><summary>Configuration Commands</summary>` +\r\n\t\t\t`- minbid [amount]: Sets the minimum bid.<br/>` +\r\n\t\t\t`- minplayers [amount]: Sets the minimum number of players.<br/>` +\r\n\t\t\t`- nomtimer [seconds]: Sets the nomination timer to [seconds] seconds.<br/>` +\r\n\t\t\t`- bidtimer [seconds]: Sets the bid timer to [seconds] seconds.<br/>` +\r\n\t\t\t`- settype [auction|blind|snake]: Sets the auction type.<br/>` +\r\n\t\t\t`- addowners [user1], [user2], ...: Adds users as auction owners.<br/>` +\r\n\t\t\t`- removeowners [user1], [user2], ...: Removes users as auction owners.<br/>` +\r\n\t\t\t`- importplayers [pastebin url]: Imports a list of players from a pastebin.<br/>` +\r\n\t\t\t`- addplayer [name], [tier1], [tier2], ...: Adds a player to the auction.<br/>` +\r\n\t\t\t`- removeplayer [name]: Removes a player from the auction.<br/>` +\r\n\t\t\t`- assignplayer [player], [team]: Assigns a player to a team. If team is blank, returns player to draft pool.<br/>` +\r\n\t\t\t`- addteam [name], [manager1], [manager2], ...: Adds a team to the auction.<br/>` +\r\n\t\t\t`- removeteam [name]: Removes the given team from the auction.<br/>` +\r\n\t\t\t`- suspendteam [name]: Suspends the given team from the auction.<br/>` +\r\n\t\t\t`- unsuspendteam [name]: Unsuspends the given team from the auction.<br/>` +\r\n\t\t\t`- addmanagers [team], [user1], [user2], ...: Adds users as managers to a team.<br/>` +\r\n\t\t\t`- removemanagers [user1], [user2], ...: Removes users as managers..<br/>` +\r\n\t\t\t`- addcredits [team], [amount]: Adds credits to a team.<br/>` +\r\n\t\t\t`- skipnom: Skips the current nomination.<br/>` +\r\n\t\t\t`- undo: Undoes the last nomination.<br/>` +\r\n\t\t\t`- [enable/disable]: Enables or disables auctions from being started in a room.<br/>` +\r\n\t\t\t`</details>`\r\n\t\t);\r\n\t},\r\n\tnom(target) {\r\n\t\tthis.parse(`/auction nominate ${target}`);\r\n\t},\r\n\tbid() {\r\n\t\tthrow new Chat.ErrorMessage(`/bid is no longer supported. Send the amount by itself in the chat to place your bid.`);\r\n\t},\r\n\toverpay() {\r\n\t\tthis.requireGame(Auction);\r\n\t\tthis.checkChat();\r\n\t\treturn '/announce OVERPAY!';\r\n\t},\r\n};\r\n\r\nexport const roomSettings: Chat.SettingsHandler = room => ({\r\n\tlabel: \"Auction\",\r\n\tpermission: 'editroom',\r\n\toptions: [\r\n\t\t[`disabled`, room.settings.auctionDisabled || 'auction disable'],\r\n\t\t[`enabled`, !room.settings.auctionDisabled || 'auction enable'],\r\n\t],\r\n});\r\n"],
  "mappings": "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",
  "names": ["table", "smogonTable"]
}
