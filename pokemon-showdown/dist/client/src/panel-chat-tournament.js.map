{
  "version": 3,
  "sources": ["../../../client/src/panel-chat-tournament.tsx"],
  "sourcesContent": ["import preact from \"../js/lib/preact\";\r\nimport { Dex, toRoomid } from \"./battle-dex\";\r\nimport { BattleLog } from \"./battle-log\";\r\nimport { PSModel, type PSSubscription } from \"./client-core\";\r\nimport { PS, type RoomID, type Team } from \"./client-main\";\r\nimport { TeamForm } from \"./panel-mainmenu\";\r\nimport type { Args } from \"./battle-text-parser\";\r\nimport type { ChatRoom } from \"./panel-chat\";\r\n// we check window.d3 before using it, so d3 doesn't need to be loaded before this file\r\nimport * as d3 from 'd3';\r\nimport { PSPanelWrapper, PSRoomPanel } from \"./panels\";\r\n\r\ninterface TreeNode {\r\n\tchildren?: TreeNode[];\r\n}\r\ninterface TournamentTreeBracketNode extends TreeNode {\r\n\tparent?: TournamentTreeBracketNode;\r\n\tchildren?: TournamentTreeBracketNode[];\r\n\tx: number;\r\n\ty: number;\r\n\tstate: string;\r\n\tteam: string;\r\n\troom: string;\r\n\tresult: string;\r\n\tscore: [number, number];\r\n}\r\ninterface TournamentElimBracketNode extends TournamentTreeBracketNode {\r\n\tparent?: TournamentElimBracketNode;\r\n\tchildren?: TournamentElimBracketNode[];\r\n\tteam1: string;\r\n\tteam2: string;\r\n\thighlightLink?: boolean;\r\n\tabbreviated?: boolean;\r\n}\r\ninterface TournamentTreeBracketData {\r\n\ttype: 'tree';\r\n\tusers: string[];\r\n\trootNode: TournamentTreeBracketNode;\r\n}\r\ninterface TournamentTableBracketData {\r\n\ttype: 'table';\r\n\tusers: string[];\r\n\ttableContents: {\r\n\t\tstate: string,\r\n\t\troom: string,\r\n\t\tresult: string,\r\n\t\tscore: [number, number],\r\n\t}[][];\r\n\ttableHeaders: {\r\n\t\trows: string[],\r\n\t\tcols: string[],\r\n\t};\r\n\tscores: number[];\r\n}\r\ntype TournamentInfo = {\r\n\tformat?: string,\r\n\tteambuilderFormat?: string,\r\n\tgenerator?: string,\r\n\tisActive?: boolean,\r\n\tisJoined?: boolean,\r\n\tisStarted?: boolean,\r\n\tchallenging?: string | null,\r\n\tchallenged?: string | null,\r\n\tchallenges?: string[],\r\n\tchallengeBys?: string[],\r\n\tbracketData?: TournamentTreeBracketData | TournamentTableBracketData,\r\n};\r\nexport class ChatTournament extends PSModel {\r\n\tinfo: TournamentInfo = {};\r\n\tupdates: TournamentInfo = {};\r\n\troom: ChatRoom;\r\n\tboxVisible = false;\r\n\tselectedChallenge = 0;\r\n\tjoinLeave: { join: string[], leave: string[], messageId: string } | null = null;\r\n\tconstructor(room: ChatRoom) {\r\n\t\tsuper();\r\n\t\tthis.room = room;\r\n\t}\r\n\ttryAdd(line: string) {\r\n\t\tif (PS.prefs.tournaments === 'hide') return false;\r\n\t\tthis.room.add(line);\r\n\t\treturn true;\r\n\t}\r\n\tstatic arrayToPhrase(array: string[], finalSeparator = 'and') {\r\n\t\tif (array.length <= 1)\r\n\t\t\treturn array.join();\r\n\t\treturn `${array.slice(0, -1).join(\", \")} ${finalSeparator} ${array.slice(-1)[0]}`;\r\n\t}\r\n\thandleJoinLeave(action: 'join' | 'leave', name: string) {\r\n\t\tthis.joinLeave ||= {\r\n\t\t\tjoin: [],\r\n\t\t\tleave: [],\r\n\t\t\tmessageId: `joinleave-${Date.now()}`,\r\n\t\t};\r\n\t\tif (action === 'join' && this.joinLeave['leave'].includes(name)) {\r\n\t\t\tthis.joinLeave['leave'].splice(this.joinLeave['leave'].indexOf(name), 1);\r\n\t\t} else if (action === 'leave' && this.joinLeave['join'].includes(name)) {\r\n\t\t\tthis.joinLeave['join'].splice(this.joinLeave['join'].indexOf(name), 1);\r\n\t\t} else {\r\n\t\t\tthis.joinLeave[action].push(name);\r\n\t\t}\r\n\t\tif (!this.joinLeave[action].includes(name)) this.joinLeave[action].push(name);\r\n\t\tlet message = this.joinLeave['join'].length ?\r\n\t\t\tChatTournament.arrayToPhrase(this.joinLeave['join']) + ' joined the tournament' :\r\n\t\t\t'';\r\n\t\tif (this.joinLeave['join'].length && this.joinLeave['leave'].length) message += '; ';\r\n\t\tmessage += this.joinLeave['leave'].length ?\r\n\t\t\tChatTournament.arrayToPhrase(this.joinLeave['leave']) + ' left the tournament' :\r\n\t\t\t'';\r\n\r\n\t\tthis.tryAdd(`|uhtml|${this.joinLeave.messageId}|<div class=\"tournament-message-joinleave\">${message}.</div>`);\r\n\t}\r\n\ttournamentName() {\r\n\t\tif (!this.info.format || !this.info.generator) return \"\";\r\n\t\tconst formatName = BattleLog.formatName(this.info.format);\r\n\t\tconst type = this.info.generator;\r\n\t\treturn `${formatName} ${type} Tournament`;\r\n\t}\r\n\treceiveLine(args: Args) {\r\n\t\tconst data = args.slice(2);\r\n\t\tconst notify = PS.prefs.tournaments === 'notify' || (!PS.prefs.tournaments && this.info.isJoined);\r\n\t\tlet cmd = args[1].toLowerCase();\r\n\t\tif (args[0] === 'tournaments') {\r\n\t\t\tswitch (cmd) {\r\n\t\t\tcase 'info':\r\n\t\t\t\tconst tournaments = JSON.parse(data.join('|'));\r\n\t\t\t\tlet buf = `<div class=\"infobox tournaments-info\">`;\r\n\t\t\t\tif (tournaments.length <= 0) {\r\n\t\t\t\t\tbuf += `No tournaments are currently running.`;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbuf += `<ul>`;\r\n\t\t\t\t\tfor (const tournament of tournaments) {\r\n\t\t\t\t\t\tconst formatName = BattleLog.formatName(tournament.format);\r\n\t\t\t\t\t\tbuf += `<li>`;\r\n\t\t\t\t\t\tbuf += BattleLog.html`<a class=\"ilink\" href=\"${toRoomid(tournament.room)}\">${tournament.room}</a>`;\r\n\t\t\t\t\t\tbuf += BattleLog.html`: ${formatName} ${tournament.generator}${tournament.isStarted ? \" (Started)\" : \"\"}`;\r\n\t\t\t\t\t\tbuf += `</li>`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbuf += `</ul>`;\r\n\t\t\t\t}\r\n\t\t\t\tbuf += '</div>';\r\n\t\t\t\tthis.tryAdd(`|html|${buf}`);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else if (args[0] === 'tournament') {\r\n\t\t\tswitch (cmd) {\r\n\t\t\tcase 'create': {\r\n\t\t\t\tthis.info.format = args[2];\r\n\t\t\t\tthis.info.generator = args[3];\r\n\t\t\t\tconst formatName = BattleLog.formatName(args[2]);\r\n\t\t\t\tconst type = args[3];\r\n\t\t\t\tconst buf = BattleLog.html`<div class=\"tournament-message-create\">${this.tournamentName()} created.</div>`;\r\n\t\t\t\tif (!this.tryAdd(`|html|${buf}`)) {\r\n\t\t\t\t\tconst hiddenBuf = BattleLog.html`<div class=\"tournament-message-create\">${this.tournamentName()} created (and hidden).</div>`;\r\n\t\t\t\t\tthis.room.add(`|html|${hiddenBuf}`);\r\n\t\t\t\t}\r\n\t\t\t\tif (notify) {\r\n\t\t\t\t\tthis.room.notify({\r\n\t\t\t\t\t\ttitle: \"Tournament created\",\r\n\t\t\t\t\t\tbody: `Room: ${this.room.title}\\nFormat: ${formatName}\\nType: ${type}`,\r\n\t\t\t\t\t\tid: 'tournament-create',\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'join':\r\n\t\t\tcase 'leave': {\r\n\t\t\t\tthis.handleJoinLeave(cmd, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'replace': {\r\n\t\t\t\tthis.tryAdd(`||${args[3]} has joined the tournament, replacing ${args[4]}.`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'start':\r\n\t\t\t\tthis.room.dismissNotification('tournament-create');\r\n\t\t\t\tif (!this.info.isJoined) {\r\n\t\t\t\t\tthis.boxVisible = false;\r\n\t\t\t\t} else if (this.info.teambuilderFormat?.startsWith('gen5') && !Dex.loadedSpriteData['bw']) {\r\n\t\t\t\t\tDex.loadSpriteData('bw');\r\n\t\t\t\t}\r\n\t\t\t\tlet participants = data[0] ? ` (${data[0]} players)` : \"\";\r\n\t\t\t\tthis.room.add(`|html|<div class=\"tournament-message-start\">The tournament has started!${participants}</div>`);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'disqualify':\r\n\t\t\t\tthis.tryAdd(BattleLog.html`|html|<div class=\"tournament-message-disqualify\">${data[0]} has been disqualified from the tournament.</div>`);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'autodq':\r\n\t\t\t\tif (data[0] === 'off') {\r\n\t\t\t\t\tthis.tryAdd(`|html|<div class=\"tournament-message-autodq-off\">The tournament's automatic disqualify timer has been turned off.</div>`);\r\n\t\t\t\t} else if (data[0] === 'on') {\r\n\t\t\t\t\tlet minutes = Math.round(parseInt(data[1]) / 1000 / 60);\r\n\t\t\t\t\tthis.tryAdd(BattleLog.html`|html|<div class=\"tournament-message-autodq-on\">The tournament's automatic disqualify timer has been set to ${minutes} minute${minutes === 1 ? \"\" : \"s\"}.</div>`);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet seconds = Math.floor(parseInt(data[1]) / 1000);\r\n\t\t\t\t\tPS.alert(`Please respond to the tournament within ${seconds} seconds or you may be automatically disqualified.`);\r\n\t\t\t\t\tif (notify) {\r\n\t\t\t\t\t\tthis.room.notify({\r\n\t\t\t\t\t\t\ttitle: \"Tournament Automatic Disqualification Warning\",\r\n\t\t\t\t\t\t\tbody: `Room: ${this.room.title}\\nSeconds: ${seconds}`,\r\n\t\t\t\t\t\t\tid: 'tournament-autodq-warning',\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'autostart':\r\n\t\t\t\tif (data[0] === 'off') {\r\n\t\t\t\t\tthis.tryAdd(`|html|<div class=\"tournament-message-autostart\">The tournament's automatic start is now off.</div>`);\r\n\t\t\t\t} else if (data[0] === 'on') {\r\n\t\t\t\t\tlet minutes = (parseInt(data[1]) / 1000 / 60);\r\n\t\t\t\t\tthis.tryAdd(BattleLog.html`|html|<div class=\"tournament-message-autostart\">The tournament will automatically start in ${minutes} minute${minutes === 1 ? \"\" : \"s\"}.</div>`);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'scouting':\r\n\t\t\t\tif (data[0] === 'allow') {\r\n\t\t\t\t\tthis.tryAdd(`|html|<div class=\"tournament-message-scouting\">Scouting is now allowed (Tournament players can watch other tournament battles)</div>`);\r\n\t\t\t\t} else if (data[0] === 'disallow') {\r\n\t\t\t\t\tthis.tryAdd(`|html|<div class=\"tournament-message-scouting\">Scouting is now banned (Tournament players can't watch other tournament battles)</div>`);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'update':\r\n\t\t\t\tObject.assign(this.updates, JSON.parse(data.join('|')));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'updateend':\r\n\t\t\t\tconst info = { ...this.info, ...this.updates };\r\n\t\t\t\tif (!info.isActive) {\r\n\t\t\t\t\tif (!info.isStarted || info.isJoined)\r\n\t\t\t\t\t\tthis.boxVisible = true;\r\n\t\t\t\t\tinfo.isActive = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ('format' in this.updates || 'teambuilderFormat' in this.updates) {\r\n\t\t\t\t\tif (!info.teambuilderFormat) info.teambuilderFormat = info.format;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (info.isStarted && info.isJoined) {\r\n\t\t\t\t\t// Update the challenges\r\n\t\t\t\t\tif ('challenges' in this.updates) {\r\n\t\t\t\t\t\tif (info.challenges?.length) {\r\n\t\t\t\t\t\t\tthis.boxVisible = true;\r\n\t\t\t\t\t\t\tif (!this.info.challenges?.length) {\r\n\t\t\t\t\t\t\t\t// app.playNotificationSound();\r\n\t\t\t\t\t\t\t\tif (notify) {\r\n\t\t\t\t\t\t\t\t\tthis.room.notify({\r\n\t\t\t\t\t\t\t\t\t\ttitle: \"Tournament challenges available\",\r\n\t\t\t\t\t\t\t\t\t\tbody: `Room: ${this.room.title}`,\r\n\t\t\t\t\t\t\t\t\t\tid: 'tournament-challenges',\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ('challenged' in this.updates) {\r\n\t\t\t\t\t\tif (info.challenged) {\r\n\t\t\t\t\t\t\tthis.boxVisible = true;\r\n\t\t\t\t\t\t\tif (!this.info.challenged) {\r\n\t\t\t\t\t\t\t\tif (notify) {\r\n\t\t\t\t\t\t\t\t\tthis.room.notify({\r\n\t\t\t\t\t\t\t\t\t\ttitle: `Tournament challenge from ${info.challenged}`,\r\n\t\t\t\t\t\t\t\t\t\tbody: `Room: ${this.room.title}`,\r\n\t\t\t\t\t\t\t\t\t\tid: 'tournament-challenged',\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.info = info;\r\n\t\t\t\tthis.updates = {};\r\n\t\t\t\tthis.update();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'battlestart': {\r\n\t\t\t\tconst roomid = toRoomid(data[2]);\r\n\t\t\t\tthis.tryAdd(`|uhtml|tournament-${roomid}|<div class=\"tournament-message-battlestart\"><a href=\"${roomid}\" class=\"ilink\">Tournament battle between ${BattleLog.escapeHTML(data[0])} and ${BattleLog.escapeHTML(data[1])} started.</a></div>`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'battleend': {\r\n\t\t\t\tlet result = \"drawn\";\r\n\t\t\t\tif (data[2] === 'win')\r\n\t\t\t\t\tresult = \"won\";\r\n\t\t\t\telse if (data[2] === 'loss')\r\n\t\t\t\t\tresult = \"lost\";\r\n\t\t\t\tconst message = `${BattleLog.escapeHTML(data[0])} has ${result} the match ${BattleLog.escapeHTML(data[3].split(',').join(' - '))} against ${BattleLog.escapeHTML(data[1])}${data[4] === 'fail' ? \" but the tournament does not support drawing, so it did not count\" : \"\"}.`;\r\n\t\t\t\tconst roomid = toRoomid(data[5]);\r\n\t\t\t\tthis.tryAdd(`|uhtml|tournament-${roomid}|<div class=\"tournament-message-battleend\"><a href=\"${roomid}\" class=\"ilink\">${message}</a></div>`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'end':\r\n\t\t\t\tlet endData = JSON.parse(data.join('|'));\r\n\t\t\t\tthis.info.format = endData.format;\r\n\t\t\t\tthis.info.generator = endData.generator;\r\n\t\t\t\tif (endData.bracketData) this.info.bracketData = endData.bracketData;\r\n\r\n\t\t\t\tif (this.room.log) {\r\n\t\t\t\t\tconst bracketNode = document.createElement('div');\r\n\t\t\t\t\tbracketNode.style.position = 'relative';\r\n\t\t\t\t\tthis.room.log.addNode(bracketNode);\r\n\t\t\t\t\tpreact.render(<TournamentBracket tour={this} abbreviated />, bracketNode);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.room.add(BattleLog.html`|html|<div class=\"tournament-message-end-winner\">Congratulations to ${ChatTournament.arrayToPhrase(endData.results[0])} for winning the ${this.tournamentName()}!</div>`);\r\n\t\t\t\tif (endData.results[1]) {\r\n\t\t\t\t\tthis.tryAdd(BattleLog.html`|html|<div class=\"tournament-message-end-runnerup\">Runner${endData.results[1].length > 1 ? \"s\" : \"\"}-up: ${ChatTournament.arrayToPhrase(endData.results[1])}</div>`);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Fallthrough\r\n\r\n\t\t\tcase 'forceend':\r\n\t\t\t\tthis.room.dismissNotification('tournament-create');\r\n\t\t\t\tthis.updates = {};\r\n\r\n\t\t\t\tthis.info.isActive = false;\r\n\t\t\t\tthis.boxVisible = false;\r\n\r\n\t\t\t\tif (cmd === 'forceend') {\r\n\t\t\t\t\tthis.info = {}; // not needed; nothing to pop out\r\n\t\t\t\t\tthis.room.add(`|html|<div class=\"tournament-message-forceend\">The tournament was forcibly ended.</div>`);\r\n\t\t\t\t}\r\n\t\t\t\t// clear room's tour, so next tour gets a different tour object\r\n\t\t\t\t//  (and the bracket for this one's pop-out is unaffected)\r\n\t\t\t\tthis.room.tour = null;\r\n\t\t\t\tthis.update();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'error': {\r\n\t\t\t\tlet appendError = (message: string) => {\r\n\t\t\t\t\tthis.tryAdd(`|html|<div class=\"tournament-message-forceend\">${BattleLog.sanitizeHTML(message)}</div>`);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tswitch (data[0]) {\r\n\t\t\t\tcase 'BracketFrozen':\r\n\t\t\t\tcase 'AlreadyStarted':\r\n\t\t\t\t\tappendError(\"The tournament has already started.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'BracketNotFrozen':\r\n\t\t\t\tcase 'NotStarted':\r\n\t\t\t\t\tappendError(\"The tournament hasn't started yet.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'UserAlreadyAdded':\r\n\t\t\t\t\tappendError(\"You are already in the tournament.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'AltUserAlreadyAdded':\r\n\t\t\t\t\tappendError(\"One of your alts is already in the tournament.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'UserNotAdded':\r\n\t\t\t\t\tappendError(`${data[1] && data[1] === PS.user.userid ? \"You aren't\" : \"This user isn't\"} in the tournament.`);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'NotEnoughUsers':\r\n\t\t\t\t\tappendError(\"There aren't enough users.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'InvalidAutoDisqualifyTimeout':\r\n\t\t\t\tcase 'InvalidAutoStartTimeout':\r\n\t\t\t\t\tappendError(\"That isn't a valid timeout value.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'InvalidMatch':\r\n\t\t\t\t\tappendError(\"That isn't a valid tournament matchup.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'UserNotNamed':\r\n\t\t\t\t\tappendError(\"You must have a name in order to join the tournament.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Full':\r\n\t\t\t\t\tappendError(\"The tournament is already at maximum capacity for users.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'AlreadyDisqualified':\r\n\t\t\t\t\tappendError(`${data[1] && data[1] === PS.user.userid ? \"You have\" : \"This user has\"} already been disqualified.`);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Banned':\r\n\t\t\t\t\tappendError(\"You are banned from entering tournaments.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tappendError(\"Unknown error: \" + data[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class TournamentBox extends preact.Component<{ tour: ChatTournament, left?: number }> {\r\n\tsubscription!: PSSubscription;\r\n\toverride componentDidMount(): void {\r\n\t\tthis.subscription = this.props.tour.subscribe(() => {\r\n\t\t\tthis.forceUpdate();\r\n\t\t});\r\n\t}\r\n\toverride componentWillUnmount(): void {\r\n\t\tthis.subscription.unsubscribe();\r\n\t}\r\n\tselectChallengeUser(ev: Event) {\r\n\t\tconst target = ev.target as HTMLSelectElement;\r\n\t\tif (target.tagName !== 'SELECT') return;\r\n\t\tconst selectedIndex = target.selectedIndex;\r\n\t\tif (selectedIndex < 0) return;\r\n\t\tthis.props.tour.selectedChallenge = selectedIndex;\r\n\t\tthis.forceUpdate();\r\n\t}\r\n\tacceptChallenge = (ev: Event, format: string, team?: Team) => {\r\n\t\tconst tour = this.props.tour;\r\n\t\tconst room = tour.room;\r\n\t\tconst packedTeam = team ? team.packedTeam : '';\r\n\t\tPS.send(`/utm ${packedTeam}`);\r\n\t\tif (tour.info.challenged) {\r\n\t\t\troom.send(`/tournament acceptchallenge`);\r\n\t\t} else if (tour.info.challenges?.length) {\r\n\t\t\tconst target = tour.info.challenges[tour.selectedChallenge] || tour.info.challenges[0];\r\n\t\t\troom.send(`/tournament challenge ${target}`);\r\n\t\t}\r\n\t\troom.update(null);\r\n\t};\r\n\tvalidate = (ev: Event, format: string, team?: Team) => {\r\n\t\tconst room = this.props.tour.room;\r\n\t\tconst packedTeam = team ? team.packedTeam : '';\r\n\t\tPS.send(`/utm ${packedTeam}`);\r\n\t\troom.send(`/tournament vtm`);\r\n\t\troom.update(null);\r\n\t};\r\n\ttoggleBoxVisibility = () => {\r\n\t\tthis.props.tour.boxVisible = !this.props.tour.boxVisible;\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\trenderTournamentTools() {\r\n\t\tconst tour = this.props.tour;\r\n\t\tconst info = tour.info;\r\n\t\tif (!info.isJoined) {\r\n\t\t\tif (info.isStarted) return null;\r\n\t\t\treturn <div class=\"tournament-tools\">\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<button data-cmd=\"/tournament join\" class=\"button\"><strong>Join</strong></button> {}\r\n\t\t\t\t\t<button onClick={this.toggleBoxVisibility} class=\"button\">Close</button>\r\n\t\t\t\t</p>\r\n\t\t\t</div>;\r\n\t\t}\r\n\r\n\t\t// joined\r\n\t\tconst noMatches = !info.challenges?.length && !info.challengeBys?.length && !info.challenging && !info.challenged;\r\n\t\treturn <div class=\"tournament-tools\">\r\n\t\t\t<TeamForm\r\n\t\t\t\tformat={info.format} teamFormat={info.teambuilderFormat} hideFormat\r\n\t\t\t\tonSubmit={this.acceptChallenge} onValidate={this.validate}\r\n\t\t\t>\r\n\t\t\t\t{(info.isJoined && !info.challenging && !info.challenged && !info.challenges?.length) && (\r\n\t\t\t\t\t<button name=\"validate\" class=\"button\"><i class=\"fa fa-check\" aria-hidden></i> Validate</button>\r\n\t\t\t\t)} {}\r\n\t\t\t\t{!!(!info.isStarted && info.isJoined) && (\r\n\t\t\t\t\t<button data-cmd=\"/tournament leave\" class=\"button\">Leave</button>\r\n\t\t\t\t)}\r\n\t\t\t\t{(info.isStarted && noMatches) && (\r\n\t\t\t\t\t<div class=\"tournament-nomatches\">Waiting for battles to become available...</div>\r\n\t\t\t\t)}\r\n\t\t\t\t{!!info.challenges?.length && <div class=\"tournament-challenge\">\r\n\t\t\t\t\t<div class=\"tournament-challenge-user\">vs. {info.challenges[tour.selectedChallenge]}</div>\r\n\t\t\t\t\t<button type=\"submit\" class=\"button\"><strong>Ready!</strong></button>\r\n\t\t\t\t\t{info.challenges.length > 1 && <span class=\"tournament-challenge-user-menu\">\r\n\t\t\t\t\t\t<select onChange={this.selectChallengeUser}>\r\n\t\t\t\t\t\t\t{info.challenges.map((challenge, index) => (\r\n\t\t\t\t\t\t\t\t<option value={index} selected={index === tour.selectedChallenge}>{challenge}</option>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t</span>}\r\n\t\t\t\t</div>}\r\n\t\t\t\t{!!info.challengeBys?.length && <div class=\"tournament-challengeby\">\r\n\t\t\t\t\t{info.challenges?.length ? \"Or wait\" : \"Waiting\"} for {ChatTournament.arrayToPhrase(info.challengeBys, \"or\")} {}\r\n\t\t\t\t\tto challenge you.\r\n\t\t\t\t</div>}\r\n\t\t\t\t{!!info.challenging && <div class=\"tournament-challenging\">\r\n\t\t\t\t\t<div class=\"tournament-challenging-message\">Waiting for {info.challenging}...</div>\r\n\t\t\t\t\t<button data-cmd=\"/tournament cancelchallenge\" class=\"button\">Cancel</button>\r\n\t\t\t\t</div>}\r\n\t\t\t\t{!!info.challenged && <div class=\"tournament-challenged\">\r\n\t\t\t\t\t<div class=\"tournament-challenged-message\">vs. {info.challenged}</div>\r\n\t\t\t\t\t<button type=\"submit\" class=\"button\"><strong>Ready!</strong></button>\r\n\t\t\t\t</div>}\r\n\t\t\t</TeamForm>\r\n\t\t</div>;\r\n\t}\r\n\toverride render() {\r\n\t\tconst tour = this.props.tour;\r\n\t\tconst info = tour.info;\r\n\t\treturn <div class={`tournament-wrapper ${info.isActive ? 'active' : ''}`} style={{ left: this.props.left || 0 }}>\r\n\t\t\t<button class=\"tournament-title\" onClick={this.toggleBoxVisibility}>\r\n\t\t\t\t<span class=\"tournament-status\">{info.isStarted ? \"In Progress\" : \"Signups\"}</span>\r\n\t\t\t\t{tour.tournamentName()}\r\n\t\t\t\t{tour.boxVisible ? <i class=\"fa fa-caret-up\" aria-hidden></i> : <i class=\"fa fa-caret-down\" aria-hidden></i>}\r\n\t\t\t</button>\r\n\t\t\t<div class={`tournament-box ${tour.boxVisible ? 'active' : ''}`}>\r\n\t\t\t\t<TournamentBracket tour={tour} />\r\n\t\t\t\t{this.renderTournamentTools()}\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nexport class TournamentBracket extends preact.Component<{\r\n\ttour: ChatTournament, poppedOut?: boolean, abbreviated?: boolean,\r\n}> {\r\n\tsubscription!: PSSubscription;\r\n\trenderTableBracket(data: TournamentTableBracketData) {\r\n\t\tif (data.tableContents.length === 0)\r\n\t\t\treturn null;\r\n\r\n\t\tif (data.tableHeaders.rows.length > 4 && this.props.abbreviated) {\r\n\t\t\tlet rows = data.tableHeaders.rows.map((row, i) => ({\r\n\t\t\t\tname: row,\r\n\t\t\t\tscore: data.scores[i],\r\n\t\t\t}));\r\n\t\t\trows.sort((a, b) => b.score - a.score);\r\n\t\t\trows = rows.slice(0, 4);\r\n\t\t\treturn <div class=\"pad\"><table class=\"tournament-bracket-table\" style=\"border-bottom-width:0\">\r\n\t\t\t\t{rows.map((row, i) => (\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<th>{row.name}</th><td>{row.score}</td>\r\n\t\t\t\t\t\t<td class=\"tournament-bracket-table-cell-null\">{i < 3 ? (\r\n\t\t\t\t\t\t\t<i class=\"fa fa-trophy\" aria-hidden style={{ color: ['#d6c939', '#adb2bb', '#ca8530'][i] }}></i>\r\n\t\t\t\t\t\t) : null}</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t))}\r\n\t\t\t\t<tr><th colSpan={2}>...</th><td class=\"tournament-bracket-table-cell-null\"></td></tr>\r\n\t\t\t</table></div>;\r\n\t\t}\r\n\r\n\t\treturn <div class=\"pad\"><table class=\"tournament-bracket-table\">\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"empty\"></td>\r\n\t\t\t\t{data.tableHeaders.cols.map(name => <th>{name}</th>)}\r\n\t\t\t</tr>\r\n\t\t\t{data.tableHeaders.rows.map((name, r) => <tr>\r\n\t\t\t\t<th>{name}</th>\r\n\t\t\t\t{data.tableContents[r].map(cell => cell ? (\r\n\t\t\t\t\t<td\r\n\t\t\t\t\t\tclass={`tournament-bracket-table-cell-${cell.state}${cell.state === 'finished' ? (\r\n\t\t\t\t\t\t\t`tournament-bracket-table-cell-result-${cell.result}`\r\n\t\t\t\t\t\t) : ''}`}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{cell.state === 'unavailable' ? (\r\n\t\t\t\t\t\t\t\"Unavailable\"\r\n\t\t\t\t\t\t) : cell.state === 'available' ? (\r\n\t\t\t\t\t\t\t\"Waiting\"\r\n\t\t\t\t\t\t) : cell.state === 'challenging' ? (\r\n\t\t\t\t\t\t\t\"Challenging\"\r\n\t\t\t\t\t\t) : cell.state === 'inprogress' ? (\r\n\t\t\t\t\t\t\t<a href={toRoomid(cell.room)} class=\"ilink\">In-progress</a>\r\n\t\t\t\t\t\t) : cell.state === 'finished' ? (\r\n\t\t\t\t\t\t\tcell.score.join(\" - \")\r\n\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t</td>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<td class=\"tournament-bracket-table-cell-null\"></td>\r\n\t\t\t\t))}\r\n\t\t\t\t<th class=\"tournament-bracket-row-score\">{data.scores[r]}</th>\r\n\t\t\t</tr>)}\r\n\t\t</table></div>;\r\n\t}\r\n\tdragging: {\r\n\t\tx: number,\r\n\t\ty: number,\r\n\t} | null = null;\r\n\tonMouseDown = (ev: MouseEvent) => {\r\n\t\tconst elem = this.base!;\r\n\t\tconst canScrollVertically = elem.scrollHeight > elem.clientHeight;\r\n\t\tconst canScrollHorizontally = elem.scrollWidth > elem.clientWidth;\r\n\t\tif (!canScrollVertically && !canScrollHorizontally) return;\r\n\t\tif (ev.button) return;\r\n\r\n\t\tev.preventDefault();\r\n\t\t// in case mouse moves outside the element\r\n\t\twindow.addEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.addEventListener('mouseup', this.onMouseUp);\r\n\t\tthis.dragging = {\r\n\t\t\tx: ev.clientX,\r\n\t\t\ty: ev.clientY,\r\n\t\t};\r\n\t\telem.style.cursor = 'grabbing';\r\n\t};\r\n\tonMouseMove = (ev: MouseEvent) => {\r\n\t\tif (!this.dragging) return;\r\n\t\tconst dx = ev.clientX - this.dragging.x;\r\n\t\tconst dy = ev.clientY - this.dragging.y;\r\n\t\tthis.dragging.x = ev.clientX;\r\n\t\tthis.dragging.y = ev.clientY;\r\n\t\tconst elem = this.base!;\r\n\t\telem.scrollLeft -= dx;\r\n\t\telem.scrollTop -= dy;\r\n\t};\r\n\tonMouseUp = (ev: MouseEvent) => {\r\n\t\tif (!this.dragging) return;\r\n\t\tthis.dragging = null;\r\n\t\tconst elem = this.base!;\r\n\t\telem.style.cursor = 'grab';\r\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\r\n\t};\r\n\toverride componentWillUnmount(): void {\r\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\r\n\t}\r\n\toverride componentDidUpdate() {\r\n\t\tconst elem = this.base!;\r\n\t\tconst canScrollVertically = elem.scrollHeight > elem.clientHeight;\r\n\t\tconst canScrollHorizontally = elem.scrollWidth > elem.clientWidth;\r\n\t\tif (!canScrollVertically && !canScrollHorizontally) {\r\n\t\t\telem.style.cursor = 'default';\r\n\t\t} else {\r\n\t\t\telem.style.cursor = 'grab';\r\n\t\t}\r\n\t}\r\n\toverride componentDidMount() {\r\n\t\tthis.componentDidUpdate();\r\n\t}\r\n\tpopOut = (ev: Event) => {\r\n\t\tPS.join('tourpopout' as RoomID, {\r\n\t\t\tparentElem: ev.currentTarget as HTMLElement,\r\n\t\t\targs: { tour: this.props.tour },\r\n\t\t});\r\n\t\tev.stopImmediatePropagation();\r\n\t\tev.preventDefault();\r\n\t};\r\n\trender() {\r\n\t\tconst data = this.props.tour.info.bracketData;\r\n\t\treturn <div\r\n\t\t\tclass={`tournament-bracket${this.props.poppedOut ? ' tournament-popout-bracket' : ''}`}\r\n\t\t\tonMouseDown={this.onMouseDown} onMouseUp={this.onMouseUp} onMouseMove={this.onMouseMove}\r\n\t\t>\r\n\t\t\t{data?.type === 'table' ? this.renderTableBracket(data) :\r\n\t\t\tdata?.type === 'tree' ? <TournamentTreeBracket data={data} abbreviated={this.props.abbreviated} /> :\r\n\t\t\tnull}\r\n\t\t\t{this.props.poppedOut ? (\r\n\t\t\t\t<button class=\"tournament-close-link button\" data-cmd=\"/close\">\r\n\t\t\t\t\t<i class=\"fa fa-times\" aria-hidden></i> Close\r\n\t\t\t\t</button>\r\n\t\t\t) : (\r\n\t\t\t\t<button class=\"tournament-popout-link button\" onClick={this.popOut}>\r\n\t\t\t\t\t<i class=\"fa fa-arrows-alt\" aria-hidden></i> Pop-out\r\n\t\t\t\t</button>\r\n\t\t\t)}\r\n\t\t</div>;\r\n\t}\r\n}\r\nexport class TournamentTreeBracket extends preact.Component<{\r\n\tdata: TournamentTreeBracketData, abbreviated?: boolean,\r\n}> {\r\n\td3Loader: Promise<void> | null = null;\r\n\tforEachTreeNode<T extends TreeNode>(node: T, callback: (node: T, depth: number) => void, depth = 0) {\r\n\t\tcallback(node, depth);\r\n\t\tif (node.children) {\r\n\t\t\tfor (const child of node.children) {\r\n\t\t\t\tthis.forEachTreeNode(child as T, callback, depth + 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tcloneTree<T extends TreeNode>(node: T): T {\r\n\t\tconst clonedNode = { ...node };\r\n\t\tif (node.children) {\r\n\t\t\tclonedNode.children = node.children.map(child => this.cloneTree(child));\r\n\t\t}\r\n\t\treturn clonedNode;\r\n\t}\r\n\t/**\r\n\t * Customize tree size. Height is for a single player, a full node is double that.\r\n\t */\r\n\tstatic nodeSize = {\r\n\t\twidth: 160, height: 15,\r\n\t\tradius: 5,\r\n\t\tseparationX: 20, separationY: 10,\r\n\t\t// Safari bug: some issue with dominant-baseline. whatever, we can just manually v-align text\r\n\t\ttextOffset: 4,\r\n\t};\r\n\tgenerateTreeBracket(data: TournamentTreeBracketData, abbreviated?: boolean) {\r\n\t\tconst div = document.createElement('div');\r\n\t\tdiv.className = 'tournament-bracket-tree';\r\n\r\n\t\tif (!data.rootNode) {\r\n\t\t\tconst users = data.users;\r\n\t\t\tif (users?.length) {\r\n\t\t\t\tdiv.innerHTML = `<b>${users.length}</b> user${users.length !== 1 ? 's' : ''}:<br />${BattleLog.escapeHTML(users.join(\", \"))}`;\r\n\t\t\t} else {\r\n\t\t\t\tdiv.innerHTML = `<b>0</b> users`;\r\n\t\t\t}\r\n\t\t\treturn div;\r\n\t\t}\r\n\t\tif (!window.d3) {\r\n\t\t\tdiv.innerHTML = `<b>d3 not loaded yet</b>`;\r\n\t\t\tthis.d3Loader ||= PS.libsLoaded.then(() => {\r\n\t\t\t\tthis.forceUpdate();\r\n\t\t\t});\r\n\t\t\treturn div;\r\n\t\t}\r\n\t\tthis.d3Loader = null;\r\n\r\n\t\tlet name = PS.user.name;\r\n\r\n\t\t// Construct the visual tree from the real tree\r\n\r\n\t\tconst newTree = this.cloneTree(data.rootNode) as TournamentElimBracketNode;\r\n\t\tif (newTree.team) newTree.highlightLink = true;\r\n\t\tconst highlightName = newTree.team; // if we have a root winner, trace it through double elim brackets\r\n\r\n\t\tthis.forEachTreeNode(newTree, (node, depth) => {\r\n\t\t\tif (node.children?.length === 2) {\r\n\t\t\t\tnode.team1 = node.children[0].team;\r\n\t\t\t\tnode.team2 = node.children[1].team;\r\n\t\t\t\tconst shouldHaveChildren = node.children.some(child => child.children?.length === 2);\r\n\t\t\t\tif (!shouldHaveChildren) node.children = [];\r\n\t\t\t\tif (depth >= 2 && node.children?.length && abbreviated) {\r\n\t\t\t\t\tnode.children = [];\r\n\t\t\t\t\tnode.abbreviated = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (node.highlightLink) {\r\n\t\t\t\t\tfor (const child of node.children) {\r\n\t\t\t\t\t\tif (child.team === node.team) {\r\n\t\t\t\t\t\t\tchild.highlightLink = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (\r\n\t\t\t\t\tnode.state === 'inprogress' || node.state === 'available' || node.state === 'challenging' ||\r\n\t\t\t\t\tnode.state === 'unavailable'\r\n\t\t\t\t) {\r\n\t\t\t\t\tfor (const child of node.children) {\r\n\t\t\t\t\t\tif (child.team && !child.team.startsWith('(')) {\r\n\t\t\t\t\t\t\tchild.highlightLink = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (highlightName) {\r\n\t\t\t\t\tfor (const child of node.children) {\r\n\t\t\t\t\t\tif (child.team === highlightName) {\r\n\t\t\t\t\t\t\tchild.highlightLink = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Calculate dimensions\r\n\r\n\t\tlet numLeaves = 0;\r\n\t\tconst hasLeafAtDepth: boolean[] = [];\r\n\t\tthis.forEachTreeNode(newTree, (node, depth) => {\r\n\t\t\thasLeafAtDepth[depth] ||= false;\r\n\t\t\tif (!node.children?.length) {\r\n\t\t\t\tnumLeaves++;\r\n\t\t\t\thasLeafAtDepth[depth] = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Setting `breadthCompression` to 0.8 for 3+ depths with leaves is\r\n\t\t// an extremely approximate guess for how tall a double+ elim tree\r\n\t\t// should be. The old algorithm also approximated, but its\r\n\t\t// approximation was arguably worse. This one is basically perfect\r\n\t\t// for single elim and pretty good for double elim.\r\n\t\tconst depthsWithLeaves = hasLeafAtDepth.filter(Boolean).length;\r\n\t\tconst breadthCompression = depthsWithLeaves > 2 ? 0.8 : 2;\r\n\t\tconst maxBreadth = numLeaves - (depthsWithLeaves - 1) / breadthCompression;\r\n\t\tconst maxDepth = hasLeafAtDepth.length;\r\n\r\n\t\tconst nodeSize = TournamentTreeBracket.nodeSize;\r\n\t\tconst size = {\r\n\t\t\twidth: nodeSize.width * maxDepth + nodeSize.separationX * (maxDepth + 1),\r\n\t\t\theight: nodeSize.height * 2 * (maxBreadth + 0.5) + nodeSize.separationY * maxBreadth,\r\n\t\t};\r\n\r\n\t\t// Make d3 layout the tree\r\n\r\n\t\tconst tree = d3.layout.tree<TournamentElimBracketNode>()\r\n\t\t\t.size([size.height, size.width - nodeSize.width - nodeSize.separationX])\r\n\t\t\t.separation(() => 1)\r\n\t\t\t.children(node => (\r\n\t\t\t\tnode.children?.length ? node.children : null!\r\n\t\t\t));\r\n\t\tconst nodes = tree.nodes(newTree);\r\n\t\tconst links = tree.links(nodes);\r\n\r\n\t\t// Put the tree in the right place\r\n\r\n\t\tconst layoutRoot = d3.select(div)\r\n\t\t\t.append('svg:svg').attr('width', size.width).attr('height', size.height)\r\n\t\t\t.append('svg:g')\r\n\t\t\t.attr('transform', `translate(${-(nodeSize.width) / 2 - 6},0)`);\r\n\r\n\t\t// Style the links between the nodes\r\n\r\n\t\tconst diagonalLink = d3.svg.diagonal()\r\n\t\t\t.source(link => ({\r\n\t\t\t\tx: link.source.x, y: link.source.y + nodeSize.width / 2,\r\n\t\t\t}))\r\n\t\t\t.target(link => ({\r\n\t\t\t\tx: link.target.x, y: link.target.y - nodeSize.width / 2,\r\n\t\t\t}))\r\n\t\t\t.projection(link => [\r\n\t\t\t\tsize.width - link.y, link.x,\r\n\t\t\t]);\r\n\t\tlayoutRoot.selectAll('path.tournament-bracket-tree-link').data(links).enter()\r\n\t\t\t.append('svg:path')\r\n\t\t\t.attr('d', diagonalLink)\r\n\t\t\t.classed('tournament-bracket-tree-link', true)\r\n\t\t\t.classed('tournament-bracket-tree-link-active', link => (\r\n\t\t\t\t!!link.target.highlightLink\r\n\t\t\t));\r\n\r\n\t\t// Style the nodes themselves\r\n\r\n\t\tconst nodeGroup = layoutRoot.selectAll('g.tournament-bracket-tree-node').data(nodes).enter()\r\n\t\t\t.append('svg:g').classed('tournament-bracket-tree-node', true).attr('transform', node => (\r\n\t\t\t\t`translate(${size.width - node.y},${node.x})`\r\n\t\t\t));\r\n\t\tnodeGroup.each(function (this: EventTarget, node) {\r\n\t\t\tlet elem = d3.select(this);\r\n\t\t\tconst outerElem = elem;\r\n\r\n\t\t\tif (node.abbreviated) {\r\n\t\t\t\telem.append('svg:text').attr('y', -nodeSize.height / 2 + 4)\r\n\t\t\t\t\t.attr('x', -nodeSize.width / 2 - 7).classed('tournament-bracket-tree-abbreviated', true)\r\n\t\t\t\t\t.text('...');\r\n\t\t\t}\r\n\r\n\t\t\tif (node.state === 'inprogress') {\r\n\t\t\t\telem = elem.append('svg:a').attr('xlink:href', toRoomid(node.room)).classed('ilink', true)\r\n\t\t\t\t\t.on('click', () => {\r\n\t\t\t\t\t\tconst ev = d3.event as MouseEvent;\r\n\t\t\t\t\t\tif (ev.metaKey || ev.ctrlKey) return;\r\n\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\tev.stopPropagation();\r\n\t\t\t\t\t\tconst roomid = (ev.currentTarget as Element).getAttribute('href');\r\n\t\t\t\t\t\tPS.join(roomid as RoomID);\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\touterElem.classed('tournament-bracket-tree-node-match', true);\r\n\t\t\touterElem.classed('tournament-bracket-tree-node-match-' + node.state, true);\r\n\r\n\t\t\tif (node.team && !node.team1 && !node.team2) {\r\n\t\t\t\tconst rect = elem.append('svg:rect').classed('tournament-bracket-tree-draw', true)\r\n\t\t\t\t\t.attr('rx', nodeSize.radius)\r\n\t\t\t\t\t.attr('x', -nodeSize.width / 2).attr('width', nodeSize.width)\r\n\t\t\t\t\t.attr('y', -nodeSize.height / 2).attr('height', nodeSize.height);\r\n\t\t\t\tif (node.team === name) rect.attr('stroke-dasharray', '5,5').attr('stroke-width', 2);\r\n\r\n\t\t\t\telem.append('svg:text').classed('tournament-bracket-tree-node-team', true)\r\n\t\t\t\t\t.attr('y', nodeSize.textOffset)\r\n\t\t\t\t\t.classed('tournament-bracket-tree-node-team-draw', true)\r\n\t\t\t\t\t.text(node.team || '');\r\n\t\t\t} else {\r\n\t\t\t\tconst rect1 = elem.append('svg:rect')\r\n\t\t\t\t\t.attr('rx', nodeSize.radius)\r\n\t\t\t\t\t.attr('x', -nodeSize.width / 2).attr('width', nodeSize.width)\r\n\t\t\t\t\t.attr('y', -nodeSize.height).attr('height', nodeSize.height);\r\n\t\t\t\tconst rect2 = elem.append('svg:rect')\r\n\t\t\t\t\t.attr('rx', nodeSize.radius)\r\n\t\t\t\t\t.attr('x', -nodeSize.width / 2).attr('width', nodeSize.width)\r\n\t\t\t\t\t.attr('y', 0).attr('height', nodeSize.height);\r\n\t\t\t\tif (node.team1 === name) rect1.attr('stroke-dasharray', '5,5').attr('stroke-width', 2);\r\n\t\t\t\tif (node.team2 === name) rect2.attr('stroke-dasharray', '5,5').attr('stroke-width', 2);\r\n\r\n\t\t\t\tconst row1 = elem.append('svg:text').attr('y', -nodeSize.height / 2 + nodeSize.textOffset)\r\n\t\t\t\t\t.classed('tournament-bracket-tree-node-row1', true);\r\n\t\t\t\tconst row2 = elem.append('svg:text').attr('y', nodeSize.height / 2 + nodeSize.textOffset)\r\n\t\t\t\t\t.classed('tournament-bracket-tree-node-row2', true);\r\n\r\n\t\t\t\tconst team1 = row1.append('svg:tspan').classed('tournament-bracket-tree-team', true)\r\n\t\t\t\t\t.text(node.team1 || '');\r\n\t\t\t\tconst team2 = row2.append('svg:tspan').classed('tournament-bracket-tree-team', true)\r\n\t\t\t\t\t.text(node.team2 || '');\r\n\r\n\t\t\t\tif (node.state === 'available') {\r\n\t\t\t\t\telem.append('title').text(\"Waiting\");\r\n\t\t\t\t} else if (node.state === 'challenging') {\r\n\t\t\t\t\telem.append('title').text(\"Challenging\");\r\n\t\t\t\t} else if (node.state === 'inprogress') {\r\n\t\t\t\t\telem.append('title').text(\"In-progress\");\r\n\t\t\t\t} else if (node.state === 'finished') {\r\n\t\t\t\t\tif (node.result === 'win') {\r\n\t\t\t\t\t\trect1.classed('tournament-bracket-tree-win', true);\r\n\t\t\t\t\t\trect2.classed('tournament-bracket-tree-loss', true);\r\n\t\t\t\t\t\tteam1.classed('tournament-bracket-tree-team-win', true);\r\n\t\t\t\t\t\tteam2.classed('tournament-bracket-tree-team-loss', true);\r\n\t\t\t\t\t} else if (node.result === 'loss') {\r\n\t\t\t\t\t\trect1.classed('tournament-bracket-tree-loss', true);\r\n\t\t\t\t\t\trect2.classed('tournament-bracket-tree-win', true);\r\n\t\t\t\t\t\tteam1.classed('tournament-bracket-tree-team-loss', true);\r\n\t\t\t\t\t\tteam2.classed('tournament-bracket-tree-team-win', true);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trect1.classed('tournament-bracket-tree-draw', true);\r\n\t\t\t\t\t\trect2.classed('tournament-bracket-tree-draw', true);\r\n\t\t\t\t\t\tteam1.classed('tournament-bracket-tree-team-draw', true);\r\n\t\t\t\t\t\tteam2.classed('tournament-bracket-tree-team-draw', true);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telem.classed('tournament-bracket-tree-node-match-result-' + node.result, true);\r\n\t\t\t\t\trow1.append('svg:tspan').text(` (${node.score[0]})`).classed('tournament-bracket-tree-score', true);\r\n\t\t\t\t\trow2.append('svg:tspan').text(` (${node.score[1]})`).classed('tournament-bracket-tree-score', true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn div;\r\n\t};\r\n\toverride componentDidMount() {\r\n\t\tthis.base!.appendChild(this.generateTreeBracket(this.props.data, this.props.abbreviated));\r\n\t}\r\n\toverride shouldComponentUpdate(props: { data: TournamentTreeBracketData }) {\r\n\t\tif (props.data === this.props.data && !this.d3Loader) return false;\r\n\t\tthis.base!.replaceChild(this.generateTreeBracket(props.data), this.base!.children[0]);\r\n\t\treturn false;\r\n\t}\r\n\trender() {\r\n\t\treturn <div class=\"pad\"></div>;\r\n\t}\r\n}\r\n\r\nexport class TourPopOutPanel extends PSRoomPanel {\r\n\tstatic readonly id = 'tourpopout';\r\n\tstatic readonly routes = ['tourpopout'];\r\n\tstatic readonly location = 'semimodal-popup';\r\n\tstatic readonly noURL = true;\r\n\toverride componentDidMount() {\r\n\t\tconst tour = this.props.room.args?.tour as ChatTournament;\r\n\t\tif (tour) this.subscribeTo(tour);\r\n\t}\r\n\toverride render() {\r\n\t\tconst room = this.props.room;\r\n\t\tconst tour = room.args?.tour as ChatTournament;\r\n\t\treturn <PSPanelWrapper room={room} fullSize>\r\n\t\t\t{tour && <TournamentBracket tour={tour} poppedOut />}\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nPS.addRoomType(TourPopOutPanel);\r\n"],
  "mappings": "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",
  "names": ["preact"]
}
