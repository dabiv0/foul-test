{
  "version": 3,
  "sources": ["../../../client/src/panels.tsx"],
  "sourcesContent": ["/**\r\n * Panels\r\n *\r\n * Main view - sets up the frame, and the generic panels.\r\n *\r\n * Also sets up most global event listeners.\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nimport preact from \"../js/lib/preact\";\r\nimport type { Pokemon, ServerPokemon } from \"./battle\";\r\nimport { Dex, toID } from \"./battle-dex\";\r\nimport type { Args } from \"./battle-text-parser\";\r\nimport { BattleTooltips } from \"./battle-tooltips\";\r\nimport { Net } from \"./client-connection\";\r\nimport type { PSModel, PSStreamModel, PSSubscription } from \"./client-core\";\r\nimport { PS, type PSRoom, type RoomID } from \"./client-main\";\r\nimport type { ChatRoom } from \"./panel-chat\";\r\nimport { PSHeader, PSMiniHeader } from \"./panel-topbar\";\r\n\r\nexport const VERTICAL_HEADER_WIDTH = 240;\r\nexport const NARROW_MODE_HEADER_WIDTH = 280;\r\n\r\nexport class PSRouter {\r\n\troomid = '' as RoomID;\r\n\tpanelState = '';\r\n\tconstructor() {\r\n\t\tconst currentRoomid = location.pathname.slice(1);\r\n\t\tif (/^[a-z0-9-]*$/.test(currentRoomid)) {\r\n\t\t\tthis.subscribeHistory();\r\n\t\t} else if (location.pathname.endsWith('.html')) {\r\n\t\t\tthis.subscribeHash();\r\n\t\t}\r\n\t}\r\n\textractRoomID(url: string | null) {\r\n\t\tif (!url) return null;\r\n\t\tif (url.startsWith(document.location.origin)) {\r\n\t\t\turl = url.slice(document.location.origin.length);\r\n\t\t} else {\r\n\t\t\tif (url.startsWith('http://')) {\r\n\t\t\t\turl = url.slice(7);\r\n\t\t\t} else if (url.startsWith('https://')) {\r\n\t\t\t\turl = url.slice(8);\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('psim.us/t/')) {\r\n\t\t\t\turl = `viewteam-${url.slice(10)}`;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('teams.pokemonshowdown.com/view/') && /[0-9]/.test(url.charAt(31))) {\r\n\t\t\t\turl = `viewteam-${url.slice(31)}`;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('psim.us/r/')) {\r\n\t\t\t\turl = `battle-${url.slice(10)}`;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('replay.pokemonshowdown.com/') && /[a-z]/.test(url.charAt(27))) {\r\n\t\t\t\turl = `battle-${url.slice(27)}`;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith(document.location.host)) {\r\n\t\t\t\turl = url.slice(document.location.host.length);\r\n\t\t\t} else if (PS.server.id === 'showdown' && url.startsWith('play.pokemonshowdown.com')) {\r\n\t\t\t\turl = url.slice(24);\r\n\t\t\t} else if (PS.server.id === 'showdown' && url.startsWith('psim.us')) {\r\n\t\t\t\turl = url.slice(7);\r\n\t\t\t} else if (url.startsWith('replay.pokemonshowdown.com')) {\r\n\t\t\t\turl = url.slice(26).replace('/', '/battle-');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (url.startsWith('/')) url = url.slice(1);\r\n\t\tif (url === '.') url = '';\r\n\r\n\t\tif (!/^[a-z0-9-]*$/.test(url)) return null;\r\n\r\n\t\tconst redirects = /^(appeals?|rooms?suggestions?|suggestions?|adminrequests?|bugs?|bugreports?|rules?|faq|credits?|privacy|contact|dex|insecure)$/;\r\n\t\tif (redirects.test(url)) return null;\r\n\r\n\t\tif (url.startsWith('view-teams-view-')) {\r\n\t\t\tconst teamid = url.slice(16);\r\n\t\t\turl = `viewteam-${teamid}` as RoomID;\r\n\t\t}\r\n\t\treturn url as RoomID;\r\n\t}\r\n\t/** true: roomid changed, false: panelState changed, null: neither changed */\r\n\tupdatePanelState(): { roomid: RoomID, changed: boolean | null, newTitle: string } {\r\n\t\tlet room = PS.room;\r\n\t\t// some popups don't have URLs and don't generate history\r\n\t\t// there's definitely a better way to do this but I'm lazy\r\n\t\tif (room.noURL) room = PS.rooms[PS.popups[PS.popups.length - 2]] || PS.panel;\r\n\t\tif (room.noURL) room = PS.panel;\r\n\r\n\t\t// don't generate history when focusing things on things visible on the home screen\r\n\t\tif (room.id === 'news' && room.location === 'mini-window') room = PS.mainmenu;\r\n\t\tif (room.id === '' && PS.leftPanelWidth && PS.rightPanel) {\r\n\t\t\troom = PS.rightPanel;\r\n\t\t}\r\n\t\tif (room.id === 'rooms') room = PS.leftPanel;\r\n\r\n\t\tlet roomid = room.id;\r\n\t\tconst panelState = (PS.leftPanelWidth && room === PS.panel ?\r\n\t\t\tPS.leftPanel.id + '..' + PS.rightPanel!.id :\r\n\t\t\troom.id);\r\n\t\tconst newTitle = roomid === '' ? 'Showdown!' : `${room.title} - Showdown!`;\r\n\t\tlet changed: boolean | null = (roomid !== this.roomid);\r\n\r\n\t\tthis.roomid = roomid;\r\n\t\tif (this.panelState === panelState) changed = null;\r\n\t\tthis.panelState = panelState;\r\n\t\treturn { roomid, changed, newTitle };\r\n\t}\r\n\tsubscribeHash() {\r\n\t\tif (location.hash) {\r\n\t\t\tconst currentRoomid = location.hash.slice(1);\r\n\t\t\tif (/^[a-z0-9-]+$/.test(currentRoomid)) {\r\n\t\t\t\tPS.join(currentRoomid as RoomID);\r\n\t\t\t}\r\n\t\t}\r\n\t\t{\r\n\t\t\tconst { newTitle } = this.updatePanelState();\r\n\t\t\tdocument.title = newTitle;\r\n\t\t}\r\n\t\tPS.subscribe(() => {\r\n\t\t\tconst { roomid, changed, newTitle } = this.updatePanelState();\r\n\t\t\tif (changed) location.hash = roomid ? `#${roomid}` : '';\r\n\t\t\t// n.b. must be done after changing hash, so history entry has the old title\r\n\t\t\tdocument.title = newTitle;\r\n\t\t});\r\n\t\twindow.addEventListener('hashchange', e => {\r\n\t\t\t// really dumb hack, but it's not like back/forward has ever been very reliable\r\n\t\t\tif (PS.popups.length && PS.rooms[PS.popups[PS.popups.length - 1]]?.noURL) return;\r\n\t\t\tconst possibleRoomid = location.hash.slice(1);\r\n\t\t\tlet currentRoomid: RoomID | null = null;\r\n\t\t\tif (/^[a-z0-9-]*$/.test(possibleRoomid)) {\r\n\t\t\t\tcurrentRoomid = possibleRoomid as RoomID;\r\n\t\t\t}\r\n\t\t\tif (currentRoomid !== null) {\r\n\t\t\t\tif (currentRoomid === PS.room.id) return;\r\n\t\t\t\tthis.roomid = currentRoomid;\r\n\t\t\t\tPS.join(currentRoomid);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tsubscribeHistory() {\r\n\t\tconst currentRoomid = location.pathname.slice(1);\r\n\t\tif (/^[a-z0-9-]+$/.test(currentRoomid)) {\r\n\t\t\tif (currentRoomid !== 'preactalpha' && currentRoomid !== 'preactbeta' && currentRoomid !== 'beta') {\r\n\t\t\t\tPS.join(currentRoomid as RoomID);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!window.history) return;\r\n\t\t{\r\n\t\t\tconst { roomid, newTitle } = this.updatePanelState();\r\n\t\t\thistory.replaceState(this.panelState, '', `/${roomid}`);\r\n\t\t\tdocument.title = newTitle;\r\n\t\t}\r\n\t\tPS.subscribe(() => {\r\n\t\t\tconst { roomid, changed, newTitle } = this.updatePanelState();\r\n\t\t\tif (changed) {\r\n\t\t\t\thistory.pushState(this.panelState, '', `/${roomid}`);\r\n\t\t\t} else if (changed !== null) {\r\n\t\t\t\thistory.replaceState(this.panelState, '', `/${roomid}`);\r\n\t\t\t}\r\n\t\t\t// n.b. must be done after changing hash, so history entry has the old title\r\n\t\t\tdocument.title = newTitle;\r\n\t\t});\r\n\t\twindow.addEventListener('popstate', e => {\r\n\t\t\tconst possibleRoomid = location.pathname.slice(1);\r\n\t\t\tlet roomid: RoomID | null = null;\r\n\t\t\tif (/^[a-z0-9-]*$/.test(possibleRoomid)) {\r\n\t\t\t\troomid = possibleRoomid as RoomID;\r\n\t\t\t}\r\n\t\t\tif (typeof e.state === 'string') {\r\n\t\t\t\tconst [leftRoomid, rightRoomid] = e.state.split('..') as RoomID[];\r\n\t\t\t\tif (rightRoomid) {\r\n\t\t\t\t\tPS.addRoom({ id: leftRoomid, location: 'left' }, true);\r\n\t\t\t\t\tPS.addRoom({ id: rightRoomid, location: 'right' }, true);\r\n\t\t\t\t\tPS.leftPanel = PS.rooms[leftRoomid] || PS.leftPanel;\r\n\t\t\t\t\tPS.rightPanel = PS.rooms[rightRoomid] || PS.rightPanel;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (roomid !== null) {\r\n\t\t\t\tthis.roomid = roomid;\r\n\t\t\t\tPS.join(roomid);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\nPS.router = new PSRouter();\r\n\r\nexport class PSRoomPanel<T extends PSRoom = PSRoom> extends preact.Component<{ room: T }> {\r\n\tsubscriptions: PSSubscription[] = [];\r\n\tsubscribeTo<M>(\r\n\t\tmodel: PSModel<M> | PSStreamModel<M>, callback: (value: M) => void = () => { this.forceUpdate(); }\r\n\t): PSSubscription {\r\n\t\tconst subscription = model.subscribe(callback);\r\n\t\tthis.subscriptions.push(subscription);\r\n\t\treturn subscription;\r\n\t}\r\n\toverride componentDidMount() {\r\n\t\tthis.props.room.onParentEvent = (id: string, e?: Event) => {\r\n\t\t\tif (id === 'focus') this.focus();\r\n\t\t};\r\n\t\tthis.subscriptions.push(this.props.room.subscribe(args => {\r\n\t\t\tif (!args) this.forceUpdate();\r\n\t\t\telse this.receiveLine(args);\r\n\t\t}));\r\n\t\tthis.componentDidUpdate();\r\n\t}\r\n\tjustUpdatedDimensions = false;\r\n\tupdateDimensions() {\r\n\t\tconst justUpdated = this.justUpdatedDimensions;\r\n\t\tthis.justUpdatedDimensions = false;\r\n\r\n\t\tconst room = this.props.room;\r\n\t\tconst newWidth = this.base!.offsetWidth;\r\n\t\tconst newHeight = this.base!.offsetHeight;\r\n\t\tif (room.width === newWidth && room.height === newHeight) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\troom.width = newWidth;\r\n\t\troom.height = newHeight;\r\n\r\n\t\tif (justUpdated) return; // should never happen; safeguard against infinite loops\r\n\t\tthis.justUpdatedDimensions = true;\r\n\t\tthis.forceUpdate();\r\n\t}\r\n\toverride componentDidUpdate() {\r\n\t\tconst room = this.props.room;\r\n\t\tconst currentlyHidden = !room.width && room.parentElem && ['popup', 'semimodal-popup'].includes(room.location);\r\n\t\tthis.updateDimensions();\r\n\t\tif (currentlyHidden) return;\r\n\t\tif (room.focusNextUpdate) {\r\n\t\t\troom.focusNextUpdate = false;\r\n\t\t\tthis.focus();\r\n\t\t}\r\n\t}\r\n\toverride componentWillUnmount() {\r\n\t\tthis.props.room.onParentEvent = null;\r\n\t\tfor (const subscription of this.subscriptions) {\r\n\t\t\tsubscription.unsubscribe();\r\n\t\t}\r\n\t\tthis.subscriptions = [];\r\n\t}\r\n\tclose() {\r\n\t\tPS.leave(this.props.room.id);\r\n\t}\r\n\tcomponentDidCatch(err: Error) {\r\n\t\tthis.props.room.caughtError = err.stack || err.message;\r\n\t\tthis.setState({});\r\n\t}\r\n\treceiveLine(args: Args) {}\r\n\t/**\r\n\t * PS has \"fake select menus\", buttons that act like <select> dropdowns.\r\n\t * This function is used by the popups they open to change the button\r\n\t * values.\r\n\t */\r\n\tchooseParentValue(value: string) {\r\n\t\tconst dropdownButton = this.props.room.parentElem as HTMLButtonElement;\r\n\t\tdropdownButton.value = value;\r\n\t\tconst changeEvent = new Event('change');\r\n\t\tdropdownButton.dispatchEvent(changeEvent);\r\n\t\tPS.closePopup();\r\n\t}\r\n\tfocus() {\r\n\t\tif (PSView.hasTapped) return;\r\n\r\n\t\tconst autofocus = this.base?.querySelector<HTMLElement>('.autofocus');\r\n\t\tautofocus?.focus();\r\n\t\t(autofocus as HTMLInputElement)?.select?.();\r\n\t}\r\n\toverride render() {\r\n\t\treturn <PSPanelWrapper room={this.props.room}>\r\n\t\t\t<div class=\"mainmessage\"><p>Loading...</p></div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nexport function PSPanelWrapper(props: {\r\n\troom: PSRoom, children: preact.ComponentChildren,\r\n\tfocusClick?: boolean, scrollable?: boolean | 'hidden', width?: number | 'auto',\r\n\tfullSize?: boolean, onDragEnter?: (ev: DragEvent) => void,\r\n}) {\r\n\tconst room = props.room;\r\n\tif (room.location === 'mini-window') {\r\n\t\tconst size = props.fullSize ? ' mini-window-flex' : '';\r\n\t\treturn <div\r\n\t\t\tid={`room-${room.id}`}\r\n\t\t\tclass={`mini-window-contents tiny-layout ps-room-light${props.scrollable === true ? ' scrollable' : ''}${size}`}\r\n\t\t\tonClick={props.focusClick ? PSView.focusIfNoSelection : undefined} onDragEnter={props.onDragEnter}\r\n\t\t>\r\n\t\t\t{props.children}\r\n\t\t</div>;\r\n\t}\r\n\tif (PS.isPopup(room)) {\r\n\t\tconst style = PSView.getPopupStyle(room, props.width, props.fullSize);\r\n\t\treturn <div class=\"ps-popup\" id={`room-${room.id}`} style={style} onDragEnter={props.onDragEnter}>\r\n\t\t\t{props.children}\r\n\t\t</div>;\r\n\t}\r\n\tconst style = PSView.posStyle(room) as any;\r\n\tif (props.scrollable === 'hidden') style.overflow = 'hidden';\r\n\tconst tinyLayout = room.width < 620 ? ' tiny-layout' : '';\r\n\treturn <div\r\n\t\tclass={`ps-room${room.id === '' ? '' : ' ps-room-light'}${props.scrollable === true ? ' scrollable' : ''}${tinyLayout}`}\r\n\t\tid={`room-${room.id}`} role=\"tabpanel\" aria-labelledby={`roomtab-${room.id}`}\r\n\t\tstyle={style} onClick={props.focusClick ? PSView.focusIfNoSelection : undefined} onDragEnter={props.onDragEnter}\r\n\t>\r\n\t\t{room.caughtError ? <div class=\"broadcast broadcast-red\"><pre>{room.caughtError}</pre></div> : props.children}\r\n\t</div>;\r\n}\r\n\r\nexport class PSView extends preact.Component {\r\n\tstatic readonly isIOS = [\r\n\t\t'iPad Simulator', 'iPhone Simulator', 'iPod Simulator', 'iPad', 'iPhone', 'iPod',\r\n\t].includes(navigator.platform);\r\n\tstatic readonly isChrome = navigator.userAgent.includes(' Chrome/');\r\n\tstatic readonly isSafari = !this.isChrome && navigator.userAgent.includes(' Safari/');\r\n\tstatic readonly isFirefox = navigator.userAgent.includes(' Firefox/');\r\n\tstatic readonly isMac = navigator.platform?.startsWith('Mac');\r\n\tstatic textboxFocused = false;\r\n\tstatic dragend: ((ev: DragEvent) => void) | null = null;\r\n\t/** was the last click event a tap? heristic for mobile/desktop */\r\n\tstatic hasTapped = false;\r\n\t/** mode where the tabbar is opened rather than always being there */\r\n\tstatic narrowMode = false;\r\n\tstatic verticalHeaderWidth = VERTICAL_HEADER_WIDTH;\r\n\tstatic setTextboxFocused(focused: boolean) {\r\n\t\tif (!PSView.narrowMode) return;\r\n\t\tif (!PSView.isChrome && !PSView.isSafari) return;\r\n\t\t// Chrome bug: on Android, it insistently scrolls everything leftmost when scroll snap is enabled\r\n\r\n\t\tthis.textboxFocused = focused;\r\n\t\tif (focused) {\r\n\t\t\tdocument.documentElement.classList.remove('scroll-snap-enabled');\r\n\t\t\tPSView.scrollToRoom();\r\n\t\t} else {\r\n\t\t\tdocument.documentElement.classList.add('scroll-snap-enabled');\r\n\t\t}\r\n\t}\r\n\tstatic focusPreview(room: PSRoom) {\r\n\t\tif (room !== PS.room) return '';\r\n\r\n\t\tconst verticalBuf = this.verticalFocusPreview();\r\n\t\tif (verticalBuf) return verticalBuf;\r\n\r\n\t\tconst isMiniRoom = PS.room.location === 'mini-window';\r\n\t\tconst { rooms, index } = PS.horizontalNav();\r\n\t\tif (index === -1) return '';\r\n\r\n\t\tlet buf = ' ';\r\n\t\tconst leftRoom = PS.rooms[rooms[index - 1]];\r\n\t\tif (leftRoom) buf += `\\u2190 ${leftRoom.title}`;\r\n\t\tbuf += (PS.arrowKeysUsed || isMiniRoom ? \" | \" : \" (use arrow keys) \");\r\n\t\tconst rightRoom = PS.rooms[rooms[index + 1]];\r\n\t\tif (rightRoom) buf += `${rightRoom.title} \\u2192`;\r\n\t\treturn buf;\r\n\t}\r\n\tstatic verticalFocusPreview() {\r\n\t\tconst { rooms, index } = PS.verticalNav();\r\n\t\tif (index === -1) return '';\r\n\r\n\t\tconst upRoom = PS.rooms[rooms[index - 1]];\r\n\t\tlet downRoom = PS.rooms[rooms[index + 1]];\r\n\t\tif (index === rooms.length - 2 && rooms[index + 1] === 'news') downRoom = undefined;\r\n\t\tif (!upRoom && !downRoom) return '';\r\n\r\n\t\tlet buf = ' ';\r\n\t\t// const altLabel = PSMain.isMac ? '\u2325' : '\u1D00\u029F\u1D1B';\r\n\t\tconst altLabel = PSView.isMac ? '\u1D0F\u1D18\u1D1B' : '\u1D00\u029F\u1D1B';\r\n\t\tif (upRoom) buf += `${altLabel}\\u2191 ${upRoom.title}`;\r\n\t\tbuf += \" | \";\r\n\t\tif (downRoom) buf += `${altLabel}\\u2193 ${downRoom.title}`;\r\n\r\n\t\treturn buf;\r\n\t}\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tPS.subscribe(() => this.forceUpdate());\r\n\r\n\t\tif (PSView.isSafari) {\r\n\t\t\t// I don't want to prevent users from being able to zoom, but iOS Safari\r\n\t\t\t// auto-zooms when focusing textboxes (unless the font size is 16px),\r\n\t\t\t// and this apparently fixes it while still allowing zooming.\r\n\t\t\tdocument.querySelector('meta[name=viewport]')?.setAttribute('content', 'width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0');\r\n\t\t}\r\n\r\n\t\twindow.onbeforeunload = (ev: Event) => {\r\n\t\t\treturn PS.prefs.refreshprompt ? \"Are you sure you want to leave?\" : null;\r\n\t\t};\r\n\r\n\t\twindow.addEventListener('submit', ev => {\r\n\t\t\tconst elem = ev.target as HTMLFormElement | null;\r\n\t\t\tif (elem?.getAttribute('data-submitsend')) {\r\n\t\t\t\tconst inputs = Net.formData(elem);\r\n\t\t\t\tlet cmd = elem.getAttribute('data-submitsend')!;\r\n\t\t\t\tfor (const [name, value] of Object.entries(inputs)) {\r\n\t\t\t\t\tcmd = cmd.replace(`{${name}}`, value === true ? 'on' : value === false ? 'off' : value);\r\n\t\t\t\t}\r\n\t\t\t\tcmd = cmd.replace(/\\{[a-z0-9-]+\\}/g, '');\r\n\t\t\t\tconst room = PS.getRoom(elem) || PS.mainmenu;\r\n\t\t\t\troom.sendDirect(cmd);\r\n\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('pointerdown', ev => {\r\n\t\t\t// can't be part of the click event because Safari pretends the pointer is a mouse\r\n\t\t\tPSView.hasTapped = ev.pointerType === 'touch' || ev.pointerType === 'pen';\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('click', ev => {\r\n\t\t\tlet elem = ev.target as HTMLElement | null;\r\n\t\t\tconst clickedRoom = PS.getRoom(elem);\r\n\t\t\twhile (elem) {\r\n\t\t\t\tif (elem.className === 'spoiler') {\r\n\t\t\t\t\telem.className = 'spoiler-shown';\r\n\t\t\t\t} else if (elem.className === 'spoiler-shown') {\r\n\t\t\t\t\telem.className = 'spoiler';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (` ${elem.className} `.includes(' username ')) {\r\n\t\t\t\t\tconst name = elem.getAttribute('data-name') || elem.innerText;\r\n\t\t\t\t\tconst userid = toID(name);\r\n\t\t\t\t\tconst roomid = `${` ${elem.className} `.includes(' no-interact ') ? 'viewuser' : 'user'}-${userid}` as RoomID;\r\n\t\t\t\t\tPS.join(roomid, {\r\n\t\t\t\t\t\tparentElem: elem,\r\n\t\t\t\t\t\trightPopup: elem.className === 'userbutton username',\r\n\t\t\t\t\t\targs: { username: name },\r\n\t\t\t\t\t});\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (elem.tagName === 'A' || elem.getAttribute('data-href')) {\r\n\t\t\t\t\tif (ev.ctrlKey || ev.metaKey || ev.shiftKey) break;\r\n\r\n\t\t\t\t\tconst href = elem.getAttribute('data-href') || elem.getAttribute('href');\r\n\t\t\t\t\tlet roomid = PS.router.extractRoomID(href);\r\n\r\n\t\t\t\t\t// keep this in sync with .htaccess\r\n\t\t\t\t\tconst shortLinks = /^(rooms?suggestions?|suggestions?|adminrequests?|forgotpassword|bugs?(reports?)?|formatsuggestions|rules?|faq|credits?|privacy|contact|dex|(damage)?calc|insecure|replays?|devdiscord|smogdex|smogcord|forums?|trustworthy-dlc-link)$/;\r\n\t\t\t\t\tif (roomid === 'appeal' || roomid === 'appeals') roomid = 'view-help-request--appeal' as RoomID;\r\n\t\t\t\t\tif (roomid === 'report') roomid = 'view-help-request--report' as RoomID;\r\n\t\t\t\t\tif (roomid === 'requesthelp') roomid = 'view-help-request--other' as RoomID;\r\n\r\n\t\t\t\t\tif (roomid !== null && elem.className !== 'no-panel-intercept' && !shortLinks.test(roomid)) {\r\n\t\t\t\t\t\tlet location = null;\r\n\t\t\t\t\t\tif (elem.getAttribute('data-target') === 'replace') {\r\n\t\t\t\t\t\t\tconst room = PS.getRoom(elem);\r\n\t\t\t\t\t\t\tif (room) {\r\n\t\t\t\t\t\t\t\tPS.leave(room.id);\r\n\t\t\t\t\t\t\t\tlocation = room.location;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tPS.join(roomid, {\r\n\t\t\t\t\t\t\tparentElem: elem,\r\n\t\t\t\t\t\t\tlocation,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (!PS.isPopup(PS.rooms[roomid])) {\r\n\t\t\t\t\t\t\tPS.closeAllPopups();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.getAttribute('data-cmd')) {\r\n\t\t\t\t\tconst cmd = elem.getAttribute('data-cmd')!;\r\n\t\t\t\t\tconst room = PS.getRoom(elem) || PS.mainmenu;\r\n\t\t\t\t\troom.send(cmd, elem);\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.getAttribute('data-sendraw')) {\r\n\t\t\t\t\tconst cmd = elem.getAttribute('data-sendraw')!;\r\n\t\t\t\t\tconst room = PS.getRoom(elem) || PS.mainmenu;\r\n\t\t\t\t\troom.sendDirect(cmd);\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.tagName === 'BUTTON') {\r\n\t\t\t\t\tif (this.handleButtonClick(elem as HTMLButtonElement)) {\r\n\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t} else if (!elem.getAttribute('type')) {\r\n\t\t\t\t\t\t// the spec says that buttons with no `type` attribute should be\r\n\t\t\t\t\t\t// submit buttons, but this is a bad default so we're going\r\n\t\t\t\t\t\t// to just assume they're not\r\n\t\t\t\t\t\telem.setAttribute('type', 'button');\r\n\r\n\t\t\t\t\t\t// don't return, to allow <a><button> to make links that look\r\n\t\t\t\t\t\t// like buttons\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.id.startsWith('room-')) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telem = elem.parentElement;\r\n\t\t\t}\r\n\t\t\tif (PS.room !== clickedRoom) {\r\n\t\t\t\tif (clickedRoom) PS.room = clickedRoom;\r\n\t\t\t\tPS.closePopupsAbove(clickedRoom);\r\n\t\t\t\tPS.update();\r\n\t\t\t}\r\n\t\t\tif (clickedRoom && !PS.isPopup(clickedRoom)) {\r\n\t\t\t\tPSView.scrollToRoom();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('keydown', ev => {\r\n\t\t\tlet elem = ev.target as HTMLInputElement | null;\r\n\t\t\tlet isTextInput = false;\r\n\t\t\tlet isNonEmptyTextInput = false;\r\n\t\t\tif (elem) {\r\n\t\t\t\tisTextInput = (elem.tagName === 'INPUT' || elem.tagName === 'TEXTAREA');\r\n\t\t\t\tif (isTextInput && ['button', 'radio', 'checkbox', 'file'].includes(elem.type)) {\r\n\t\t\t\t\tisTextInput = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (isTextInput && elem.value) {\r\n\t\t\t\t\tisNonEmptyTextInput = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.contentEditable === 'true') {\r\n\t\t\t\t\tisTextInput = true;\r\n\t\t\t\t\tif (elem.textContent && elem.textContent !== '\\n') {\r\n\t\t\t\t\t\tisNonEmptyTextInput = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!isNonEmptyTextInput) {\r\n\t\t\t\tif (PS.room.onParentEvent?.('keydown', ev) === false) {\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst modifierKey = ev.ctrlKey || ev.altKey || ev.metaKey || ev.shiftKey;\r\n\t\t\tconst altKey = !ev.ctrlKey && ev.altKey && !ev.metaKey && !ev.shiftKey;\r\n\t\t\tif (altKey && ev.keyCode === 38) { // alt + up\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusUpRoom();\r\n\t\t\t} else if (altKey && ev.keyCode === 40) { // alt + down\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusDownRoom();\r\n\t\t\t} else if (ev.keyCode === 27) { // escape\r\n\t\t\t\t// close popups\r\n\t\t\t\tif (PS.popups.length) {\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tPS.closePopup();\r\n\t\t\t\t\tPS.focusRoom(PS.room.id);\r\n\t\t\t\t} else if (PS.room.id === 'rooms') {\r\n\t\t\t\t\tPS.hideRightRoom();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (isNonEmptyTextInput) return;\r\n\t\t\tif (altKey && ev.keyCode === 37) { // alt + left\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusLeftRoom();\r\n\t\t\t} else if (altKey && ev.keyCode === 39) { // alt + right\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusRightRoom();\r\n\t\t\t}\r\n\t\t\tif (modifierKey) return;\r\n\t\t\tif (ev.keyCode === 37) { // left\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusLeftRoom();\r\n\t\t\t} else if (ev.keyCode === 39) { // right\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusRightRoom();\r\n\t\t\t} else if (ev.keyCode === 191 && !isTextInput && PS.room === PS.mainmenu) { // forward slash\r\n\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tPS.join('dm---' as RoomID);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('dragend', ev => {\r\n\t\t\tPS.dragging = null;\r\n\t\t\tev.preventDefault();\r\n\t\t});\r\n\r\n\t\tconst colorSchemeQuery = window.matchMedia?.('(prefers-color-scheme: dark)');\r\n\t\tif (colorSchemeQuery?.media !== 'not all') {\r\n\t\t\tcolorSchemeQuery.addEventListener('change', cs => {\r\n\t\t\t\tif (PS.prefs.theme === 'system') document.body.className = cs.matches ? 'dark' : '';\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tPS.prefs.subscribeAndRun(key => {\r\n\t\t\tif (!key || key === 'theme') {\r\n\t\t\t\tconst dark = PS.prefs.theme === 'dark' ||\r\n\t\t\t\t\t(PS.prefs.theme === 'system' && colorSchemeQuery?.matches);\r\n\t\t\t\tdocument.body.className = dark ? 'dark' : '';\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tstatic scrollToHeader() {\r\n\t\tif (PSView.narrowMode && window.scrollX > 0) {\r\n\t\t\tif (PSView.isSafari || PSView.isFirefox) {\r\n\t\t\t\t// Safari bug: `scrollBy` doesn't actually work when scroll snap is enabled\r\n\t\t\t\t// note: interferes with the `PSView.textboxFocused` workaround for a Chrome bug\r\n\t\t\t\tdocument.documentElement.classList.remove('scroll-snap-enabled');\r\n\t\t\t\twindow.scrollTo(0, 0);\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (!PSView.textboxFocused) document.documentElement.classList.add('scroll-snap-enabled');\r\n\t\t\t\t}, 1);\r\n\t\t\t} else {\r\n\t\t\t\twindow.scrollTo(0, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tstatic scrollToRoom() {\r\n\t\tif (PSView.narrowMode && window.scrollX === 0) {\r\n\t\t\tif (PSView.isSafari || PSView.isFirefox) {\r\n\t\t\t\t// Safari bug: `scrollBy` doesn't actually work when scroll snap is enabled\r\n\t\t\t\t// note: interferes with the `PSView.textboxFocused` workaround for a Chrome bug\r\n\t\t\t\tdocument.documentElement.classList.remove('scroll-snap-enabled');\r\n\t\t\t\twindow.scrollTo(NARROW_MODE_HEADER_WIDTH, 0);\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (!PSView.textboxFocused) document.documentElement.classList.add('scroll-snap-enabled');\r\n\t\t\t\t}, 1);\r\n\t\t\t} else {\r\n\t\t\t\twindow.scrollTo(NARROW_MODE_HEADER_WIDTH, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tstatic focusIfNoSelection = (ev: MouseEvent) => {\r\n\t\tconst room = PS.getRoom(ev.target as HTMLElement, true);\r\n\t\tif (!room) return;\r\n\r\n\t\tif (window.getSelection?.()?.type === 'Range') return;\r\n\t\troom.autoDismissNotifications();\r\n\t\tPS.setFocus(room);\r\n\t};\r\n\thandleClickOverlay = (ev: MouseEvent) => {\r\n\t\t// iOS Safari bug, no global click events when tapping\r\n\t\t// I'm sure it's intentional but it interferes with putting the dismiss feature in window.onclick\r\n\t\tif ((ev.target as Element)?.className === 'ps-overlay') {\r\n\t\t\tPS.closePopup();\r\n\t\t\tev.preventDefault();\r\n\t\t\tev.stopImmediatePropagation();\r\n\t\t}\r\n\t};\r\n\thandleButtonClick(elem: HTMLButtonElement) {\r\n\t\tswitch (elem.name) {\r\n\t\tcase 'closeRoom': {\r\n\t\t\tconst roomid = elem.value as RoomID || PS.getRoom(elem)?.id || '' as RoomID;\r\n\t\t\tPS.rooms[roomid]?.send('/close', elem);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tcase 'joinRoom':\r\n\t\t\tPS.join(elem.value as RoomID, {\r\n\t\t\t\tparentElem: elem,\r\n\t\t\t});\r\n\t\t\treturn true;\r\n\t\tcase 'register':\r\n\t\t\tPS.join('register' as RoomID, {\r\n\t\t\t\tparentElem: elem,\r\n\t\t\t});\r\n\t\t\treturn true;\r\n\t\tcase 'showOtherFormats': {\r\n\t\t\t// TODO: refactor to a command after we drop support for the old client\r\n\t\t\tconst table = elem.closest('table');\r\n\t\t\tconst room = PS.getRoom(elem);\r\n\t\t\tif (table) {\r\n\t\t\t\tfor (const row of table.querySelectorAll<HTMLElement>('tr.hidden')) {\r\n\t\t\t\t\trow.style.display = 'table-row';\r\n\t\t\t\t}\r\n\t\t\t\tfor (const row of table.querySelectorAll<HTMLElement>('tr.no-matches')) {\r\n\t\t\t\t\trow.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t\telem.closest('tr')!.style.display = 'none';\r\n\t\t\t\t(room as ChatRoom).log?.updateScroll();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tcase 'copyText':\r\n\t\t\tconst dummyInput = document.createElement(\"input\");\r\n\t\t\t// This is a hack. You can only \"select\" an input field.\r\n\t\t\t//  The trick is to create a short lived input element and destroy it after a copy.\r\n\t\t\t// (stolen from the replay code, obviously --mia)\r\n\t\t\tdummyInput.id = \"dummyInput\";\r\n\t\t\tdummyInput.value = elem.value || (elem as any).href || \"\";\r\n\t\t\tdummyInput.style.position = 'absolute';\r\n\t\t\telem.appendChild(dummyInput);\r\n\t\t\tdummyInput.select();\r\n\t\t\tdocument.execCommand(\"copy\");\r\n\t\t\telem.removeChild(dummyInput);\r\n\t\t\telem.innerText = 'Copied!';\r\n\t\t\treturn true;\r\n\t\tcase 'send':\r\n\t\tcase 'cmd':\r\n\t\t\tconst room = PS.getRoom(elem) || PS.mainmenu;\r\n\t\t\tif (elem.name === 'send') {\r\n\t\t\t\troom.sendDirect(elem.value);\r\n\t\t\t} else {\r\n\t\t\t\troom.send(elem.value);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tcomponentDidCatch(err: Error) {\r\n\t\tPS.mainmenu.caughtError = err.stack || err.message;\r\n\t\tthis.setState({});\r\n\t}\r\n\tstatic containingRoomid(elem: HTMLElement) {\r\n\t\tlet curElem: HTMLElement | null = elem;\r\n\t\twhile (curElem) {\r\n\t\t\tif (curElem.id.startsWith('room-')) {\r\n\t\t\t\treturn curElem.id.slice(5) as RoomID;\r\n\t\t\t}\r\n\t\t\tcurElem = curElem.parentElement;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\tstatic isEmptyClick(e: MouseEvent) {\r\n\t\ttry {\r\n\t\t\tconst selection = window.getSelection()!;\r\n\t\t\tif (selection.type === 'Range') return false;\r\n\t\t} catch {}\r\n\t\tBattleTooltips.hideTooltip();\r\n\t}\r\n\tstatic posStyle(room: PSRoom) {\r\n\t\tif (PS.leftPanelWidth === null) {\r\n\t\t\t// vertical mode\r\n\t\t\tif (room === PS.panel) {\r\n\t\t\t\t// const minWidth = Math.min(500, Math.max(320, document.body.offsetWidth - 9));\r\n\t\t\t\treturn { top: '30px', left: `${PSView.verticalHeaderWidth}px`, minWidth: `none` };\r\n\t\t\t}\r\n\t\t} else if (PS.leftPanelWidth === 0) {\r\n\t\t\t// one panel visible\r\n\t\t\tif (room === PS.panel) return {};\r\n\t\t} else {\r\n\t\t\t// both panels visible\r\n\t\t\tif (room === PS.leftPanel) return { width: `${PS.leftPanelWidth}px`, right: 'auto' };\r\n\t\t\tif (room === PS.rightPanel) return { top: 56, left: PS.leftPanelWidth + 1 };\r\n\t\t}\r\n\r\n\t\treturn { display: 'none' };\r\n\t}\r\n\tstatic getPopupStyle(room: PSRoom, width?: number | 'auto', fullSize?: boolean): any {\r\n\t\tif (fullSize) {\r\n\t\t\treturn { width: '90%', maxHeight: '90%', maxWidth: 'none', position: 'relative', margin: '5vh auto 0' };\r\n\t\t}\r\n\r\n\t\tconst source = room.parentElem?.getBoundingClientRect();\r\n\t\tif (source && !source.width && !source.height && !source.top && !source.left) {\r\n\t\t\t// parent elem has been unmounted\r\n\t\t\troom.parentElem = null;\r\n\t\t\tPS.update();\r\n\t\t}\r\n\r\n\t\tif (room.location === 'modal-popup' || !room.parentElem || !source) {\r\n\t\t\treturn { maxWidth: width || 480 };\r\n\t\t}\r\n\t\tif (!room.width || !room.height) {\r\n\t\t\troom.focusNextUpdate = true;\r\n\t\t\treturn {\r\n\t\t\t\tposition: 'absolute',\r\n\t\t\t\tvisibility: 'hidden',\r\n\t\t\t\tmargin: 0,\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tleft: 0,\r\n\t\t\t};\r\n\t\t}\r\n\t\t// nonmodal popup: should be positioned near source element\r\n\t\tlet style: any = {\r\n\t\t\tposition: 'absolute',\r\n\t\t\tmargin: 0,\r\n\t\t};\r\n\t\t// semimodal popups exist in a fixed-positioned overlay and are\r\n\t\t// positioned relative to the overlay (the viewport).\r\n\t\t// regular popups are positioned relative to the document root, and so\r\n\t\t// need to account for scrolling.\r\n\t\tconst isFixed = room.location !== 'popup';\r\n\t\tconst offsetLeft = isFixed ? 0 : window.scrollX;\r\n\t\tconst offsetTop = isFixed ? 0 : window.scrollY;\r\n\t\tconst availableWidth = document.documentElement.clientWidth + offsetLeft;\r\n\t\tconst availableHeight = document.documentElement.clientHeight;\r\n\r\n\t\tconst sourceWidth = source.width;\r\n\t\tconst sourceHeight = source.height;\r\n\t\tconst sourceTop = source.top + offsetTop;\r\n\t\tconst sourceLeft = source.left + offsetLeft;\r\n\r\n\t\tconst height = room.height;\r\n\t\twidth = width || room.width;\r\n\r\n\t\tif (room.rightPopup) {\r\n\r\n\t\t\tif (availableHeight > sourceTop + height + 5 &&\r\n\t\t\t\t(sourceTop < availableHeight * 2 / 3 || sourceTop + 200 < availableHeight)) {\r\n\t\t\t\tstyle.top = sourceTop;\r\n\t\t\t} else if (sourceTop + sourceHeight >= height) {\r\n\t\t\t\tstyle.bottom = Math.max(availableHeight - sourceTop - sourceHeight, 0);\r\n\t\t\t} else {\r\n\t\t\t\tstyle.top = Math.max(0, availableHeight - height);\r\n\t\t\t}\r\n\t\t\tconst popupLeft = sourceLeft + sourceWidth;\r\n\t\t\tif (width !== 'auto' && popupLeft + width > availableWidth) {\r\n\t\t\t\t// can't fit, give up and put it in the normal place\r\n\t\t\t\tstyle = {\r\n\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\tmargin: 0,\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tstyle.left = popupLeft;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (style.left === undefined) {\r\n\r\n\t\t\tif (availableHeight > sourceTop + sourceHeight + height + 5 &&\r\n\t\t\t\t(sourceTop + sourceHeight < availableHeight * 2 / 3 || sourceTop + sourceHeight + 200 < availableHeight)) {\r\n\t\t\t\tstyle.top = sourceTop + sourceHeight;\r\n\t\t\t} else if (height + 30 <= sourceTop) {\r\n\t\t\t\tstyle.bottom = Math.max(availableHeight - sourceTop, 0);\r\n\t\t\t} else if (height + 35 < availableHeight) {\r\n\t\t\t\tstyle.bottom = 5;\r\n\t\t\t} else {\r\n\t\t\t\tstyle.top = 25;\r\n\t\t\t}\r\n\r\n\t\t\tconst availableAlignedWidth = availableWidth - sourceLeft;\r\n\t\t\tif (width !== 'auto' && availableAlignedWidth < width + 10) {\r\n\t\t\t\t// while `right: 10` would be simpler, it doesn't work if there is horizontal scrolling,\r\n\t\t\t\t// like in the mobile layout\r\n\t\t\t\tstyle.left = Math.max(availableWidth - width - 10, offsetLeft);\r\n\t\t\t} else {\r\n\t\t\t\tstyle.left = sourceLeft;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (width) style.maxWidth = width;\r\n\r\n\t\treturn style;\r\n\t}\r\n\trenderRoom(room: PSRoom) {\r\n\t\tconst RoomType = PS.roomTypes[room.type];\r\n\t\tconst Panel = RoomType && !room.isPlaceholder && !room.caughtError ? RoomType : PSRoomPanel;\r\n\t\treturn <Panel key={room.id} room={room} />;\r\n\t}\r\n\trenderPopup(room: PSRoom) {\r\n\t\tconst RoomType = PS.roomTypes[room.type];\r\n\t\tconst Panel = RoomType && !room.isPlaceholder && !room.caughtError ? RoomType : PSRoomPanel;\r\n\t\tif (room.location === 'popup' && room.parentElem) {\r\n\t\t\treturn <Panel key={room.id} room={room} />;\r\n\t\t}\r\n\t\treturn <div key={room.id} class=\"ps-overlay\" onClick={this.handleClickOverlay} role=\"dialog\">\r\n\t\t\t<Panel room={room} />\r\n\t\t</div>;\r\n\t}\r\n\trender() {\r\n\t\tlet rooms = [] as preact.VNode[];\r\n\t\tfor (const roomid in PS.rooms) {\r\n\t\t\tconst room = PS.rooms[roomid]!;\r\n\t\t\tif (PS.isNormalRoom(room)) {\r\n\t\t\t\trooms.push(this.renderRoom(room));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div class=\"ps-frame\" role=\"none\">\r\n\t\t\t<PSHeader />\r\n\t\t\t<PSMiniHeader />\r\n\t\t\t{rooms}\r\n\t\t\t{PS.popups.map(roomid => this.renderPopup(PS.rooms[roomid]!))}\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nexport function PSIcon(\r\n\tprops: { pokemon: string | Pokemon | ServerPokemon | Dex.PokemonSet | null } |\r\n\t\t{ item: string } | { type: string, b?: boolean } | { category: string }\r\n) {\r\n\tif ('pokemon' in props) {\r\n\t\treturn <span class=\"picon\" style={Dex.getPokemonIcon(props.pokemon)} />;\r\n\t}\r\n\tif ('item' in props) {\r\n\t\treturn <span class=\"itemicon\" style={Dex.getItemIcon(props.item)} />;\r\n\t}\r\n\tif ('type' in props) {\r\n\t\tlet type = Dex.types.get(props.type).name;\r\n\t\tif (!type) type = '???';\r\n\t\tlet sanitizedType = type.replace(/\\?/g, '%3f');\r\n\t\treturn <img\r\n\t\t\tsrc={`${Dex.resourcePrefix}sprites/types/${sanitizedType}.png`} alt={type}\r\n\t\t\theight=\"14\" width=\"32\" class={`pixelated${props.b ? ' b' : ''}`}\r\n\t\t/>;\r\n\t}\r\n\tif ('category' in props) {\r\n\t\tconst categoryID = toID(props.category);\r\n\t\tlet sanitizedCategory = '';\r\n\t\tswitch (categoryID) {\r\n\t\tcase 'physical':\r\n\t\tcase 'special':\r\n\t\tcase 'status':\r\n\t\t\tsanitizedCategory = categoryID.charAt(0).toUpperCase() + categoryID.slice(1);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tsanitizedCategory = 'undefined';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\treturn <img\r\n\t\t\tsrc={`${Dex.resourcePrefix}sprites/categories/${sanitizedCategory}.png`} alt={sanitizedCategory}\r\n\t\t\theight=\"14\" width=\"32\" class=\"pixelated\"\r\n\t\t/>;\r\n\t}\r\n\treturn null!;\r\n}\r\n"],
  "mappings": "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",
  "names": ["preact", "style", "location", "room"]
}
