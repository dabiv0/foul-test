{"version":3,"file":"battle-choices.js","names":["BattleChoiceBuilder","request","noCancel","choices","current","choiceType","move","targetLoc","mega","megax","megay","ultra","z","max","tera","alreadySwitchingIn","alreadyMega","alreadyMax","alreadyZ","alreadyTera","requestType","fillPasses","_proto","prototype","toString","concat","stringChoice","join","replace","isDone","length","requestLength","isEmpty","_i2","_this$choices2","choice","index","active","forceSwitch","chosenTeamSize","currentMoveRequest","arguments","undefined","noMoreSwitchChoices","i","side","pokemon","fainted","includes","addChoice","choiceString","parseChoice","err","message","isLastChoice","_this$currentMoveRequ","targetable","_this$currentMove","choosableTargets","currentMove","target","maybeDisabled","_this$currentMoveRequ2","_this$currentMoveRequ3","trapped","targetPokemon","splice","maybeTrapped","push","_this$currentMoveList","moveIndex","currentMoveList","moveRequest","maxMoves","canDynamax","zMoves","moves","Error","startsWith","slice","test","toID","parseInt","trim","endsWith","moveid","id","disabled","name","_move$name","isTeamPreview","lowerChoice","toLowerCase","choiceid","matchLevel","match","serverPokemon","curMatchLevel","speciesForme","Dex","species","get","baseSpecies","moveSpecial","fixRequest","battle","teamPreview","wait","_i7","_request$side$pokemon2","parseDetails","ident","substr","details","parseHealth","condition","gameType","_i9","_request$side$pokemon4","switchable","baseAbility","maxChosenTeamSize","teamPreviewCount","mySide","map","_i11","_request$active2","_i13","_active$moves2","gigantamax","_i15","_active$maxMoves2","canZMove","_i17","_active$zMoves2"],"sources":["../src/battle-choices.ts"],"sourcesContent":["/**\r\n * Battle choices\r\n *\r\n * PS will send requests \"what do you do this turn?\", and you send back\r\n * choices \"I switch Pikachu for Caterpie, and Squirtle uses Water Gun\"\r\n *\r\n * This file contains classes for handling requests and choices.\r\n *\r\n * Dependencies: battle-dex\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license MIT\r\n */\r\n\r\nimport type { Battle, ServerPokemon } from \"./battle\";\r\nimport { Dex, toID, type ID } from \"./battle-dex\";\r\n\r\nexport interface BattleRequestSideInfo {\r\n\tname: string;\r\n\tid: 'p1' | 'p2' | 'p3' | 'p4';\r\n\tpokemon: ServerPokemon[];\r\n}\r\nexport interface BattleRequestActivePokemon {\r\n\tmoves: {\r\n\t\tname: string,\r\n\t\tid: ID,\r\n\t\tpp: number,\r\n\t\tmaxpp: number,\r\n\t\ttarget: Dex.MoveTarget,\r\n\t\tdisabled?: boolean,\r\n\t}[];\r\n\tmaxMoves?: {\r\n\t\tname: string,\r\n\t\tid: ID,\r\n\t\ttarget: Dex.MoveTarget,\r\n\t\tdisabled?: boolean,\r\n\t}[];\r\n\tzMoves?: ({\r\n\t\tname: string,\r\n\t\tid: ID,\r\n\t\ttarget: Dex.MoveTarget,\r\n\t\tdisabled?: false,\r\n\t} | null)[];\r\n\t/** also true if the pokemon can Gigantamax */\r\n\tcanDynamax?: boolean;\r\n\t/** if the pokemon can Gigantamax, a string containing the full name of its G-max move */\r\n\tgigantamax?: string;\r\n\tcanMegaEvo?: boolean;\r\n\tcanMegaEvoX?: boolean;\r\n\tcanMegaEvoY?: boolean;\r\n\tcanUltraBurst?: boolean;\r\n\tcanTerastallize?: string;\r\n\ttrapped?: boolean;\r\n\tmaybeTrapped?: boolean;\r\n\tmaybeDisabled?: boolean;\r\n\tmaybeLocked?: boolean;\r\n}\r\n\r\nexport interface BattleMoveRequest {\r\n\trequestType: 'move';\r\n\trqid: number;\r\n\tside: BattleRequestSideInfo;\r\n\tactive: (BattleRequestActivePokemon | null)[];\r\n\tnoCancel?: boolean;\r\n\ttargetable?: boolean;\r\n}\r\nexport interface BattleSwitchRequest {\r\n\trequestType: 'switch';\r\n\trqid: number;\r\n\tside: BattleRequestSideInfo;\r\n\tforceSwitch: boolean[];\r\n\tnoCancel?: boolean;\r\n}\r\nexport interface BattleTeamRequest {\r\n\trequestType: 'team';\r\n\trqid: number;\r\n\tside: BattleRequestSideInfo;\r\n\tmaxTeamSize?: number;\r\n\tmaxChosenTeamSize?: number;\r\n\tchosenTeamSize?: number;\r\n\tnoCancel?: boolean;\r\n}\r\nexport interface BattleWaitRequest {\r\n\trequestType: 'wait';\r\n\trqid: number;\r\n\tside: undefined;\r\n\tnoCancel?: boolean;\r\n}\r\nexport type BattleRequest = BattleMoveRequest | BattleSwitchRequest | BattleTeamRequest | BattleWaitRequest;\r\n\r\ninterface BattleMoveChoice {\r\n\tchoiceType: 'move';\r\n\t/** 1-based move */\r\n\tmove: number;\r\n\ttargetLoc: number;\r\n\t// gen 6\r\n\tmega: boolean;\r\n\tmegax: boolean;\r\n\tmegay: boolean;\r\n\t// gen 7\r\n\tz: boolean;\r\n\tultra: boolean;\r\n\t// gen 8\r\n\tmax: boolean;\r\n\t// gen 9\r\n\ttera: boolean;\r\n}\r\ninterface BattleSwitchChoice {\r\n\tchoiceType: 'switch' | 'team';\r\n\t/** 1-based pokemon */\r\n\ttargetPokemon: number;\r\n}\r\ninterface BattleMiscChoice {\r\n\tchoiceType: 'shift' | 'testfight';\r\n}\r\ntype BattleChoice = BattleMoveChoice | BattleSwitchChoice | BattleMiscChoice;\r\n\r\n/**\r\n * Tracks a partial choice, allowing you to build it up one step at a time,\r\n * and maybe even construct a UI to build it!\r\n *\r\n * Doesn't support going backwards; just use `new BattleChoiceBuilder`.\r\n */\r\nexport class BattleChoiceBuilder {\r\n\trequest: BattleRequest;\r\n\tnoCancel: boolean;\r\n\t/** Completed choices in string form */\r\n\tchoices: string[] = [];\r\n\t/** Currently active partial move choice - not used for other choices, which don't have partial states */\r\n\tcurrent: BattleMoveChoice = {\r\n\t\tchoiceType: 'move',\r\n\t\t/** if nonzero, show target screen; if zero, show move screen */\r\n\t\tmove: 0,\r\n\t\ttargetLoc: 0, // should always be 0: is not partial if `targetLoc` is known\r\n\t\tmega: false,\r\n\t\tmegax: false,\r\n\t\tmegay: false,\r\n\t\tultra: false,\r\n\t\tz: false,\r\n\t\tmax: false,\r\n\t\ttera: false,\r\n\t};\r\n\talreadySwitchingIn: number[] = [];\r\n\talreadyMega = false;\r\n\talreadyMax = false;\r\n\talreadyZ = false;\r\n\talreadyTera = false;\r\n\r\n\tconstructor(request: BattleRequest) {\r\n\t\tthis.request = request;\r\n\t\tthis.noCancel = request.noCancel || request.requestType === 'wait';\r\n\t\tthis.fillPasses();\r\n\t}\r\n\r\n\ttoString() {\r\n\t\tlet choices = this.choices;\r\n\t\tif (this.current.move) choices = choices.concat(this.stringChoice(this.current));\r\n\t\treturn choices.join(', ').replace(/, team /g, ', ');\r\n\t}\r\n\r\n\tisDone() {\r\n\t\treturn this.choices.length >= this.requestLength();\r\n\t}\r\n\tisEmpty() {\r\n\t\tfor (const choice of this.choices) {\r\n\t\t\tif (choice !== 'pass') return false;\r\n\t\t}\r\n\t\tif (this.current.move) return false;\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/** Index of the current Pokémon to make choices for */\r\n\tindex(): number {\r\n\t\treturn this.choices.length;\r\n\t}\r\n\t/** How many choices is the server expecting? */\r\n\trequestLength() {\r\n\t\tconst request = this.request;\r\n\t\tswitch (request.requestType) {\r\n\t\tcase 'move':\r\n\t\t\treturn request.active.length;\r\n\t\tcase 'switch':\r\n\t\t\treturn request.forceSwitch.length;\r\n\t\tcase 'team':\r\n\t\t\treturn request.chosenTeamSize || 1;\r\n\t\tcase 'wait':\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n\tcurrentMoveRequest(index = this.index()) {\r\n\t\tif (this.request.requestType !== 'move') return null;\r\n\t\treturn this.request.active[index];\r\n\t}\r\n\tnoMoreSwitchChoices() {\r\n\t\tif (this.request.requestType !== 'switch') return false;\r\n\t\tfor (let i = this.requestLength(); i < this.request.side.pokemon.length; i++) {\r\n\t\t\tconst pokemon = this.request.side.pokemon[i];\r\n\t\t\tif (!pokemon.fainted && !this.alreadySwitchingIn.includes(i + 1)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\taddChoice(choiceString: string) {\r\n\t\tlet choice: BattleChoice | null;\r\n\t\ttry {\r\n\t\t\tchoice = this.parseChoice(choiceString);\r\n\t\t} catch (err) {\r\n\t\t\treturn (err as Error).message;\r\n\t\t}\r\n\t\tif (!choice) {\r\n\t\t\treturn \"You do not need to manually choose to pass; the client handles it for you automatically\";\r\n\t\t}\r\n\t\t/** only the last choice can be uncancelable */\r\n\t\tconst isLastChoice = this.choices.length + 1 >= this.requestLength();\r\n\t\tif (choice.choiceType === 'move') {\r\n\t\t\tif (!choice.targetLoc && (this.request as BattleMoveRequest).targetable) {\r\n\t\t\t\tconst choosableTargets: unknown[] = ['normal', 'any', 'adjacentAlly', 'adjacentAllyOrSelf', 'adjacentFoe'];\r\n\t\t\t\tif (choosableTargets.includes(this.currentMove(choice)?.target)) {\r\n\t\t\t\t\tthis.current = choice;\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.currentMoveRequest()?.maybeDisabled && isLastChoice) {\r\n\t\t\t\tthis.noCancel = true;\r\n\t\t\t}\r\n\t\t\tif (choice.mega || choice.megax || choice.megay) this.alreadyMega = true;\r\n\t\t\tif (choice.z) this.alreadyZ = true;\r\n\t\t\tif (choice.max) this.alreadyMax = true;\r\n\t\t\tif (choice.tera) this.alreadyTera = true;\r\n\t\t\tthis.current = {\r\n\t\t\t\tchoiceType: 'move',\r\n\t\t\t\tmove: 0,\r\n\t\t\t\ttargetLoc: 0,\r\n\t\t\t\tmega: false,\r\n\t\t\t\tmegax: false,\r\n\t\t\t\tmegay: false,\r\n\t\t\t\tultra: false,\r\n\t\t\t\tz: false,\r\n\t\t\t\tmax: false,\r\n\t\t\t\ttera: false,\r\n\t\t\t};\r\n\t\t} else if (choice.choiceType === 'switch' || choice.choiceType === 'team') {\r\n\t\t\tif (this.currentMoveRequest()?.trapped) {\r\n\t\t\t\treturn \"You are trapped and cannot switch out\";\r\n\t\t\t}\r\n\t\t\tif (this.alreadySwitchingIn.includes(choice.targetPokemon)) {\r\n\t\t\t\tif (choice.choiceType === 'switch') {\r\n\t\t\t\t\treturn \"You've already chosen to switch that Pokémon in\";\r\n\t\t\t\t}\r\n\t\t\t\t// remove choice instead\r\n\t\t\t\tfor (let i = 0; i < this.alreadySwitchingIn.length; i++) {\r\n\t\t\t\t\tif (this.alreadySwitchingIn[i] === choice.targetPokemon) {\r\n\t\t\t\t\t\tthis.alreadySwitchingIn.splice(i, 1);\r\n\t\t\t\t\t\tthis.choices.splice(i, 1);\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn \"Unexpected bug, please report this\";\r\n\t\t\t}\r\n\t\t\tif (this.currentMoveRequest()?.maybeTrapped && isLastChoice) {\r\n\t\t\t\tthis.noCancel = true;\r\n\t\t\t}\r\n\t\t\tthis.alreadySwitchingIn.push(choice.targetPokemon);\r\n\t\t} else if (choice.choiceType === 'testfight') {\r\n\t\t\tif (isLastChoice) {\r\n\t\t\t\tthis.noCancel = true;\r\n\t\t\t}\r\n\t\t} else if (choice.choiceType === 'shift') {\r\n\t\t\tif (this.index() === 1) {\r\n\t\t\t\treturn \"Only Pokémon not already in the center can shift to the center\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.choices.push(this.stringChoice(choice));\r\n\t\tthis.fillPasses();\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Move and switch requests will often skip over some active Pokémon (mainly\r\n\t * fainted Pokémon). This will fill them in automatically, so we don't need\r\n\t * to ask a user for them.\r\n\t */\r\n\tfillPasses() {\r\n\t\tconst request = this.request;\r\n\t\tswitch (request.requestType) {\r\n\t\tcase 'move':\r\n\t\t\twhile (this.choices.length < request.active.length && !request.active[this.choices.length]) {\r\n\t\t\t\tthis.choices.push('pass');\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'switch':\r\n\t\t\tconst noMoreSwitchChoices = this.noMoreSwitchChoices();\r\n\t\t\twhile (this.choices.length < request.forceSwitch.length) {\r\n\t\t\t\tif (!request.forceSwitch[this.choices.length] || noMoreSwitchChoices) {\r\n\t\t\t\t\tthis.choices.push('pass');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcurrentMove(choice = this.current, index = this.index()) {\r\n\t\tconst moveIndex = choice.move - 1;\r\n\t\treturn this.currentMoveList(index, choice)?.[moveIndex] || null;\r\n\t}\r\n\r\n\tcurrentMoveList(\r\n\t\tindex = this.index(), current: { max?: boolean, z?: boolean } = this.current\r\n\t): ({ name: string, id: ID, target: Dex.MoveTarget, disabled?: boolean } | null)[] | null {\r\n\t\tconst moveRequest = this.currentMoveRequest(index);\r\n\t\tif (!moveRequest) return null;\r\n\t\tif (current.max || (moveRequest.maxMoves && !moveRequest.canDynamax)) {\r\n\t\t\treturn moveRequest.maxMoves || null;\r\n\t\t}\r\n\t\tif (current.z) {\r\n\t\t\treturn moveRequest.zMoves || null;\r\n\t\t}\r\n\t\treturn moveRequest.moves;\r\n\t}\r\n\t/**\r\n\t * Parses a choice from string form to BattleChoice form\r\n\t */\r\n\tparseChoice(choice: string, index = this.choices.length): BattleChoice | null {\r\n\t\tconst request = this.request;\r\n\t\tif (request.requestType === 'wait') throw new Error(`It's not your turn to choose anything`);\r\n\r\n\t\tif (choice === 'shift' || choice === 'testfight') {\r\n\t\t\tif (request.requestType !== 'move') {\r\n\t\t\t\tthrow new Error(`You must switch in a Pokémon, not move.`);\r\n\t\t\t}\r\n\t\t\treturn { choiceType: choice };\r\n\t\t}\r\n\r\n\t\tif (choice.startsWith('move ')) {\r\n\t\t\tif (request.requestType !== 'move') {\r\n\t\t\t\tthrow new Error(`You must switch in a Pokémon, not move.`);\r\n\t\t\t}\r\n\t\t\tconst moveRequest = request.active[index]!;\r\n\t\t\tchoice = choice.slice(5);\r\n\t\t\tlet current: BattleMoveChoice = {\r\n\t\t\t\tchoiceType: 'move',\r\n\t\t\t\tmove: 0,\r\n\t\t\t\ttargetLoc: 0,\r\n\t\t\t\tmega: false,\r\n\t\t\t\tmegax: false,\r\n\t\t\t\tmegay: false,\r\n\t\t\t\tultra: false,\r\n\t\t\t\tz: false,\r\n\t\t\t\tmax: false,\r\n\t\t\t\ttera: false,\r\n\t\t\t};\r\n\t\t\twhile (true) {\r\n\t\t\t\t// If data ends with a number, treat it as a target location.\r\n\t\t\t\t// We need to special case 'Conversion 2' so it doesn't get\r\n\t\t\t\t// confused with 'Conversion' erroneously sent with the target\r\n\t\t\t\t// '2' (since Conversion targets 'self', targetLoc can't be 2).\r\n\t\t\t\tif (/\\s(?:-|\\+)?[1-3]$/.test(choice) && toID(choice) !== 'conversion2') {\r\n\t\t\t\t\tif (current.targetLoc) throw new Error(`Move choice has multiple targets`);\r\n\t\t\t\t\tcurrent.targetLoc = parseInt(choice.slice(-2), 10);\r\n\t\t\t\t\tchoice = choice.slice(0, -2).trim();\r\n\t\t\t\t} else if (choice.endsWith(' mega')) {\r\n\t\t\t\t\tcurrent.mega = true;\r\n\t\t\t\t\tchoice = choice.slice(0, -5);\r\n\t\t\t\t} else if (choice.endsWith(' megax')) {\r\n\t\t\t\t\tcurrent.megax = true;\r\n\t\t\t\t\tchoice = choice.slice(0, -6);\r\n\t\t\t\t} else if (choice.endsWith(' megay')) {\r\n\t\t\t\t\tcurrent.megay = true;\r\n\t\t\t\t\tchoice = choice.slice(0, -6);\r\n\t\t\t\t} else if (choice.endsWith(' zmove')) {\r\n\t\t\t\t\tcurrent.z = true;\r\n\t\t\t\t\tchoice = choice.slice(0, -6);\r\n\t\t\t\t} else if (choice.endsWith(' ultra')) {\r\n\t\t\t\t\tcurrent.ultra = true;\r\n\t\t\t\t\tchoice = choice.slice(0, -6);\r\n\t\t\t\t} else if (choice.endsWith(' dynamax')) {\r\n\t\t\t\t\tcurrent.max = true;\r\n\t\t\t\t\tchoice = choice.slice(0, -8);\r\n\t\t\t\t} else if (choice.endsWith(' max')) {\r\n\t\t\t\t\tcurrent.max = true;\r\n\t\t\t\t\tchoice = choice.slice(0, -4);\r\n\t\t\t\t} else if (choice.endsWith(' terastallize')) {\r\n\t\t\t\t\tcurrent.tera = true;\r\n\t\t\t\t\tchoice = choice.slice(0, -13);\r\n\t\t\t\t} else if (choice.endsWith(' terastal')) {\r\n\t\t\t\t\tcurrent.tera = true;\r\n\t\t\t\t\tchoice = choice.slice(0, -9);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (/^[0-9]+$/.test(choice)) {\r\n\t\t\t\t// Parse a one-based move index.\r\n\t\t\t\tcurrent.move = parseInt(choice, 10);\r\n\t\t\t} else {\r\n\t\t\t\t// Parse a move ID.\r\n\t\t\t\t// Move names are also allowed, but may cause ambiguity (see client issue #167).\r\n\t\t\t\tlet moveid = toID(choice);\r\n\t\t\t\tif (moveid.startsWith('hiddenpower')) moveid = 'hiddenpower' as ID;\r\n\r\n\t\t\t\tfor (let i = 0; i < moveRequest.moves.length; i++) {\r\n\t\t\t\t\tif (moveid === moveRequest.moves[i].id) {\r\n\t\t\t\t\t\tcurrent.move = i + 1;\r\n\t\t\t\t\t\tif (moveRequest.moves[i].disabled) {\r\n\t\t\t\t\t\t\tthrow new Error(`Move \"${moveRequest.moves[i].name}\" is disabled`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!current.move && moveRequest.zMoves) {\r\n\t\t\t\t\tfor (let i = 0; i < moveRequest.zMoves.length; i++) {\r\n\t\t\t\t\t\tif (!moveRequest.zMoves[i]) continue;\r\n\t\t\t\t\t\tif (moveid === moveRequest.zMoves[i]!.id) {\r\n\t\t\t\t\t\t\tcurrent.move = i + 1;\r\n\t\t\t\t\t\t\tcurrent.z = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!current.move && moveRequest.maxMoves) {\r\n\t\t\t\t\tfor (let i = 0; i < moveRequest.maxMoves.length; i++) {\r\n\t\t\t\t\t\tif (moveid === moveRequest.maxMoves[i].id) {\r\n\t\t\t\t\t\t\tif (moveRequest.maxMoves[i].disabled) {\r\n\t\t\t\t\t\t\t\tthrow new Error(`Move \"${moveRequest.maxMoves[i].name}\" is disabled`);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcurrent.move = i + 1;\r\n\t\t\t\t\t\t\tcurrent.max = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (current.max && !moveRequest.canDynamax) current.max = false;\r\n\t\t\tconst move = this.currentMove(current, index);\r\n\t\t\tif (!move || move.disabled) {\r\n\t\t\t\tthrow new Error(`Move ${move?.name ?? current.move} is disabled`);\r\n\t\t\t}\r\n\t\t\treturn current;\r\n\t\t}\r\n\r\n\t\tif (choice.startsWith('switch ') || choice.startsWith('team ')) {\r\n\t\t\tchoice = choice.slice(choice.startsWith('team ') ? 5 : 7);\r\n\t\t\tconst isTeamPreview = request.requestType === 'team';\r\n\t\t\tlet current: BattleSwitchChoice = {\r\n\t\t\t\tchoiceType: isTeamPreview ? 'team' : 'switch',\r\n\t\t\t\ttargetPokemon: 0,\r\n\t\t\t};\r\n\t\t\tif (/^[0-9]+$/.test(choice)) {\r\n\t\t\t\t// Parse a one-based move index.\r\n\t\t\t\tcurrent.targetPokemon = parseInt(choice, 10);\r\n\t\t\t} else {\r\n\t\t\t\t// Parse a pokemon name\r\n\t\t\t\tconst lowerChoice = choice.toLowerCase();\r\n\t\t\t\tconst choiceid = toID(choice);\r\n\t\t\t\tlet matchLevel = 0;\r\n\t\t\t\tlet match = 0;\r\n\t\t\t\tfor (let i = 0; i < request.side.pokemon.length; i++) {\r\n\t\t\t\t\tconst serverPokemon = request.side.pokemon[i];\r\n\t\t\t\t\tlet curMatchLevel = 0;\r\n\t\t\t\t\tif (choice === serverPokemon.name) {\r\n\t\t\t\t\t\tcurMatchLevel = 10;\r\n\t\t\t\t\t} else if (lowerChoice === serverPokemon.name.toLowerCase()) {\r\n\t\t\t\t\t\tcurMatchLevel = 9;\r\n\t\t\t\t\t} else if (choiceid === toID(serverPokemon.name)) {\r\n\t\t\t\t\t\tcurMatchLevel = 8;\r\n\t\t\t\t\t} else if (choiceid === toID(serverPokemon.speciesForme)) {\r\n\t\t\t\t\t\tcurMatchLevel = 7;\r\n\t\t\t\t\t} else if (choiceid === toID(Dex.species.get(serverPokemon.speciesForme).baseSpecies)) {\r\n\t\t\t\t\t\tcurMatchLevel = 6;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (curMatchLevel > matchLevel) {\r\n\t\t\t\t\t\tmatch = i + 1;\r\n\t\t\t\t\t\tmatchLevel = curMatchLevel;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!match) {\r\n\t\t\t\t\tthrow new Error(`Couldn't find Pokémon \"${choice}\" to switch to`);\r\n\t\t\t\t}\r\n\t\t\t\tcurrent.targetPokemon = match;\r\n\t\t\t}\r\n\t\t\tif (!isTeamPreview && current.targetPokemon - 1 < this.requestLength()) {\r\n\t\t\t\tthrow new Error(`That Pokémon is already in battle!`);\r\n\t\t\t}\r\n\t\t\tconst target = request.side.pokemon[current.targetPokemon - 1];\r\n\t\t\tif (!target) {\r\n\t\t\t\tthrow new Error(`Couldn't find Pokémon \"${choice}\" to switch to!`);\r\n\t\t\t}\r\n\t\t\tif (target.fainted) {\r\n\t\t\t\tthrow new Error(`${target.name} is fainted and cannot battle!`);\r\n\t\t\t}\r\n\t\t\treturn current;\r\n\t\t}\r\n\r\n\t\tif (choice === 'pass') return null;\r\n\r\n\t\tthrow new Error(`Unrecognized choice \"${choice}\"`);\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a choice from `BattleChoice` into string form\r\n\t */\r\n\tstringChoice(choice: BattleChoice | null) {\r\n\t\tif (!choice) return `pass`;\r\n\t\tswitch (choice.choiceType) {\r\n\t\tcase 'move':\r\n\t\t\tconst target = choice.targetLoc ? ` ${choice.targetLoc > 0 ? '+' : ''}${choice.targetLoc}` : ``;\r\n\t\t\treturn `move ${choice.move}${this.moveSpecial(choice)}${target}`;\r\n\t\tcase 'switch':\r\n\t\tcase 'team':\r\n\t\t\treturn `${choice.choiceType} ${choice.targetPokemon}`;\r\n\t\tcase 'shift':\r\n\t\tcase 'testfight':\r\n\t\t\treturn choice.choiceType;\r\n\t\t}\r\n\t}\r\n\tmoveSpecial(choice: BattleMoveChoice) {\r\n\t\treturn (choice.max ? ' max' : '') +\r\n\t\t\t(choice.mega ? ' mega' : '') +\r\n\t\t\t(choice.megax ? ' megax' : '') +\r\n\t\t\t(choice.megay ? ' megay' : '') +\r\n\t\t\t(choice.z ? ' zmove' : '') +\r\n\t\t\t(choice.tera ? ' terastallize' : '');\r\n\t}\r\n\r\n\t/**\r\n\t * The request sent from the server is actually really gross, but we'll have\r\n\t * to wait until we transition to the new client before fixing it in the\r\n\t * protocol, in the interests of not needing to fix it twice (or needing to\r\n\t * fix it without TypeScript).\r\n\t *\r\n\t * In the meantime, this function converts a request from a shitty request\r\n\t * to a request that makes sense.\r\n\t *\r\n\t * I'm sorry for literally all of this.\r\n\t */\r\n\tstatic fixRequest(request: any, battle: Battle) {\r\n\t\tif (!request.requestType) {\r\n\t\t\trequest.requestType = 'move';\r\n\t\t\tif (request.forceSwitch) {\r\n\t\t\t\trequest.requestType = 'switch';\r\n\t\t\t} else if (request.teamPreview) {\r\n\t\t\t\trequest.requestType = 'team';\r\n\t\t\t} else if (request.wait) {\r\n\t\t\t\trequest.requestType = 'wait';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (request.requestType === 'wait') request.noCancel = true;\r\n\t\tif (request.side) {\r\n\t\t\tfor (const serverPokemon of request.side.pokemon) {\r\n\t\t\t\tbattle.parseDetails(serverPokemon.ident.substr(4), serverPokemon.ident, serverPokemon.details, serverPokemon);\r\n\t\t\t\tbattle.parseHealth(serverPokemon.condition, serverPokemon);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (request.requestType === 'team' && !request.chosenTeamSize) {\r\n\t\t\trequest.chosenTeamSize = 1;\r\n\t\t\tif (battle.gameType === 'doubles') {\r\n\t\t\t\trequest.chosenTeamSize = 2;\r\n\t\t\t}\r\n\t\t\tif (battle.gameType === 'triples' || battle.gameType === 'rotation') {\r\n\t\t\t\trequest.chosenTeamSize = 3;\r\n\t\t\t}\r\n\t\t\t// Request full team order if one of our Pokémon has Illusion\r\n\t\t\tfor (const switchable of request.side.pokemon) {\r\n\t\t\t\tif (toID(switchable.baseAbility) === 'illusion') {\r\n\t\t\t\t\trequest.chosenTeamSize = request.side.pokemon.length;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (request.maxChosenTeamSize) {\r\n\t\t\t\trequest.chosenTeamSize = request.maxChosenTeamSize;\r\n\t\t\t}\r\n\t\t\tif (battle.teamPreviewCount) {\r\n\t\t\t\tconst chosenTeamSize = battle.teamPreviewCount;\r\n\t\t\t\tif (chosenTeamSize > 0 && chosenTeamSize <= request.side.pokemon.length) {\r\n\t\t\t\t\trequest.chosenTeamSize = chosenTeamSize;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\trequest.targetable ||= battle.mySide.active.length > 1;\r\n\r\n\t\tif (request.active) {\r\n\t\t\trequest.active = request.active.map(\r\n\t\t\t\t(active: any, i: number) => request.side.pokemon[i].fainted ? null : active\r\n\t\t\t);\r\n\t\t\tfor (const active of request.active) {\r\n\t\t\t\tif (!active) continue;\r\n\t\t\t\tfor (const move of active.moves) {\r\n\t\t\t\t\tif (move.move) move.name = move.move;\r\n\t\t\t\t\tmove.id = toID(move.name);\r\n\t\t\t\t}\r\n\t\t\t\tif (active.maxMoves) {\r\n\t\t\t\t\tif (active.maxMoves.maxMoves) {\r\n\t\t\t\t\t\tactive.gigantamax = active.maxMoves.gigantamax;\r\n\t\t\t\t\t\tactive.maxMoves = active.maxMoves.maxMoves;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (const move of active.maxMoves) {\r\n\t\t\t\t\t\tif (move.move) move.name = Dex.moves.get(move.move).name;\r\n\t\t\t\t\t\tmove.id = toID(move.name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (active.canZMove) {\r\n\t\t\t\t\tactive.zMoves = active.canZMove;\r\n\t\t\t\t\tfor (const move of active.zMoves) {\r\n\t\t\t\t\t\tif (!move) continue;\r\n\t\t\t\t\t\tif (move.move) move.name = move.move;\r\n\t\t\t\t\t\tmove.id = toID(move.name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n"],"mappings":"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","ignoreList":[]}