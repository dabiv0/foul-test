{"version":3,"file":"panels.js","names":["VERTICAL_HEADER_WIDTH","NARROW_MODE_HEADER_WIDTH","PSRouter","roomid","panelState","currentRoomid","location","pathname","slice","test","subscribeHistory","endsWith","subscribeHash","_proto","prototype","extractRoomID","url","startsWith","document","origin","length","charAt","host","PS","server","id","replace","redirects","teamid","updatePanelState","room","noURL","rooms","popups","panel","mainmenu","leftPanelWidth","rightPanel","leftPanel","newTitle","title","changed","_this","hash","join","_this$updatePanelStat","subscribe","_this$updatePanelStat2","window","addEventListener","e","_PS$rooms$PS$popups","possibleRoomid","_this2","history","_this$updatePanelStat3","replaceState","_this2$updatePanelSta","pushState","state","_ref","split","leftRoomid","rightRoomid","addRoom","router","PSRoomPanel","_preact$Component","_this3","_len","arguments","args","Array","_key","call","apply","concat","subscriptions","justUpdatedDimensions","_inheritsLoose","_proto2","subscribeTo","model","_this4","callback","undefined","forceUpdate","subscription","push","componentDidMount","_this5","props","onParentEvent","focus","receiveLine","componentDidUpdate","updateDimensions","justUpdated","newWidth","base","offsetWidth","newHeight","offsetHeight","width","height","currentlyHidden","parentElem","includes","focusNextUpdate","componentWillUnmount","_i2","_this$subscriptions2","unsubscribe","close","leave","componentDidCatch","err","caughtError","stack","message","setState","chooseParentValue","value","dropdownButton","changeEvent","Event","dispatchEvent","closePopup","_this$base","PSView","hasTapped","autofocus","querySelector","select","render","preact","h","PSPanelWrapper","Component","size","fullSize","scrollable","onClick","focusClick","focusIfNoSelection","onDragEnter","children","isPopup","style","getPopupStyle","posStyle","overflow","tinyLayout","role","_preact$Component2","_this6","handleClickOverlay","ev","_ev$target","target","className","preventDefault","stopImmediatePropagation","isSafari","_document$querySelect","setAttribute","onbeforeunload","prefs","refreshprompt","elem","getAttribute","inputs","Net","formData","cmd","_i4","_Object$entries2","Object","entries","_ref2","name","getRoom","sendDirect","pointerType","clickedRoom","innerText","userid","toID","rightPopup","username","tagName","ctrlKey","metaKey","shiftKey","href","shortLinks","closeAllPopups","send","handleButtonClick","parentElement","closePopupsAbove","update","scrollToRoom","isTextInput","isNonEmptyTextInput","type","contentEditable","textContent","modifierKey","altKey","keyCode","arrowKeysUsed","focusUpRoom","focusDownRoom","focusRoom","hideRightRoom","focusLeftRoom","focusRightRoom","dragging","colorSchemeQuery","matchMedia","media","cs","theme","body","matches","subscribeAndRun","key","dark","setTextboxFocused","focused","narrowMode","isChrome","textboxFocused","documentElement","classList","remove","add","focusPreview","verticalBuf","verticalFocusPreview","isMiniRoom","_PS$horizontalNav","horizontalNav","index","buf","leftRoom","rightRoom","_PS$verticalNav","verticalNav","upRoom","downRoom","altLabel","isMac","scrollToHeader","scrollX","isFirefox","scrollTo","setTimeout","_proto3","_PS$getRoom","_PS$rooms$roomid","table","closest","_log","_i6","_table$querySelectorA2","querySelectorAll","row","display","_i8","_table$querySelectorA4","log","updateScroll","dummyInput","createElement","position","appendChild","execCommand","removeChild","containingRoomid","curElem","isEmptyClick","selection","getSelection","_unused","BattleTooltips","hideTooltip","top","left","verticalHeaderWidth","minWidth","right","_room$parentElem","maxHeight","maxWidth","margin","source","getBoundingClientRect","visibility","isFixed","offsetLeft","offsetTop","scrollY","availableWidth","clientWidth","availableHeight","clientHeight","sourceWidth","sourceHeight","sourceTop","sourceLeft","bottom","Math","max","popupLeft","availableAlignedWidth","renderRoom","RoomType","roomTypes","Panel","isPlaceholder","renderPopup","_this7","isNormalRoom","PSHeader","PSMiniHeader","map","_PSView","isIOS","navigator","platform","userAgent","_navigator$platform","dragend","_window$getSelection","autoDismissNotifications","setFocus","PSIcon","Dex","getPokemonIcon","pokemon","getItemIcon","item","types","get","sanitizedType","src","resourcePrefix","alt","b","categoryID","category","sanitizedCategory","toUpperCase"],"sources":["../src/panels.tsx"],"sourcesContent":["/**\r\n * Panels\r\n *\r\n * Main view - sets up the frame, and the generic panels.\r\n *\r\n * Also sets up most global event listeners.\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nimport preact from \"../js/lib/preact\";\r\nimport type { Pokemon, ServerPokemon } from \"./battle\";\r\nimport { Dex, toID } from \"./battle-dex\";\r\nimport type { Args } from \"./battle-text-parser\";\r\nimport { BattleTooltips } from \"./battle-tooltips\";\r\nimport { Net } from \"./client-connection\";\r\nimport type { PSModel, PSStreamModel, PSSubscription } from \"./client-core\";\r\nimport { PS, type PSRoom, type RoomID } from \"./client-main\";\r\nimport type { ChatRoom } from \"./panel-chat\";\r\nimport { PSHeader, PSMiniHeader } from \"./panel-topbar\";\r\n\r\nexport const VERTICAL_HEADER_WIDTH = 240;\r\nexport const NARROW_MODE_HEADER_WIDTH = 280;\r\n\r\nexport class PSRouter {\r\n\troomid = '' as RoomID;\r\n\tpanelState = '';\r\n\tconstructor() {\r\n\t\tconst currentRoomid = location.pathname.slice(1);\r\n\t\tif (/^[a-z0-9-]*$/.test(currentRoomid)) {\r\n\t\t\tthis.subscribeHistory();\r\n\t\t} else if (location.pathname.endsWith('.html')) {\r\n\t\t\tthis.subscribeHash();\r\n\t\t}\r\n\t}\r\n\textractRoomID(url: string | null) {\r\n\t\tif (!url) return null;\r\n\t\tif (url.startsWith(document.location.origin)) {\r\n\t\t\turl = url.slice(document.location.origin.length);\r\n\t\t} else {\r\n\t\t\tif (url.startsWith('http://')) {\r\n\t\t\t\turl = url.slice(7);\r\n\t\t\t} else if (url.startsWith('https://')) {\r\n\t\t\t\turl = url.slice(8);\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('psim.us/t/')) {\r\n\t\t\t\turl = `viewteam-${url.slice(10)}`;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('teams.pokemonshowdown.com/view/') && /[0-9]/.test(url.charAt(31))) {\r\n\t\t\t\turl = `viewteam-${url.slice(31)}`;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('psim.us/r/')) {\r\n\t\t\t\turl = `battle-${url.slice(10)}`;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('replay.pokemonshowdown.com/') && /[a-z]/.test(url.charAt(27))) {\r\n\t\t\t\turl = `battle-${url.slice(27)}`;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith(document.location.host)) {\r\n\t\t\t\turl = url.slice(document.location.host.length);\r\n\t\t\t} else if (PS.server.id === 'showdown' && url.startsWith('play.pokemonshowdown.com')) {\r\n\t\t\t\turl = url.slice(24);\r\n\t\t\t} else if (PS.server.id === 'showdown' && url.startsWith('psim.us')) {\r\n\t\t\t\turl = url.slice(7);\r\n\t\t\t} else if (url.startsWith('replay.pokemonshowdown.com')) {\r\n\t\t\t\turl = url.slice(26).replace('/', '/battle-');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (url.startsWith('/')) url = url.slice(1);\r\n\t\tif (url === '.') url = '';\r\n\r\n\t\tif (!/^[a-z0-9-]*$/.test(url)) return null;\r\n\r\n\t\tconst redirects = /^(appeals?|rooms?suggestions?|suggestions?|adminrequests?|bugs?|bugreports?|rules?|faq|credits?|privacy|contact|dex|insecure)$/;\r\n\t\tif (redirects.test(url)) return null;\r\n\r\n\t\tif (url.startsWith('view-teams-view-')) {\r\n\t\t\tconst teamid = url.slice(16);\r\n\t\t\turl = `viewteam-${teamid}` as RoomID;\r\n\t\t}\r\n\t\treturn url as RoomID;\r\n\t}\r\n\t/** true: roomid changed, false: panelState changed, null: neither changed */\r\n\tupdatePanelState(): { roomid: RoomID, changed: boolean | null, newTitle: string } {\r\n\t\tlet room = PS.room;\r\n\t\t// some popups don't have URLs and don't generate history\r\n\t\t// there's definitely a better way to do this but I'm lazy\r\n\t\tif (room.noURL) room = PS.rooms[PS.popups[PS.popups.length - 2]] || PS.panel;\r\n\t\tif (room.noURL) room = PS.panel;\r\n\r\n\t\t// don't generate history when focusing things on things visible on the home screen\r\n\t\tif (room.id === 'news' && room.location === 'mini-window') room = PS.mainmenu;\r\n\t\tif (room.id === '' && PS.leftPanelWidth && PS.rightPanel) {\r\n\t\t\troom = PS.rightPanel;\r\n\t\t}\r\n\t\tif (room.id === 'rooms') room = PS.leftPanel;\r\n\r\n\t\tlet roomid = room.id;\r\n\t\tconst panelState = (PS.leftPanelWidth && room === PS.panel ?\r\n\t\t\tPS.leftPanel.id + '..' + PS.rightPanel!.id :\r\n\t\t\troom.id);\r\n\t\tconst newTitle = roomid === '' ? 'Showdown!' : `${room.title} - Showdown!`;\r\n\t\tlet changed: boolean | null = (roomid !== this.roomid);\r\n\r\n\t\tthis.roomid = roomid;\r\n\t\tif (this.panelState === panelState) changed = null;\r\n\t\tthis.panelState = panelState;\r\n\t\treturn { roomid, changed, newTitle };\r\n\t}\r\n\tsubscribeHash() {\r\n\t\tif (location.hash) {\r\n\t\t\tconst currentRoomid = location.hash.slice(1);\r\n\t\t\tif (/^[a-z0-9-]+$/.test(currentRoomid)) {\r\n\t\t\t\tPS.join(currentRoomid as RoomID);\r\n\t\t\t}\r\n\t\t}\r\n\t\t{\r\n\t\t\tconst { newTitle } = this.updatePanelState();\r\n\t\t\tdocument.title = newTitle;\r\n\t\t}\r\n\t\tPS.subscribe(() => {\r\n\t\t\tconst { roomid, changed, newTitle } = this.updatePanelState();\r\n\t\t\tif (changed) location.hash = roomid ? `#${roomid}` : '';\r\n\t\t\t// n.b. must be done after changing hash, so history entry has the old title\r\n\t\t\tdocument.title = newTitle;\r\n\t\t});\r\n\t\twindow.addEventListener('hashchange', e => {\r\n\t\t\t// really dumb hack, but it's not like back/forward has ever been very reliable\r\n\t\t\tif (PS.popups.length && PS.rooms[PS.popups[PS.popups.length - 1]]?.noURL) return;\r\n\t\t\tconst possibleRoomid = location.hash.slice(1);\r\n\t\t\tlet currentRoomid: RoomID | null = null;\r\n\t\t\tif (/^[a-z0-9-]*$/.test(possibleRoomid)) {\r\n\t\t\t\tcurrentRoomid = possibleRoomid as RoomID;\r\n\t\t\t}\r\n\t\t\tif (currentRoomid !== null) {\r\n\t\t\t\tif (currentRoomid === PS.room.id) return;\r\n\t\t\t\tthis.roomid = currentRoomid;\r\n\t\t\t\tPS.join(currentRoomid);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tsubscribeHistory() {\r\n\t\tconst currentRoomid = location.pathname.slice(1);\r\n\t\tif (/^[a-z0-9-]+$/.test(currentRoomid)) {\r\n\t\t\tif (currentRoomid !== 'preactalpha' && currentRoomid !== 'preactbeta' && currentRoomid !== 'beta') {\r\n\t\t\t\tPS.join(currentRoomid as RoomID);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!window.history) return;\r\n\t\t{\r\n\t\t\tconst { roomid, newTitle } = this.updatePanelState();\r\n\t\t\thistory.replaceState(this.panelState, '', `/${roomid}`);\r\n\t\t\tdocument.title = newTitle;\r\n\t\t}\r\n\t\tPS.subscribe(() => {\r\n\t\t\tconst { roomid, changed, newTitle } = this.updatePanelState();\r\n\t\t\tif (changed) {\r\n\t\t\t\thistory.pushState(this.panelState, '', `/${roomid}`);\r\n\t\t\t} else if (changed !== null) {\r\n\t\t\t\thistory.replaceState(this.panelState, '', `/${roomid}`);\r\n\t\t\t}\r\n\t\t\t// n.b. must be done after changing hash, so history entry has the old title\r\n\t\t\tdocument.title = newTitle;\r\n\t\t});\r\n\t\twindow.addEventListener('popstate', e => {\r\n\t\t\tconst possibleRoomid = location.pathname.slice(1);\r\n\t\t\tlet roomid: RoomID | null = null;\r\n\t\t\tif (/^[a-z0-9-]*$/.test(possibleRoomid)) {\r\n\t\t\t\troomid = possibleRoomid as RoomID;\r\n\t\t\t}\r\n\t\t\tif (typeof e.state === 'string') {\r\n\t\t\t\tconst [leftRoomid, rightRoomid] = e.state.split('..') as RoomID[];\r\n\t\t\t\tif (rightRoomid) {\r\n\t\t\t\t\tPS.addRoom({ id: leftRoomid, location: 'left' }, true);\r\n\t\t\t\t\tPS.addRoom({ id: rightRoomid, location: 'right' }, true);\r\n\t\t\t\t\tPS.leftPanel = PS.rooms[leftRoomid] || PS.leftPanel;\r\n\t\t\t\t\tPS.rightPanel = PS.rooms[rightRoomid] || PS.rightPanel;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (roomid !== null) {\r\n\t\t\t\tthis.roomid = roomid;\r\n\t\t\t\tPS.join(roomid);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\nPS.router = new PSRouter();\r\n\r\nexport class PSRoomPanel<T extends PSRoom = PSRoom> extends preact.Component<{ room: T }> {\r\n\tsubscriptions: PSSubscription[] = [];\r\n\tsubscribeTo<M>(\r\n\t\tmodel: PSModel<M> | PSStreamModel<M>, callback: (value: M) => void = () => { this.forceUpdate(); }\r\n\t): PSSubscription {\r\n\t\tconst subscription = model.subscribe(callback);\r\n\t\tthis.subscriptions.push(subscription);\r\n\t\treturn subscription;\r\n\t}\r\n\toverride componentDidMount() {\r\n\t\tthis.props.room.onParentEvent = (id: string, e?: Event) => {\r\n\t\t\tif (id === 'focus') this.focus();\r\n\t\t};\r\n\t\tthis.subscriptions.push(this.props.room.subscribe(args => {\r\n\t\t\tif (!args) this.forceUpdate();\r\n\t\t\telse this.receiveLine(args);\r\n\t\t}));\r\n\t\tthis.componentDidUpdate();\r\n\t}\r\n\tjustUpdatedDimensions = false;\r\n\tupdateDimensions() {\r\n\t\tconst justUpdated = this.justUpdatedDimensions;\r\n\t\tthis.justUpdatedDimensions = false;\r\n\r\n\t\tconst room = this.props.room;\r\n\t\tconst newWidth = this.base!.offsetWidth;\r\n\t\tconst newHeight = this.base!.offsetHeight;\r\n\t\tif (room.width === newWidth && room.height === newHeight) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\troom.width = newWidth;\r\n\t\troom.height = newHeight;\r\n\r\n\t\tif (justUpdated) return; // should never happen; safeguard against infinite loops\r\n\t\tthis.justUpdatedDimensions = true;\r\n\t\tthis.forceUpdate();\r\n\t}\r\n\toverride componentDidUpdate() {\r\n\t\tconst room = this.props.room;\r\n\t\tconst currentlyHidden = !room.width && room.parentElem && ['popup', 'semimodal-popup'].includes(room.location);\r\n\t\tthis.updateDimensions();\r\n\t\tif (currentlyHidden) return;\r\n\t\tif (room.focusNextUpdate) {\r\n\t\t\troom.focusNextUpdate = false;\r\n\t\t\tthis.focus();\r\n\t\t}\r\n\t}\r\n\toverride componentWillUnmount() {\r\n\t\tthis.props.room.onParentEvent = null;\r\n\t\tfor (const subscription of this.subscriptions) {\r\n\t\t\tsubscription.unsubscribe();\r\n\t\t}\r\n\t\tthis.subscriptions = [];\r\n\t}\r\n\tclose() {\r\n\t\tPS.leave(this.props.room.id);\r\n\t}\r\n\tcomponentDidCatch(err: Error) {\r\n\t\tthis.props.room.caughtError = err.stack || err.message;\r\n\t\tthis.setState({});\r\n\t}\r\n\treceiveLine(args: Args) {}\r\n\t/**\r\n\t * PS has \"fake select menus\", buttons that act like <select> dropdowns.\r\n\t * This function is used by the popups they open to change the button\r\n\t * values.\r\n\t */\r\n\tchooseParentValue(value: string) {\r\n\t\tconst dropdownButton = this.props.room.parentElem as HTMLButtonElement;\r\n\t\tdropdownButton.value = value;\r\n\t\tconst changeEvent = new Event('change');\r\n\t\tdropdownButton.dispatchEvent(changeEvent);\r\n\t\tPS.closePopup();\r\n\t}\r\n\tfocus() {\r\n\t\tif (PSView.hasTapped) return;\r\n\r\n\t\tconst autofocus = this.base?.querySelector<HTMLElement>('.autofocus');\r\n\t\tautofocus?.focus();\r\n\t\t(autofocus as HTMLInputElement)?.select?.();\r\n\t}\r\n\toverride render() {\r\n\t\treturn <PSPanelWrapper room={this.props.room}>\r\n\t\t\t<div class=\"mainmessage\"><p>Loading...</p></div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nexport function PSPanelWrapper(props: {\r\n\troom: PSRoom, children: preact.ComponentChildren,\r\n\tfocusClick?: boolean, scrollable?: boolean | 'hidden', width?: number | 'auto',\r\n\tfullSize?: boolean, onDragEnter?: (ev: DragEvent) => void,\r\n}) {\r\n\tconst room = props.room;\r\n\tif (room.location === 'mini-window') {\r\n\t\tconst size = props.fullSize ? ' mini-window-flex' : '';\r\n\t\treturn <div\r\n\t\t\tid={`room-${room.id}`}\r\n\t\t\tclass={`mini-window-contents tiny-layout ps-room-light${props.scrollable === true ? ' scrollable' : ''}${size}`}\r\n\t\t\tonClick={props.focusClick ? PSView.focusIfNoSelection : undefined} onDragEnter={props.onDragEnter}\r\n\t\t>\r\n\t\t\t{props.children}\r\n\t\t</div>;\r\n\t}\r\n\tif (PS.isPopup(room)) {\r\n\t\tconst style = PSView.getPopupStyle(room, props.width, props.fullSize);\r\n\t\treturn <div class=\"ps-popup\" id={`room-${room.id}`} style={style} onDragEnter={props.onDragEnter}>\r\n\t\t\t{props.children}\r\n\t\t</div>;\r\n\t}\r\n\tconst style = PSView.posStyle(room) as any;\r\n\tif (props.scrollable === 'hidden') style.overflow = 'hidden';\r\n\tconst tinyLayout = room.width < 620 ? ' tiny-layout' : '';\r\n\treturn <div\r\n\t\tclass={`ps-room${room.id === '' ? '' : ' ps-room-light'}${props.scrollable === true ? ' scrollable' : ''}${tinyLayout}`}\r\n\t\tid={`room-${room.id}`} role=\"tabpanel\" aria-labelledby={`roomtab-${room.id}`}\r\n\t\tstyle={style} onClick={props.focusClick ? PSView.focusIfNoSelection : undefined} onDragEnter={props.onDragEnter}\r\n\t>\r\n\t\t{room.caughtError ? <div class=\"broadcast broadcast-red\"><pre>{room.caughtError}</pre></div> : props.children}\r\n\t</div>;\r\n}\r\n\r\nexport class PSView extends preact.Component {\r\n\tstatic readonly isIOS = [\r\n\t\t'iPad Simulator', 'iPhone Simulator', 'iPod Simulator', 'iPad', 'iPhone', 'iPod',\r\n\t].includes(navigator.platform);\r\n\tstatic readonly isChrome = navigator.userAgent.includes(' Chrome/');\r\n\tstatic readonly isSafari = !this.isChrome && navigator.userAgent.includes(' Safari/');\r\n\tstatic readonly isFirefox = navigator.userAgent.includes(' Firefox/');\r\n\tstatic readonly isMac = navigator.platform?.startsWith('Mac');\r\n\tstatic textboxFocused = false;\r\n\tstatic dragend: ((ev: DragEvent) => void) | null = null;\r\n\t/** was the last click event a tap? heristic for mobile/desktop */\r\n\tstatic hasTapped = false;\r\n\t/** mode where the tabbar is opened rather than always being there */\r\n\tstatic narrowMode = false;\r\n\tstatic verticalHeaderWidth = VERTICAL_HEADER_WIDTH;\r\n\tstatic setTextboxFocused(focused: boolean) {\r\n\t\tif (!PSView.narrowMode) return;\r\n\t\tif (!PSView.isChrome && !PSView.isSafari) return;\r\n\t\t// Chrome bug: on Android, it insistently scrolls everything leftmost when scroll snap is enabled\r\n\r\n\t\tthis.textboxFocused = focused;\r\n\t\tif (focused) {\r\n\t\t\tdocument.documentElement.classList.remove('scroll-snap-enabled');\r\n\t\t\tPSView.scrollToRoom();\r\n\t\t} else {\r\n\t\t\tdocument.documentElement.classList.add('scroll-snap-enabled');\r\n\t\t}\r\n\t}\r\n\tstatic focusPreview(room: PSRoom) {\r\n\t\tif (room !== PS.room) return '';\r\n\r\n\t\tconst verticalBuf = this.verticalFocusPreview();\r\n\t\tif (verticalBuf) return verticalBuf;\r\n\r\n\t\tconst isMiniRoom = PS.room.location === 'mini-window';\r\n\t\tconst { rooms, index } = PS.horizontalNav();\r\n\t\tif (index === -1) return '';\r\n\r\n\t\tlet buf = ' ';\r\n\t\tconst leftRoom = PS.rooms[rooms[index - 1]];\r\n\t\tif (leftRoom) buf += `\\u2190 ${leftRoom.title}`;\r\n\t\tbuf += (PS.arrowKeysUsed || isMiniRoom ? \" | \" : \" (use arrow keys) \");\r\n\t\tconst rightRoom = PS.rooms[rooms[index + 1]];\r\n\t\tif (rightRoom) buf += `${rightRoom.title} \\u2192`;\r\n\t\treturn buf;\r\n\t}\r\n\tstatic verticalFocusPreview() {\r\n\t\tconst { rooms, index } = PS.verticalNav();\r\n\t\tif (index === -1) return '';\r\n\r\n\t\tconst upRoom = PS.rooms[rooms[index - 1]];\r\n\t\tlet downRoom = PS.rooms[rooms[index + 1]];\r\n\t\tif (index === rooms.length - 2 && rooms[index + 1] === 'news') downRoom = undefined;\r\n\t\tif (!upRoom && !downRoom) return '';\r\n\r\n\t\tlet buf = ' ';\r\n\t\t// const altLabel = PSMain.isMac ? '⌥' : 'ᴀʟᴛ';\r\n\t\tconst altLabel = PSView.isMac ? 'ᴏᴘᴛ' : 'ᴀʟᴛ';\r\n\t\tif (upRoom) buf += `${altLabel}\\u2191 ${upRoom.title}`;\r\n\t\tbuf += \" | \";\r\n\t\tif (downRoom) buf += `${altLabel}\\u2193 ${downRoom.title}`;\r\n\r\n\t\treturn buf;\r\n\t}\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tPS.subscribe(() => this.forceUpdate());\r\n\r\n\t\tif (PSView.isSafari) {\r\n\t\t\t// I don't want to prevent users from being able to zoom, but iOS Safari\r\n\t\t\t// auto-zooms when focusing textboxes (unless the font size is 16px),\r\n\t\t\t// and this apparently fixes it while still allowing zooming.\r\n\t\t\tdocument.querySelector('meta[name=viewport]')?.setAttribute('content', 'width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0');\r\n\t\t}\r\n\r\n\t\twindow.onbeforeunload = (ev: Event) => {\r\n\t\t\treturn PS.prefs.refreshprompt ? \"Are you sure you want to leave?\" : null;\r\n\t\t};\r\n\r\n\t\twindow.addEventListener('submit', ev => {\r\n\t\t\tconst elem = ev.target as HTMLFormElement | null;\r\n\t\t\tif (elem?.getAttribute('data-submitsend')) {\r\n\t\t\t\tconst inputs = Net.formData(elem);\r\n\t\t\t\tlet cmd = elem.getAttribute('data-submitsend')!;\r\n\t\t\t\tfor (const [name, value] of Object.entries(inputs)) {\r\n\t\t\t\t\tcmd = cmd.replace(`{${name}}`, value === true ? 'on' : value === false ? 'off' : value);\r\n\t\t\t\t}\r\n\t\t\t\tcmd = cmd.replace(/\\{[a-z0-9-]+\\}/g, '');\r\n\t\t\t\tconst room = PS.getRoom(elem) || PS.mainmenu;\r\n\t\t\t\troom.sendDirect(cmd);\r\n\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('pointerdown', ev => {\r\n\t\t\t// can't be part of the click event because Safari pretends the pointer is a mouse\r\n\t\t\tPSView.hasTapped = ev.pointerType === 'touch' || ev.pointerType === 'pen';\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('click', ev => {\r\n\t\t\tlet elem = ev.target as HTMLElement | null;\r\n\t\t\tconst clickedRoom = PS.getRoom(elem);\r\n\t\t\twhile (elem) {\r\n\t\t\t\tif (elem.className === 'spoiler') {\r\n\t\t\t\t\telem.className = 'spoiler-shown';\r\n\t\t\t\t} else if (elem.className === 'spoiler-shown') {\r\n\t\t\t\t\telem.className = 'spoiler';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (` ${elem.className} `.includes(' username ')) {\r\n\t\t\t\t\tconst name = elem.getAttribute('data-name') || elem.innerText;\r\n\t\t\t\t\tconst userid = toID(name);\r\n\t\t\t\t\tconst roomid = `${` ${elem.className} `.includes(' no-interact ') ? 'viewuser' : 'user'}-${userid}` as RoomID;\r\n\t\t\t\t\tPS.join(roomid, {\r\n\t\t\t\t\t\tparentElem: elem,\r\n\t\t\t\t\t\trightPopup: elem.className === 'userbutton username',\r\n\t\t\t\t\t\targs: { username: name },\r\n\t\t\t\t\t});\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (elem.tagName === 'A' || elem.getAttribute('data-href')) {\r\n\t\t\t\t\tif (ev.ctrlKey || ev.metaKey || ev.shiftKey) break;\r\n\r\n\t\t\t\t\tconst href = elem.getAttribute('data-href') || elem.getAttribute('href');\r\n\t\t\t\t\tlet roomid = PS.router.extractRoomID(href);\r\n\r\n\t\t\t\t\t// keep this in sync with .htaccess\r\n\t\t\t\t\tconst shortLinks = /^(rooms?suggestions?|suggestions?|adminrequests?|forgotpassword|bugs?(reports?)?|formatsuggestions|rules?|faq|credits?|privacy|contact|dex|(damage)?calc|insecure|replays?|devdiscord|smogdex|smogcord|forums?|trustworthy-dlc-link)$/;\r\n\t\t\t\t\tif (roomid === 'appeal' || roomid === 'appeals') roomid = 'view-help-request--appeal' as RoomID;\r\n\t\t\t\t\tif (roomid === 'report') roomid = 'view-help-request--report' as RoomID;\r\n\t\t\t\t\tif (roomid === 'requesthelp') roomid = 'view-help-request--other' as RoomID;\r\n\r\n\t\t\t\t\tif (roomid !== null && elem.className !== 'no-panel-intercept' && !shortLinks.test(roomid)) {\r\n\t\t\t\t\t\tlet location = null;\r\n\t\t\t\t\t\tif (elem.getAttribute('data-target') === 'replace') {\r\n\t\t\t\t\t\t\tconst room = PS.getRoom(elem);\r\n\t\t\t\t\t\t\tif (room) {\r\n\t\t\t\t\t\t\t\tPS.leave(room.id);\r\n\t\t\t\t\t\t\t\tlocation = room.location;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tPS.join(roomid, {\r\n\t\t\t\t\t\t\tparentElem: elem,\r\n\t\t\t\t\t\t\tlocation,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (!PS.isPopup(PS.rooms[roomid])) {\r\n\t\t\t\t\t\t\tPS.closeAllPopups();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.getAttribute('data-cmd')) {\r\n\t\t\t\t\tconst cmd = elem.getAttribute('data-cmd')!;\r\n\t\t\t\t\tconst room = PS.getRoom(elem) || PS.mainmenu;\r\n\t\t\t\t\troom.send(cmd, elem);\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.getAttribute('data-sendraw')) {\r\n\t\t\t\t\tconst cmd = elem.getAttribute('data-sendraw')!;\r\n\t\t\t\t\tconst room = PS.getRoom(elem) || PS.mainmenu;\r\n\t\t\t\t\troom.sendDirect(cmd);\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.tagName === 'BUTTON') {\r\n\t\t\t\t\tif (this.handleButtonClick(elem as HTMLButtonElement)) {\r\n\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t} else if (!elem.getAttribute('type')) {\r\n\t\t\t\t\t\t// the spec says that buttons with no `type` attribute should be\r\n\t\t\t\t\t\t// submit buttons, but this is a bad default so we're going\r\n\t\t\t\t\t\t// to just assume they're not\r\n\t\t\t\t\t\telem.setAttribute('type', 'button');\r\n\r\n\t\t\t\t\t\t// don't return, to allow <a><button> to make links that look\r\n\t\t\t\t\t\t// like buttons\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.id.startsWith('room-')) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telem = elem.parentElement;\r\n\t\t\t}\r\n\t\t\tif (PS.room !== clickedRoom) {\r\n\t\t\t\tif (clickedRoom) PS.room = clickedRoom;\r\n\t\t\t\tPS.closePopupsAbove(clickedRoom);\r\n\t\t\t\tPS.update();\r\n\t\t\t}\r\n\t\t\tif (clickedRoom && !PS.isPopup(clickedRoom)) {\r\n\t\t\t\tPSView.scrollToRoom();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('keydown', ev => {\r\n\t\t\tlet elem = ev.target as HTMLInputElement | null;\r\n\t\t\tlet isTextInput = false;\r\n\t\t\tlet isNonEmptyTextInput = false;\r\n\t\t\tif (elem) {\r\n\t\t\t\tisTextInput = (elem.tagName === 'INPUT' || elem.tagName === 'TEXTAREA');\r\n\t\t\t\tif (isTextInput && ['button', 'radio', 'checkbox', 'file'].includes(elem.type)) {\r\n\t\t\t\t\tisTextInput = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (isTextInput && elem.value) {\r\n\t\t\t\t\tisNonEmptyTextInput = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.contentEditable === 'true') {\r\n\t\t\t\t\tisTextInput = true;\r\n\t\t\t\t\tif (elem.textContent && elem.textContent !== '\\n') {\r\n\t\t\t\t\t\tisNonEmptyTextInput = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!isNonEmptyTextInput) {\r\n\t\t\t\tif (PS.room.onParentEvent?.('keydown', ev) === false) {\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst modifierKey = ev.ctrlKey || ev.altKey || ev.metaKey || ev.shiftKey;\r\n\t\t\tconst altKey = !ev.ctrlKey && ev.altKey && !ev.metaKey && !ev.shiftKey;\r\n\t\t\tif (altKey && ev.keyCode === 38) { // alt + up\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusUpRoom();\r\n\t\t\t} else if (altKey && ev.keyCode === 40) { // alt + down\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusDownRoom();\r\n\t\t\t} else if (ev.keyCode === 27) { // escape\r\n\t\t\t\t// close popups\r\n\t\t\t\tif (PS.popups.length) {\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tPS.closePopup();\r\n\t\t\t\t\tPS.focusRoom(PS.room.id);\r\n\t\t\t\t} else if (PS.room.id === 'rooms') {\r\n\t\t\t\t\tPS.hideRightRoom();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (isNonEmptyTextInput) return;\r\n\t\t\tif (altKey && ev.keyCode === 37) { // alt + left\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusLeftRoom();\r\n\t\t\t} else if (altKey && ev.keyCode === 39) { // alt + right\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusRightRoom();\r\n\t\t\t}\r\n\t\t\tif (modifierKey) return;\r\n\t\t\tif (ev.keyCode === 37) { // left\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusLeftRoom();\r\n\t\t\t} else if (ev.keyCode === 39) { // right\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusRightRoom();\r\n\t\t\t} else if (ev.keyCode === 191 && !isTextInput && PS.room === PS.mainmenu) { // forward slash\r\n\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tPS.join('dm---' as RoomID);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('dragend', ev => {\r\n\t\t\tPS.dragging = null;\r\n\t\t\tev.preventDefault();\r\n\t\t});\r\n\r\n\t\tconst colorSchemeQuery = window.matchMedia?.('(prefers-color-scheme: dark)');\r\n\t\tif (colorSchemeQuery?.media !== 'not all') {\r\n\t\t\tcolorSchemeQuery.addEventListener('change', cs => {\r\n\t\t\t\tif (PS.prefs.theme === 'system') document.body.className = cs.matches ? 'dark' : '';\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tPS.prefs.subscribeAndRun(key => {\r\n\t\t\tif (!key || key === 'theme') {\r\n\t\t\t\tconst dark = PS.prefs.theme === 'dark' ||\r\n\t\t\t\t\t(PS.prefs.theme === 'system' && colorSchemeQuery?.matches);\r\n\t\t\t\tdocument.body.className = dark ? 'dark' : '';\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tstatic scrollToHeader() {\r\n\t\tif (PSView.narrowMode && window.scrollX > 0) {\r\n\t\t\tif (PSView.isSafari || PSView.isFirefox) {\r\n\t\t\t\t// Safari bug: `scrollBy` doesn't actually work when scroll snap is enabled\r\n\t\t\t\t// note: interferes with the `PSView.textboxFocused` workaround for a Chrome bug\r\n\t\t\t\tdocument.documentElement.classList.remove('scroll-snap-enabled');\r\n\t\t\t\twindow.scrollTo(0, 0);\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (!PSView.textboxFocused) document.documentElement.classList.add('scroll-snap-enabled');\r\n\t\t\t\t}, 1);\r\n\t\t\t} else {\r\n\t\t\t\twindow.scrollTo(0, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tstatic scrollToRoom() {\r\n\t\tif (PSView.narrowMode && window.scrollX === 0) {\r\n\t\t\tif (PSView.isSafari || PSView.isFirefox) {\r\n\t\t\t\t// Safari bug: `scrollBy` doesn't actually work when scroll snap is enabled\r\n\t\t\t\t// note: interferes with the `PSView.textboxFocused` workaround for a Chrome bug\r\n\t\t\t\tdocument.documentElement.classList.remove('scroll-snap-enabled');\r\n\t\t\t\twindow.scrollTo(NARROW_MODE_HEADER_WIDTH, 0);\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (!PSView.textboxFocused) document.documentElement.classList.add('scroll-snap-enabled');\r\n\t\t\t\t}, 1);\r\n\t\t\t} else {\r\n\t\t\t\twindow.scrollTo(NARROW_MODE_HEADER_WIDTH, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tstatic focusIfNoSelection = (ev: MouseEvent) => {\r\n\t\tconst room = PS.getRoom(ev.target as HTMLElement, true);\r\n\t\tif (!room) return;\r\n\r\n\t\tif (window.getSelection?.()?.type === 'Range') return;\r\n\t\troom.autoDismissNotifications();\r\n\t\tPS.setFocus(room);\r\n\t};\r\n\thandleClickOverlay = (ev: MouseEvent) => {\r\n\t\t// iOS Safari bug, no global click events when tapping\r\n\t\t// I'm sure it's intentional but it interferes with putting the dismiss feature in window.onclick\r\n\t\tif ((ev.target as Element)?.className === 'ps-overlay') {\r\n\t\t\tPS.closePopup();\r\n\t\t\tev.preventDefault();\r\n\t\t\tev.stopImmediatePropagation();\r\n\t\t}\r\n\t};\r\n\thandleButtonClick(elem: HTMLButtonElement) {\r\n\t\tswitch (elem.name) {\r\n\t\tcase 'closeRoom': {\r\n\t\t\tconst roomid = elem.value as RoomID || PS.getRoom(elem)?.id || '' as RoomID;\r\n\t\t\tPS.rooms[roomid]?.send('/close', elem);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tcase 'joinRoom':\r\n\t\t\tPS.join(elem.value as RoomID, {\r\n\t\t\t\tparentElem: elem,\r\n\t\t\t});\r\n\t\t\treturn true;\r\n\t\tcase 'register':\r\n\t\t\tPS.join('register' as RoomID, {\r\n\t\t\t\tparentElem: elem,\r\n\t\t\t});\r\n\t\t\treturn true;\r\n\t\tcase 'showOtherFormats': {\r\n\t\t\t// TODO: refactor to a command after we drop support for the old client\r\n\t\t\tconst table = elem.closest('table');\r\n\t\t\tconst room = PS.getRoom(elem);\r\n\t\t\tif (table) {\r\n\t\t\t\tfor (const row of table.querySelectorAll<HTMLElement>('tr.hidden')) {\r\n\t\t\t\t\trow.style.display = 'table-row';\r\n\t\t\t\t}\r\n\t\t\t\tfor (const row of table.querySelectorAll<HTMLElement>('tr.no-matches')) {\r\n\t\t\t\t\trow.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t\telem.closest('tr')!.style.display = 'none';\r\n\t\t\t\t(room as ChatRoom).log?.updateScroll();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tcase 'copyText':\r\n\t\t\tconst dummyInput = document.createElement(\"input\");\r\n\t\t\t// This is a hack. You can only \"select\" an input field.\r\n\t\t\t//  The trick is to create a short lived input element and destroy it after a copy.\r\n\t\t\t// (stolen from the replay code, obviously --mia)\r\n\t\t\tdummyInput.id = \"dummyInput\";\r\n\t\t\tdummyInput.value = elem.value || (elem as any).href || \"\";\r\n\t\t\tdummyInput.style.position = 'absolute';\r\n\t\t\telem.appendChild(dummyInput);\r\n\t\t\tdummyInput.select();\r\n\t\t\tdocument.execCommand(\"copy\");\r\n\t\t\telem.removeChild(dummyInput);\r\n\t\t\telem.innerText = 'Copied!';\r\n\t\t\treturn true;\r\n\t\tcase 'send':\r\n\t\tcase 'cmd':\r\n\t\t\tconst room = PS.getRoom(elem) || PS.mainmenu;\r\n\t\t\tif (elem.name === 'send') {\r\n\t\t\t\troom.sendDirect(elem.value);\r\n\t\t\t} else {\r\n\t\t\t\troom.send(elem.value);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tcomponentDidCatch(err: Error) {\r\n\t\tPS.mainmenu.caughtError = err.stack || err.message;\r\n\t\tthis.setState({});\r\n\t}\r\n\tstatic containingRoomid(elem: HTMLElement) {\r\n\t\tlet curElem: HTMLElement | null = elem;\r\n\t\twhile (curElem) {\r\n\t\t\tif (curElem.id.startsWith('room-')) {\r\n\t\t\t\treturn curElem.id.slice(5) as RoomID;\r\n\t\t\t}\r\n\t\t\tcurElem = curElem.parentElement;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\tstatic isEmptyClick(e: MouseEvent) {\r\n\t\ttry {\r\n\t\t\tconst selection = window.getSelection()!;\r\n\t\t\tif (selection.type === 'Range') return false;\r\n\t\t} catch {}\r\n\t\tBattleTooltips.hideTooltip();\r\n\t}\r\n\tstatic posStyle(room: PSRoom) {\r\n\t\tif (PS.leftPanelWidth === null) {\r\n\t\t\t// vertical mode\r\n\t\t\tif (room === PS.panel) {\r\n\t\t\t\t// const minWidth = Math.min(500, Math.max(320, document.body.offsetWidth - 9));\r\n\t\t\t\treturn { top: '30px', left: `${PSView.verticalHeaderWidth}px`, minWidth: `none` };\r\n\t\t\t}\r\n\t\t} else if (PS.leftPanelWidth === 0) {\r\n\t\t\t// one panel visible\r\n\t\t\tif (room === PS.panel) return {};\r\n\t\t} else {\r\n\t\t\t// both panels visible\r\n\t\t\tif (room === PS.leftPanel) return { width: `${PS.leftPanelWidth}px`, right: 'auto' };\r\n\t\t\tif (room === PS.rightPanel) return { top: 56, left: PS.leftPanelWidth + 1 };\r\n\t\t}\r\n\r\n\t\treturn { display: 'none' };\r\n\t}\r\n\tstatic getPopupStyle(room: PSRoom, width?: number | 'auto', fullSize?: boolean): any {\r\n\t\tif (fullSize) {\r\n\t\t\treturn { width: '90%', maxHeight: '90%', maxWidth: 'none', position: 'relative', margin: '5vh auto 0' };\r\n\t\t}\r\n\r\n\t\tconst source = room.parentElem?.getBoundingClientRect();\r\n\t\tif (source && !source.width && !source.height && !source.top && !source.left) {\r\n\t\t\t// parent elem has been unmounted\r\n\t\t\troom.parentElem = null;\r\n\t\t\tPS.update();\r\n\t\t}\r\n\r\n\t\tif (room.location === 'modal-popup' || !room.parentElem || !source) {\r\n\t\t\treturn { maxWidth: width || 480 };\r\n\t\t}\r\n\t\tif (!room.width || !room.height) {\r\n\t\t\troom.focusNextUpdate = true;\r\n\t\t\treturn {\r\n\t\t\t\tposition: 'absolute',\r\n\t\t\t\tvisibility: 'hidden',\r\n\t\t\t\tmargin: 0,\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tleft: 0,\r\n\t\t\t};\r\n\t\t}\r\n\t\t// nonmodal popup: should be positioned near source element\r\n\t\tlet style: any = {\r\n\t\t\tposition: 'absolute',\r\n\t\t\tmargin: 0,\r\n\t\t};\r\n\t\t// semimodal popups exist in a fixed-positioned overlay and are\r\n\t\t// positioned relative to the overlay (the viewport).\r\n\t\t// regular popups are positioned relative to the document root, and so\r\n\t\t// need to account for scrolling.\r\n\t\tconst isFixed = room.location !== 'popup';\r\n\t\tconst offsetLeft = isFixed ? 0 : window.scrollX;\r\n\t\tconst offsetTop = isFixed ? 0 : window.scrollY;\r\n\t\tconst availableWidth = document.documentElement.clientWidth + offsetLeft;\r\n\t\tconst availableHeight = document.documentElement.clientHeight;\r\n\r\n\t\tconst sourceWidth = source.width;\r\n\t\tconst sourceHeight = source.height;\r\n\t\tconst sourceTop = source.top + offsetTop;\r\n\t\tconst sourceLeft = source.left + offsetLeft;\r\n\r\n\t\tconst height = room.height;\r\n\t\twidth = width || room.width;\r\n\r\n\t\tif (room.rightPopup) {\r\n\r\n\t\t\tif (availableHeight > sourceTop + height + 5 &&\r\n\t\t\t\t(sourceTop < availableHeight * 2 / 3 || sourceTop + 200 < availableHeight)) {\r\n\t\t\t\tstyle.top = sourceTop;\r\n\t\t\t} else if (sourceTop + sourceHeight >= height) {\r\n\t\t\t\tstyle.bottom = Math.max(availableHeight - sourceTop - sourceHeight, 0);\r\n\t\t\t} else {\r\n\t\t\t\tstyle.top = Math.max(0, availableHeight - height);\r\n\t\t\t}\r\n\t\t\tconst popupLeft = sourceLeft + sourceWidth;\r\n\t\t\tif (width !== 'auto' && popupLeft + width > availableWidth) {\r\n\t\t\t\t// can't fit, give up and put it in the normal place\r\n\t\t\t\tstyle = {\r\n\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\tmargin: 0,\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tstyle.left = popupLeft;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (style.left === undefined) {\r\n\r\n\t\t\tif (availableHeight > sourceTop + sourceHeight + height + 5 &&\r\n\t\t\t\t(sourceTop + sourceHeight < availableHeight * 2 / 3 || sourceTop + sourceHeight + 200 < availableHeight)) {\r\n\t\t\t\tstyle.top = sourceTop + sourceHeight;\r\n\t\t\t} else if (height + 30 <= sourceTop) {\r\n\t\t\t\tstyle.bottom = Math.max(availableHeight - sourceTop, 0);\r\n\t\t\t} else if (height + 35 < availableHeight) {\r\n\t\t\t\tstyle.bottom = 5;\r\n\t\t\t} else {\r\n\t\t\t\tstyle.top = 25;\r\n\t\t\t}\r\n\r\n\t\t\tconst availableAlignedWidth = availableWidth - sourceLeft;\r\n\t\t\tif (width !== 'auto' && availableAlignedWidth < width + 10) {\r\n\t\t\t\t// while `right: 10` would be simpler, it doesn't work if there is horizontal scrolling,\r\n\t\t\t\t// like in the mobile layout\r\n\t\t\t\tstyle.left = Math.max(availableWidth - width - 10, offsetLeft);\r\n\t\t\t} else {\r\n\t\t\t\tstyle.left = sourceLeft;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (width) style.maxWidth = width;\r\n\r\n\t\treturn style;\r\n\t}\r\n\trenderRoom(room: PSRoom) {\r\n\t\tconst RoomType = PS.roomTypes[room.type];\r\n\t\tconst Panel = RoomType && !room.isPlaceholder && !room.caughtError ? RoomType : PSRoomPanel;\r\n\t\treturn <Panel key={room.id} room={room} />;\r\n\t}\r\n\trenderPopup(room: PSRoom) {\r\n\t\tconst RoomType = PS.roomTypes[room.type];\r\n\t\tconst Panel = RoomType && !room.isPlaceholder && !room.caughtError ? RoomType : PSRoomPanel;\r\n\t\tif (room.location === 'popup' && room.parentElem) {\r\n\t\t\treturn <Panel key={room.id} room={room} />;\r\n\t\t}\r\n\t\treturn <div key={room.id} class=\"ps-overlay\" onClick={this.handleClickOverlay} role=\"dialog\">\r\n\t\t\t<Panel room={room} />\r\n\t\t</div>;\r\n\t}\r\n\trender() {\r\n\t\tlet rooms = [] as preact.VNode[];\r\n\t\tfor (const roomid in PS.rooms) {\r\n\t\t\tconst room = PS.rooms[roomid]!;\r\n\t\t\tif (PS.isNormalRoom(room)) {\r\n\t\t\t\trooms.push(this.renderRoom(room));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div class=\"ps-frame\" role=\"none\">\r\n\t\t\t<PSHeader />\r\n\t\t\t<PSMiniHeader />\r\n\t\t\t{rooms}\r\n\t\t\t{PS.popups.map(roomid => this.renderPopup(PS.rooms[roomid]!))}\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nexport function PSIcon(\r\n\tprops: { pokemon: string | Pokemon | ServerPokemon | Dex.PokemonSet | null } |\r\n\t\t{ item: string } | { type: string, b?: boolean } | { category: string }\r\n) {\r\n\tif ('pokemon' in props) {\r\n\t\treturn <span class=\"picon\" style={Dex.getPokemonIcon(props.pokemon)} />;\r\n\t}\r\n\tif ('item' in props) {\r\n\t\treturn <span class=\"itemicon\" style={Dex.getItemIcon(props.item)} />;\r\n\t}\r\n\tif ('type' in props) {\r\n\t\tlet type = Dex.types.get(props.type).name;\r\n\t\tif (!type) type = '???';\r\n\t\tlet sanitizedType = type.replace(/\\?/g, '%3f');\r\n\t\treturn <img\r\n\t\t\tsrc={`${Dex.resourcePrefix}sprites/types/${sanitizedType}.png`} alt={type}\r\n\t\t\theight=\"14\" width=\"32\" class={`pixelated${props.b ? ' b' : ''}`}\r\n\t\t/>;\r\n\t}\r\n\tif ('category' in props) {\r\n\t\tconst categoryID = toID(props.category);\r\n\t\tlet sanitizedCategory = '';\r\n\t\tswitch (categoryID) {\r\n\t\tcase 'physical':\r\n\t\tcase 'special':\r\n\t\tcase 'status':\r\n\t\t\tsanitizedCategory = categoryID.charAt(0).toUpperCase() + categoryID.slice(1);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tsanitizedCategory = 'undefined';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\treturn <img\r\n\t\t\tsrc={`${Dex.resourcePrefix}sprites/categories/${sanitizedCategory}.png`} alt={sanitizedCategory}\r\n\t\t\theight=\"14\" width=\"32\" class=\"pixelated\"\r\n\t\t/>;\r\n\t}\r\n\treturn null!;\r\n}\r\n"],"mappings":"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","ignoreList":[]}