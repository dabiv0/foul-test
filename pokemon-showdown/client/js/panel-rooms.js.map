{"version":3,"file":"panel-rooms.js","names":["RoomsRoom","_PSRoom","options","_this","call","classType","PS","send","_inheritsLoose","PSRoom","RoomsPanel","_PSRoomPanel","_this2","_len","arguments","length","args","Array","_key","apply","concat","hidden","search","section","lastKeyCode","roomList","roomListFocusIndex","roomListLength","hide","ev","stopImmediatePropagation","hideRightRoom","changeSearch","target","currentTarget","selectionStart","selectionEnd","updateRoomList","value","forceUpdate","changeSection","handleOnBlur","keyDownSearch","keyCode","shiftKey","ctrlKey","altKey","metaKey","Math","max","preventDefault","min","getRoomListFocusTitle","arrowIndex","indexOf","slice","test","toID","join","_proto","prototype","componentDidMount","subscriptions","push","user","subscribe","update","named","componentDidUpdate","_this$base","el","base","querySelector","scrollIntoView","behavior","block","forceNoAutocomplete","undefined","getRoomList","_i2","_this$roomList2","_ref","rooms","sort","a","b","userCount","searchid","roomsCache","mainmenu","officialRooms","chatRooms","hiddenRooms","_i4","_ref3","chat","room","privacy","exactMatch","_i6","_roomList2","subRooms","_i8","_room$subRooms2","title","desc","results","filter","titleid","startsWith","replace","includes","toLowerCase","autoFill","firstTitle","firstTitleOffset","autoFillValue","oldSearch","searchElem","setSelectionRange","render","_rooms$sectionTitles","isVisible","props","preact","h","PSPanelWrapper","scrollable","style","onClick","href","battleCount","name","onChange","sectionTitles","map","type","placeholder","autocomplete","onInput","onKeyDown","onBlur","renderRoomList","_this$roomList$map$re","_ref4","reduce","_this3","isOffline","nextOffset","_ref5","sortedRooms","offset","index","roomInfo","i","key","roomName","PSRoomPanel","id","routes","Model","location","icon","addRoomType"],"sources":["../src/panel-rooms.tsx"],"sourcesContent":["/**\r\n * Room-list panel (default right-panel)\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nimport { PS, PSRoom, type RoomID, type RoomOptions } from \"./client-main\";\r\nimport { PSPanelWrapper, PSRoomPanel } from \"./panels\";\r\nimport type { RoomInfo } from \"./panel-mainmenu\";\r\nimport { toID } from \"./battle-dex\";\r\n\r\nexport class RoomsRoom extends PSRoom {\r\n\toverride readonly classType: string = 'rooms';\r\n\tconstructor(options: RoomOptions) {\r\n\t\tsuper(options);\r\n\t\tPS.send(`/cmd rooms`);\r\n\t}\r\n}\r\n\r\ntype RoomsSection = [string, RoomInfo[]];\r\nclass RoomsPanel extends PSRoomPanel {\r\n\tstatic readonly id = 'rooms';\r\n\tstatic readonly routes = ['rooms'];\r\n\tstatic readonly Model = RoomsRoom;\r\n\tstatic readonly location = 'right';\r\n\tstatic readonly icon = <i class=\"fa fa-plus rooms-plus\" aria-hidden></i>;\r\n\tstatic readonly title = \"Chat Rooms\";\r\n\thidden = false;\r\n\tsearch = '';\r\n\tsection = '';\r\n\tlastKeyCode = 0;\r\n\troomList: RoomsSection[] = [];\r\n\troomListFocusIndex = -1;\r\n\troomListLength = 0;\r\n\toverride componentDidMount() {\r\n\t\tsuper.componentDidMount();\r\n\t\tthis.subscriptions.push(PS.user.subscribe(update => {\r\n\t\t\tif (!update && PS.user.named) PS.send(`/cmd rooms`);\r\n\t\t}));\r\n\t}\r\n\toverride componentDidUpdate() {\r\n\t\tconst el = this.base?.querySelector('a.blocklink.cur');\r\n\t\tif (!this.roomListFocusIndex) return;\r\n\t\tel?.scrollIntoView({ behavior: 'auto', block: 'center' });\r\n\t}\r\n\thide = (ev: Event) => {\r\n\t\tev.stopImmediatePropagation();\r\n\t\tPS.hideRightRoom();\r\n\t};\r\n\tchangeSearch = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tif (target.selectionStart !== target.selectionEnd) return;\r\n\t\tthis.updateRoomList(target.value);\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\tchangeSection = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLSelectElement;\r\n\t\tthis.section = target.value;\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\thandleOnBlur = (ev: Event) => {\r\n\t\tthis.roomListFocusIndex = -1;\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\tkeyDownSearch = (ev: KeyboardEvent) => {\r\n\t\tthis.lastKeyCode = ev.keyCode;\r\n\t\tif (ev.shiftKey || ev.ctrlKey || ev.altKey || ev.metaKey) return;\r\n\t\tif (ev.keyCode === 38) { // up\r\n\t\t\tthis.roomListFocusIndex = Math.max(this.roomListFocusIndex - 1, this.search ? 0 : -1);\r\n\t\t\tthis.forceUpdate();\r\n\t\t\tev.preventDefault();\r\n\t\t} else if (ev.keyCode === 40) { // down\r\n\t\t\tthis.roomListFocusIndex = Math.min(this.roomListFocusIndex + 1, this.roomListLength - 1);\r\n\t\t\tthis.forceUpdate();\r\n\t\t\tev.preventDefault();\r\n\t\t} else if (ev.keyCode === 13) { // enter\r\n\t\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\t\tlet value = this.getRoomListFocusTitle() || target.value;\r\n\t\t\tconst arrowIndex = value.indexOf(' \\u21d2 ');\r\n\t\t\tif (arrowIndex >= 0) value = value.slice(arrowIndex + 3);\r\n\t\t\tif (!/^[a-z0-9-]$/.test(value)) value = toID(value);\r\n\t\t\tev.preventDefault();\r\n\t\t\tev.stopImmediatePropagation();\r\n\t\t\ttarget.value = '';\r\n\t\t\tthis.updateRoomList('');\r\n\r\n\t\t\tPS.join(value as RoomID);\r\n\t\t}\r\n\t};\r\n\tupdateRoomList(search?: string) {\r\n\t\tif (search) search = toID(search);\r\n\t\tconst forceNoAutocomplete = this.search === `${search || ''}-`;\r\n\t\tif (search || this.search) {\r\n\t\t\tif (search === undefined || search === this.search) return;\r\n\t\t\tthis.search = search;\r\n\t\t\tthis.roomListFocusIndex = this.search ? 0 : -1;\r\n\t\t}\r\n\t\tthis.roomList = this.getRoomList(forceNoAutocomplete);\r\n\t\tfor (const [, rooms] of this.roomList) {\r\n\t\t\trooms.sort((a, b) => (b.userCount || 0) - (a.userCount || 0));\r\n\t\t}\r\n\t}\r\n\tgetRoomList(forceNoAutocomplete?: boolean): RoomsSection[] {\r\n\t\tconst searchid = toID(this.search);\r\n\r\n\t\tif (!searchid) {\r\n\t\t\tconst roomsCache = PS.mainmenu.roomsCache;\r\n\t\t\tconst officialRooms = [], chatRooms = [], hiddenRooms = [];\r\n\t\t\tfor (const room of roomsCache.chat || []) {\r\n\t\t\t\tif (room.section !== this.section && this.section !== '') continue;\r\n\t\t\t\tif (room.privacy === 'hidden') {\r\n\t\t\t\t\thiddenRooms.push(room);\r\n\t\t\t\t} else if (room.section === 'Official') {\r\n\t\t\t\t\tofficialRooms.push(room);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tchatRooms.push(room);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn [\r\n\t\t\t\t[\"Official chat rooms\", officialRooms],\r\n\t\t\t\t[\"Chat rooms\", chatRooms],\r\n\t\t\t\t[\"Hidden rooms\", hiddenRooms],\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\tlet exactMatch = false;\r\n\r\n\t\tconst rooms = PS.mainmenu.roomsCache;\r\n\t\tlet roomList = [...(rooms.chat || [])];\r\n\t\tfor (const room of roomList) {\r\n\t\t\tif (!room.subRooms) continue;\r\n\t\t\tfor (const title of room.subRooms) {\r\n\t\t\t\troomList.push({\r\n\t\t\t\t\ttitle,\r\n\t\t\t\t\tdesc: `(Subroom of ${room.title})`,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet results = roomList.filter(room => {\r\n\t\t\tconst titleid = toID(room.title);\r\n\t\t\tif (titleid === searchid) exactMatch = true;\r\n\t\t\treturn titleid.startsWith(searchid) ||\r\n\t\t\t\ttoID(room.title.replace(/^The /, '')).startsWith(searchid);\r\n\t\t});\r\n\t\troomList = roomList.filter(room => !results.includes(room));\r\n\r\n\t\tresults = results.concat(roomList.filter(room =>\r\n\t\t\ttoID(room.title.toLowerCase().replace(/\\b([a-z0-9])[a-z0-9]*\\b/g, '$1')).startsWith(searchid) ||\r\n\t\t\troom.title.replace(/[^A-Z0-9]+/g, '').toLowerCase().startsWith(searchid)\r\n\t\t));\r\n\r\n\t\tconst hidden: RoomsSection[] = !exactMatch ?\r\n\t\t\t[[\"Possible secret room\", [{ title: this.search, desc: \"(Private room?)\" }]]] : [];\r\n\r\n\t\tconst autoFill = this.lastKeyCode !== 127 && this.lastKeyCode >= 32;\r\n\t\tif (autoFill && !forceNoAutocomplete) {\r\n\t\t\tresults.sort((a, b) => (b.userCount || 0) - (a.userCount || 0));\r\n\t\t\tconst firstTitle = (results[0] || hidden[0][1][0]).title;\r\n\t\t\tlet firstTitleOffset = 0;\r\n\t\t\twhile (\r\n\t\t\t\tsearchid !== toID(firstTitle.slice(0, firstTitleOffset)) &&\r\n\t\t\t\tfirstTitleOffset < firstTitle.length // should never happen, but sanity against infinite loop\r\n\t\t\t) {\r\n\t\t\t\tfirstTitleOffset++;\r\n\t\t\t}\r\n\t\t\tlet autoFillValue = firstTitle.slice(firstTitleOffset);\r\n\t\t\tif (!autoFillValue && toID(firstTitle) !== searchid) {\r\n\t\t\t\tautoFillValue = ' \\u21d2 ' + firstTitle;\r\n\t\t\t}\r\n\t\t\tconst oldSearch = this.search;\r\n\t\t\tconst searchElem = this.base!.querySelector<HTMLInputElement>('input[type=search]')!;\r\n\t\t\tif (autoFillValue) {\r\n\t\t\t\tsearchElem.value = oldSearch + autoFillValue;\r\n\t\t\t\tsearchElem.setSelectionRange(oldSearch.length, oldSearch.length + autoFillValue.length);\r\n\t\t\t\tthis.search += '-';\r\n\t\t\t}\r\n\r\n\t\t\treturn [[\"Search results\", results], ...hidden];\r\n\t\t}\r\n\r\n\t\treturn [...hidden, [\"Search results\", results]];\r\n\t}\r\n\toverride render() {\r\n\t\tif (this.hidden && PS.isVisible(this.props.room)) this.hidden = false;\r\n\t\tif (this.hidden) {\r\n\t\t\treturn <PSPanelWrapper room={this.props.room} scrollable>{null}</PSPanelWrapper>;\r\n\t\t}\r\n\t\tconst rooms = PS.mainmenu.roomsCache;\r\n\t\tthis.updateRoomList();\r\n\r\n\t\treturn <PSPanelWrapper room={this.props.room} scrollable><div class=\"pad\">\r\n\t\t\t<button class=\"button\" style=\"float:right;font-size:10pt;margin-top:3px\" onClick={this.hide}>\r\n\t\t\t\t<i class=\"fa fa-caret-right\" aria-hidden></i> Hide\r\n\t\t\t</button>\r\n\t\t\t<div class=\"roomcounters\">\r\n\t\t\t\t<a class=\"button\" href=\"users\" title=\"Find an online user\">\r\n\t\t\t\t\t<span\r\n\t\t\t\t\t\tclass=\"pixelated usercount\"\r\n\t\t\t\t\t\ttitle=\"Meloetta is PS's mascot! The Aria forme is about using its voice, and represents our chatrooms.\"\r\n\t\t\t\t\t></span>\r\n\t\t\t\t\t<strong>{rooms.userCount || '-'}</strong> users online\r\n\t\t\t\t</a> {}\r\n\t\t\t\t<a class=\"button\" href=\"battles\" title=\"Watch an active battle\">\r\n\t\t\t\t\t<span\r\n\t\t\t\t\t\tclass=\"pixelated battlecount\"\r\n\t\t\t\t\t\ttitle=\"Meloetta is PS's mascot! The Pirouette forme is Fighting-type, and represents our battles.\"\r\n\t\t\t\t\t></span>\r\n\t\t\t\t\t<strong>{rooms.battleCount || '-'}</strong> active battles\r\n\t\t\t\t</a>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<select name=\"sections\" class=\"button\" onChange={this.changeSection}>\r\n\t\t\t\t\t<option value=\"\">(All rooms)</option>\r\n\t\t\t\t\t{rooms.sectionTitles?.map(title => {\r\n\t\t\t\t\t\treturn <option value={title}> {title} </option>;\r\n\t\t\t\t\t})}\r\n\t\t\t\t</select>\r\n\t\t\t\t<br /><br />\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"search\" name=\"roomsearch\" class=\"textbox autofocus\" style=\"width: 100%; max-width: 480px\"\r\n\t\t\t\t\tplaceholder=\"Join or search for rooms\" autocomplete=\"off\"\r\n\t\t\t\t\tonInput={this.changeSearch} onKeyDown={this.keyDownSearch} onBlur={this.handleOnBlur}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t{this.renderRoomList()}\r\n\t\t</div></PSPanelWrapper>;\r\n\t}\r\n\tgetRoomListFocusTitle(): string | undefined {\r\n\t\treturn this.roomList.map(([, rooms]) => rooms).reduce((a, b) => a.concat(b))[this.roomListFocusIndex]?.title;\r\n\t}\r\n\trenderRoomList() {\r\n\t\tconst roomsCache = PS.mainmenu.roomsCache;\r\n\t\tif (roomsCache.userCount === undefined) {\r\n\t\t\treturn <div class=\"roomlist\"><h2>Official chat rooms</h2><p><em>Connecting...</em></p></div>;\r\n\t\t}\r\n\t\tif (this.search) {\r\n\t\t\t// do nothing\r\n\t\t} else if (PS.isOffline) {\r\n\t\t\treturn <div class=\"roomlist\"><h2>Offline</h2></div>;\r\n\t\t} else if (roomsCache.userCount === undefined) {\r\n\t\t\treturn <div class=\"roomlist\"><h2>Official chat rooms</h2><p><em>Connecting...</em></p></div>;\r\n\t\t}\r\n\r\n\t\t// Descending order\r\n\t\tlet nextOffset = 0;\r\n\t\treturn this.roomList.map(([title, rooms]) => {\r\n\t\t\tif (!rooms.length) return null;\r\n\r\n\t\t\tconst sortedRooms = rooms.sort((a, b) => (b.userCount || 0) - (a.userCount || 0));\r\n\t\t\tconst offset = nextOffset;\r\n\t\t\tnextOffset += sortedRooms.length;\r\n\t\t\tthis.roomListLength = nextOffset;\r\n\r\n\t\t\tconst index = this.roomListFocusIndex >= offset && this.roomListFocusIndex < nextOffset ?\r\n\t\t\t\tthis.roomListFocusIndex - offset : -1;\r\n\r\n\t\t\treturn <div class=\"roomlist\">\r\n\t\t\t\t<h2>{title}</h2>\r\n\t\t\t\t{sortedRooms.map((roomInfo, i) => <div key={roomInfo.title}>\r\n\t\t\t\t\t<a href={`/${toID(roomInfo.title)}`} class={`blocklink${i === index ? \" cur\" : ''}`}>\r\n\t\t\t\t\t\t{roomInfo.userCount !== undefined && <small style=\"float:right\">({roomInfo.userCount} users)</small>}\r\n\t\t\t\t\t\t<strong><i class=\"fa fa-comment-o\" aria-hidden></i> {roomInfo.title}<br /></strong>\r\n\t\t\t\t\t\t<small>{roomInfo.desc || ''}</small>\r\n\t\t\t\t\t</a>\r\n\t\t\t\t\t{roomInfo.subRooms && <div class=\"subrooms\">\r\n\t\t\t\t\t\t<i class=\"fa fa-level-up fa-rotate-90\" aria-hidden></i> Subrooms: {}\r\n\t\t\t\t\t\t{roomInfo.subRooms.map(roomName => [<a href={`/${toID(roomName)}`} class=\"blocklink\">\r\n\t\t\t\t\t\t\t<i class=\"fa fa-comment-o\" aria-hidden></i> <strong>{roomName}</strong>\r\n\t\t\t\t\t\t</a>, ' '])}\r\n\t\t\t\t\t</div>}\r\n\t\t\t\t</div>)}\r\n\t\t\t</div>;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nPS.addRoomType(RoomsPanel);\r\n"],"mappings":"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","ignoreList":[]}