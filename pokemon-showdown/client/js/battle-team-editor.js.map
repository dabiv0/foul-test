{"version":3,"file":"battle-team-editor.js","names":["TeamEditorState","_PSModel","team","_this","call","sets","gen","Dex","dex","deletedSet","search","DexSearch","format","searchIndex","originalSpecies","narrow","selectionTypeOrder","innerFocus","isLetsGo","isNatDex","isBDSP","formeLegality","abilityLegality","defaultLevel","readonly","fetching","ignoreRows","Teams","unpack","packedTeam","setFormat","window","_inheritsLoose","_proto","prototype","setReadonly","formatid","toID","forFormat","slice","includes","setSearchType","type","i","value","_this$search","_this$search$results","set","setType","prependResults","getSearchMoves","some","row","split","species","get","exists","items","abilities","push","find","results","updateSearchMoves","_this$search$prependR","oldResultsLength","length","query","setSearchValue","out","Math","max","moves","_this$search$results2","selectSearchValue","_this$search$results3","_result","result","_this$search$results4","addFilter","getResultValue","changeSpecies","speciesName","_this$getDefaultItem","item","getDefaultItem","undefined","name","ability","getDefaultAbility","level","gender","evs","hp","atk","def","spa","spd","spe","ivs","nature","deleteSet","index","splice","undeleteSet","downSearchValue","_this$search$results$","_this$search$results$2","upSearchValue","_this$search$results$3","_this$search$results$4","_this$search$results$5","startsWith","_result$1$slice$split","slot","moveid","canAdd","isBox","getHPType","hpType","hpMove","getHPMove","hpTypes","atkDV","floor","defDV","defaultIVs","hpTypeX","statOrder","_i2","s","hpTypeMatters","_i4","_set$moves2","move","_i6","_set$moves4","charAt","toUpperCase","getIVs","Object","assign","noGuess","arguments","useIVs","_i8","_Dex$statNames2","statNames","stat","hpModulo","_this$prefersMinStats","prefersMinStats","minAtk","minSpe","hpDVs","types","HPdvs","hpIVs","HPivs","canHyperTrain","_hpIVs$spe","_hpIVs$atk","defaultHappiness","_set$evs","_set$evs2","_i10","_set$moves6","moveName","id","hasMoveBesidesTransform","category","damage","ohko","getNickname","baseSpecies","getHPIVs","getStat","ivOverride","evOverride","natureOverride","_ref","_set$evs3","_BattleNatures","_BattleNatures2","supportsEVs","supportsAVs","baseStat","baseStats","iv","ev","trunc","val","BattleNatures","plus","minus","friendshipValue","export","compat","import","PSTeambuilder","importTeam","save","getTypeWeakness","attackType","_this$dex$types$get$d","weaknessType","damageTaken","IMMUNE","RESIST","WEAK","getWeakness","abilityid","_i12","factor","_i14","pokemonDefensiveCoverage","coverage","_i16","_this$dex$types$names2","names","teamDefensiveCoverage","counters","_i18","_this$dex$types$names4","resists","neutrals","weaknesses","_i20","_this$sets2","_i22","_Object$entries2","entries","_ref2","battleOnly","requiredItems","values","filter","endsWith","isMega","isPrimal","pack","iconCache","PSModel","TeamEditor","_preact$Component","_this2","_len","args","Array","_key","apply","concat","wizard","editor","setTab","target","currentTarget","forceUpdate","update","renderTypeIcon","b","sanitizedType","replace","preact","h","src","resourcePrefix","alt","height","width","style","probablyMobile","document","body","offsetWidth","_proto2","renderDefensiveCoverage","PSUtils","sortBy","counter","good","medium","bad","renderTypeDefensive","_i24","colSpan","render","_this$props$narrow","props","readOnly","onClick","TeamWizard","onChange","onUpdate","TeamTextbox","Fragment","children","resources","Component","_preact$Component2","_this3","_len2","_key2","setInfo","textbox","heightTester","setDirty","windowing","selection","input","updateText","keyUp","contextMenu","shiftKey","_this3$innerFocus","_this3$innerFocus2","hadInnerFocus","range","openInnerFocus","preventDefault","stopImmediatePropagation","keyDown","keyCode","atStart","selectionStart","selectionEnd","removeFilter","getInnerFocusValue","resetScroll","closeMenu","resultsUp","base","querySelector","scrollTop","innerHeight","resultsDown","altKey","metaKey","maybeReplaceLine","addPokemon","_result$split","moveSlot","selectResult","replaceNoFocus","PS","alert","_exec","current","lineStart","lastIndexOf","pokepaste","exec","Net","then","json","paste","JSON","parse","pasteTxt","valueIndex","indexOf","notes","title","clearInnerFocus","focus","noTextChange","autoSelect","lineEnd","line","rangeEndChar","_this3$innerFocus$ran","start","end","updateSearch","setIndex","nextSetIndex","nlIndex","trim","bottomY","getYAt","atIndex","parenIndex","selectionEndCutoff","lcLine","toLowerCase","lineRange","typeIndex","engageFocus","changeSet","changeCompat","checkbox","checked","clickDetails","_this3$innerFocus3","parseInt","offsetY","setSelectionRange","scrollResults","documentElement","clientWidth","scrollWidth","scrollIntoViewIfNeeded","handleSetChange","replaceSet","copyAll","select","execCommand","button","innerHTML","className","_proto3","fullLine","newValue","scrollHeight","_this$selection","oldRange","getSelectionTypeRange","_this$selection2","_this$selection3","_selection$lineRange","_this$editor$sets","_focus$setIndex","getSetRange","_this$innerFocus","newText","exportSet","_this$getSetRange","text","_this$props$onChange","_this$props","componentDidMount","_this4","getElementsByClassName","exportedTeam","setTimeout","componentWillUnmount","searchResults","windowResults","ceil","renderDetails","GenderChart","shiny","teraType","requiredTeraType","renderStats","StatForm","renderStatGraph","_this$setInfo$bottomY","_this$setInfo","_this5","_this$innerFocus2","_this$setInfo$this$in","_this$setInfo$this$in2","statsDetailsOffset","onInput","onContextMenu","onKeyUp","onKeyDown","placeholder","tabIndex","map","info","prevOffset","num","getPokemonIconNum","top","left","iconStyle","itemStyle","getItemIcon","getTeambuilderSprite","onScroll","DetailsForm","PSSearchResults","resultIndex","onSelect","EMPTY_PROMISE","Promise","resolve","_preact$Component3","_this6","_len3","_key3","setSearchBox","setFocus","_split","rawType","changeFocus","_editor$deletedSet","reverse","clearSearchBox","_editor$sets","pop","every","Boolean","searchBox","handleClickFilters","tagName","getAttribute","stopPropagation","parentElement","keyDownSearch","_editor$innerFocus","_editor$innerFocus2","_editor$innerFocus3","_value$split","_proto4","renderSet","sprite","rowSpan","overfull","cur","t","_editor$innerFocus4","fxPrefix","mi","componentDidUpdate","filters","_filters$getBoundingC","getBoundingClientRect","paddingLeft","renderInnerFocus","_this7","_editor$innerFocus5","curSet","getPokemonIcon","autocomplete","renderFilters","hideFilters","_this8","_editor$deletedSet2","_preact$Component4","_this9","_len4","_key4","handleGuess","_this9$props","guess","BattleStatGuesser","plusStat","minusStat","updateNatureFromPlusMinus","handleOptimize","_this9$props2","optimized","BattleStatOptimizer","changeEV","statID","abs","isNaN","maxEv","maxEVs","totalEv","_i27","_Object$values2","curEv","changeIV","dvToIv","changeNature","changeIVSpread","_target$value$split$m","Number","defaultEV","_set$evs$statID","_set$evs4","_BattleNatures3","_BattleNatures4","hue","statName","BattleStatNames","_proto5","renderIVMenu","_this$props2","hpIVdata","autoSpread","autoSpreadValue","join","selected","label","minStat","spread","smogdexLink","smogdexid","forme","generationNumber","number","generation","renderSpreadGuesser","_this$props3","href","role","guessedEVs","guessedPlus","guessedMinus","renderStatOptimizer","savedEVs","setInput","evInput","init","_querySelector","skipID","_i29","_Dex$statNames4","_set$evs5","_set$ivs","plusMinus","ivToDv","renderStatbar","dvOrIvString","dvOrIv","useEVs","Infinity","_this10","_this$props4","maxEV","stepEV","stats","remaining","_i31","_Object$values4","_ref3","_set$evs$statID2","_set$evs6","inputMode","min","step","_ref4","natureName","curNature","_preact$Component5","_this11","_len5","_key5","changeNickname","changeTera","_this11$props","changeLevel","changeGender","changeHappiness","happiness","changeShiny","changeDynamaxLevel","dynamaxLevel","changeGigantamax","gigantamax","changeHPType","_proto6","_querySelector2","nickname","renderGender","genderTable","_set$level","_set$happiness","_set$dynamaxLevel","_this$props5","cannotDynamax","canGigantamax","disabled","all","cosmeticFormes"],"sources":["../src/battle-team-editor.tsx"],"sourcesContent":["/**\r\n * Teambuilder team editor, extracted from the rest of the Preact\r\n * client so that it can be used in isolation.\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nimport preact from \"../js/lib/preact\";\r\nimport { type Team } from \"./client-main\";\r\nimport { PSTeambuilder } from \"./panel-teamdropdown\";\r\nimport { Dex, type ModdedDex, toID, type ID, PSUtils } from \"./battle-dex\";\r\nimport { Teams } from './battle-teams';\r\nimport { DexSearch, type SearchRow, type SearchType } from \"./battle-dex-search\";\r\nimport { PSSearchResults } from \"./battle-searchresults\";\r\nimport { BattleNatures, BattleStatNames, type StatName } from \"./battle-dex-data\";\r\nimport { BattleStatGuesser, BattleStatOptimizer } from \"./battle-tooltips\";\r\nimport { PSModel } from \"./client-core\";\r\nimport { Net } from \"./client-connection\";\r\n\r\ntype SelectionType = 'pokemon' | 'ability' | 'item' | 'move' | 'stats' | 'details';\r\n\r\nclass TeamEditorState extends PSModel {\r\n\tteam: Team;\r\n\tsets: Dex.PokemonSet[] = [];\r\n\tgen = Dex.gen;\r\n\tdex: ModdedDex = Dex;\r\n\tdeletedSet: {\r\n\t\tset: Dex.PokemonSet,\r\n\t\tindex: number,\r\n\t} | null = null;\r\n\tsearch = new DexSearch();\r\n\tformat: ID = `gen${this.gen}` as ID;\r\n\tsearchIndex = 0;\r\n\toriginalSpecies: string | null = null;\r\n\tnarrow = false;\r\n\tselectionTypeOrder: readonly SelectionType[] = [\r\n\t\t'pokemon', 'ability', 'item', 'move', 'stats', 'details',\r\n\t];\r\n\tinnerFocus: {\r\n\t\tsetIndex: number,\r\n\t\ttype: SelectionType,\r\n\t\ttypeIndex?: number,\r\n\t} | null = null;\r\n\tisLetsGo = false;\r\n\tisNatDex = false;\r\n\tisBDSP = false;\r\n\tformeLegality: 'normal' | 'hackmons' | 'custom' = 'normal';\r\n\tabilityLegality: 'normal' | 'hackmons' = 'normal';\r\n\tdefaultLevel = 100;\r\n\treadonly = false;\r\n\tfetching = false;\r\n\tconstructor(team: Team) {\r\n\t\tsuper();\r\n\t\tthis.team = team;\r\n\t\tthis.sets = Teams.unpack(team.packedTeam);\r\n\t\tthis.setFormat(team.format);\r\n\t\twindow.search = this.search;\r\n\t}\r\n\tsetReadonly(readonly: boolean) {\r\n\t\tif (!readonly && this.readonly) this.sets = Teams.unpack(this.team.packedTeam);\r\n\t\tthis.readonly = readonly;\r\n\t}\r\n\tsetFormat(format: string) {\r\n\t\tconst team = this.team;\r\n\t\tconst formatid = toID(format);\r\n\t\tthis.format = formatid;\r\n\t\tteam.format = formatid;\r\n\t\tthis.dex = Dex.forFormat(formatid);\r\n\t\tthis.gen = this.dex.gen;\r\n\r\n\t\tformat = toID(format).slice(4);\r\n\t\tthis.isLetsGo = formatid.includes('letsgo');\r\n\t\tthis.isNatDex = formatid.includes('nationaldex') || formatid.includes('natdex');\r\n\t\tthis.isBDSP = formatid.includes('bdsp');\r\n\t\tif (formatid.includes('almostanyability') || formatid.includes('aaa')) {\r\n\t\t\tthis.abilityLegality = 'hackmons';\r\n\t\t} else {\r\n\t\t\tthis.abilityLegality = 'normal';\r\n\t\t}\r\n\t\tif (formatid.includes('hackmons') || formatid.includes('bh')) {\r\n\t\t\tthis.formeLegality = 'hackmons';\r\n\t\t\tthis.abilityLegality = 'hackmons';\r\n\t\t} else if (formatid.includes('metronome') || formatid.includes('customgame')) {\r\n\t\t\tthis.formeLegality = 'custom';\r\n\t\t\tthis.abilityLegality = 'hackmons';\r\n\t\t} else {\r\n\t\t\tthis.formeLegality = 'normal';\r\n\t\t}\r\n\r\n\t\tthis.defaultLevel = 100;\r\n\t\tif (\r\n\t\t\tformatid.includes('vgc') || formatid.includes('bss') || formatid.includes('ultrasinnohclassic') ||\r\n\t\t\tformatid.includes('battlespot') || formatid.includes('battlestadium') || formatid.includes('battlefestival')\r\n\t\t) {\r\n\t\t\tthis.defaultLevel = 50;\r\n\t\t}\r\n\t\tif (formatid.includes('lc')) {\r\n\t\t\tthis.defaultLevel = 5;\r\n\t\t}\r\n\t}\r\n\tsetSearchType(type: SearchType, i: number, value?: string) {\r\n\t\tconst set = this.sets[i];\r\n\t\tthis.search.setType(type, this.format, set);\r\n\t\tthis.originalSpecies = null;\r\n\t\tthis.search.prependResults = null;\r\n\t\tif (type === 'move') {\r\n\t\t\tthis.search.prependResults = this.getSearchMoves(set);\r\n\t\t\tif (value && this.search.prependResults.some(row => row[1].split('_')[2] === toID(value))) {\r\n\t\t\t\tvalue = '';\r\n\t\t\t}\r\n\t\t} else if (value) {\r\n\t\t\tswitch (type) {\r\n\t\t\tcase 'pokemon':\r\n\t\t\t\tif (this.dex.species.get(value).exists) {\r\n\t\t\t\t\tthis.originalSpecies = value;\r\n\t\t\t\t\tthis.search.prependResults = [['pokemon', toID(value)]];\r\n\t\t\t\t\tvalue = '';\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'item':\r\n\t\t\t\tif (toID(value) === 'noitem') value = '';\r\n\t\t\t\tif (this.dex.items.get(value).exists) {\r\n\t\t\t\t\tthis.search.prependResults = [['item', toID(value)]];\r\n\t\t\t\t\tvalue = '';\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'ability':\r\n\t\t\t\tif (toID(value) === 'selectability') value = '';\r\n\t\t\t\tif (toID(value) === 'noability') value = '';\r\n\t\t\t\tif (this.dex.abilities.get(value).exists) {\r\n\t\t\t\t\tthis.search.prependResults = [['ability', toID(value)]];\r\n\t\t\t\t\tvalue = '';\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (type === 'item') (this.search.prependResults ||= []).push(['item', '' as ID]);\r\n\t\tthis.search.find(value || '');\r\n\t\tthis.searchIndex = this.search.results?.[0]?.[0] === 'header' ? 1 : 0;\r\n\t}\r\n\tupdateSearchMoves(set: Dex.PokemonSet) {\r\n\t\tlet oldResultsLength = this.search.prependResults?.length || 0;\r\n\t\tthis.search.prependResults = this.getSearchMoves(set);\r\n\t\tthis.searchIndex += this.search.prependResults.length - oldResultsLength;\r\n\t\tif (this.searchIndex < 0) this.searchIndex = 0;\r\n\t\tthis.search.results = null;\r\n\t\tif (this.search.query) {\r\n\t\t\tthis.setSearchValue('');\r\n\t\t} else {\r\n\t\t\tthis.search.find('');\r\n\t\t}\r\n\t}\r\n\tgetSearchMoves(set: Dex.PokemonSet) {\r\n\t\tconst out: SearchRow[] = [];\r\n\t\tfor (let i = 0; i < Math.max(set.moves.length, 4); i++) {\r\n\t\t\tout.push(['move', `_${i + 1}_${toID(set.moves[i] || '')}` as ID]);\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\tsetSearchValue(value: string) {\r\n\t\tthis.search.find(value);\r\n\t\tthis.searchIndex = this.search.results?.[0]?.[0] === 'header' ? 1 : 0;\r\n\t}\r\n\tselectSearchValue(): string | null {\r\n\t\tlet result = this.search.results?.[this.searchIndex];\r\n\t\tif (result?.[0] === 'header') {\r\n\t\t\tthis.searchIndex++;\r\n\t\t\tresult = this.search.results?.[this.searchIndex];\r\n\t\t}\r\n\t\tif (!result) return null;\r\n\t\tif (this.search.addFilter(result)) {\r\n\t\t\tthis.searchIndex = 0;\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.getResultValue(result);\r\n\t}\r\n\tchangeSpecies(set: Dex.PokemonSet, speciesName: string) {\r\n\t\tconst species = this.dex.species.get(speciesName);\r\n\t\tif (set.item === this.getDefaultItem(set.species)) set.item = undefined;\r\n\t\tif (set.name === set.species.split('-')[0]) delete set.name;\r\n\t\tset.species = species.name;\r\n\t\tset.ability = this.getDefaultAbility(set);\r\n\t\tset.item = this.getDefaultItem(species.name) ?? set.item;\r\n\r\n\t\tif (toID(speciesName) === 'Cathy') {\r\n\t\t\tset.name = \"Cathy\";\r\n\t\t\tset.species = 'Trevenant';\r\n\t\t\tset.level = undefined;\r\n\t\t\tset.gender = 'F';\r\n\t\t\tset.item = 'Starf Berry';\r\n\t\t\tset.ability = 'Harvest';\r\n\t\t\tset.moves = ['Substitute', 'Horn Leech', 'Earthquake', 'Phantom Force'];\r\n\t\t\tset.evs = { hp: 36, atk: 252, def: 0, spa: 0, spd: 0, spe: 220 };\r\n\t\t\tset.ivs = undefined;\r\n\t\t\tset.nature = 'Jolly';\r\n\t\t}\r\n\t}\r\n\tdeleteSet(index: number) {\r\n\t\tif (this.sets.length <= index) return;\r\n\t\tthis.deletedSet = {\r\n\t\t\tset: this.sets[index],\r\n\t\t\tindex,\r\n\t\t};\r\n\t\tthis.sets.splice(index, 1);\r\n\t}\r\n\tundeleteSet() {\r\n\t\tif (!this.deletedSet) return;\r\n\t\tthis.sets.splice(this.deletedSet.index, 0, this.deletedSet.set);\r\n\t\tthis.deletedSet = null;\r\n\t}\r\n\tignoreRows = ['header', 'sortpokemon', 'sortmove', 'html'];\r\n\tdownSearchValue() {\r\n\t\tif (!this.search.results || this.searchIndex >= this.search.results.length - 1) return;\r\n\r\n\t\tthis.searchIndex++;\r\n\t\tif (this.ignoreRows.includes(this.search.results[this.searchIndex]?.[0])) {\r\n\t\t\tif (this.searchIndex >= this.search.results.length - 1) return;\r\n\t\t\tthis.searchIndex++;\r\n\t\t}\r\n\t\tif (this.ignoreRows.includes(this.search.results[this.searchIndex]?.[0])) {\r\n\t\t\tif (this.searchIndex >= this.search.results.length - 1) return;\r\n\t\t\tthis.searchIndex++;\r\n\t\t}\r\n\t}\r\n\tupSearchValue() {\r\n\t\tif (!this.search.results || this.searchIndex <= 0) return;\r\n\r\n\t\tif (this.searchIndex <= 1 && this.ignoreRows.includes(this.search.results[0]?.[0])) return;\r\n\t\tthis.searchIndex--;\r\n\t\tif (this.ignoreRows.includes(this.search.results[this.searchIndex]?.[0])) {\r\n\t\t\tif (this.searchIndex <= 0) return;\r\n\t\t\tthis.searchIndex--;\r\n\t\t}\r\n\t\tif (this.ignoreRows.includes(this.search.results[this.searchIndex]?.[0])) {\r\n\t\t\tif (this.searchIndex <= 0) return;\r\n\t\t\tthis.searchIndex--;\r\n\t\t}\r\n\t}\r\n\tgetResultValue(result: SearchRow): string {\r\n\t\tswitch (result[0]) {\r\n\t\tcase 'pokemon':\r\n\t\t\treturn this.dex.species.get(result[1]).name;\r\n\t\tcase 'item':\r\n\t\t\treturn this.dex.items.get(result[1]).name;\r\n\t\tcase 'ability':\r\n\t\t\treturn this.dex.abilities.get(result[1]).name;\r\n\t\tcase 'move':\r\n\t\t\tif (result[1].startsWith('_')) {\r\n\t\t\t\tconst [slot, moveid] = result[1].slice(1).split('_');\r\n\t\t\t\treturn this.dex.moves.get(moveid).name + '|' + slot;\r\n\t\t\t}\r\n\t\t\treturn this.dex.moves.get(result[1]).name;\r\n\t\tdefault:\r\n\t\t\treturn result[1];\r\n\t\t}\r\n\t}\r\n\tcanAdd(): boolean {\r\n\t\treturn this.sets.length < 6 || this.team.isBox;\r\n\t}\r\n\tgetHPType(set: Dex.PokemonSet): Dex.TypeName {\r\n\t\tif (set.hpType) return set.hpType as Dex.TypeName;\r\n\t\tconst hpMove = set.ivs ? null : this.getHPMove(set);\r\n\t\tif (hpMove) return hpMove;\r\n\r\n\t\tconst hpTypes = [\r\n\t\t\t'Fighting', 'Flying', 'Poison', 'Ground', 'Rock', 'Bug', 'Ghost', 'Steel', 'Fire', 'Water', 'Grass', 'Electric', 'Psychic', 'Ice', 'Dragon', 'Dark',\r\n\t\t] as const;\r\n\t\tif (this.gen <= 2) {\r\n\t\t\tif (!set.ivs) return 'Dark';\r\n\t\t\t// const hpDV = Math.floor(set.ivs.hp / 2);\r\n\t\t\tconst atkDV = Math.floor(set.ivs.atk / 2);\r\n\t\t\tconst defDV = Math.floor(set.ivs.def / 2);\r\n\t\t\t// const speDV = Math.floor(set.ivs.spe / 2);\r\n\t\t\t// const spcDV = Math.floor(set.ivs.spa / 2);\r\n\t\t\t// const expectedHpDV = (atkDV % 2) * 8 + (defDV % 2) * 4 + (speDV % 2) * 2 + (spcDV % 2);\r\n\t\t\t// if (expectedHpDV !== hpDV) {\r\n\t\t\t// \tset.ivs.hp = expectedHpDV * 2;\r\n\t\t\t// \tif (set.ivs.hp === 30) set.ivs.hp = 31;\r\n\t\t\t// }\r\n\t\t\treturn hpTypes[4 * (atkDV % 4) + (defDV % 4)];\r\n\t\t} else {\r\n\t\t\tconst ivs = set.ivs || this.defaultIVs(set);\r\n\t\t\tlet hpTypeX = 0;\r\n\t\t\tlet i = 1;\r\n\t\t\t// n.b. this is not our usual order (Spe and SpD are flipped)\r\n\t\t\tconst statOrder = ['hp', 'atk', 'def', 'spe', 'spa', 'spd'] as const;\r\n\t\t\tfor (const s of statOrder) {\r\n\t\t\t\tif (ivs[s] === undefined) ivs[s] = 31;\r\n\t\t\t\thpTypeX += i * (ivs[s] % 2);\r\n\t\t\t\ti *= 2;\r\n\t\t\t}\r\n\t\t\treturn hpTypes[Math.floor(hpTypeX * 15 / 63)];\r\n\t\t}\r\n\t};\r\n\thpTypeMatters(set: Dex.PokemonSet): boolean {\r\n\t\tif (this.gen < 2) return false;\r\n\t\tif (this.gen > 7) return false;\r\n\t\tfor (const move of set.moves) {\r\n\t\t\tconst moveid = toID(move);\r\n\t\t\tif (moveid.startsWith('hiddenpower')) return true;\r\n\t\t\tif (moveid === 'transform') return true;\r\n\t\t}\r\n\t\tif (toID(set.ability) === 'imposter') return true;\r\n\t\treturn false;\r\n\t}\r\n\tgetHPMove(set: Dex.PokemonSet): Dex.TypeName | null {\r\n\t\tif (set.moves) {\r\n\t\t\tfor (const move of set.moves) {\r\n\t\t\t\tconst moveid = toID(move);\r\n\t\t\t\tif (moveid.startsWith('hiddenpower')) {\r\n\t\t\t\t\treturn moveid.charAt(11).toUpperCase() + moveid.slice(12) as Dex.TypeName;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\tgetIVs(set: Dex.PokemonSet) {\r\n\t\tconst ivs = this.defaultIVs(set);\r\n\t\tif (set.ivs) Object.assign(ivs, set.ivs);\r\n\t\treturn ivs;\r\n\t}\r\n\tdefaultIVs(set: Dex.PokemonSet, noGuess = !!set.ivs): Record<Dex.StatName, number> {\r\n\t\tconst useIVs = this.gen > 2;\r\n\t\tconst defaultIVs = { hp: 31, atk: 31, def: 31, spa: 31, spd: 31, spe: 31 };\r\n\t\tif (!useIVs) {\r\n\t\t\tfor (const stat of Dex.statNames) defaultIVs[stat] = 15;\r\n\t\t}\r\n\t\tif (noGuess) return defaultIVs;\r\n\r\n\t\tconst hpType = this.getHPMove(set);\r\n\t\tconst hpModulo = (useIVs ? 2 : 4);\r\n\t\tconst { minAtk, minSpe } = this.prefersMinStats(set);\r\n\t\tif (minAtk) defaultIVs['atk'] = 0;\r\n\t\tif (minSpe) defaultIVs['spe'] = 0;\r\n\r\n\t\tif (!useIVs) {\r\n\t\t\tconst hpDVs = hpType ? this.dex.types.get(hpType).HPdvs : null;\r\n\t\t\tif (hpDVs) {\r\n\t\t\t\tfor (const stat in hpDVs) defaultIVs[stat as Dex.StatName] = hpDVs[stat as Dex.StatName]!;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst hpIVs = hpType ? this.dex.types.get(hpType).HPivs : null;\r\n\t\t\tif (hpIVs) {\r\n\t\t\t\tif (this.canHyperTrain(set)) {\r\n\t\t\t\t\tif (minSpe) defaultIVs['spe'] = hpIVs['spe'] ?? 31;\r\n\t\t\t\t\tif (minAtk) defaultIVs['atk'] = hpIVs['atk'] ?? 31;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (const stat in hpIVs) defaultIVs[stat as Dex.StatName] = hpIVs[stat as Dex.StatName]!;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (hpType) {\r\n\t\t\tif (minSpe) defaultIVs['spe'] %= hpModulo;\r\n\t\t\tif (minAtk) defaultIVs['atk'] %= hpModulo;\r\n\t\t}\r\n\t\tif (minAtk && useIVs) {\r\n\t\t\t// min Atk\r\n\t\t\tif (['Gouging Fire', 'Iron Boulder', 'Iron Crown', 'Raging Bolt'].includes(set.species)) {\r\n\t\t\t\t// only available with 20 Atk IVs\r\n\t\t\t\tdefaultIVs['atk'] = 20;\r\n\t\t\t} else if (set.species.startsWith('Terapagos')) {\r\n\t\t\t\t// only available with 15 Atk IVs\r\n\t\t\t\tdefaultIVs['atk'] = 15;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn defaultIVs;\r\n\t}\r\n\tdefaultHappiness(set: Dex.PokemonSet) {\r\n\t\tif (set.moves.includes('Return')) return 255;\r\n\t\tif (set.moves.includes('Frustration')) return 0;\r\n\t\treturn undefined;\r\n\t}\r\n\tprefersMinStats(set: Dex.PokemonSet) {\r\n\t\tlet minSpe = !set.evs?.spe && set.moves.includes('Gyro Ball');\r\n\t\tlet minAtk = !set.evs?.atk;\r\n\r\n\t\t// only available through an event with 31 Spe IVs\r\n\t\tif (set.species.startsWith('Terapagos')) minSpe = false;\r\n\r\n\t\tif (this.format === 'gen7hiddentype') return { minAtk, minSpe };\r\n\t\tif (this.format.includes('1v1')) return { minAtk, minSpe };\r\n\r\n\t\t// only available through an event with 31 Atk IVs\r\n\t\tif (set.ability === 'Battle Bond' || ['Koraidon', 'Miraidon'].includes(set.species)) {\r\n\t\t\tminAtk = false;\r\n\t\t\treturn { minAtk, minSpe };\r\n\t\t}\r\n\t\tif (!set.moves.length) minAtk = false;\r\n\t\tfor (const moveName of set.moves) {\r\n\t\t\tif (!moveName) continue;\r\n\t\t\tconst move = this.dex.moves.get(moveName);\r\n\t\t\tif (move.id === 'transform') {\r\n\t\t\t\tconst hasMoveBesidesTransform = set.moves.length > 1;\r\n\t\t\t\tif (!hasMoveBesidesTransform) minAtk = false;\r\n\t\t\t} else if (\r\n\t\t\t\tmove.category === 'Physical' && !move.damage && !move.ohko &&\r\n\t\t\t\t!['foulplay', 'endeavor', 'counter', 'bodypress', 'seismictoss', 'bide', 'metalburst', 'superfang'].includes(move.id) &&\r\n\t\t\t\t!(this.gen < 8 && move.id === 'rapidspin')\r\n\t\t\t) {\r\n\t\t\t\tminAtk = false;\r\n\t\t\t} else if (\r\n\t\t\t\t['metronome', 'assist', 'copycat', 'mefirst', 'photongeyser', 'shellsidearm', 'terablast'].includes(move.id) ||\r\n\t\t\t\t(this.gen === 5 && move.id === 'naturepower')\r\n\t\t\t) {\r\n\t\t\t\tminAtk = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn { minAtk, minSpe };\r\n\t}\r\n\tgetNickname(set: Dex.PokemonSet) {\r\n\t\treturn set.name || this.dex.species.get(set.species).baseSpecies || '';\r\n\t}\r\n\tcanHyperTrain(set: Dex.PokemonSet) {\r\n\t\tlet format: string = this.format;\r\n\t\tif (this.gen < 7 || format === 'gen7hiddentype') return false;\r\n\t\tif ((set.level || this.defaultLevel) === 100) return true;\r\n\t\tif ((set.level || this.defaultLevel) >= 50 && this.defaultLevel === 50) return true;\r\n\t\treturn false;\r\n\t}\r\n\tgetHPIVs(hpType: Dex.TypeName | null) {\r\n\t\tswitch (hpType) {\r\n\t\tcase 'Dark':\r\n\t\t\treturn ['111111'];\r\n\t\tcase 'Dragon':\r\n\t\t\treturn ['011111', '101111', '110111'];\r\n\t\tcase 'Ice':\r\n\t\t\treturn ['010111', '100111', '111110'];\r\n\t\tcase 'Psychic':\r\n\t\t\treturn ['011110', '101110', '110110'];\r\n\t\tcase 'Electric':\r\n\t\t\treturn ['010110', '100110', '111011'];\r\n\t\tcase 'Grass':\r\n\t\t\treturn ['011011', '101011', '110011'];\r\n\t\tcase 'Water':\r\n\t\t\treturn ['100011', '111010'];\r\n\t\tcase 'Fire':\r\n\t\t\treturn ['101010', '110010'];\r\n\t\tcase 'Steel':\r\n\t\t\treturn ['100010', '111101'];\r\n\t\tcase 'Ghost':\r\n\t\t\treturn ['101101', '110101'];\r\n\t\tcase 'Bug':\r\n\t\t\treturn ['100101', '111100', '101100'];\r\n\t\tcase 'Rock':\r\n\t\t\treturn ['001100', '110100', '100100'];\r\n\t\tcase 'Ground':\r\n\t\t\treturn ['000100', '111001', '101001'];\r\n\t\tcase 'Poison':\r\n\t\t\treturn ['001001', '110001', '100001'];\r\n\t\tcase 'Flying':\r\n\t\t\treturn ['000001', '111000', '101000'];\r\n\t\tcase 'Fighting':\r\n\t\t\treturn ['001000', '110000', '100000'];\r\n\t\tdefault:\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\tgetStat(stat: StatName, set: Dex.PokemonSet, ivOverride: number, evOverride?: number, natureOverride?: number) {\r\n\t\tconst team = this.team;\r\n\r\n\t\tconst supportsEVs = !team.format.includes('letsgo');\r\n\t\tconst supportsAVs = !supportsEVs;\r\n\r\n\t\t// do this after setting set.evs because it's assumed to exist\r\n\t\t// after getStat is run\r\n\t\tconst species = this.dex.species.get(set.species);\r\n\t\tif (!species.exists) return 0;\r\n\r\n\t\tconst level = set.level || this.defaultLevel;\r\n\r\n\t\tconst baseStat = species.baseStats[stat];\r\n\t\tconst iv = ivOverride;\r\n\t\tconst ev = evOverride ?? set.evs?.[stat] ?? (this.gen > 2 ? 0 : 252);\r\n\r\n\t\tif (stat === 'hp') {\r\n\t\t\tif (baseStat === 1) return 1;\r\n\t\t\tif (!supportsEVs) return Math.trunc(Math.trunc(2 * baseStat + iv + 100) * level / 100 + 10) + (supportsAVs ? ev : 0);\r\n\t\t\treturn Math.trunc(Math.trunc(2 * baseStat + iv + Math.trunc(ev / 4) + 100) * level / 100 + 10);\r\n\t\t}\r\n\t\tlet val = Math.trunc(Math.trunc(2 * baseStat + iv + Math.trunc(ev / 4)) * level / 100 + 5);\r\n\t\tif (!supportsEVs) {\r\n\t\t\tval = Math.trunc(Math.trunc(2 * baseStat + iv) * level / 100 + 5);\r\n\t\t}\r\n\t\tif (natureOverride) {\r\n\t\t\tval *= natureOverride;\r\n\t\t} else if (BattleNatures[set.nature!]?.plus === stat) {\r\n\t\t\tval *= 1.1;\r\n\t\t} else if (BattleNatures[set.nature!]?.minus === stat) {\r\n\t\t\tval *= 0.9;\r\n\t\t}\r\n\t\tif (!supportsEVs) {\r\n\t\t\tconst friendshipValue = Math.trunc((70 / 255 / 10 + 1) * 100);\r\n\t\t\tval = Math.trunc(val) * friendshipValue / 100 + (supportsAVs ? ev : 0);\r\n\t\t}\r\n\t\treturn Math.trunc(val);\r\n\t}\r\n\texport(compat?: boolean) {\r\n\t\treturn Teams.export(this.sets, this.dex, !compat);\r\n\t}\r\n\timport(value: string) {\r\n\t\tthis.sets = PSTeambuilder.importTeam(value);\r\n\t\tthis.save();\r\n\t}\r\n\tgetTypeWeakness(type: Dex.TypeName, attackType: Dex.TypeName): 0 | 0.5 | 1 | 2 {\r\n\t\tconst weaknessType = this.dex.types.get(type).damageTaken?.[attackType];\r\n\t\tif (weaknessType === Dex.IMMUNE) return 0;\r\n\t\tif (weaknessType === Dex.RESIST) return 0.5;\r\n\t\tif (weaknessType === Dex.WEAK) return 2;\r\n\t\treturn 1;\r\n\t}\r\n\tgetWeakness(types: readonly Dex.TypeName[], abilityid: ID, attackType: Dex.TypeName): number {\r\n\t\tif (attackType === 'Ground' && abilityid === 'levitate') return 0;\r\n\t\tif (attackType === 'Water' && abilityid === 'dryskin') return 0;\r\n\t\tif (attackType === 'Fire' && abilityid === 'flashfire') return 0;\r\n\t\tif (attackType === 'Electric' && abilityid === 'lightningrod' && this.gen >= 5) return 0;\r\n\t\tif (attackType === 'Grass' && abilityid === 'sapsipper') return 0;\r\n\t\tif (attackType === 'Electric' && abilityid === 'motordrive') return 0;\r\n\t\tif (attackType === 'Water' && abilityid === 'stormdrain' && this.gen >= 5) return 0;\r\n\t\tif (attackType === 'Electric' && abilityid === 'voltabsorb') return 0;\r\n\t\tif (attackType === 'Water' && abilityid === 'waterabsorb') return 0;\r\n\t\tif (attackType === 'Ground' && abilityid === 'eartheater') return 0;\r\n\t\tif (attackType === 'Fire' && abilityid === 'wellbakedbody') return 0;\r\n\r\n\t\tif (attackType === 'Fire' && abilityid === 'primordialsea') return 0;\r\n\t\tif (attackType === 'Water' && abilityid === 'desolateland') return 0;\r\n\r\n\t\tif (abilityid === 'wonderguard') {\r\n\t\t\tfor (const type of types) {\r\n\t\t\t\tif (this.getTypeWeakness(type, attackType) <= 1) return 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet factor = 1;\r\n\t\tif ((attackType === 'Fire' || attackType === 'Ice') && abilityid === 'thickfat') factor *= 0.5;\r\n\t\tif (attackType === 'Fire' && abilityid === 'waterbubble') factor *= 0.5;\r\n\t\tif (attackType === 'Fire' && abilityid === 'heatproof') factor *= 0.5;\r\n\t\tif (attackType === 'Ghost' && abilityid === 'purifyingsalt') factor *= 0.5;\r\n\t\tif (attackType === 'Fire' && abilityid === 'fluffy') factor *= 2;\r\n\t\tif ((attackType === 'Electric' || attackType === 'Rock' || attackType === 'Ice') && abilityid === 'deltastream') {\r\n\t\t\tfactor *= 0.5;\r\n\t\t}\r\n\t\tfor (const type of types) {\r\n\t\t\tfactor *= this.getTypeWeakness(type, attackType);\r\n\t\t}\r\n\t\treturn factor;\r\n\t}\r\n\tpokemonDefensiveCoverage(set: Dex.PokemonSet) {\r\n\t\tconst coverage: Record<string, number> = {};\r\n\t\tconst species = this.dex.species.get(set.species);\r\n\t\tconst abilityid = toID(set.ability);\r\n\t\tfor (const type of this.dex.types.names()) {\r\n\t\t\tcoverage[type] = this.getWeakness(species.types, abilityid, type);\r\n\t\t}\r\n\t\treturn coverage as Record<Dex.TypeName, number>;\r\n\t}\r\n\tteamDefensiveCoverage() {\r\n\t\ttype Counter = { type: Dex.TypeName, resists: number, neutrals: number, weaknesses: number };\r\n\t\tconst counters: Record<Dex.TypeName, Counter> = {} as any;\r\n\t\tfor (const type of this.dex.types.names()) {\r\n\t\t\tcounters[type] = {\r\n\t\t\t\ttype,\r\n\t\t\t\tresists: 0,\r\n\t\t\t\tneutrals: 0,\r\n\t\t\t\tweaknesses: 0,\r\n\t\t\t};\r\n\t\t}\r\n\t\tfor (const set of this.sets) {\r\n\t\t\tconst coverage = this.pokemonDefensiveCoverage(set);\r\n\t\t\tfor (const [type, value] of Object.entries(coverage) as [Dex.TypeName, number][]) {\r\n\t\t\t\tif (value < 1) {\r\n\t\t\t\t\tcounters[type].resists++;\r\n\t\t\t\t} else if (value === 1) {\r\n\t\t\t\t\tcounters[type].neutrals++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcounters[type].weaknesses++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn counters;\r\n\t}\r\n\tgetDefaultAbility(set: Dex.PokemonSet) {\r\n\t\tif (this.gen < 3 || this.isLetsGo || this.formeLegality === 'custom') return set.ability;\r\n\t\tconst species = this.dex.species.get(set.species);\r\n\t\tif (this.formeLegality === 'hackmons') {\r\n\t\t\t// TODO: support gen 9 hackmons forme legality more completely than this\r\n\t\t\tif (this.gen < 9 || species.baseSpecies !== 'Xerneas') return set.ability;\r\n\t\t\t// falls through to final return statement\r\n\t\t} else if (this.abilityLegality === 'hackmons') {\r\n\t\t\tif (!species.battleOnly) return set.ability;\r\n\t\t\tif (species.requiredItems.length || species.baseSpecies === 'Meloetta') return set.ability;\r\n\t\t\t// battle only species only ever have one ability\r\n\t\t\t// if they don't have a required item and aren't Meloetta, they change formes with that ability\r\n\t\t\t// so it's forced, even in AAA\r\n\t\t\treturn species.abilities[0];\r\n\t\t}\r\n\t\tconst abilities = Object.values(species.abilities);\r\n\t\tif (abilities.length === 1) return abilities[0];\r\n\t\tif (set.ability && abilities.includes(set.ability)) return set.ability;\r\n\t\treturn undefined;\r\n\t}\r\n\tgetDefaultItem(speciesName: string) {\r\n\t\tconst species = this.dex.species.get(speciesName);\r\n\t\tlet items = species.requiredItems;\r\n\t\tif (this.gen !== 7 && !this.isNatDex) {\r\n\t\t\t// Require plates on Arceus when Z crystals don't exist\r\n\t\t\titems = items.filter(i => !i.endsWith('ium Z'));\r\n\t\t}\r\n\t\tif (items.length === 1) {\r\n\t\t\tif (this.formeLegality === 'normal' ||\r\n\t\t\t\tthis.formeLegality === 'hackmons' && this.gen === 9 && species.battleOnly &&\r\n\t\t\t\t!species.isMega && !species.isPrimal && species.name !== 'Necrozma-Ultra') {\r\n\t\t\t\treturn items[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\tsave() {\r\n\t\tthis.team.packedTeam = Teams.pack(this.sets);\r\n\t\tthis.team.iconCache = null;\r\n\t}\r\n}\r\n\r\nexport class TeamEditor extends preact.Component<{\r\n\tteam: Team, narrow?: boolean, onChange?: () => void, readOnly?: boolean,\r\n\tchildren?: preact.ComponentChildren, resources?: preact.ComponentChildren,\r\n}> {\r\n\twizard = true;\r\n\teditor!: TeamEditorState;\r\n\tsetTab = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLButtonElement;\r\n\t\tconst wizard = target.value === 'wizard';\r\n\t\tthis.wizard = wizard;\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\tstatic renderTypeIcon(type: string | null, b?: boolean) { // b is just for utilichart.js\r\n\t\tif (!type) return null;\r\n\r\n\t\ttype = Dex.types.get(type).name;\r\n\t\tif (!type) type = '???';\r\n\t\tlet sanitizedType = type.replace(/\\?/g, '%3f');\r\n\t\treturn <img\r\n\t\t\tsrc={`${Dex.resourcePrefix}sprites/types/${sanitizedType}.png`} alt={type}\r\n\t\t\theight=\"14\" width=\"32\" class={`pixelated${b ? ' b' : ''}`} style=\"vertical-align:middle\"\r\n\t\t/>;\r\n\t}\r\n\tstatic probablyMobile() {\r\n\t\treturn document.body.offsetWidth < 500;\r\n\t}\r\n\trenderDefensiveCoverage() {\r\n\t\tconst { editor } = this;\r\n\t\tif (editor.team.isBox) return null;\r\n\t\tif (!editor.sets.length) return null;\r\n\r\n\t\tconst counters = Object.values(editor.teamDefensiveCoverage());\r\n\t\tPSUtils.sortBy(counters, counter => [counter.resists, -counter.weaknesses]);\r\n\t\tconst good = [], medium = [], bad = [];\r\n\t\tconst renderTypeDefensive = (counter: typeof counters[number]) => (\r\n\t\t\t<tr>\r\n\t\t\t\t<th>{counter.type}</th>\r\n\t\t\t\t<td>{counter.resists} <small class=\"gray\">resist</small></td>\r\n\t\t\t\t<td>{counter.weaknesses} <small class=\"gray\">weak</small></td>\r\n\t\t\t</tr>\r\n\t\t);\r\n\t\tfor (const counter of counters) {\r\n\t\t\tif (counter.resists > 0) {\r\n\t\t\t\tgood.push(renderTypeDefensive(counter));\r\n\t\t\t} else if (counter.weaknesses <= 0) {\r\n\t\t\t\tmedium.push(renderTypeDefensive(counter));\r\n\t\t\t} else {\r\n\t\t\t\tbad.push(renderTypeDefensive(counter));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <details class=\"details\">\r\n\t\t\t<summary>\r\n\t\t\t\t<strong>Defensive coverage</strong>\r\n\t\t\t\t<table class=\"details-preview table\">\r\n\t\t\t\t\t{bad}\r\n\t\t\t\t\t<tr><td colSpan={3}><span class=\"details-preview ilink\"><small>See all</small></span></td></tr>\r\n\t\t\t\t</table>\r\n\t\t\t</summary>\r\n\t\t\t<table class=\"table\">{bad}{medium}{good}</table>\r\n\t\t</details>;\r\n\t}\r\n\tupdate = () => {\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\toverride render() {\r\n\t\tthis.editor ||= new TeamEditorState(this.props.team);\r\n\t\tconst editor = this.editor;\r\n\t\teditor.setReadonly(!!this.props.readOnly);\r\n\t\teditor.narrow = this.props.narrow ?? document.body.offsetWidth < 500;\r\n\t\tif (this.props.team.format !== editor.format) {\r\n\t\t\teditor.setFormat(this.props.team.format);\r\n\t\t}\r\n\r\n\t\treturn <div class=\"teameditor\">\r\n\t\t\t<ul class=\"tabbar\">\r\n\t\t\t\t<li><button onClick={this.setTab} value=\"wizard\" class={`button${this.wizard ? ' cur' : ''}`}>\r\n\t\t\t\t\tWizard\r\n\t\t\t\t</button></li>\r\n\t\t\t\t<li><button onClick={this.setTab} value=\"import\" class={`button${!this.wizard ? ' cur' : ''}`}>\r\n\t\t\t\t\tImport/Export\r\n\t\t\t\t</button></li>\r\n\t\t\t</ul>\r\n\t\t\t{this.wizard ? (\r\n\t\t\t\t<TeamWizard editor={editor} onChange={this.props.onChange} onUpdate={this.update} />\r\n\t\t\t) : (\r\n\t\t\t\t<TeamTextbox editor={editor} onChange={this.props.onChange} onUpdate={this.update} />\r\n\t\t\t)}\r\n\t\t\t{!this.editor.innerFocus && <>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t\t<div class=\"team-resources\">\r\n\t\t\t\t\t<br /><hr /><br />\r\n\t\t\t\t\t{this.renderDefensiveCoverage()}\r\n\t\t\t\t\t{this.props.resources}\r\n\t\t\t\t</div>\r\n\t\t\t</>}\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nclass TeamTextbox extends preact.Component<{\r\n\teditor: TeamEditorState,\r\n\tonChange?: () => void, onUpdate?: () => void,\r\n}> {\r\n\tstatic EMPTY_PROMISE = Promise.resolve(null);\r\n\teditor!: TeamEditorState;\r\n\tsetInfo: {\r\n\t\tspecies: string,\r\n\t\tbottomY: number,\r\n\t\tindex: number,\r\n\t}[] = [];\r\n\ttextbox: HTMLTextAreaElement = null!;\r\n\theightTester: HTMLTextAreaElement = null!;\r\n\tcompat = false;\r\n\t/** we changed the set but are delaying updates until the selection form is closed */\r\n\tsetDirty = false;\r\n\twindowing = true;\r\n\tselection: {\r\n\t\tsetIndex: number,\r\n\t\ttype: SelectionType | null,\r\n\t\ttypeIndex: number,\r\n\t\tlineRange: [number, number] | null,\r\n\t} | null = null;\r\n\tinnerFocus: {\r\n\t\toffsetY: number | null,\r\n\t\tsetIndex: number,\r\n\t\ttype: SelectionType,\r\n\t\t/** i.e. which move is this */\r\n\t\ttypeIndex: number,\r\n\t\trange: [number, number],\r\n\t\t/** if you edit, you'll change the range end, so it needs to be updated with this in mind */\r\n\t\trangeEndChar: string,\r\n\t} | null = null;\r\n\tgetYAt(index: number, fullLine?: boolean) {\r\n\t\tif (index < 0) return 10;\r\n\t\tif (index === 0) return 31;\r\n\t\tconst newValue = this.textbox.value.slice(0, index);\r\n\t\tthis.heightTester.value = fullLine && !newValue.endsWith('\\n') ? newValue + '\\n' : newValue;\r\n\t\treturn this.heightTester.scrollHeight;\r\n\t}\r\n\tinput = () => {\r\n\t\tthis.updateText();\r\n\t\tthis.save();\r\n\t};\r\n\tkeyUp = () => this.updateText(true);\r\n\tcontextMenu = (ev: MouseEvent) => {\r\n\t\tif (!ev.shiftKey) {\r\n\t\t\tconst hadInnerFocus = this.innerFocus?.range[1];\r\n\t\t\tthis.openInnerFocus();\r\n\t\t\tif (hadInnerFocus !== this.innerFocus?.range[1]) {\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\topenInnerFocus() {\r\n\t\tconst oldRange = this.selection?.lineRange;\r\n\t\tthis.updateText(true, true);\r\n\t\tif (this.selection) {\r\n\t\t\t// this shouldn't actually update anything, so the reference comparison is enough\r\n\t\t\tif (this.selection.lineRange === oldRange) return !!this.innerFocus;\r\n\t\t\tif (this.textbox.selectionStart === this.textbox.selectionEnd) {\r\n\t\t\t\tconst range = this.getSelectionTypeRange();\r\n\t\t\t\tif (range) this.textbox.setSelectionRange(range[0], range[1]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn !!this.innerFocus;\r\n\t}\r\n\tkeyDown = (ev: KeyboardEvent) => {\r\n\t\tconst editor = this.editor;\r\n\t\tswitch (ev.keyCode) {\r\n\t\tcase 27: // escape\r\n\t\tcase 8: // backspace\r\n\t\t\tif (this.innerFocus) {\r\n\t\t\t\tconst atStart = (this.innerFocus.range[0] === this.textbox.selectionStart &&\r\n\t\t\t\t\tthis.innerFocus.range[0] === this.textbox.selectionEnd);\r\n\t\t\t\tif (ev.keyCode === 27 || atStart) {\r\n\t\t\t\t\tif (editor.search.removeFilter()) {\r\n\t\t\t\t\t\teditor.setSearchValue(this.getInnerFocusValue());\r\n\t\t\t\t\t\tthis.resetScroll();\r\n\t\t\t\t\t\tthis.forceUpdate();\r\n\t\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t} else if (this.closeMenu()) {\r\n\t\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 38: // up\r\n\t\t\tif (this.innerFocus) {\r\n\t\t\t\teditor.upSearchValue();\r\n\t\t\t\tconst resultsUp = this.base!.querySelector('.searchresults');\r\n\t\t\t\tif (resultsUp) {\r\n\t\t\t\t\tresultsUp.scrollTop = Math.max(0, editor.searchIndex * 33 - Math.trunc((window.innerHeight - 100) * 0.4));\r\n\t\t\t\t}\r\n\t\t\t\tthis.forceUpdate();\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 40: // down\r\n\t\t\tif (this.innerFocus) {\r\n\t\t\t\teditor.downSearchValue();\r\n\t\t\t\tconst resultsDown = this.base!.querySelector('.searchresults');\r\n\t\t\t\tif (resultsDown) {\r\n\t\t\t\t\tresultsDown.scrollTop = Math.max(0, editor.searchIndex * 33 - Math.trunc((window.innerHeight - 100) * 0.4));\r\n\t\t\t\t}\r\n\t\t\t\tthis.forceUpdate();\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 9: // tab\r\n\t\tcase 13: // enter\r\n\t\t\tif (ev.keyCode === 13 && ev.shiftKey) return;\r\n\t\t\tif (ev.altKey || ev.metaKey) return;\r\n\t\t\tif (!this.innerFocus) {\r\n\t\t\t\tif (this.maybeReplaceLine()) {\r\n\t\t\t\t\t// do nothing else\r\n\t\t\t\t} else if (\r\n\t\t\t\t\tthis.textbox.selectionStart === this.textbox.value.length &&\r\n\t\t\t\t\t(this.textbox.value.endsWith('\\n\\n') || !this.textbox.value)\r\n\t\t\t\t) {\r\n\t\t\t\t\tthis.addPokemon();\r\n\t\t\t\t} else if (!this.openInnerFocus()) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t} else {\r\n\t\t\t\tconst result = this.editor.selectSearchValue();\r\n\t\t\t\tif (result !== null) {\r\n\t\t\t\t\tconst [name, moveSlot] = result.split('|');\r\n\t\t\t\t\tthis.selectResult(this.innerFocus.type, name, moveSlot);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.replaceNoFocus('', this.innerFocus.range[0], this.innerFocus.range[1]);\r\n\t\t\t\t\tthis.editor.setSearchValue('');\r\n\t\t\t\t\tthis.forceUpdate();\r\n\t\t\t\t}\r\n\t\t\t\tthis.resetScroll();\r\n\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 80: // p\r\n\t\t\tif (ev.metaKey) {\r\n\t\t\t\twindow.PS.alert(editor.export(this.compat));\r\n\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tmaybeReplaceLine = () => {\r\n\t\tif (this.textbox.selectionStart !== this.textbox.selectionEnd) return;\r\n\t\tconst current = this.textbox.selectionEnd;\r\n\t\tconst lineStart = this.textbox.value.lastIndexOf('\\n', current) + 1;\r\n\t\tconst value = this.textbox.value.slice(lineStart, current);\r\n\r\n\t\tconst pokepaste = /^https?:\\/\\/pokepast.es\\/([a-z0-9]+)(?:\\/.*)?$/.exec(value)?.[1];\r\n\t\tif (pokepaste) {\r\n\t\t\tthis.editor.fetching = true;\r\n\t\t\tNet(`https://pokepast.es/${pokepaste}/json`).get().then(json => {\r\n\t\t\t\tconst paste = JSON.parse(json);\r\n\t\t\t\tconst pasteTxt = paste.paste.replace(/\\r\\n/g, '\\n');\r\n\t\t\t\tif (this.textbox) {\r\n\t\t\t\t\t// make sure it's still there:\r\n\t\t\t\t\tconst valueIndex = this.textbox.value.indexOf(value);\r\n\t\t\t\t\tthis.replace(paste.paste.replace(/\\r\\n/g, '\\n'), valueIndex, valueIndex + value.length);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.editor.import(pasteTxt);\r\n\t\t\t\t}\r\n\t\t\t\tconst notes = paste[\"notes\"] as string;\r\n\t\t\t\tif (notes.startsWith(\"Format: \")) {\r\n\t\t\t\t\tconst formatid = toID(notes.slice(8));\r\n\t\t\t\t\tthis.editor.setFormat(formatid);\r\n\t\t\t\t}\r\n\t\t\t\tconst title = paste[\"title\"] as string;\r\n\t\t\t\tif (title && !title.startsWith('Untitled')) {\r\n\t\t\t\t\tthis.editor.team.name = title.replace(/[|\\\\/]/g, '');\r\n\t\t\t\t}\r\n\t\t\t\tthis.editor.fetching = false;\r\n\t\t\t\tthis.props.onUpdate?.();\r\n\t\t\t});\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\tgetInnerFocusValue() {\r\n\t\tif (!this.innerFocus) return '';\r\n\t\treturn this.textbox.value.slice(this.innerFocus.range[0], this.innerFocus.range[1]);\r\n\t}\r\n\tclearInnerFocus() {\r\n\t\tif (this.innerFocus) {\r\n\t\t\tif (this.innerFocus.type === 'pokemon') {\r\n\t\t\t\tconst value = this.getInnerFocusValue();\r\n\t\t\t\tif (!toID(value)) {\r\n\t\t\t\t\tthis.replaceNoFocus(this.editor.originalSpecies || '', this.innerFocus.range[0], this.innerFocus.range[1]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.innerFocus = null;\r\n\t\t}\r\n\t}\r\n\tcloseMenu = () => {\r\n\t\tif (this.innerFocus) {\r\n\t\t\tthis.clearInnerFocus();\r\n\t\t\tif (this.setDirty) {\r\n\t\t\t\tthis.updateText();\r\n\t\t\t\tthis.save();\r\n\t\t\t} else {\r\n\t\t\t\tthis.forceUpdate();\r\n\t\t\t}\r\n\t\t\tthis.textbox.focus();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\tupdateText = (noTextChange?: boolean, autoSelect?: boolean | SelectionType) => {\r\n\t\tconst textbox = this.textbox;\r\n\t\tlet value = textbox.value;\r\n\t\tlet selectionStart = textbox.selectionStart || 0;\r\n\t\tlet selectionEnd = textbox.selectionEnd || 0;\r\n\r\n\t\tif (this.innerFocus) {\r\n\t\t\tif (!noTextChange) {\r\n\t\t\t\tlet lineEnd = this.textbox.value.indexOf('\\n', this.innerFocus.range[0]);\r\n\t\t\t\tif (lineEnd < 0) lineEnd = this.textbox.value.length;\r\n\t\t\t\tconst line = this.textbox.value.slice(this.innerFocus.range[0], lineEnd);\r\n\t\t\t\tif (this.innerFocus.rangeEndChar) {\r\n\t\t\t\t\tconst index = line.indexOf(this.innerFocus.rangeEndChar);\r\n\t\t\t\t\tif (index >= 0) lineEnd = this.innerFocus.range[0] + index;\r\n\t\t\t\t}\r\n\t\t\t\tthis.innerFocus.range[1] = lineEnd;\r\n\t\t\t}\r\n\t\t\tconst [start, end] = this.innerFocus.range;\r\n\t\t\tif (selectionStart >= start && selectionStart <= end && selectionEnd >= start && selectionEnd <= end) {\r\n\t\t\t\tif (!noTextChange) {\r\n\t\t\t\t\tthis.updateSearch();\r\n\t\t\t\t\tthis.setDirty = true;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.clearInnerFocus();\r\n\t\t\tvalue = textbox.value;\r\n\t\t\tselectionStart = textbox.selectionStart || 0;\r\n\t\t\tselectionEnd = textbox.selectionEnd || 0;\r\n\t\t}\r\n\r\n\t\tif (this.setDirty) {\r\n\t\t\tthis.setDirty = false;\r\n\t\t\tnoTextChange = false;\r\n\t\t}\r\n\r\n\t\tthis.heightTester.style.width = `${textbox.offsetWidth}px`;\r\n\t\t/** index of `value` that we've parsed to */\r\n\t\tlet index = 0;\r\n\t\t/** for the set we're currently parsing */\r\n\t\tlet setIndex: number | null = null;\r\n\t\tlet nextSetIndex = 0;\r\n\t\tif (!noTextChange) this.setInfo = [];\r\n\t\tthis.selection = null;\r\n\r\n\t\twhile (index < value.length) {\r\n\t\t\tlet nlIndex = value.indexOf('\\n', index);\r\n\t\t\tif (nlIndex < 0) nlIndex = value.length;\r\n\t\t\tconst line = value.slice(index, nlIndex);\r\n\r\n\t\t\tif (!line.trim()) {\r\n\t\t\t\tsetIndex = null;\r\n\t\t\t\tindex = nlIndex + 1;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (setIndex === null && index && !noTextChange && this.setInfo.length) {\r\n\t\t\t\tthis.setInfo[this.setInfo.length - 1].bottomY = this.getYAt(index - 1);\r\n\t\t\t}\r\n\r\n\t\t\tif (setIndex === null) {\r\n\t\t\t\tif (!noTextChange) {\r\n\t\t\t\t\tconst atIndex = line.indexOf('@');\r\n\t\t\t\t\tlet species = atIndex >= 0 ? line.slice(0, atIndex).trim() : line.trim();\r\n\t\t\t\t\tif (species.endsWith(' (M)') || species.endsWith(' (F)')) {\r\n\t\t\t\t\t\tspecies = species.slice(0, -4);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (species.endsWith(')')) {\r\n\t\t\t\t\t\tconst parenIndex = species.lastIndexOf(' (');\r\n\t\t\t\t\t\tif (parenIndex >= 0) {\r\n\t\t\t\t\t\t\tspecies = species.slice(parenIndex + 2, -1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.setInfo.push({\r\n\t\t\t\t\t\tspecies,\r\n\t\t\t\t\t\tbottomY: -1,\r\n\t\t\t\t\t\tindex,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tsetIndex = nextSetIndex;\r\n\t\t\t\tnextSetIndex++;\r\n\t\t\t}\r\n\r\n\t\t\tconst selectionEndCutoff = (selectionStart === selectionEnd ? nlIndex : nlIndex + 1);\r\n\t\t\tlet start = index, end = index + line.length;\r\n\t\t\tif (index <= selectionStart && selectionEnd <= selectionEndCutoff) {\r\n\t\t\t\t// both ends within range\r\n\t\t\t\tlet type: SelectionType | null = null;\r\n\t\t\t\tconst lcLine = line.toLowerCase().trim();\r\n\r\n\t\t\t\tif (lcLine.startsWith('ability:')) {\r\n\t\t\t\t\ttype = 'ability';\r\n\t\t\t\t} else if (lcLine.startsWith('-')) {\r\n\t\t\t\t\ttype = 'move';\r\n\t\t\t\t} else if (\r\n\t\t\t\t\t!lcLine || lcLine.startsWith('level:') || lcLine.startsWith('gender:') ||\r\n\t\t\t\t\t(lcLine + ':').startsWith('shiny:') || (lcLine + ':').startsWith('gigantamax:') ||\r\n\t\t\t\t\tlcLine.startsWith('tera type:') || lcLine.startsWith('dynamax level:')\r\n\t\t\t\t) {\r\n\t\t\t\t\ttype = 'details';\r\n\t\t\t\t} else if (\r\n\t\t\t\t\tlcLine.startsWith('ivs:') || lcLine.startsWith('evs:') ||\r\n\t\t\t\t\tlcLine.endsWith(' nature')\r\n\t\t\t\t) {\r\n\t\t\t\t\ttype = 'stats';\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttype = 'pokemon';\r\n\t\t\t\t\tconst atIndex = line.indexOf('@');\r\n\t\t\t\t\tif (atIndex >= 0) {\r\n\t\t\t\t\t\tif (selectionStart > index + atIndex) {\r\n\t\t\t\t\t\t\ttype = 'item';\r\n\t\t\t\t\t\t\tstart = index + atIndex + 1;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tend = index + atIndex;\r\n\t\t\t\t\t\t\tif (line.charAt(atIndex - 1) === ']' || line.charAt(atIndex - 2) === ']') {\r\n\t\t\t\t\t\t\t\ttype = 'ability';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (typeof autoSelect === 'string') autoSelect = autoSelect === type;\r\n\t\t\t\tthis.selection = {\r\n\t\t\t\t\tsetIndex, type, lineRange: [start, end], typeIndex: 0,\r\n\t\t\t\t};\r\n\t\t\t\tif (autoSelect) this.engageFocus();\r\n\t\t\t}\r\n\r\n\t\t\tindex = nlIndex + 1;\r\n\t\t}\r\n\t\tif (!noTextChange) {\r\n\t\t\tconst end = value.endsWith('\\n\\n') ? value.length - 1 : value.length;\r\n\t\t\tconst bottomY = this.getYAt(end, true);\r\n\t\t\tif (this.setInfo.length) {\r\n\t\t\t\tthis.setInfo[this.setInfo.length - 1].bottomY = bottomY;\r\n\t\t\t}\r\n\r\n\t\t\ttextbox.style.height = `${bottomY + 100}px`;\r\n\t\t}\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\tengageFocus(focus?: this['innerFocus']) {\r\n\t\tif (this.innerFocus && !focus) return;\r\n\t\tconst editor = this.editor;\r\n\t\tif (editor.readonly) return;\r\n\r\n\t\tif (!focus) {\r\n\t\t\tif (!this.selection?.type) return;\r\n\r\n\t\t\tconst range = this.getSelectionTypeRange();\r\n\t\t\tif (!range) return;\r\n\t\t\tconst { type, setIndex } = this.selection;\r\n\r\n\t\t\tlet rangeEndChar = this.textbox.value.charAt(range[1]);\r\n\t\t\tif (rangeEndChar === ' ') rangeEndChar += this.textbox.value.charAt(range[1] + 1);\r\n\t\t\tfocus = {\r\n\t\t\t\toffsetY: this.getYAt(range[0]),\r\n\t\t\t\tsetIndex,\r\n\t\t\t\ttype,\r\n\t\t\t\ttypeIndex: this.selection.typeIndex,\r\n\t\t\t\trange,\r\n\t\t\t\trangeEndChar,\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis.innerFocus = focus;\r\n\r\n\t\tif (focus.type === 'details' || focus.type === 'stats') {\r\n\t\t\tthis.forceUpdate();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst value = this.textbox.value.slice(focus.range[0], focus.range[1]);\r\n\t\teditor.setSearchType(focus.type, focus.setIndex, value);\r\n\t\tthis.resetScroll();\r\n\t\tthis.textbox.setSelectionRange(focus.range[0], focus.range[1]);\r\n\t\tthis.forceUpdate();\r\n\t}\r\n\tupdateSearch() {\r\n\t\tif (!this.innerFocus) return;\r\n\t\tconst { range } = this.innerFocus;\r\n\t\tconst editor = this.editor;\r\n\t\tconst value = this.textbox.value.slice(range[0], range[1]);\r\n\r\n\t\teditor.setSearchValue(value);\r\n\t\tthis.resetScroll();\r\n\t\tthis.forceUpdate();\r\n\t}\r\n\tselectResult = (type: string | null, name: string, moveSlot?: string) => {\r\n\t\tif (type === null) {\r\n\t\t\tthis.resetScroll();\r\n\t\t\tthis.forceUpdate();\r\n\t\t} else if (!type) {\r\n\t\t\tthis.changeSet(this.innerFocus!.type, '');\r\n\t\t} else {\r\n\t\t\tthis.changeSet(type as SelectionType, name, moveSlot);\r\n\t\t}\r\n\t};\r\n\tgetSelectionTypeRange(): [number, number] | null {\r\n\t\tconst selection = this.selection;\r\n\t\tif (!selection?.lineRange) return null;\r\n\r\n\t\tlet [start, end] = selection.lineRange;\r\n\t\tlet lcLine = this.textbox.value.slice(start, end).toLowerCase();\r\n\t\tif (lcLine.endsWith('  ')) {\r\n\t\t\tend -= 2;\r\n\t\t\tlcLine = lcLine.slice(0, -2);\r\n\t\t}\r\n\r\n\t\tswitch (selection.type) {\r\n\t\tcase 'pokemon': {\r\n\t\t\t// let atIndex = lcLine.lastIndexOf('@');\r\n\t\t\t// if (atIndex >= 0) {\r\n\t\t\t// \tif (lcLine.charAt(atIndex - 1) === ' ') atIndex--;\r\n\t\t\t// \tlcLine = lcLine.slice(0, atIndex);\r\n\t\t\t// \tend = start + atIndex;\r\n\t\t\t// }\r\n\r\n\t\t\tif (lcLine.endsWith(' ')) {\r\n\t\t\t\tlcLine = lcLine.slice(0, -1);\r\n\t\t\t\tend--;\r\n\t\t\t}\r\n\r\n\t\t\tif (lcLine.endsWith(' (m)') || lcLine.endsWith(' (f)')) {\r\n\t\t\t\tlcLine = lcLine.slice(0, -4);\r\n\t\t\t\tend -= 4;\r\n\t\t\t}\r\n\r\n\t\t\tif (lcLine.endsWith(')')) {\r\n\t\t\t\tconst parenIndex = lcLine.lastIndexOf(' (');\r\n\t\t\t\tif (parenIndex >= 0) {\r\n\t\t\t\t\tstart = start + parenIndex + 2;\r\n\t\t\t\t\tend--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn [start, end];\r\n\t\t}\r\n\t\tcase 'item': {\r\n\t\t\t// let atIndex = lcLine.lastIndexOf('@');\r\n\t\t\t// if (atIndex < 0) return null;\r\n\r\n\t\t\t// if (lcLine.charAt(atIndex + 1) === ' ') atIndex++;\r\n\t\t\t// return { start: start + atIndex + 1, end };\r\n\t\t\tif (lcLine.startsWith(' ')) start++;\r\n\t\t\treturn [start, end];\r\n\t\t}\r\n\t\tcase 'ability': {\r\n\t\t\tif (lcLine.startsWith('[')) {\r\n\t\t\t\tstart++;\r\n\t\t\t\tif (lcLine.endsWith(' ')) {\r\n\t\t\t\t\tend--;\r\n\t\t\t\t\tlcLine = lcLine.slice(0, -1);\r\n\t\t\t\t}\r\n\t\t\t\tif (lcLine.endsWith(']')) {\r\n\t\t\t\t\tend--;\r\n\t\t\t\t}\r\n\t\t\t\treturn [start, end];\r\n\t\t\t}\r\n\t\t\tif (!lcLine.startsWith('ability:')) return null;\r\n\t\t\tstart += lcLine.startsWith('ability: ') ? 9 : 8;\r\n\t\t\treturn [start, end];\r\n\t\t}\r\n\t\tcase 'move': {\r\n\t\t\tif (!lcLine.startsWith('-')) return null;\r\n\t\t\tstart += lcLine.startsWith('- ') ? 2 : 1;\r\n\t\t\treturn [start, end];\r\n\t\t}\r\n\t\t}\r\n\t\treturn [start, end];\r\n\t}\r\n\tchangeSet(type: SelectionType, name: string, moveSlot?: string) {\r\n\t\tconst focus = this.innerFocus;\r\n\t\tif (!focus) return;\r\n\r\n\t\tif (type === focus.type && type !== 'pokemon') {\r\n\t\t\tthis.replace(name, focus.range[0], focus.range[1]);\r\n\t\t\tthis.updateText(false, true);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tswitch (type) {\r\n\t\tcase 'pokemon': {\r\n\t\t\tconst set = this.editor.sets[focus.setIndex] ||= {\r\n\t\t\t\tspecies: '',\r\n\t\t\t\tmoves: [],\r\n\t\t\t};\r\n\t\t\tthis.editor.changeSpecies(set, name);\r\n\t\t\tthis.replaceSet(focus.setIndex);\r\n\t\t\tthis.updateText(false, true);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase 'ability': {\r\n\t\t\tthis.editor.sets[focus.setIndex].ability = name;\r\n\t\t\tthis.replaceSet(focus.setIndex);\r\n\t\t\tthis.updateText(false, true);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t}\r\n\t}\r\n\tgetSetRange(index: number) {\r\n\t\tif (!this.setInfo[index]) {\r\n\t\t\tif (this.innerFocus?.setIndex === index) {\r\n\t\t\t\treturn this.innerFocus.range;\r\n\t\t\t}\r\n\t\t\treturn [this.textbox.value.length, this.textbox.value.length];\r\n\t\t}\r\n\t\tconst start = this.setInfo[index].index;\r\n\t\tconst end = this.setInfo[index + 1].index;\r\n\t\treturn [start, end];\r\n\t}\r\n\tchangeCompat = (ev: Event) => {\r\n\t\tconst checkbox = ev.currentTarget as HTMLInputElement;\r\n\t\tthis.compat = checkbox.checked;\r\n\t\tthis.editor.import(this.textbox.value);\r\n\t\tthis.textbox.value = this.editor.export(this.compat);\r\n\t\t// this.textbox.select();\r\n\t\t// document.execCommand('insertText', false, this.editor.export(this.compat));\r\n\t\tthis.updateText();\r\n\t};\r\n\treplaceSet(index: number) {\r\n\t\tconst editor = this.editor;\r\n\t\tconst { team } = editor;\r\n\t\tif (!team) return;\r\n\r\n\t\tlet newText = Teams.exportSet(editor.sets[index], editor.dex, !this.compat);\r\n\t\tconst [start, end] = this.getSetRange(index);\r\n\t\tif (start && start === this.textbox.value.length && !this.textbox.value.endsWith('\\n\\n')) {\r\n\t\t\tnewText = (this.textbox.value.endsWith('\\n') ? '\\n' : '\\n\\n') + newText;\r\n\t\t}\r\n\t\tthis.replaceNoFocus(newText, start, end, start + newText.length);\r\n\t\t// we won't do a full update but we do need to update where the end is,\r\n\t\t// for future updates\r\n\t\tif (!this.setInfo[index]) {\r\n\t\t\tthis.updateText();\r\n\t\t\tthis.save();\r\n\t\t} else {\r\n\t\t\tif (this.setInfo[index + 1]) {\r\n\t\t\t\tthis.setInfo[index + 1].index = start + newText.length;\r\n\t\t\t}\r\n\t\t\t// others don't need to be updated;\r\n\t\t\t// we'll do a full update next time we focus the textbox\r\n\t\t\tthis.setDirty = true;\r\n\t\t}\r\n\t}\r\n\treplace(text: string, start: number, end: number, selectionStart = start, selectionEnd = start + text.length) {\r\n\t\tconst textbox = this.textbox;\r\n\t\t// const value = textbox.value;\r\n\t\t// textbox.value = value.slice(0, start) + text + value.slice(end);\r\n\t\ttextbox.focus();\r\n\t\ttextbox.setSelectionRange(start, end);\r\n\t\tdocument.execCommand('insertText', false, text);\r\n\t\t// textbox.setSelectionRange(selectionStart, selectionEnd);\r\n\t\tthis.save();\r\n\t}\r\n\treplaceNoFocus(text: string, start: number, end: number, selectionStart = start, selectionEnd = start + text.length) {\r\n\t\tconst textbox = this.textbox;\r\n\t\tconst value = textbox.value;\r\n\t\ttextbox.value = value.slice(0, start) + text + value.slice(end);\r\n\t\ttextbox.setSelectionRange(selectionStart, selectionEnd);\r\n\t\tthis.save();\r\n\t}\r\n\tsave() {\r\n\t\tthis.editor.import(this.textbox.value);\r\n\t\tthis.props.onChange?.();\r\n\t}\r\n\toverride componentDidMount() {\r\n\t\tthis.textbox = this.base!.getElementsByClassName('teamtextbox')[0] as HTMLTextAreaElement;\r\n\t\tthis.heightTester = this.base!.getElementsByClassName('heighttester')[0] as HTMLTextAreaElement;\r\n\r\n\t\tthis.editor = this.props.editor;\r\n\t\tconst exportedTeam = this.editor.export(this.compat);\r\n\t\tthis.textbox.value = exportedTeam;\r\n\t\tthis.updateText();\r\n\t\tsetTimeout(() => this.updateText());\r\n\t}\r\n\toverride componentWillUnmount() {\r\n\t\tthis.textbox = null!;\r\n\t\tthis.heightTester = null!;\r\n\t}\r\n\tclickDetails = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLButtonElement;\r\n\t\tconst i = parseInt(target.value || '0');\r\n\t\tif (this.innerFocus?.type === target.name) {\r\n\t\t\tthis.innerFocus = null;\r\n\t\t\tthis.forceUpdate();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.engageFocus({\r\n\t\t\toffsetY: null,\r\n\t\t\tsetIndex: i,\r\n\t\t\ttype: target.name as SelectionType,\r\n\t\t\ttypeIndex: 0,\r\n\t\t\trange: [0, 0],\r\n\t\t\trangeEndChar: '',\r\n\t\t});\r\n\t};\r\n\taddPokemon = () => {\r\n\t\tif (this.textbox.value && !this.textbox.value.endsWith('\\n\\n')) {\r\n\t\t\tthis.textbox.value += this.textbox.value.endsWith('\\n') ? '\\n' : '\\n\\n';\r\n\t\t}\r\n\t\tconst end = this.textbox.value === '\\n\\n' ? 0 : this.textbox.value.length;\r\n\t\tthis.textbox.setSelectionRange(end, end);\r\n\t\tthis.textbox.focus();\r\n\t\tthis.engageFocus({\r\n\t\t\toffsetY: this.getYAt(end, true),\r\n\t\t\tsetIndex: this.setInfo.length,\r\n\t\t\ttype: 'pokemon',\r\n\t\t\ttypeIndex: 0,\r\n\t\t\trange: [end, end],\r\n\t\t\trangeEndChar: '@',\r\n\t\t});\r\n\t};\r\n\tscrollResults = (ev: Event) => {\r\n\t\tif (!(ev.currentTarget as HTMLElement).scrollTop) return;\r\n\t\tthis.windowing = false;\r\n\t\tif (document.documentElement.clientWidth === document.documentElement.scrollWidth) {\r\n\t\t\t(ev.currentTarget as any).scrollIntoViewIfNeeded?.();\r\n\t\t}\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\tresetScroll() {\r\n\t\tthis.windowing = true;\r\n\t\tconst searchResults = this.base!.querySelector('.searchresults');\r\n\t\tif (searchResults) searchResults.scrollTop = 0;\r\n\t}\r\n\twindowResults() {\r\n\t\tif (this.windowing) {\r\n\t\t\treturn Math.ceil(window.innerHeight / 33);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\trenderDetails(set: Dex.PokemonSet, i: number) {\r\n\t\tconst editor = this.editor;\r\n\t\tconst species = editor.dex.species.get(set.species);\r\n\r\n\t\tconst GenderChart = {\r\n\t\t\t'M': 'Male',\r\n\t\t\t'F': 'Female',\r\n\t\t\t'N': '\\u2014', // em dash\r\n\t\t};\r\n\t\tconst gender = GenderChart[(set.gender || species.gender || 'N') as 'N'];\r\n\r\n\t\treturn <button class=\"textbox setdetails\" name=\"details\" value={i} onClick={this.clickDetails}>\r\n\t\t\t<span class=\"detailcell\">\r\n\t\t\t\t<label>Level</label>{set.level || editor.defaultLevel}\r\n\t\t\t</span>\r\n\t\t\t<span class=\"detailcell\">\r\n\t\t\t\t<label>Shiny</label>{set.shiny ? 'Yes' : '\\u2014'}\r\n\t\t\t</span>\r\n\t\t\t{editor.gen === 9 ? (\r\n\t\t\t\t<span class=\"detailcell\">\r\n\t\t\t\t\t<label>Tera</label>{TeamEditor.renderTypeIcon(set.teraType || species.requiredTeraType || species.types[0])}\r\n\t\t\t\t</span>\r\n\t\t\t) : editor.hpTypeMatters(set) ? (\r\n\t\t\t\t<span class=\"detailcell\">\r\n\t\t\t\t\t<label>H. Power</label>{TeamEditor.renderTypeIcon(editor.getHPType(set))}\r\n\t\t\t\t</span>\r\n\t\t\t) : (\r\n\t\t\t\t<span class=\"detailcell\">\r\n\t\t\t\t\t<label>Gender</label>{gender}\r\n\t\t\t\t</span>\r\n\t\t\t)}\r\n\t\t</button>;\r\n\t}\r\n\r\n\trenderStats(set: Dex.PokemonSet, i: number) {\r\n\t\tconst editor = this.editor;\r\n\r\n\t\t// stat cell\r\n\t\treturn <button class=\"textbox setstats\" name=\"stats\" value={i} onClick={this.clickDetails}>\r\n\t\t\t{StatForm.renderStatGraph(set, editor)}\r\n\t\t</button>;\r\n\t}\r\n\thandleSetChange = () => {\r\n\t\tif (this.selection) {\r\n\t\t\tthis.replaceSet(this.selection.setIndex);\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\t};\r\n\tbottomY() {\r\n\t\treturn this.setInfo[this.setInfo.length - 1]?.bottomY ?? 8;\r\n\t}\r\n\tcopyAll = (ev: Event) => {\r\n\t\tthis.textbox.select();\r\n\t\tdocument.execCommand('copy');\r\n\t\tconst button = ev?.currentTarget as HTMLButtonElement;\r\n\t\tif (button) {\r\n\t\t\tbutton.innerHTML = '<i class=\"fa fa-check\"></i> Copied';\r\n\t\t\tbutton.className += ' cur';\r\n\t\t}\r\n\t};\r\n\trender() {\r\n\t\tconst editor = this.props.editor;\r\n\t\tconst statsDetailsOffset = editor.gen >= 3 ? 18 : -1;\r\n\t\treturn <div>\r\n\t\t\t<p>\r\n\t\t\t\t<button class=\"button\" onClick={this.copyAll}>\r\n\t\t\t\t\t<i class=\"fa fa-copy\" aria-hidden></i> Copy\r\n\t\t\t\t</button> {}\r\n\t\t\t\t<label class=\"checkbox inline\">\r\n\t\t\t\t\t<input type=\"checkbox\" name=\"compat\" onChange={this.changeCompat} /> Old export format\r\n\t\t\t\t</label>\r\n\t\t\t</p>\r\n\t\t\t<div class=\"teameditor-text\">\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tclass=\"textbox teamtextbox\" style={`padding-left:${editor.narrow ? '50px' : '100px'}`}\r\n\t\t\t\t\tonInput={this.input} onContextMenu={this.contextMenu} onKeyUp={this.keyUp} onKeyDown={this.keyDown}\r\n\t\t\t\t\tonClick={this.keyUp} onChange={this.maybeReplaceLine}\r\n\t\t\t\t\tplaceholder=\" Paste exported teams, pokepaste URLs, or JSON here\" readOnly={editor.readonly}\r\n\t\t\t\t/>\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tclass=\"textbox teamtextbox heighttester\" tabIndex={-1} aria-hidden\r\n\t\t\t\t\tstyle={`padding-left:${editor.narrow ? '50px' : '100px'};visibility:hidden;left:-15px`}\r\n\t\t\t\t/>\r\n\t\t\t\t<div class=\"teamoverlays\">\r\n\t\t\t\t\t{this.setInfo.slice(0, -1).map(info =>\r\n\t\t\t\t\t\t<hr style={`top:${info.bottomY - 18}px;pointer-events:none`} />\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t{editor.canAdd() && !!this.setInfo.length && <hr style={`top:${this.bottomY() - 18}px`} />}\r\n\t\t\t\t\t{this.setInfo.map((info, i) => {\r\n\t\t\t\t\t\tif (!info.species) return null;\r\n\t\t\t\t\t\tconst set = editor.sets[i];\r\n\t\t\t\t\t\tif (!set) return null;\r\n\t\t\t\t\t\tconst prevOffset = i === 0 ? 8 : this.setInfo[i - 1].bottomY;\r\n\t\t\t\t\t\tconst species = editor.dex.species.get(info.species);\r\n\t\t\t\t\t\tconst num = Dex.getPokemonIconNum(species.id);\r\n\t\t\t\t\t\tif (!num) return null;\r\n\r\n\t\t\t\t\t\tconst top = Math.floor(num / 12) * 30;\r\n\t\t\t\t\t\tconst left = (num % 12) * 40;\r\n\t\t\t\t\t\tconst iconStyle = `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-sheet.png) no-repeat scroll -${left}px -${top}px`;\r\n\r\n\t\t\t\t\t\tconst itemStyle = set.item && Dex.getItemIcon(editor.dex.items.get(set.item));\r\n\r\n\t\t\t\t\t\tif (editor.narrow) {\r\n\t\t\t\t\t\t\treturn <div style={`top:${prevOffset + 1}px;left:5px;position:absolute;text-align:center;pointer-events:none`}>\r\n\t\t\t\t\t\t\t\t<div><span class=\"picon\" style={iconStyle}></span></div>\r\n\t\t\t\t\t\t\t\t{species.types.map(type => <div>{TeamEditor.renderTypeIcon(type)}</div>)}\r\n\t\t\t\t\t\t\t\t<div><span class=\"itemicon\" style={itemStyle}></span></div>\r\n\t\t\t\t\t\t\t</div>;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn [<div\r\n\t\t\t\t\t\t\tstyle={\r\n\t\t\t\t\t\t\t\t`top:${prevOffset - 7}px;left:0;position:absolute;text-align:right;` +\r\n\t\t\t\t\t\t\t\t`width:94px;padding:103px 5px 0 0;min-height:24px;pointer-events:none;` +\r\n\t\t\t\t\t\t\t\tDex.getTeambuilderSprite(set, editor.dex)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div>{species.types.map(type => TeamEditor.renderTypeIcon(type))}<span class=\"itemicon\" style={itemStyle}></span></div>\r\n\t\t\t\t\t\t</div>, <div style={`top:${prevOffset + statsDetailsOffset}px;right:9px;position:absolute`}>\r\n\t\t\t\t\t\t\t{this.renderStats(set, i)}\r\n\t\t\t\t\t\t</div>, <div style={`top:${prevOffset + statsDetailsOffset}px;right:145px;position:absolute`}>\r\n\t\t\t\t\t\t\t{this.renderDetails(set, i)}\r\n\t\t\t\t\t\t</div>];\r\n\t\t\t\t\t})}\r\n\t\t\t\t\t{editor.canAdd() && !(this.innerFocus && this.innerFocus.setIndex >= this.setInfo.length) && (\r\n\t\t\t\t\t\t<div style={`top:${this.bottomY() - 3}px;left:${editor.narrow ? 55 : 105}px;position:absolute`}>\r\n\t\t\t\t\t\t\t<button class=\"button\" onClick={this.addPokemon}>\r\n\t\t\t\t\t\t\t\t<i class=\"fa fa-plus\" aria-hidden></i> Add Pok&eacute;mon\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t{this.innerFocus?.offsetY != null && (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclass={`teaminnertextbox teaminnertextbox-${this.innerFocus.type}`}\r\n\t\t\t\t\t\t\tstyle={`top:${this.innerFocus.offsetY - 21}px;left:${editor.narrow ? 46 : 96}px;`}\r\n\t\t\t\t\t\t></div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t\t{this.innerFocus && (\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclass=\"searchresults\"\r\n\t\t\t\t\t\tstyle={`top:${(this.setInfo[this.innerFocus.setIndex]?.bottomY ?? this.bottomY() + 50) - 12}px`}\r\n\t\t\t\t\t\tonScroll={this.scrollResults}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<button class=\"button closesearch\" onClick={this.closeMenu}>\r\n\t\t\t\t\t\t\t{!editor.narrow && <kbd>Esc</kbd>} <i class=\"fa fa-times\" aria-hidden></i> Close\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t{this.innerFocus.type === 'stats' ? (\r\n\t\t\t\t\t\t\t<StatForm editor={editor} set={this.editor.sets[this.innerFocus.setIndex]} onChange={this.handleSetChange} />\r\n\t\t\t\t\t\t) : this.innerFocus.type === 'details' ? (\r\n\t\t\t\t\t\t\t<DetailsForm editor={editor} set={this.editor.sets[this.innerFocus.setIndex]} onChange={this.handleSetChange} />\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<PSSearchResults\r\n\t\t\t\t\t\t\t\tsearch={editor.search} resultIndex={editor.searchIndex}\r\n\t\t\t\t\t\t\t\twindowing={this.windowResults()} onSelect={this.selectResult}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nclass TeamWizard extends preact.Component<{\r\n\teditor: TeamEditorState, onChange?: () => void, onUpdate: () => void,\r\n}> {\r\n\tsetSearchBox: string | null = null;\r\n\twindowing = true;\r\n\tsetFocus = (ev: Event) => {\r\n\t\tconst { editor } = this.props;\r\n\t\tif (editor.readonly) return;\r\n\t\tconst target = ev.currentTarget as HTMLButtonElement;\r\n\t\tconst [rawType, i] = (target.value || '').split('|');\r\n\t\tconst setIndex = parseInt(i);\r\n\t\tconst type = rawType as SelectionType;\r\n\t\tif (!target.value || editor.innerFocus && editor.innerFocus.setIndex === setIndex && editor.innerFocus.type === type) {\r\n\t\t\tthis.changeFocus(null);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.changeFocus({\r\n\t\t\tsetIndex,\r\n\t\t\ttype,\r\n\t\t});\r\n\t};\r\n\tdeleteSet = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLButtonElement;\r\n\t\tconst i = parseInt(target.value);\r\n\t\tconst { editor } = this.props;\r\n\t\teditor.deleteSet(i);\r\n\t\tif (editor.innerFocus) {\r\n\t\t\tthis.changeFocus({\r\n\t\t\t\tsetIndex: editor.sets.length,\r\n\t\t\t\ttype: 'pokemon',\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.handleSetChange();\r\n\t\tev.preventDefault();\r\n\t};\r\n\tundeleteSet = (ev: Event) => {\r\n\t\tconst { editor } = this.props;\r\n\t\tconst setIndex = editor.deletedSet?.index;\r\n\t\teditor.undeleteSet();\r\n\t\tif (editor.innerFocus && setIndex !== undefined) {\r\n\t\t\tthis.changeFocus({\r\n\t\t\t\tsetIndex,\r\n\t\t\t\ttype: 'pokemon',\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.handleSetChange();\r\n\t\tev.preventDefault();\r\n\t};\r\n\tchangeFocus(focus: TeamEditorState['innerFocus']) {\r\n\t\tconst { editor } = this.props;\r\n\t\teditor.innerFocus = focus;\r\n\t\tif (!focus) {\r\n\t\t\tthis.props.onUpdate();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst set = editor.sets[focus.setIndex];\r\n\t\tif (focus.type === 'details') {\r\n\t\t\tthis.setSearchBox = set.name || '';\r\n\t\t} else if (focus.type !== 'stats') {\r\n\t\t\tlet value;\r\n\t\t\tif (focus.type === 'pokemon') value = set?.species || '';\r\n\t\t\telse if (focus.type === 'item') value = set.item;\r\n\t\t\telse if (focus.type === 'ability') value = set.ability;\r\n\t\t\teditor.setSearchType(focus.type, focus.setIndex, value);\r\n\t\t\tthis.resetScroll();\r\n\t\t\tthis.setSearchBox = value || '';\r\n\t\t}\r\n\t\tthis.props.onUpdate();\r\n\t}\r\n\trenderSet(set: Dex.PokemonSet | undefined, i: number) {\r\n\t\tconst { editor } = this.props;\r\n\t\tconst sprite = Dex.getTeambuilderSprite(set, editor.dex);\r\n\t\tif (!set) {\r\n\t\t\treturn <div class=\"set-button\">\r\n\t\t\t\t<div style=\"text-align:right\">\r\n\t\t\t\t\t{editor.deletedSet ? (\r\n\t\t\t\t\t\t<button onClick={this.undeleteSet} class=\"option\"><i class=\"fa fa-undo\" aria-hidden></i> Undo delete</button>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<button class=\"option\" style=\"visibility:hidden\"><i class=\"fa fa-trash\" aria-hidden></i> Delete</button>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t\t<table>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td rowSpan={2} class=\"set-pokemon\"><div class=\"border-collapse\">\r\n\t\t\t\t\t\t\t<button class=\"button button-first cur\" onClick={this.setFocus} value={`pokemon|${i}`}>\r\n\t\t\t\t\t\t\t\t<span class=\"sprite\" style={sprite}><span class=\"sprite-inner\">\r\n\t\t\t\t\t\t\t\t\t<strong class=\"label\">Pokemon</strong> {}\r\n\t\t\t\t\t\t\t\t\t<em>(choose species)</em>\r\n\t\t\t\t\t\t\t\t</span></span>\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div></td>\r\n\t\t\t\t\t\t<td colSpan={2} class=\"set-details\"></td>\r\n\t\t\t\t\t\t<td rowSpan={2} class=\"set-moves\"></td>\r\n\t\t\t\t\t\t<td rowSpan={2} class=\"set-stats\"></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td class=\"set-ability\"></td>\r\n\t\t\t\t\t\t<td class=\"set-item\"></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\twhile (set.moves.length < 4) set.moves.push('');\r\n\t\tconst overfull = set.moves.length > 4 ? ' overfull' : '';\r\n\r\n\t\tconst cur = (t: SelectionType) => (\r\n\t\t\teditor.readonly || (editor.innerFocus?.type === t && editor.innerFocus.setIndex === i) ? ' cur' : ''\r\n\t\t);\r\n\t\tconst species = editor.dex.species.get(set.species);\r\n\t\treturn <div class=\"set-button\">\r\n\t\t\t<div style=\"text-align:right\">\r\n\t\t\t\t<button class=\"option\" onClick={this.deleteSet} value={i} style={editor.readonly ? \"visibility:hidden\" : \"\"}>\r\n\t\t\t\t\t<i class=\"fa fa-trash\" aria-hidden></i> Delete\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t\t<table>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td rowSpan={2} class=\"set-pokemon\"><div class=\"border-collapse\">\r\n\t\t\t\t\t\t<button class={`button button-first${cur('pokemon')}`} onClick={this.setFocus} value={`pokemon|${i}`}>\r\n\t\t\t\t\t\t\t<span class=\"sprite\" style={sprite}><span class=\"sprite-inner\">\r\n\t\t\t\t\t\t\t\t<strong class=\"label\">Pokemon</strong> {}\r\n\t\t\t\t\t\t\t\t{set.species}\r\n\t\t\t\t\t\t\t</span></span>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div></td>\r\n\t\t\t\t\t<td colSpan={2} class=\"set-details\"><div class=\"border-collapse\">\r\n\t\t\t\t\t\t<button class={`button button-middle${cur('details')}`} onClick={this.setFocus} value={`details|${i}`}>\r\n\t\t\t\t\t\t\t<span class=\"detailcell\">\r\n\t\t\t\t\t\t\t\t<strong class=\"label\">Types</strong> {}\r\n\t\t\t\t\t\t\t\t{species.types.map(type => <div>{TeamEditor.renderTypeIcon(type)}</div>)}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<span class=\"detailcell\">\r\n\t\t\t\t\t\t\t\t<strong class=\"label\">Level</strong> {}\r\n\t\t\t\t\t\t\t\t{set.level || editor.defaultLevel}\r\n\t\t\t\t\t\t\t\t{editor.narrow && set.shiny && <><br />\r\n\t\t\t\t\t\t\t\t\t<img src={`${Dex.resourcePrefix}sprites/misc/shiny.png`} width={22} height={22} alt=\"Shiny\" />\r\n\t\t\t\t\t\t\t\t</>}\r\n\t\t\t\t\t\t\t\t{!editor.narrow && set.gender && set.gender !== 'N' && <>\r\n\t\t\t\t\t\t\t\t\t<br /><img\r\n\t\t\t\t\t\t\t\t\t\tsrc={`${Dex.fxPrefix}gender-${set.gender.toLowerCase()}.png`} alt={set.gender} width=\"7\" height=\"10\" class=\"pixelated\"\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</>}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t{!!(!editor.narrow && (set.shiny || editor.gen >= 2)) && <span class=\"detailcell\">\r\n\t\t\t\t\t\t\t\t<strong class=\"label\">Shiny</strong> {}\r\n\t\t\t\t\t\t\t\t{set.shiny ? <img src={`${Dex.resourcePrefix}sprites/misc/shiny.png`} width={22} height={22} alt=\"Yes\" /> : '\\u2014'}\r\n\t\t\t\t\t\t\t</span>}\r\n\t\t\t\t\t\t\t{editor.gen === 9 && <span class=\"detailcell\">\r\n\t\t\t\t\t\t\t\t<strong class=\"label\">Tera</strong> {}\r\n\t\t\t\t\t\t\t\t{TeamEditor.renderTypeIcon(set.teraType || species.requiredTeraType || species.types[0])}\r\n\t\t\t\t\t\t\t</span>}\r\n\t\t\t\t\t\t\t{editor.hpTypeMatters(set) && <span class=\"detailcell\">\r\n\t\t\t\t\t\t\t\t<strong class=\"label\">H.P.</strong> {}\r\n\t\t\t\t\t\t\t\t{TeamEditor.renderTypeIcon(editor.getHPType(set))}\r\n\t\t\t\t\t\t\t</span>}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div></td>\r\n\t\t\t\t\t<td rowSpan={2} class=\"set-moves\"><div class=\"border-collapse\">\r\n\t\t\t\t\t\t<button class={`button button-middle${cur('move')}${overfull}`} onClick={this.setFocus} value={`move|${i}`}>\r\n\t\t\t\t\t\t\t<strong class=\"label\">Moves</strong> {}\r\n\t\t\t\t\t\t\t{set.moves.map((move, mi) => <div>\r\n\t\t\t\t\t\t\t\t{!editor.narrow && <small class=\"gray\">&bull;</small>}\r\n\t\t\t\t\t\t\t\t{mi >= 4 ? <span class=\"message-error\">{move || (editor.narrow && '-') || ''}</span> : move || (editor.narrow && '-')}\r\n\t\t\t\t\t\t\t</div>)}\r\n\t\t\t\t\t\t\t{!set.moves.length && <em>(no moves)</em>}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div></td>\r\n\t\t\t\t\t<td rowSpan={2} class=\"set-stats\"><div class=\"border-collapse\">\r\n\t\t\t\t\t\t<button class={`button button-last${cur('stats')}`} onClick={this.setFocus} value={`stats|${i}`}>\r\n\t\t\t\t\t\t\t{StatForm.renderStatGraph(set, this.props.editor, true)}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div></td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td class=\"set-ability\"><div class=\"border-collapse\">\r\n\t\t\t\t\t\t<button class={`button button-middle${cur('ability')}`} onClick={this.setFocus} value={`ability|${i}`}>\r\n\t\t\t\t\t\t\t{(editor.gen >= 3 || set.ability) && <>\r\n\t\t\t\t\t\t\t\t<strong class=\"label\">Ability</strong> {}\r\n\t\t\t\t\t\t\t\t{(set.ability !== 'No Ability' && set.ability) ||\r\n\t\t\t\t\t\t\t\t\t(!set.ability ? <em>(choose ability)</em> : <em>(no ability)</em>)}\r\n\t\t\t\t\t\t\t</>}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div></td>\r\n\t\t\t\t\t<td class=\"set-item\"><div class=\"border-collapse\">\r\n\t\t\t\t\t\t<button class={`button button-middle${cur('item')}`} onClick={this.setFocus} value={`item|${i}`}>\r\n\t\t\t\t\t\t\t{(editor.gen >= 2 || set.item) && <>\r\n\t\t\t\t\t\t\t\t{set.item && <span class=\"itemicon\" style={'float:right;' + Dex.getItemIcon(set.item)}></span>}\r\n\t\t\t\t\t\t\t\t<strong class=\"label\">Item</strong> {}\r\n\t\t\t\t\t\t\t\t{set.item || <em>(no item)</em>}\r\n\t\t\t\t\t\t\t</>}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div></td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t\t<button class={`button set-nickname${cur('details')}`} onClick={this.setFocus} value={`details|${i}`}>\r\n\t\t\t\t<strong class=\"label\">Nickname</strong> {}\r\n\t\t\t\t{editor.getNickname(set)}\r\n\t\t\t</button>\r\n\t\t</div>;\r\n\t}\r\n\thandleSetChange = () => {\r\n\t\tthis.props.editor.save();\r\n\t\tthis.props.onChange?.();\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\tclearSearchBox() {\r\n\t\tconst searchBox = this.base!.querySelector<HTMLInputElement>('input[name=value]');\r\n\t\tif (searchBox) {\r\n\t\t\tsearchBox.value = '';\r\n\t\t\tif (!TeamEditor.probablyMobile()) searchBox.focus();\r\n\t\t}\r\n\t}\r\n\tselectResult = (type: string | null, name: string, slot?: string, reverse?: boolean) => {\r\n\t\tconst { editor } = this.props;\r\n\t\tthis.clearSearchBox();\r\n\t\tif (type === null) {\r\n\t\t\tthis.resetScroll();\r\n\t\t\tthis.forceUpdate();\r\n\t\t} if (!type) {\r\n\t\t\teditor.setSearchValue('');\r\n\t\t\tthis.resetScroll();\r\n\t\t\tthis.forceUpdate();\r\n\t\t} else {\r\n\t\t\tconst setIndex = editor.innerFocus!.setIndex;\r\n\t\t\tconst set = (editor.sets[setIndex] ||= { species: '', moves: [] });\r\n\t\t\tswitch (type) {\r\n\t\t\tcase 'pokemon':\r\n\t\t\t\teditor.changeSpecies(set, name);\r\n\t\t\t\tthis.changeFocus({\r\n\t\t\t\t\tsetIndex,\r\n\t\t\t\t\ttype: reverse ? 'details' : 'ability',\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'ability':\r\n\t\t\t\tif (name === 'No Ability' && editor.gen <= 2) name = '';\r\n\t\t\t\tset.ability = name;\r\n\t\t\t\tthis.changeFocus({\r\n\t\t\t\t\tsetIndex,\r\n\t\t\t\t\ttype: reverse ? 'pokemon' : 'item',\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'item':\r\n\t\t\t\tset.item = name;\r\n\t\t\t\tthis.changeFocus({\r\n\t\t\t\t\tsetIndex,\r\n\t\t\t\t\ttype: reverse ? 'ability' : 'move',\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'move':\r\n\t\t\t\tif (slot) {\r\n\t\t\t\t\t// intentional; we're _removing_ from the slot\r\n\t\t\t\t\tconst i = parseInt(slot) - 1;\r\n\t\t\t\t\tif (set.moves[i]) {\r\n\t\t\t\t\t\tset.moves[i] = '';\r\n\t\t\t\t\t\t// remove empty slots at the end\r\n\t\t\t\t\t\tif (i === set.moves.length - 1) {\r\n\t\t\t\t\t\t\twhile (set.moves.length > 4 && !set.moves[set.moves.length - 1]) {\r\n\t\t\t\t\t\t\t\tset.moves.pop();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// if we have more than 4 moves, move the last move into the newly-cleared slot\r\n\t\t\t\t\t\tif (set.moves.length > 4 && i < set.moves.length - 1) {\r\n\t\t\t\t\t\t\tset.moves[i] = set.moves.pop()!;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (set.moves.includes(name)) {\r\n\t\t\t\t\tset.moves.splice(set.moves.indexOf(name), 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (let i = 0; i < set.moves.length + 1; i++) {\r\n\t\t\t\t\t\tif (!set.moves[i]) {\r\n\t\t\t\t\t\t\tset.moves[i] = name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (set.moves.length === 4 && set.moves.every(Boolean)) {\r\n\t\t\t\t\tthis.changeFocus({\r\n\t\t\t\t\t\tsetIndex,\r\n\t\t\t\t\t\ttype: reverse ? 'item' : 'stats',\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (editor.search.query) {\r\n\t\t\t\t\t\tthis.resetScroll();\r\n\t\t\t\t\t}\r\n\t\t\t\t\teditor.updateSearchMoves(set);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\teditor.save();\r\n\t\t\tthis.props.onChange?.();\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\t};\r\n\tupdateSearch = (ev: Event) => {\r\n\t\tconst searchBox = ev.currentTarget as HTMLInputElement;\r\n\t\tthis.props.editor.setSearchValue(searchBox.value);\r\n\t\tthis.resetScroll();\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\thandleClickFilters = (ev: Event) => {\r\n\t\tconst search = this.props.editor.search;\r\n\t\tlet target = ev.target as HTMLElement | null;\r\n\t\twhile (target && target.className !== 'dexlist') {\r\n\t\t\tif (target.tagName === 'BUTTON') {\r\n\t\t\t\tconst filter = target.getAttribute('data-filter');\r\n\t\t\t\tif (filter) {\r\n\t\t\t\t\tsearch.removeFilter(filter.split(':') as any);\r\n\t\t\t\t\tconst searchBox = this.base!.querySelector<HTMLInputElement>('input[name=value]');\r\n\t\t\t\t\tsearch.find(searchBox?.value || '');\r\n\t\t\t\t\tif (!TeamEditor.probablyMobile()) searchBox?.select();\r\n\t\t\t\t\tthis.forceUpdate();\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tev.stopPropagation();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttarget = target.parentElement;\r\n\t\t}\r\n\t};\r\n\tkeyDownSearch = (ev: KeyboardEvent) => {\r\n\t\tconst searchBox = ev.currentTarget as HTMLInputElement;\r\n\t\tconst { editor } = this.props;\r\n\t\tswitch (ev.keyCode) {\r\n\t\tcase 8: // backspace\r\n\t\t\tif (searchBox.selectionStart === 0 && searchBox.selectionEnd === 0) {\r\n\t\t\t\teditor.search.removeFilter();\r\n\t\t\t\teditor.setSearchValue(searchBox.value);\r\n\t\t\t\tthis.resetScroll();\r\n\t\t\t\tthis.forceUpdate();\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 38: // up\r\n\t\t\teditor.upSearchValue();\r\n\t\t\tconst resultsUp = this.base!.querySelector('.wizardsearchresults');\r\n\t\t\tif (resultsUp) {\r\n\t\t\t\tresultsUp.scrollTop = Math.max(0, editor.searchIndex * 33 - Math.trunc((window.innerHeight - 300) / 2));\r\n\t\t\t}\r\n\t\t\tthis.forceUpdate();\r\n\t\t\tev.preventDefault();\r\n\t\t\tbreak;\r\n\t\tcase 40: // down\r\n\t\t\teditor.downSearchValue();\r\n\t\t\tconst resultsDown = this.base!.querySelector('.wizardsearchresults');\r\n\t\t\tif (resultsDown) {\r\n\t\t\t\tresultsDown.scrollTop = Math.max(0, editor.searchIndex * 33 - Math.trunc((window.innerHeight - 300) / 2));\r\n\t\t\t}\r\n\t\t\tthis.forceUpdate();\r\n\t\t\tev.preventDefault();\r\n\t\t\tbreak;\r\n\t\tcase 37: // left\r\n\t\t\t// prevent jumping to other rooms\r\n\t\t\tev.stopImmediatePropagation();\r\n\t\t\tbreak;\r\n\t\tcase 39: // right\r\n\t\t\t// prevent jumping to other rooms\r\n\t\t\tev.stopImmediatePropagation();\r\n\t\t\tbreak;\r\n\t\tcase 13: // enter\r\n\t\tcase 9: // tab\r\n\t\t\tconst value = editor.selectSearchValue();\r\n\t\t\tif (editor.innerFocus?.type !== 'move') searchBox.value = value || '';\r\n\t\t\tif (value !== null) {\r\n\t\t\t\tif (ev.keyCode === 9 && editor.innerFocus?.type === 'move') {\r\n\t\t\t\t\tthis.changeFocus({\r\n\t\t\t\t\t\tsetIndex: editor.innerFocus.setIndex,\r\n\t\t\t\t\t\ttype: ev.shiftKey ? 'item' : 'stats',\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst [name, moveSlot] = value.split('|');\r\n\t\t\t\t\tthis.selectResult(editor.innerFocus?.type || '', name, moveSlot, ev.keyCode === 9 && ev.shiftKey);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.clearSearchBox();\r\n\t\t\t\teditor.setSearchValue('');\r\n\t\t\t\tthis.resetScroll();\r\n\t\t\t\tthis.forceUpdate();\r\n\t\t\t}\r\n\t\t\tev.preventDefault();\r\n\t\t\tbreak;\r\n\t\t}\r\n\t};\r\n\tscrollResults = (ev: Event) => {\r\n\t\tif (!(ev.currentTarget as HTMLElement).scrollTop) return;\r\n\t\tthis.windowing = false;\r\n\t\tif (document.documentElement.clientWidth === document.documentElement.scrollWidth) {\r\n\t\t\t(ev.currentTarget as any).scrollIntoViewIfNeeded?.();\r\n\t\t}\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\tresetScroll() {\r\n\t\tthis.windowing = true;\r\n\t\tconst searchResults = this.base!.querySelector('.wizardsearchresults');\r\n\t\tif (searchResults) searchResults.scrollTop = 0;\r\n\t}\r\n\twindowResults() {\r\n\t\tif (this.windowing) {\r\n\t\t\treturn Math.ceil(window.innerHeight / 33);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\toverride componentDidUpdate() {\r\n\t\tconst searchBox = this.base!.querySelector<HTMLInputElement>('input[name=value], input[name=nickname]');\r\n\t\tif (this.setSearchBox !== null) {\r\n\t\t\tif (searchBox) {\r\n\t\t\t\tsearchBox.value = this.setSearchBox;\r\n\t\t\t\tif (!TeamEditor.probablyMobile()) searchBox.select();\r\n\t\t\t}\r\n\t\t\tthis.setSearchBox = null;\r\n\t\t}\r\n\t\tconst filters = this.base!.querySelector('.dexlist-filters');\r\n\t\tif (searchBox && searchBox.name === 'value') {\r\n\t\t\tif (filters) {\r\n\t\t\t\tconst { width } = filters.getBoundingClientRect();\r\n\t\t\t\tsearchBox.style.paddingLeft = `${width + 5}px`;\r\n\t\t\t} else {\r\n\t\t\t\tsearchBox.style.paddingLeft = `3px`;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\trenderInnerFocus() {\r\n\t\tconst { editor } = this.props;\r\n\t\tif (!editor.innerFocus) return null;\r\n\t\tconst { type, setIndex } = editor.innerFocus;\r\n\t\tconst set = this.props.editor.sets[setIndex] as Dex.PokemonSet | undefined;\r\n\t\tconst cur = (i: number) => setIndex === i ? ' cur' : '';\r\n\t\treturn <div class=\"team-focus-editor\">\r\n\t\t\t<ul class=\"tabbar\">\r\n\t\t\t\t<li class=\"home-li\"><button class=\"button\" onClick={this.setFocus}>\r\n\t\t\t\t\t<i class=\"fa fa-chevron-left\" aria-hidden></i> Back\r\n\t\t\t\t</button></li>\r\n\t\t\t\t{editor.sets.map((curSet, i) => <li><button\r\n\t\t\t\t\tclass={`button picontab${cur(i)}`} onClick={this.setFocus} value={`${type}|${i}`}\r\n\t\t\t\t>\r\n\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(curSet)}></span><br />\r\n\t\t\t\t\t{editor.getNickname(curSet)}\r\n\t\t\t\t</button></li>)}\r\n\t\t\t\t{editor.canAdd() && <li><button\r\n\t\t\t\t\tclass={`button picontab${cur(editor.sets.length)}`} onClick={this.setFocus} value={`pokemon|${editor.sets.length}`}\r\n\t\t\t\t>\r\n\t\t\t\t\t<i class=\"fa fa-plus\"></i>\r\n\t\t\t\t</button></li>}\r\n\t\t\t</ul>\r\n\t\t\t<div class=\"pad\" style=\"padding-top:0\">{this.renderSet(set, setIndex)}</div>\r\n\t\t\t{type === 'stats' ? (\r\n\t\t\t\t<StatForm editor={editor} set={set!} onChange={this.handleSetChange} />\r\n\t\t\t) : type === 'details' ? (\r\n\t\t\t\t<DetailsForm editor={editor} set={set!} onChange={this.handleSetChange} />\r\n\t\t\t) : (\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<div class=\"searchboxwrapper pad\" onClick={this.handleClickFilters}>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype=\"search\" name=\"value\" class=\"textbox\" placeholder=\"Search or filter\"\r\n\t\t\t\t\t\t\tonInput={this.updateSearch} onKeyDown={this.keyDownSearch} autocomplete=\"off\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t{PSSearchResults.renderFilters(editor.search)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"wizardsearchresults\" onScroll={this.scrollResults}><PSSearchResults\r\n\t\t\t\t\t\tsearch={editor.search} hideFilters resultIndex={editor.searchIndex}\r\n\t\t\t\t\t\tonSelect={this.selectResult} windowing={this.windowResults()}\r\n\t\t\t\t\t/></div>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>;\r\n\t}\r\n\toverride render() {\r\n\t\tconst { editor } = this.props;\r\n\t\tif (editor.innerFocus) return this.renderInnerFocus();\r\n\t\tif (editor.fetching) {\r\n\t\t\treturn <div class=\"teameditor\">Fetching Paste...</div>;\r\n\t\t}\r\n\r\n\t\tconst deletedSet = (i: number) => editor.deletedSet?.index === i ? <p style=\"text-align:right\">\r\n\t\t\t<button class=\"button\" onClick={this.undeleteSet}>\r\n\t\t\t\t<i class=\"fa fa-undo\" aria-hidden></i> Undo delete\r\n\t\t\t</button>\r\n\t\t</p> : null;\r\n\t\treturn <div class=\"teameditor\">\r\n\t\t\t{editor.sets.map((set, i) => [\r\n\t\t\t\tdeletedSet(i),\r\n\t\t\t\tthis.renderSet(set, i),\r\n\t\t\t])}\r\n\t\t\t{deletedSet(editor.sets.length)}\r\n\t\t\t{editor.canAdd() && <p><button class=\"button big\" onClick={this.setFocus} value={`pokemon|${editor.sets.length}`}>\r\n\t\t\t\t<i class=\"fa fa-plus\" aria-hidden></i> Add Pok&eacute;mon\r\n\t\t\t</button></p>}\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nclass StatForm extends preact.Component<{\r\n\teditor: TeamEditorState,\r\n\tset: Dex.PokemonSet,\r\n\tonChange: () => void,\r\n}> {\r\n\tstatic renderStatGraph(set: Dex.PokemonSet, editor: TeamEditorState, evs?: boolean) {\r\n\t\t// const supportsEVs = !team.format.includes('letsgo');\r\n\t\tconst defaultEV = (editor.gen > 2 ? 0 : 252);\r\n\t\tconst ivs = editor.getIVs(set);\r\n\t\treturn Dex.statNames.map(statID => {\r\n\t\t\tif (statID === 'spd' && editor.gen === 1) return null;\r\n\r\n\t\t\tconst stat = editor.getStat(statID, set, ivs[statID]);\r\n\t\t\tlet ev: number | string = set.evs?.[statID] ?? defaultEV;\r\n\t\t\tlet width = stat * 75 / 504;\r\n\t\t\tif (statID === 'hp') width = stat * 75 / 704;\r\n\t\t\tif (width > 75) width = 75;\r\n\t\t\tlet hue = Math.floor(stat * 180 / 714);\r\n\t\t\tif (hue > 360) hue = 360;\r\n\t\t\tconst statName = editor.gen === 1 && statID === 'spa' ? 'Spc' : BattleStatNames[statID];\r\n\t\t\tif (evs && !ev && !set.evs && statID === 'hp') ev = 'EVs';\r\n\t\t\treturn <span class=\"statrow\">\r\n\t\t\t\t<label>{statName}</label> {}\r\n\t\t\t\t<span class=\"statgraph\">\r\n\t\t\t\t\t<span style={`width:${width}px;background:hsl(${hue},40%,75%);border-color:hsl(${hue},40%,45%)`}></span>\r\n\t\t\t\t</span> {}\r\n\t\t\t\t{!evs && <em>{stat}</em>}\r\n\t\t\t\t{evs && <em>{ev || ''}</em>}\r\n\t\t\t\t{evs && (BattleNatures[set.nature!]?.plus === statID ? (\r\n\t\t\t\t\t<small>+</small>\r\n\t\t\t\t) : BattleNatures[set.nature!]?.minus === statID ? (\r\n\t\t\t\t\t<small>&minus;</small>\r\n\t\t\t\t) : null)}\r\n\t\t\t</span>;\r\n\t\t});\r\n\t}\r\n\trenderIVMenu() {\r\n\t\tconst { editor, set } = this.props;\r\n\t\tif (editor.gen <= 2) return null;\r\n\r\n\t\tconst hpType = editor.getHPMove(set);\r\n\t\tconst hpIVdata = hpType && !editor.canHyperTrain(set) && editor.getHPIVs(hpType) || null;\r\n\t\tconst autoSpread = set.ivs && editor.defaultIVs(set, false);\r\n\t\tconst autoSpreadValue = autoSpread && Object.values(autoSpread).join('/');\r\n\t\tif (!hpIVdata) {\r\n\t\t\treturn <select name=\"ivspread\" class=\"button\" onChange={this.changeIVSpread}>\r\n\t\t\t\t<option value=\"\" selected>IV spreads</option>\r\n\t\t\t\t{autoSpreadValue && <option value=\"auto\">Auto ({autoSpreadValue})</option>}\r\n\t\t\t\t<optgroup label=\"min Atk\">\r\n\t\t\t\t\t<option value=\"31/0/31/31/31/31\">31/0/31/31/31/31</option>\r\n\t\t\t\t</optgroup>\r\n\t\t\t\t<optgroup label=\"min Atk, min Spe\">\r\n\t\t\t\t\t<option value=\"31/0/31/31/31/0\">31/0/31/31/31/0</option>\r\n\t\t\t\t</optgroup>\r\n\t\t\t\t<optgroup label=\"max all\">\r\n\t\t\t\t\t<option value=\"31/31/31/31/31/31\">31/31/31/31/31/31</option>\r\n\t\t\t\t</optgroup>\r\n\t\t\t\t<optgroup label=\"min Spe\">\r\n\t\t\t\t\t<option value=\"31/31/31/31/31/0\">31/31/31/31/31/0</option>\r\n\t\t\t\t</optgroup>\r\n\t\t\t</select>;\r\n\t\t}\r\n\t\tconst minStat = editor.gen >= 6 ? 0 : 2;\r\n\t\tconst hpIVs = hpIVdata.map(ivs => ivs.split('').map(iv => parseInt(iv)));\r\n\r\n\t\treturn <select name=\"ivspread\" class=\"button\" onChange={this.changeIVSpread}>\r\n\t\t\t<option value=\"\" selected>Hidden Power {hpType} IVs</option>\r\n\t\t\t{autoSpreadValue && <option value=\"auto\">Auto ({autoSpreadValue})</option>}\r\n\t\t\t<optgroup label=\"min Atk\">\r\n\t\t\t\t{hpIVs.map(ivs => {\r\n\t\t\t\t\tconst spread = ivs.map((iv, i) => (i === 1 ? minStat : 30) + iv).join('/');\r\n\t\t\t\t\treturn <option value={spread}>{spread}</option>;\r\n\t\t\t\t})}\r\n\t\t\t</optgroup>\r\n\t\t\t<optgroup label=\"min Atk, min Spe\">\r\n\t\t\t\t{hpIVs.map(ivs => {\r\n\t\t\t\t\tconst spread = ivs.map((iv, i) => (i === 5 || i === 1 ? minStat : 30) + iv).join('/');\r\n\t\t\t\t\treturn <option value={spread}>{spread}</option>;\r\n\t\t\t\t})}\r\n\t\t\t</optgroup>\r\n\t\t\t<optgroup label=\"max all\">\r\n\t\t\t\t{hpIVs.map(ivs => {\r\n\t\t\t\t\tconst spread = ivs.map(iv => 30 + iv).join('/');\r\n\t\t\t\t\treturn <option value={spread}>{spread}</option>;\r\n\t\t\t\t})}\r\n\t\t\t</optgroup>\r\n\t\t\t<optgroup label=\"min Spe\">\r\n\t\t\t\t{hpIVs.map(ivs => {\r\n\t\t\t\t\tconst spread = ivs.map((iv, i) => (i === 5 ? minStat : 30) + iv).join('/');\r\n\t\t\t\t\treturn <option value={spread}>{spread}</option>;\r\n\t\t\t\t})}\r\n\t\t\t</optgroup>\r\n\t\t</select>;\r\n\t}\r\n\tsmogdexLink(s: string) {\r\n\t\tconst { editor } = this.props;\r\n\t\tconst species = editor.dex.species.get(s);\r\n\t\tlet format: string = editor.format;\r\n\t\tlet smogdexid: string = toID(species.baseSpecies);\r\n\r\n\t\tif (species.id === 'meowstic') {\r\n\t\t\tsmogdexid = 'meowstic-m';\r\n\t\t} else if (species.forme) {\r\n\t\t\tswitch (species.baseSpecies) {\r\n\t\t\tcase 'Alcremie':\r\n\t\t\tcase 'Basculin':\r\n\t\t\tcase 'Burmy':\r\n\t\t\tcase 'Castform':\r\n\t\t\tcase 'Cherrim':\r\n\t\t\tcase 'Deerling':\r\n\t\t\tcase 'Flabebe':\r\n\t\t\tcase 'Floette':\r\n\t\t\tcase 'Florges':\r\n\t\t\tcase 'Furfrou':\r\n\t\t\tcase 'Gastrodon':\r\n\t\t\tcase 'Genesect':\r\n\t\t\tcase 'Keldeo':\r\n\t\t\tcase 'Mimikyu':\r\n\t\t\tcase 'Minior':\r\n\t\t\tcase 'Pikachu':\r\n\t\t\tcase 'Polteageist':\r\n\t\t\tcase 'Sawsbuck':\r\n\t\t\tcase 'Shellos':\r\n\t\t\tcase 'Sinistea':\r\n\t\t\tcase 'Tatsugiri':\r\n\t\t\tcase 'Vivillon':\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tsmogdexid += '-' + toID(species.forme);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet generationNumber = 9;\r\n\t\tif (format.startsWith('gen')) {\r\n\t\t\tlet number = parseInt(format.charAt(3), 10);\r\n\t\t\tif (1 <= number && number <= 8) {\r\n\t\t\t\tgenerationNumber = number;\r\n\t\t\t}\r\n\t\t\tformat = format.slice(4);\r\n\t\t}\r\n\t\tconst generation = ['rb', 'gs', 'rs', 'dp', 'bw', 'xy', 'sm', 'ss', 'sv'][generationNumber - 1];\r\n\t\tif (format === 'battlespotdoubles') {\r\n\t\t\tsmogdexid += '/vgc15';\r\n\t\t} else if (format === 'doublesou' || format === 'doublesuu') {\r\n\t\t\tsmogdexid += '/doubles';\r\n\t\t} else if (\r\n\t\t\tformat === 'ou' || format === 'uu' || format === 'ru' || format === 'nu' || format === 'pu' ||\r\n\t\t\tformat === 'lc' || format === 'monotype' || format === 'mixandmega' || format === 'nfe' ||\r\n\t\t\tformat === 'nationaldex' || format === 'stabmons' || format === '1v1' || format === 'almostanyability'\r\n\t\t) {\r\n\t\t\tsmogdexid += '/' + format;\r\n\t\t} else if (format === 'balancedhackmons') {\r\n\t\t\tsmogdexid += '/bh';\r\n\t\t} else if (format === 'anythinggoes') {\r\n\t\t\tsmogdexid += '/ag';\r\n\t\t} else if (format === 'nationaldexag') {\r\n\t\t\tsmogdexid += '/national-dex-ag';\r\n\t\t}\r\n\t\treturn `http://smogon.com/dex/${generation}/pokemon/${smogdexid}/`;\r\n\t}\r\n\thandleGuess = () => {\r\n\t\tconst { editor, set } = this.props;\r\n\t\tconst team = editor.team;\r\n\r\n\t\tconst guess = new BattleStatGuesser(team.format).guess(set);\r\n\t\tset.evs = guess.evs;\r\n\t\tthis.plus = guess.plusStat || null;\r\n\t\tthis.minus = guess.minusStat || null;\r\n\t\tthis.updateNatureFromPlusMinus();\r\n\t\tthis.props.onChange();\r\n\t};\r\n\thandleOptimize = () => {\r\n\t\tconst { editor, set } = this.props;\r\n\t\tconst team = editor.team;\r\n\r\n\t\tconst optimized = BattleStatOptimizer(set, team.format);\r\n\t\tif (!optimized) return;\r\n\r\n\t\tset.evs = optimized.evs;\r\n\t\tthis.plus = optimized.plus || null;\r\n\t\tthis.minus = optimized.minus || null;\r\n\t\tthis.props.onChange();\r\n\t};\r\n\trenderSpreadGuesser() {\r\n\t\tconst { editor, set } = this.props;\r\n\t\tconst team = editor.team;\r\n\r\n\t\tif (editor.gen < 3) {\r\n\t\t\treturn <p>\r\n\t\t\t\t(<a target=\"_blank\" href={this.smogdexLink(set.species)}>Smogon&nbsp;analysis</a>)\r\n\t\t\t</p>;\r\n\t\t}\r\n\r\n\t\tconst guess = new BattleStatGuesser(team.format).guess(set);\r\n\t\tconst role = guess.role;\r\n\r\n\t\tconst guessedEVs = guess.evs;\r\n\t\tconst guessedPlus = guess.plusStat || null;\r\n\t\tconst guessedMinus = guess.minusStat || null;\r\n\t\treturn <p class=\"suggested\">\r\n\t\t\t<small>Guessed spread: </small>\r\n\t\t\t{role === '?' ? (\r\n\t\t\t\t\"(Please choose 4 moves to get a guessed spread)\"\r\n\t\t\t) : (\r\n\t\t\t\t<button name=\"setStatFormGuesses\" class=\"button\" onClick={this.handleGuess}>{role}: {}\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tDex.statNames.map(statID => guessedEVs[statID] ? `${guessedEVs[statID]} ${BattleStatNames[statID]}` : null)\r\n\t\t\t\t\t\t\t.filter(Boolean).join(' / ')\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{!!(guessedPlus && guessedMinus) && (\r\n\t\t\t\t\t\t` (+${BattleStatNames[guessedPlus]}, -${BattleStatNames[guessedMinus]})`\r\n\t\t\t\t\t)}\r\n\t\t\t\t</button>\r\n\t\t\t)}\r\n\t\t\t<small> (<a target=\"_blank\" href={this.smogdexLink(set.species)}>Smogon&nbsp;analysis</a>)</small>\r\n\t\t\t{/* <small>\r\n\t\t\t\t({role} | bulk: phys {Math.round(guess.moveCount.physicalBulk / 1000)}\r\n\t\t\t\t{} + spec {Math.round(guess.moveCount.specialBulk / 1000)}\r\n\t\t\t\t{} = {Math.round(guess.moveCount.bulk / 1000)})\r\n\t\t\t</small> */}\r\n\t\t</p>;\r\n\t}\r\n\trenderStatOptimizer() {\r\n\t\tconst optimized = BattleStatOptimizer(this.props.set, this.props.editor.format);\r\n\t\tif (!optimized) return null;\r\n\r\n\t\treturn <p>\r\n\t\t\t<small><em>Protip:</em> Use a different nature to {\r\n\t\t\t\toptimized.savedEVs ?\r\n\t\t\t\t\t`save ${optimized.savedEVs} EVs` :\r\n\t\t\t\t\t'get higher stats'\r\n\t\t\t}: </small>\r\n\t\t\t<button name=\"setStatFormOptimization\" class=\"button\" onClick={this.handleOptimize}>\r\n\t\t\t\t{\r\n\t\t\t\t\tDex.statNames.map(statID => optimized.evs[statID] ? `${optimized.evs[statID]} ${BattleStatNames[statID]}` : null)\r\n\t\t\t\t\t\t.filter(Boolean).join(' / ')\r\n\t\t\t\t}\r\n\t\t\t\t{!!(optimized.plus && optimized.minus) && (\r\n\t\t\t\t\t` (+${BattleStatNames[optimized.plus]}, -${BattleStatNames[optimized.minus]})`\r\n\t\t\t\t)}\r\n\t\t\t</button>\r\n\t\t</p>;\r\n\t}\r\n\tsetInput(name: string, value: string) {\r\n\t\tconst evInput = this.base!.querySelector<HTMLInputElement>(`input[name=\"${name}\"]`);\r\n\t\tif (evInput) evInput.value = value;\r\n\t}\r\n\tupdate(init?: boolean) {\r\n\t\tconst { set } = this.props;\r\n\t\tconst nature = BattleNatures[set.nature!];\r\n\t\tconst skipID = !init ? this.base!.querySelector<HTMLInputElement>('input:focus')?.name : undefined;\r\n\t\tif (nature?.plus) {\r\n\t\t\tthis.plus = nature?.plus || null;\r\n\t\t\tthis.minus = nature?.minus || null;\r\n\t\t} else if (this.plus && this.minus) {\r\n\t\t\t// if only one of plus or minus is set, clearing Nature doesn't change them\r\n\t\t\tthis.plus = null;\r\n\t\t\tthis.minus = null;\r\n\t\t}\r\n\t\tfor (const statID of Dex.statNames) {\r\n\t\t\tconst ev = `${set.evs?.[statID] || ''}`;\r\n\t\t\tconst plusMinus = this.plus === statID ? '+' : this.minus === statID ? '-' : '';\r\n\t\t\tconst iv = this.ivToDv(set.ivs?.[statID]);\r\n\t\t\tif (skipID !== `ev-${statID}`) this.setInput(`ev-${statID}`, ev + plusMinus);\r\n\t\t\tif (skipID !== `iv-${statID}`) this.setInput(`iv-${statID}`, iv);\r\n\t\t}\r\n\t}\r\n\toverride componentDidMount(): void {\r\n\t\tthis.update(true);\r\n\t}\r\n\toverride componentDidUpdate(): void {\r\n\t\tthis.update();\r\n\t}\r\n\tplus: Dex.StatNameExceptHP | null = null;\r\n\tminus: Dex.StatNameExceptHP | null = null;\r\n\trenderStatbar(stat: number, statID: StatName) {\r\n\t\tlet width = stat * 180 / 504;\r\n\t\tif (statID === 'hp') width = Math.floor(stat * 180 / 704);\r\n\t\tif (width > 179) width = 179;\r\n\t\tlet hue = Math.floor(stat * 180 / 714);\r\n\t\tif (hue > 360) hue = 360;\r\n\t\treturn <span\r\n\t\t\tstyle={`width:${Math.floor(width)}px;background:hsl(${hue},85%,45%);border-color:hsl(${hue},85%,35%)`}\r\n\t\t></span>;\r\n\t}\r\n\tchangeEV = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tconst { set } = this.props;\r\n\t\tconst statID = target.name.split('-')[1] as Dex.StatName;\r\n\t\tlet value = Math.abs(parseInt(target.value));\r\n\r\n\t\tif (isNaN(value)) {\r\n\t\t\tif (set.evs) delete set.evs[statID];\r\n\t\t} else {\r\n\t\t\tset.evs ||= {};\r\n\t\t\tset.evs[statID] = value;\r\n\t\t}\r\n\r\n\t\tif (target.type === 'range') {\r\n\t\t\t// enforce limit\r\n\t\t\tconst maxEv = this.maxEVs();\r\n\t\t\tif (maxEv < 6 * 252) {\r\n\t\t\t\tlet totalEv = 0;\r\n\t\t\t\tfor (const curEv of Object.values(set.evs || {})) totalEv += curEv;\r\n\t\t\t\tif (totalEv > maxEv && totalEv - value <= maxEv) {\r\n\t\t\t\t\tset.evs![statID] = maxEv - (totalEv - value) - (maxEv % 4);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (target.value.includes('+')) {\r\n\t\t\t\tif (statID === 'hp') {\r\n\t\t\t\t\talert(\"Natures cannot raise or lower HP.\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.plus = statID;\r\n\t\t\t} else if (this.plus === statID) {\r\n\t\t\t\tthis.plus = null;\r\n\t\t\t}\r\n\t\t\tif (target.value.includes('-')) {\r\n\t\t\t\tif (statID === 'hp') {\r\n\t\t\t\t\talert(\"Natures cannot raise or lower HP.\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.minus = statID;\r\n\t\t\t} else if (this.minus === statID) {\r\n\t\t\t\tthis.minus = null;\r\n\t\t\t}\r\n\t\t\tthis.updateNatureFromPlusMinus();\r\n\t\t}\r\n\r\n\t\tthis.props.onChange();\r\n\t};\r\n\tupdateNatureFromPlusMinus = () => {\r\n\t\tconst { set } = this.props;\r\n\t\tif (!this.plus || !this.minus) {\r\n\t\t\tdelete set.nature;\r\n\t\t} else {\r\n\t\t\tfor (const i in BattleNatures) {\r\n\t\t\t\tif (BattleNatures[i as Dex.NatureName].plus === this.plus && BattleNatures[i as Dex.NatureName].minus === this.minus) {\r\n\t\t\t\t\tset.nature = i as Dex.NatureName;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t/** Converts DV/IV in a textbox to the value in set. */\r\n\tdvToIv(dvOrIvString?: string): number | null {\r\n\t\tconst dvOrIv = Number(dvOrIvString);\r\n\t\tif (isNaN(dvOrIv)) return null;\r\n\t\tconst useIVs = this.props.editor.gen > 2;\r\n\t\treturn useIVs ? dvOrIv : (dvOrIv === 15 ? 31 : dvOrIv * 2);\r\n\t}\r\n\t/** Converts set.iv value to a DV/IV for a text box. */\r\n\tivToDv(iv?: number | null): string {\r\n\t\tif (iv === null || iv === undefined) return '';\r\n\t\tconst useIVs = this.props.editor.gen > 2;\r\n\t\treturn `${useIVs ? iv : Math.trunc(iv / 2)}`;\r\n\t}\r\n\tchangeIV = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tconst { set } = this.props;\r\n\t\tconst statID = target.name.split('-')[1] as StatName;\r\n\t\tconst value = this.dvToIv(target.value);\r\n\t\tif (value === null) {\r\n\t\t\tif (set.ivs) {\r\n\t\t\t\tdelete set.ivs[statID];\r\n\t\t\t\tif (Object.values(set.ivs).every(iv => iv === undefined)) {\r\n\t\t\t\t\tset.ivs = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tset.ivs ||= { hp: 31, atk: 31, def: 31, spa: 31, spd: 31, spe: 31 };\r\n\t\t\tset.ivs[statID] = value;\r\n\t\t}\r\n\t\tthis.props.onChange();\r\n\t};\r\n\tchangeNature = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLSelectElement;\r\n\t\tconst { set } = this.props;\r\n\t\tconst nature = target.value as Dex.NatureName;\r\n\t\tif (nature === 'Serious') {\r\n\t\t\tdelete set.nature;\r\n\t\t} else {\r\n\t\t\tset.nature = nature;\r\n\t\t}\r\n\t\tthis.props.onChange();\r\n\t};\r\n\tchangeIVSpread = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLSelectElement;\r\n\t\tconst { set } = this.props;\r\n\t\tif (!target.value) return;\r\n\r\n\t\tif (target.value === 'auto') {\r\n\t\t\tset.ivs = undefined;\r\n\t\t} else {\r\n\t\t\tconst [hp, atk, def, spa, spd, spe] = target.value.split('/').map(Number);\r\n\t\t\tset.ivs = { hp, atk, def, spa, spd, spe };\r\n\t\t}\r\n\t\tthis.props.onChange();\r\n\t};\r\n\tmaxEVs() {\r\n\t\tconst team = this.props.editor.team;\r\n\t\tconst useEVs = !team.format.includes('letsgo');\r\n\t\treturn useEVs ? 510 : Infinity;\r\n\t}\r\n\toverride render() {\r\n\t\tconst { editor, set } = this.props;\r\n\t\tconst team = editor.team;\r\n\t\tconst species = editor.dex.species.get(set.species);\r\n\r\n\t\tconst baseStats = species.baseStats;\r\n\r\n\t\tconst nature = BattleNatures[set.nature || 'Serious'];\r\n\r\n\t\tconst useEVs = !team.format.includes('letsgo');\r\n\t\t// const useAVs = !useEVs && team.format.endsWith('norestrictions');\r\n\t\tconst maxEV = useEVs ? 252 : 200;\r\n\t\tconst stepEV = useEVs ? 4 : 1;\r\n\t\tconst defaultEV = useEVs && editor.gen <= 2 && !set.evs ? maxEV : 0;\r\n\t\tconst useIVs = editor.gen > 2;\r\n\r\n\t\t// label column\r\n\t\tconst statNames = {\r\n\t\t\thp: 'HP',\r\n\t\t\tatk: 'Attack',\r\n\t\t\tdef: 'Defense',\r\n\t\t\tspa: 'Sp. Atk.',\r\n\t\t\tspd: 'Sp. Def.',\r\n\t\t\tspe: 'Speed',\r\n\t\t};\r\n\t\tif (editor.gen === 1) statNames.spa = 'Special';\r\n\r\n\t\tconst ivs = editor.getIVs(set);\r\n\t\tconst stats = Dex.statNames.filter(statID => editor.gen > 1 || statID !== 'spd').map(statID => [\r\n\t\t\tstatID, statNames[statID], editor.getStat(statID, set, ivs[statID]),\r\n\t\t] as const);\r\n\r\n\t\tlet remaining = null;\r\n\t\tconst maxEv = this.maxEVs();\r\n\t\tif (maxEv < 6 * 252) {\r\n\t\t\tlet totalEv = 0;\r\n\t\t\tfor (const ev of Object.values(set.evs || {})) totalEv += ev;\r\n\t\t\tif (totalEv <= maxEv) {\r\n\t\t\t\tremaining = (totalEv > (maxEv - 2) ? 0 : (maxEv - 2) - totalEv);\r\n\t\t\t} else {\r\n\t\t\t\tremaining = maxEv - totalEv;\r\n\t\t\t}\r\n\t\t\tremaining ||= null;\r\n\t\t}\r\n\t\tconst defaultIVs = editor.defaultIVs(set);\r\n\r\n\t\treturn <div style=\"font-size:10pt\" role=\"dialog\" aria-label=\"Stats\">\r\n\t\t\t<div class=\"resultheader\"><h3>EVs, IVs, and Nature</h3></div>\r\n\t\t\t<div class=\"pad\">\r\n\t\t\t\t{this.renderSpreadGuesser()}\r\n\t\t\t\t<table>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<th>{/* Stat name */}</th>\r\n\t\t\t\t\t\t<th>Base</th>\r\n\t\t\t\t\t\t<th class=\"setstatbar\">{/* Stat bar */}</th>\r\n\t\t\t\t\t\t<th>{useEVs ? 'EVs' : 'AVs'}</th>\r\n\t\t\t\t\t\t<th>{/* EV slider */}</th>\r\n\t\t\t\t\t\t<th>{useIVs ? 'IVs' : 'DVs'}</th>\r\n\t\t\t\t\t\t<th>{/* Final stat */}</th>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t{stats.map(([statID, statName, stat]) => <tr>\r\n\t\t\t\t\t\t<th style=\"text-align:right;font-weight:normal\">{statName}</th>\r\n\t\t\t\t\t\t<td style=\"text-align:right\"><strong>{baseStats[statID]}</strong></td>\r\n\t\t\t\t\t\t<td class=\"setstatbar\">{this.renderStatbar(stat, statID)}</td>\r\n\t\t\t\t\t\t<td><input\r\n\t\t\t\t\t\t\tname={`ev-${statID}`} placeholder={`${defaultEV || ''}`}\r\n\t\t\t\t\t\t\ttype=\"text\" inputMode=\"numeric\" class=\"textbox default-placeholder\" style=\"width:40px\"\r\n\t\t\t\t\t\t\tonInput={this.changeEV} onChange={this.changeEV}\r\n\t\t\t\t\t\t/></td>\r\n\t\t\t\t\t\t<td><input\r\n\t\t\t\t\t\t\tname={`evslider-${statID}`} value={set.evs?.[statID] ?? defaultEV} min=\"0\" max={maxEV} step={stepEV}\r\n\t\t\t\t\t\t\ttype=\"range\" class=\"evslider\" tabIndex={-1} aria-hidden\r\n\t\t\t\t\t\t\tonInput={this.changeEV} onChange={this.changeEV}\r\n\t\t\t\t\t\t/></td>\r\n\t\t\t\t\t\t<td><input\r\n\t\t\t\t\t\t\tname={`iv-${statID}`} min={0} max={useIVs ? 31 : 15} placeholder={`${defaultIVs[statID]}`} style=\"width:40px\"\r\n\t\t\t\t\t\t\ttype=\"number\" inputMode=\"numeric\" class=\"textbox default-placeholder\" onInput={this.changeIV} onChange={this.changeIV}\r\n\t\t\t\t\t\t/></td>\r\n\t\t\t\t\t\t<td style=\"text-align:right\"><strong>{stat}</strong></td>\r\n\t\t\t\t\t</tr>)}\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td colSpan={2}></td>\r\n\t\t\t\t\t\t<td class=\"setstatbar\" style=\"text-align:right\">{remaining !== null ? 'Remaining:' : ''}</td>\r\n\t\t\t\t\t\t<td style=\"text-align:center\">{remaining && remaining < 0 ? <b class=\"message-error\">{remaining}</b> : remaining}</td>\r\n\t\t\t\t\t\t<td colSpan={3} style=\"text-align:right\">{this.renderIVMenu()}</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t\t{editor.gen >= 3 && <p>\r\n\t\t\t\t\tNature: <select name=\"nature\" class=\"button\" onChange={this.changeNature}>\r\n\t\t\t\t\t\t{Object.entries(BattleNatures).map(([natureName, curNature]) => (\r\n\t\t\t\t\t\t\t<option value={natureName} selected={curNature === nature}>\r\n\t\t\t\t\t\t\t\t{natureName}\r\n\t\t\t\t\t\t\t\t{curNature.plus && ` (+${BattleStatNames[curNature.plus]}, -${BattleStatNames[curNature.minus!]})`}\r\n\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</p>}\r\n\t\t\t\t{editor.gen >= 3 && <p>\r\n\t\t\t\t\t<small><em>Protip:</em> You can also set natures by typing <kbd>+</kbd> and <kbd>-</kbd> in the EV box.</small>\r\n\t\t\t\t</p>}\r\n\t\t\t\t{editor.gen >= 3 && this.renderStatOptimizer()}\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nclass DetailsForm extends preact.Component<{\r\n\teditor: TeamEditorState,\r\n\tset: Dex.PokemonSet,\r\n\tonChange: () => void,\r\n}> {\r\n\tupdate(init?: boolean) {\r\n\t\tconst { set } = this.props;\r\n\t\tconst skipID = !init ? this.base!.querySelector<HTMLInputElement>('input:focus')?.name : undefined;\r\n\r\n\t\tconst nickname = this.base!.querySelector<HTMLInputElement>('input[name=\"nickname\"]');\r\n\t\tif (nickname && skipID !== 'nickname') nickname.value = set.name || '';\r\n\t}\r\n\toverride componentDidMount(): void {\r\n\t\tthis.update(true);\r\n\t}\r\n\toverride componentDidUpdate(): void {\r\n\t\tthis.update();\r\n\t}\r\n\tchangeNickname = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tconst { set } = this.props;\r\n\t\tif (target.value) {\r\n\t\t\tset.name = target.value.trim();\r\n\t\t} else {\r\n\t\t\tdelete set.name;\r\n\t\t}\r\n\t\tthis.props.onChange();\r\n\t};\r\n\tchangeTera = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tconst { editor, set } = this.props;\r\n\t\tconst species = editor.dex.species.get(set.species);\r\n\t\tif (!target.value || target.value === (species.requiredTeraType || species.types[0])) {\r\n\t\t\tdelete set.teraType;\r\n\t\t} else {\r\n\t\t\tset.teraType = target.value.trim();\r\n\t\t}\r\n\t\tthis.props.onChange();\r\n\t};\r\n\tchangeLevel = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tconst { set } = this.props;\r\n\t\tif (target.value) {\r\n\t\t\tset.level = parseInt(target.value.trim());\r\n\t\t} else {\r\n\t\t\tdelete set.level;\r\n\t\t}\r\n\t\tthis.props.onChange();\r\n\t};\r\n\tchangeGender = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tconst { set } = this.props;\r\n\t\tif (target.value) {\r\n\t\t\tset.gender = target.value.trim();\r\n\t\t} else {\r\n\t\t\tdelete set.gender;\r\n\t\t}\r\n\t\tthis.props.onChange();\r\n\t};\r\n\tchangeHappiness = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tconst { set } = this.props;\r\n\t\tif (target.value) {\r\n\t\t\tset.happiness = parseInt(target.value.trim());\r\n\t\t} else {\r\n\t\t\tdelete set.happiness;\r\n\t\t}\r\n\t\tthis.props.onChange();\r\n\t};\r\n\tchangeShiny = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tconst { set } = this.props;\r\n\t\tif (target.value) {\r\n\t\t\tset.shiny = true;\r\n\t\t} else {\r\n\t\t\tdelete set.shiny;\r\n\t\t}\r\n\t\tthis.props.onChange();\r\n\t};\r\n\tchangeDynamaxLevel = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tconst { set } = this.props;\r\n\t\tif (target.value) {\r\n\t\t\tset.dynamaxLevel = parseInt(target.value.trim());\r\n\t\t} else {\r\n\t\t\tdelete set.dynamaxLevel;\r\n\t\t}\r\n\t\tthis.props.onChange();\r\n\t};\r\n\tchangeGigantamax = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tconst { set } = this.props;\r\n\t\tif (target.checked) {\r\n\t\t\tset.gigantamax = true;\r\n\t\t} else {\r\n\t\t\tdelete set.gigantamax;\r\n\t\t}\r\n\t\tthis.props.onChange();\r\n\t};\r\n\tchangeHPType = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tconst { set } = this.props;\r\n\t\tif (target.value) {\r\n\t\t\tset.hpType = target.value;\r\n\t\t} else {\r\n\t\t\tdelete set.hpType;\r\n\t\t}\r\n\t\tthis.props.onChange();\r\n\t};\r\n\trenderGender(gender: Dex.GenderName) {\r\n\t\tconst genderTable = { 'M': \"Male\", 'F': \"Female\" };\r\n\t\tif (gender === 'N') return 'Unknown';\r\n\t\treturn <>\r\n\t\t\t<img src={`${Dex.fxPrefix}gender-${gender.toLowerCase()}.png`} alt=\"\" width=\"7\" height=\"10\" class=\"pixelated\" /> {}\r\n\t\t\t{genderTable[gender]}\r\n\t\t</>;\r\n\t}\r\n\trender() {\r\n\t\tconst { editor, set } = this.props;\r\n\t\tconst species = editor.dex.species.get(set.species);\r\n\t\treturn <div style=\"font-size:10pt\" role=\"dialog\" aria-label=\"Details\">\r\n\t\t\t<div class=\"resultheader\"><h3>Details</h3></div>\r\n\t\t\t<div class=\"pad\">\r\n\t\t\t\t<p><label class=\"label\">Nickname: <input\r\n\t\t\t\t\tname=\"nickname\" class=\"textbox default-placeholder\" placeholder={species.baseSpecies}\r\n\t\t\t\t\tonInput={this.changeNickname} onChange={this.changeNickname}\r\n\t\t\t\t/></label></p>\r\n\t\t\t\t<p><label class=\"label\">Level: <input\r\n\t\t\t\t\tname=\"level\" value={set.level ?? ''} placeholder={`${editor.defaultLevel}`}\r\n\t\t\t\t\ttype=\"number\" inputMode=\"numeric\" min=\"1\" max=\"100\" step=\"1\"\r\n\t\t\t\t\tclass=\"textbox inputform numform default-placeholder\" style=\"width: 50px\"\r\n\t\t\t\t\tonInput={this.changeLevel} onChange={this.changeLevel}\r\n\t\t\t\t/></label><small>(You probably want to change the team's levels by changing the format, not here)</small></p>\r\n\t\t\t\t{editor.gen > 1 && (<>\r\n\t\t\t\t\t<p><div class=\"label\">Shiny: <div class=\"labeled\">\r\n\t\t\t\t\t\t<label class=\"checkbox inline\"><input\r\n\t\t\t\t\t\t\ttype=\"radio\" name=\"shiny\" value=\"true\" checked={set.shiny}\r\n\t\t\t\t\t\t\tonInput={this.changeShiny} onChange={this.changeShiny}\r\n\t\t\t\t\t\t/> <img src={`${Dex.resourcePrefix}sprites/misc/shiny.png`} width={22} height={22} alt=\"Shiny\" /> Yes</label>\r\n\t\t\t\t\t\t<label class=\"checkbox inline\"><input\r\n\t\t\t\t\t\t\ttype=\"radio\" name=\"shiny\" value=\"\" checked={!set.shiny}\r\n\t\t\t\t\t\t\tonInput={this.changeShiny} onChange={this.changeShiny}\r\n\t\t\t\t\t\t/> No</label>\r\n\t\t\t\t\t</div></div></p>\r\n\t\t\t\t\t<p><div class=\"label\">Gender: {species.gender ? (\r\n\t\t\t\t\t\t<strong>{this.renderGender(species.gender)}</strong>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<div class=\"labeled\">\r\n\t\t\t\t\t\t\t<label class=\"checkbox inline\"><input\r\n\t\t\t\t\t\t\t\ttype=\"radio\" name=\"gender\" value=\"M\" checked={set.gender === 'M'}\r\n\t\t\t\t\t\t\t\tonInput={this.changeGender} onChange={this.changeGender}\r\n\t\t\t\t\t\t\t/> {this.renderGender('M')}</label>\r\n\t\t\t\t\t\t\t<label class=\"checkbox inline\"><input\r\n\t\t\t\t\t\t\t\ttype=\"radio\" name=\"gender\" value=\"F\" checked={set.gender === 'F'}\r\n\t\t\t\t\t\t\t\tonInput={this.changeGender} onChange={this.changeGender}\r\n\t\t\t\t\t\t\t/> {this.renderGender('F')}</label>\r\n\t\t\t\t\t\t\t<label class=\"checkbox inline\"><input\r\n\t\t\t\t\t\t\t\ttype=\"radio\" name=\"gender\" value=\"\" checked={!set.gender || set.gender === 'N'}\r\n\t\t\t\t\t\t\t\tonInput={this.changeGender} onChange={this.changeGender}\r\n\t\t\t\t\t\t\t/> Random</label>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}</div></p>\r\n\t\t\t\t\t{editor.isLetsGo ? (\r\n\t\t\t\t\t\t<p><label class=\"label\">Happiness: <input\r\n\t\t\t\t\t\t\tname=\"happiness\" value=\"\" placeholder=\"70\"\r\n\t\t\t\t\t\t\ttype=\"number\" inputMode=\"numeric\"\r\n\t\t\t\t\t\t\tclass=\"textbox inputform numform default-placeholder\" style=\"width: 50px\"\r\n\t\t\t\t\t\t\tonInput={this.changeHappiness} onChange={this.changeHappiness}\r\n\t\t\t\t\t\t/></label></p>\r\n\t\t\t\t\t) : (editor.gen < 8 || editor.isNatDex) && (\r\n\t\t\t\t\t\t<p><label class=\"label\">Happiness: <input\r\n\t\t\t\t\t\t\tname=\"happiness\" value={set.happiness ?? ''} placeholder=\"255\"\r\n\t\t\t\t\t\t\ttype=\"number\" inputMode=\"numeric\" min=\"0\" max=\"255\" step=\"1\"\r\n\t\t\t\t\t\t\tclass=\"textbox inputform numform default-placeholder\" style=\"width: 50px\"\r\n\t\t\t\t\t\t\tonInput={this.changeHappiness} onChange={this.changeHappiness}\r\n\t\t\t\t\t\t/></label></p>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</>\r\n\t\t\t\t)}\r\n\t\t\t\t{editor.gen === 8 && !editor.isBDSP && !species.cannotDynamax && (\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\t<label class=\"label\" style=\"display:inline\">Dynamax Level: <input\r\n\t\t\t\t\t\t\tname=\"dynamaxlevel\" value={set.dynamaxLevel ?? ''} placeholder=\"10\"\r\n\t\t\t\t\t\t\ttype=\"number\" inputMode=\"numeric\" min=\"0\" max=\"10\" step=\"1\" class=\"textbox inputform numform default-placeholder\"\r\n\t\t\t\t\t\t\tonInput={this.changeDynamaxLevel} onChange={this.changeDynamaxLevel}\r\n\t\t\t\t\t\t/></label> {}\r\n\t\t\t\t\t\t{species.canGigantamax ? (\r\n\t\t\t\t\t\t\t<label class=\"checkbox inline\"><input\r\n\t\t\t\t\t\t\t\ttype=\"checkbox\" name=\"gigantamax\" value=\"true\" checked={set.gigantamax}\r\n\t\t\t\t\t\t\t\tonInput={this.changeGigantamax} onChange={this.changeGigantamax}\r\n\t\t\t\t\t\t\t/> Gigantamax</label>\r\n\t\t\t\t\t\t) : species.forme === 'Gmax' && (\r\n\t\t\t\t\t\t\t<label class=\"checkbox inline\"><input\r\n\t\t\t\t\t\t\t\ttype=\"checkbox\" checked disabled\r\n\t\t\t\t\t\t\t/> Gigantamax</label>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</p>\r\n\t\t\t\t)}\r\n\t\t\t\t{((!editor.isLetsGo && editor.gen === 7) || editor.isNatDex || species.baseSpecies === 'Unown') && <p>\r\n\t\t\t\t\t<label class=\"label\">Hidden Power Type: <select name=\"hptype\" class=\"button\" onChange={this.changeHPType}>\r\n\t\t\t\t\t\t{Dex.types.all().map(type => (\r\n\t\t\t\t\t\t\ttype.HPivs && <option value={type.name} selected={editor.getHPType(set) === type.name}>\r\n\t\t\t\t\t\t\t\t{type.name}\r\n\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</select></label>\r\n\t\t\t\t</p>}\r\n\t\t\t\t{editor.gen === 9 && <p>\r\n\t\t\t\t\t<label class=\"label\" title=\"Tera Type\">\r\n\t\t\t\t\t\tTera Type: {}\r\n\t\t\t\t\t\t{species.requiredTeraType && editor.formeLegality === 'normal' ? (\r\n\t\t\t\t\t\t\t<select name=\"teratype\" class=\"button cur\" disabled><option>{species.requiredTeraType}</option></select>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<select name=\"teratype\" class=\"button\" onChange={this.changeTera}>\r\n\t\t\t\t\t\t\t\t{Dex.types.all().map(type => (\r\n\t\t\t\t\t\t\t\t\t<option value={type.name} selected={(set.teraType || species.requiredTeraType || species.types[0]) === type.name}>\r\n\t\t\t\t\t\t\t\t\t\t{type.name}\r\n\t\t\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</label>\r\n\t\t\t\t</p>}\r\n\t\t\t\t{species.cosmeticFormes && <p>\r\n\t\t\t\t\t<button class=\"button\">\r\n\t\t\t\t\t\tChange sprite\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</p>}\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n"],"mappings":"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","ignoreList":[]}