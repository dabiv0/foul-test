{"version":3,"file":"panel-chat-tournament.js","names":["ChatTournament","_PSModel","room","_this","call","info","updates","boxVisible","selectedChallenge","joinLeave","_inheritsLoose","_proto","prototype","tryAdd","line","PS","prefs","tournaments","add","arrayToPhrase","array","finalSeparator","arguments","length","undefined","join","slice","handleJoinLeave","action","name","leave","messageId","Date","now","includes","splice","indexOf","push","message","tournamentName","format","generator","formatName","BattleLog","type","receiveLine","args","_this$info$teambuilde","_this2","data","notify","isJoined","cmd","toLowerCase","JSON","parse","buf","_i2","tournament","html","_templateObject","_taggedTemplateLiteralLoose","toRoomid","_templateObject2","isStarted","_templateObject3","hiddenBuf","_templateObject4","title","body","id","dismissNotification","teambuilderFormat","startsWith","Dex","loadedSpriteData","loadSpriteData","participants","_templateObject5","minutes","Math","round","parseInt","_templateObject6","seconds","floor","alert","_templateObject7","Object","assign","isActive","_info$challenges","challenges","_this$info$challenges","challenged","update","roomid","escapeHTML","result","split","endData","bracketData","log","bracketNode","document","createElement","style","position","addNode","preact","render","h","TournamentBracket","tour","abbreviated","_templateObject8","results","_templateObject9","appendError","sanitizeHTML","user","userid","PSModel","TournamentBox","_preact$Component","_this3","_len","Array","_key","apply","concat","subscription","acceptChallenge","ev","team","_tour$info$challenges","props","packedTeam","send","target","validate","toggleBoxVisibility","forceUpdate","_proto2","componentDidMount","_this4","subscribe","componentWillUnmount","unsubscribe","selectChallengeUser","tagName","selectedIndex","renderTournamentTools","_info$challenges2","_info$challengeBys","_info$challenges3","_info$challenges4","_info$challengeBys2","_info$challenges5","onClick","noMatches","challengeBys","challenging","TeamForm","teamFormat","hideFormat","onSubmit","onValidate","onChange","map","challenge","index","value","selected","left","Component","_preact$Component2","_this5","_len2","_key2","dragging","onMouseDown","elem","base","canScrollVertically","scrollHeight","clientHeight","canScrollHorizontally","scrollWidth","clientWidth","button","preventDefault","window","addEventListener","onMouseMove","onMouseUp","x","clientX","y","clientY","cursor","dx","dy","scrollLeft","scrollTop","removeEventListener","popOut","parentElem","currentTarget","stopImmediatePropagation","_proto3","renderTableBracket","tableContents","tableHeaders","rows","row","i","score","scores","sort","a","b","color","colSpan","cols","r","cell","state","href","componentDidUpdate","poppedOut","TournamentTreeBracket","_preact$Component3","_this6","_len3","_key3","d3Loader","_proto4","forEachTreeNode","node","callback","depth","children","_i4","_node$children2","child","cloneTree","_this7","clonedNode","generateTreeBracket","_this8","div","className","rootNode","users","innerHTML","d3","libsLoaded","then","newTree","highlightLink","highlightName","_node$children3","_node$children4","team1","team2","shouldHaveChildren","some","_child$children","_i6","_node$children6","_i8","_node$children8","_i10","_node$children10","numLeaves","hasLeafAtDepth","_node$children11","depthsWithLeaves","filter","Boolean","breadthCompression","maxBreadth","maxDepth","nodeSize","size","width","separationX","height","separationY","tree","layout","separation","_node$children12","nodes","links","layoutRoot","select","append","attr","diagonalLink","svg","diagonal","source","link","projection","selectAll","enter","classed","nodeGroup","each","outerElem","text","on","event","metaKey","ctrlKey","stopPropagation","getAttribute","rect","radius","textOffset","rect1","rect2","row1","row2","appendChild","shouldComponentUpdate","replaceChild","TourPopOutPanel","_PSRoomPanel","_proto5","_this$props$room$args","subscribeTo","_room$args","PSPanelWrapper","fullSize","PSRoomPanel","routes","location","noURL","addRoomType"],"sources":["../src/panel-chat-tournament.tsx"],"sourcesContent":["import preact from \"../js/lib/preact\";\r\nimport { Dex, toRoomid } from \"./battle-dex\";\r\nimport { BattleLog } from \"./battle-log\";\r\nimport { PSModel, type PSSubscription } from \"./client-core\";\r\nimport { PS, type RoomID, type Team } from \"./client-main\";\r\nimport { TeamForm } from \"./panel-mainmenu\";\r\nimport type { Args } from \"./battle-text-parser\";\r\nimport type { ChatRoom } from \"./panel-chat\";\r\n// we check window.d3 before using it, so d3 doesn't need to be loaded before this file\r\nimport * as d3 from 'd3';\r\nimport { PSPanelWrapper, PSRoomPanel } from \"./panels\";\r\n\r\ninterface TreeNode {\r\n\tchildren?: TreeNode[];\r\n}\r\ninterface TournamentTreeBracketNode extends TreeNode {\r\n\tparent?: TournamentTreeBracketNode;\r\n\tchildren?: TournamentTreeBracketNode[];\r\n\tx: number;\r\n\ty: number;\r\n\tstate: string;\r\n\tteam: string;\r\n\troom: string;\r\n\tresult: string;\r\n\tscore: [number, number];\r\n}\r\ninterface TournamentElimBracketNode extends TournamentTreeBracketNode {\r\n\tparent?: TournamentElimBracketNode;\r\n\tchildren?: TournamentElimBracketNode[];\r\n\tteam1: string;\r\n\tteam2: string;\r\n\thighlightLink?: boolean;\r\n\tabbreviated?: boolean;\r\n}\r\ninterface TournamentTreeBracketData {\r\n\ttype: 'tree';\r\n\tusers: string[];\r\n\trootNode: TournamentTreeBracketNode;\r\n}\r\ninterface TournamentTableBracketData {\r\n\ttype: 'table';\r\n\tusers: string[];\r\n\ttableContents: {\r\n\t\tstate: string,\r\n\t\troom: string,\r\n\t\tresult: string,\r\n\t\tscore: [number, number],\r\n\t}[][];\r\n\ttableHeaders: {\r\n\t\trows: string[],\r\n\t\tcols: string[],\r\n\t};\r\n\tscores: number[];\r\n}\r\ntype TournamentInfo = {\r\n\tformat?: string,\r\n\tteambuilderFormat?: string,\r\n\tgenerator?: string,\r\n\tisActive?: boolean,\r\n\tisJoined?: boolean,\r\n\tisStarted?: boolean,\r\n\tchallenging?: string | null,\r\n\tchallenged?: string | null,\r\n\tchallenges?: string[],\r\n\tchallengeBys?: string[],\r\n\tbracketData?: TournamentTreeBracketData | TournamentTableBracketData,\r\n};\r\nexport class ChatTournament extends PSModel {\r\n\tinfo: TournamentInfo = {};\r\n\tupdates: TournamentInfo = {};\r\n\troom: ChatRoom;\r\n\tboxVisible = false;\r\n\tselectedChallenge = 0;\r\n\tjoinLeave: { join: string[], leave: string[], messageId: string } | null = null;\r\n\tconstructor(room: ChatRoom) {\r\n\t\tsuper();\r\n\t\tthis.room = room;\r\n\t}\r\n\ttryAdd(line: string) {\r\n\t\tif (PS.prefs.tournaments === 'hide') return false;\r\n\t\tthis.room.add(line);\r\n\t\treturn true;\r\n\t}\r\n\tstatic arrayToPhrase(array: string[], finalSeparator = 'and') {\r\n\t\tif (array.length <= 1)\r\n\t\t\treturn array.join();\r\n\t\treturn `${array.slice(0, -1).join(\", \")} ${finalSeparator} ${array.slice(-1)[0]}`;\r\n\t}\r\n\thandleJoinLeave(action: 'join' | 'leave', name: string) {\r\n\t\tthis.joinLeave ||= {\r\n\t\t\tjoin: [],\r\n\t\t\tleave: [],\r\n\t\t\tmessageId: `joinleave-${Date.now()}`,\r\n\t\t};\r\n\t\tif (action === 'join' && this.joinLeave['leave'].includes(name)) {\r\n\t\t\tthis.joinLeave['leave'].splice(this.joinLeave['leave'].indexOf(name), 1);\r\n\t\t} else if (action === 'leave' && this.joinLeave['join'].includes(name)) {\r\n\t\t\tthis.joinLeave['join'].splice(this.joinLeave['join'].indexOf(name), 1);\r\n\t\t} else {\r\n\t\t\tthis.joinLeave[action].push(name);\r\n\t\t}\r\n\t\tif (!this.joinLeave[action].includes(name)) this.joinLeave[action].push(name);\r\n\t\tlet message = this.joinLeave['join'].length ?\r\n\t\t\tChatTournament.arrayToPhrase(this.joinLeave['join']) + ' joined the tournament' :\r\n\t\t\t'';\r\n\t\tif (this.joinLeave['join'].length && this.joinLeave['leave'].length) message += '; ';\r\n\t\tmessage += this.joinLeave['leave'].length ?\r\n\t\t\tChatTournament.arrayToPhrase(this.joinLeave['leave']) + ' left the tournament' :\r\n\t\t\t'';\r\n\r\n\t\tthis.tryAdd(`|uhtml|${this.joinLeave.messageId}|<div class=\"tournament-message-joinleave\">${message}.</div>`);\r\n\t}\r\n\ttournamentName() {\r\n\t\tif (!this.info.format || !this.info.generator) return \"\";\r\n\t\tconst formatName = BattleLog.formatName(this.info.format);\r\n\t\tconst type = this.info.generator;\r\n\t\treturn `${formatName} ${type} Tournament`;\r\n\t}\r\n\treceiveLine(args: Args) {\r\n\t\tconst data = args.slice(2);\r\n\t\tconst notify = PS.prefs.tournaments === 'notify' || (!PS.prefs.tournaments && this.info.isJoined);\r\n\t\tlet cmd = args[1].toLowerCase();\r\n\t\tif (args[0] === 'tournaments') {\r\n\t\t\tswitch (cmd) {\r\n\t\t\tcase 'info':\r\n\t\t\t\tconst tournaments = JSON.parse(data.join('|'));\r\n\t\t\t\tlet buf = `<div class=\"infobox tournaments-info\">`;\r\n\t\t\t\tif (tournaments.length <= 0) {\r\n\t\t\t\t\tbuf += `No tournaments are currently running.`;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbuf += `<ul>`;\r\n\t\t\t\t\tfor (const tournament of tournaments) {\r\n\t\t\t\t\t\tconst formatName = BattleLog.formatName(tournament.format);\r\n\t\t\t\t\t\tbuf += `<li>`;\r\n\t\t\t\t\t\tbuf += BattleLog.html`<a class=\"ilink\" href=\"${toRoomid(tournament.room)}\">${tournament.room}</a>`;\r\n\t\t\t\t\t\tbuf += BattleLog.html`: ${formatName} ${tournament.generator}${tournament.isStarted ? \" (Started)\" : \"\"}`;\r\n\t\t\t\t\t\tbuf += `</li>`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbuf += `</ul>`;\r\n\t\t\t\t}\r\n\t\t\t\tbuf += '</div>';\r\n\t\t\t\tthis.tryAdd(`|html|${buf}`);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else if (args[0] === 'tournament') {\r\n\t\t\tswitch (cmd) {\r\n\t\t\tcase 'create': {\r\n\t\t\t\tthis.info.format = args[2];\r\n\t\t\t\tthis.info.generator = args[3];\r\n\t\t\t\tconst formatName = BattleLog.formatName(args[2]);\r\n\t\t\t\tconst type = args[3];\r\n\t\t\t\tconst buf = BattleLog.html`<div class=\"tournament-message-create\">${this.tournamentName()} created.</div>`;\r\n\t\t\t\tif (!this.tryAdd(`|html|${buf}`)) {\r\n\t\t\t\t\tconst hiddenBuf = BattleLog.html`<div class=\"tournament-message-create\">${this.tournamentName()} created (and hidden).</div>`;\r\n\t\t\t\t\tthis.room.add(`|html|${hiddenBuf}`);\r\n\t\t\t\t}\r\n\t\t\t\tif (notify) {\r\n\t\t\t\t\tthis.room.notify({\r\n\t\t\t\t\t\ttitle: \"Tournament created\",\r\n\t\t\t\t\t\tbody: `Room: ${this.room.title}\\nFormat: ${formatName}\\nType: ${type}`,\r\n\t\t\t\t\t\tid: 'tournament-create',\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'join':\r\n\t\t\tcase 'leave': {\r\n\t\t\t\tthis.handleJoinLeave(cmd, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'replace': {\r\n\t\t\t\tthis.tryAdd(`||${args[3]} has joined the tournament, replacing ${args[4]}.`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'start':\r\n\t\t\t\tthis.room.dismissNotification('tournament-create');\r\n\t\t\t\tif (!this.info.isJoined) {\r\n\t\t\t\t\tthis.boxVisible = false;\r\n\t\t\t\t} else if (this.info.teambuilderFormat?.startsWith('gen5') && !Dex.loadedSpriteData['bw']) {\r\n\t\t\t\t\tDex.loadSpriteData('bw');\r\n\t\t\t\t}\r\n\t\t\t\tlet participants = data[0] ? ` (${data[0]} players)` : \"\";\r\n\t\t\t\tthis.room.add(`|html|<div class=\"tournament-message-start\">The tournament has started!${participants}</div>`);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'disqualify':\r\n\t\t\t\tthis.tryAdd(BattleLog.html`|html|<div class=\"tournament-message-disqualify\">${data[0]} has been disqualified from the tournament.</div>`);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'autodq':\r\n\t\t\t\tif (data[0] === 'off') {\r\n\t\t\t\t\tthis.tryAdd(`|html|<div class=\"tournament-message-autodq-off\">The tournament's automatic disqualify timer has been turned off.</div>`);\r\n\t\t\t\t} else if (data[0] === 'on') {\r\n\t\t\t\t\tlet minutes = Math.round(parseInt(data[1]) / 1000 / 60);\r\n\t\t\t\t\tthis.tryAdd(BattleLog.html`|html|<div class=\"tournament-message-autodq-on\">The tournament's automatic disqualify timer has been set to ${minutes} minute${minutes === 1 ? \"\" : \"s\"}.</div>`);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet seconds = Math.floor(parseInt(data[1]) / 1000);\r\n\t\t\t\t\tPS.alert(`Please respond to the tournament within ${seconds} seconds or you may be automatically disqualified.`);\r\n\t\t\t\t\tif (notify) {\r\n\t\t\t\t\t\tthis.room.notify({\r\n\t\t\t\t\t\t\ttitle: \"Tournament Automatic Disqualification Warning\",\r\n\t\t\t\t\t\t\tbody: `Room: ${this.room.title}\\nSeconds: ${seconds}`,\r\n\t\t\t\t\t\t\tid: 'tournament-autodq-warning',\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'autostart':\r\n\t\t\t\tif (data[0] === 'off') {\r\n\t\t\t\t\tthis.tryAdd(`|html|<div class=\"tournament-message-autostart\">The tournament's automatic start is now off.</div>`);\r\n\t\t\t\t} else if (data[0] === 'on') {\r\n\t\t\t\t\tlet minutes = (parseInt(data[1]) / 1000 / 60);\r\n\t\t\t\t\tthis.tryAdd(BattleLog.html`|html|<div class=\"tournament-message-autostart\">The tournament will automatically start in ${minutes} minute${minutes === 1 ? \"\" : \"s\"}.</div>`);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'scouting':\r\n\t\t\t\tif (data[0] === 'allow') {\r\n\t\t\t\t\tthis.tryAdd(`|html|<div class=\"tournament-message-scouting\">Scouting is now allowed (Tournament players can watch other tournament battles)</div>`);\r\n\t\t\t\t} else if (data[0] === 'disallow') {\r\n\t\t\t\t\tthis.tryAdd(`|html|<div class=\"tournament-message-scouting\">Scouting is now banned (Tournament players can't watch other tournament battles)</div>`);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'update':\r\n\t\t\t\tObject.assign(this.updates, JSON.parse(data.join('|')));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'updateend':\r\n\t\t\t\tconst info = { ...this.info, ...this.updates };\r\n\t\t\t\tif (!info.isActive) {\r\n\t\t\t\t\tif (!info.isStarted || info.isJoined)\r\n\t\t\t\t\t\tthis.boxVisible = true;\r\n\t\t\t\t\tinfo.isActive = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ('format' in this.updates || 'teambuilderFormat' in this.updates) {\r\n\t\t\t\t\tif (!info.teambuilderFormat) info.teambuilderFormat = info.format;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (info.isStarted && info.isJoined) {\r\n\t\t\t\t\t// Update the challenges\r\n\t\t\t\t\tif ('challenges' in this.updates) {\r\n\t\t\t\t\t\tif (info.challenges?.length) {\r\n\t\t\t\t\t\t\tthis.boxVisible = true;\r\n\t\t\t\t\t\t\tif (!this.info.challenges?.length) {\r\n\t\t\t\t\t\t\t\t// app.playNotificationSound();\r\n\t\t\t\t\t\t\t\tif (notify) {\r\n\t\t\t\t\t\t\t\t\tthis.room.notify({\r\n\t\t\t\t\t\t\t\t\t\ttitle: \"Tournament challenges available\",\r\n\t\t\t\t\t\t\t\t\t\tbody: `Room: ${this.room.title}`,\r\n\t\t\t\t\t\t\t\t\t\tid: 'tournament-challenges',\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ('challenged' in this.updates) {\r\n\t\t\t\t\t\tif (info.challenged) {\r\n\t\t\t\t\t\t\tthis.boxVisible = true;\r\n\t\t\t\t\t\t\tif (!this.info.challenged) {\r\n\t\t\t\t\t\t\t\tif (notify) {\r\n\t\t\t\t\t\t\t\t\tthis.room.notify({\r\n\t\t\t\t\t\t\t\t\t\ttitle: `Tournament challenge from ${info.challenged}`,\r\n\t\t\t\t\t\t\t\t\t\tbody: `Room: ${this.room.title}`,\r\n\t\t\t\t\t\t\t\t\t\tid: 'tournament-challenged',\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.info = info;\r\n\t\t\t\tthis.updates = {};\r\n\t\t\t\tthis.update();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'battlestart': {\r\n\t\t\t\tconst roomid = toRoomid(data[2]);\r\n\t\t\t\tthis.tryAdd(`|uhtml|tournament-${roomid}|<div class=\"tournament-message-battlestart\"><a href=\"${roomid}\" class=\"ilink\">Tournament battle between ${BattleLog.escapeHTML(data[0])} and ${BattleLog.escapeHTML(data[1])} started.</a></div>`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'battleend': {\r\n\t\t\t\tlet result = \"drawn\";\r\n\t\t\t\tif (data[2] === 'win')\r\n\t\t\t\t\tresult = \"won\";\r\n\t\t\t\telse if (data[2] === 'loss')\r\n\t\t\t\t\tresult = \"lost\";\r\n\t\t\t\tconst message = `${BattleLog.escapeHTML(data[0])} has ${result} the match ${BattleLog.escapeHTML(data[3].split(',').join(' - '))} against ${BattleLog.escapeHTML(data[1])}${data[4] === 'fail' ? \" but the tournament does not support drawing, so it did not count\" : \"\"}.`;\r\n\t\t\t\tconst roomid = toRoomid(data[5]);\r\n\t\t\t\tthis.tryAdd(`|uhtml|tournament-${roomid}|<div class=\"tournament-message-battleend\"><a href=\"${roomid}\" class=\"ilink\">${message}</a></div>`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tcase 'end':\r\n\t\t\t\tlet endData = JSON.parse(data.join('|'));\r\n\t\t\t\tthis.info.format = endData.format;\r\n\t\t\t\tthis.info.generator = endData.generator;\r\n\t\t\t\tif (endData.bracketData) this.info.bracketData = endData.bracketData;\r\n\r\n\t\t\t\tif (this.room.log) {\r\n\t\t\t\t\tconst bracketNode = document.createElement('div');\r\n\t\t\t\t\tbracketNode.style.position = 'relative';\r\n\t\t\t\t\tthis.room.log.addNode(bracketNode);\r\n\t\t\t\t\tpreact.render(<TournamentBracket tour={this} abbreviated />, bracketNode);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.room.add(BattleLog.html`|html|<div class=\"tournament-message-end-winner\">Congratulations to ${ChatTournament.arrayToPhrase(endData.results[0])} for winning the ${this.tournamentName()}!</div>`);\r\n\t\t\t\tif (endData.results[1]) {\r\n\t\t\t\t\tthis.tryAdd(BattleLog.html`|html|<div class=\"tournament-message-end-runnerup\">Runner${endData.results[1].length > 1 ? \"s\" : \"\"}-up: ${ChatTournament.arrayToPhrase(endData.results[1])}</div>`);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Fallthrough\r\n\r\n\t\t\tcase 'forceend':\r\n\t\t\t\tthis.room.dismissNotification('tournament-create');\r\n\t\t\t\tthis.updates = {};\r\n\r\n\t\t\t\tthis.info.isActive = false;\r\n\t\t\t\tthis.boxVisible = false;\r\n\r\n\t\t\t\tif (cmd === 'forceend') {\r\n\t\t\t\t\tthis.info = {}; // not needed; nothing to pop out\r\n\t\t\t\t\tthis.room.add(`|html|<div class=\"tournament-message-forceend\">The tournament was forcibly ended.</div>`);\r\n\t\t\t\t}\r\n\t\t\t\t// clear room's tour, so next tour gets a different tour object\r\n\t\t\t\t//  (and the bracket for this one's pop-out is unaffected)\r\n\t\t\t\tthis.room.tour = null;\r\n\t\t\t\tthis.update();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'error': {\r\n\t\t\t\tlet appendError = (message: string) => {\r\n\t\t\t\t\tthis.tryAdd(`|html|<div class=\"tournament-message-forceend\">${BattleLog.sanitizeHTML(message)}</div>`);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tswitch (data[0]) {\r\n\t\t\t\tcase 'BracketFrozen':\r\n\t\t\t\tcase 'AlreadyStarted':\r\n\t\t\t\t\tappendError(\"The tournament has already started.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'BracketNotFrozen':\r\n\t\t\t\tcase 'NotStarted':\r\n\t\t\t\t\tappendError(\"The tournament hasn't started yet.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'UserAlreadyAdded':\r\n\t\t\t\t\tappendError(\"You are already in the tournament.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'AltUserAlreadyAdded':\r\n\t\t\t\t\tappendError(\"One of your alts is already in the tournament.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'UserNotAdded':\r\n\t\t\t\t\tappendError(`${data[1] && data[1] === PS.user.userid ? \"You aren't\" : \"This user isn't\"} in the tournament.`);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'NotEnoughUsers':\r\n\t\t\t\t\tappendError(\"There aren't enough users.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'InvalidAutoDisqualifyTimeout':\r\n\t\t\t\tcase 'InvalidAutoStartTimeout':\r\n\t\t\t\t\tappendError(\"That isn't a valid timeout value.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'InvalidMatch':\r\n\t\t\t\t\tappendError(\"That isn't a valid tournament matchup.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'UserNotNamed':\r\n\t\t\t\t\tappendError(\"You must have a name in order to join the tournament.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Full':\r\n\t\t\t\t\tappendError(\"The tournament is already at maximum capacity for users.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'AlreadyDisqualified':\r\n\t\t\t\t\tappendError(`${data[1] && data[1] === PS.user.userid ? \"You have\" : \"This user has\"} already been disqualified.`);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Banned':\r\n\t\t\t\t\tappendError(\"You are banned from entering tournaments.\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tappendError(\"Unknown error: \" + data[0]);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class TournamentBox extends preact.Component<{ tour: ChatTournament, left?: number }> {\r\n\tsubscription!: PSSubscription;\r\n\toverride componentDidMount(): void {\r\n\t\tthis.subscription = this.props.tour.subscribe(() => {\r\n\t\t\tthis.forceUpdate();\r\n\t\t});\r\n\t}\r\n\toverride componentWillUnmount(): void {\r\n\t\tthis.subscription.unsubscribe();\r\n\t}\r\n\tselectChallengeUser(ev: Event) {\r\n\t\tconst target = ev.target as HTMLSelectElement;\r\n\t\tif (target.tagName !== 'SELECT') return;\r\n\t\tconst selectedIndex = target.selectedIndex;\r\n\t\tif (selectedIndex < 0) return;\r\n\t\tthis.props.tour.selectedChallenge = selectedIndex;\r\n\t\tthis.forceUpdate();\r\n\t}\r\n\tacceptChallenge = (ev: Event, format: string, team?: Team) => {\r\n\t\tconst tour = this.props.tour;\r\n\t\tconst room = tour.room;\r\n\t\tconst packedTeam = team ? team.packedTeam : '';\r\n\t\tPS.send(`/utm ${packedTeam}`);\r\n\t\tif (tour.info.challenged) {\r\n\t\t\troom.send(`/tournament acceptchallenge`);\r\n\t\t} else if (tour.info.challenges?.length) {\r\n\t\t\tconst target = tour.info.challenges[tour.selectedChallenge] || tour.info.challenges[0];\r\n\t\t\troom.send(`/tournament challenge ${target}`);\r\n\t\t}\r\n\t\troom.update(null);\r\n\t};\r\n\tvalidate = (ev: Event, format: string, team?: Team) => {\r\n\t\tconst room = this.props.tour.room;\r\n\t\tconst packedTeam = team ? team.packedTeam : '';\r\n\t\tPS.send(`/utm ${packedTeam}`);\r\n\t\troom.send(`/tournament vtm`);\r\n\t\troom.update(null);\r\n\t};\r\n\ttoggleBoxVisibility = () => {\r\n\t\tthis.props.tour.boxVisible = !this.props.tour.boxVisible;\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\trenderTournamentTools() {\r\n\t\tconst tour = this.props.tour;\r\n\t\tconst info = tour.info;\r\n\t\tif (!info.isJoined) {\r\n\t\t\tif (info.isStarted) return null;\r\n\t\t\treturn <div class=\"tournament-tools\">\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<button data-cmd=\"/tournament join\" class=\"button\"><strong>Join</strong></button> {}\r\n\t\t\t\t\t<button onClick={this.toggleBoxVisibility} class=\"button\">Close</button>\r\n\t\t\t\t</p>\r\n\t\t\t</div>;\r\n\t\t}\r\n\r\n\t\t// joined\r\n\t\tconst noMatches = !info.challenges?.length && !info.challengeBys?.length && !info.challenging && !info.challenged;\r\n\t\treturn <div class=\"tournament-tools\">\r\n\t\t\t<TeamForm\r\n\t\t\t\tformat={info.format} teamFormat={info.teambuilderFormat} hideFormat\r\n\t\t\t\tonSubmit={this.acceptChallenge} onValidate={this.validate}\r\n\t\t\t>\r\n\t\t\t\t{(info.isJoined && !info.challenging && !info.challenged && !info.challenges?.length) && (\r\n\t\t\t\t\t<button name=\"validate\" class=\"button\"><i class=\"fa fa-check\" aria-hidden></i> Validate</button>\r\n\t\t\t\t)} {}\r\n\t\t\t\t{!!(!info.isStarted && info.isJoined) && (\r\n\t\t\t\t\t<button data-cmd=\"/tournament leave\" class=\"button\">Leave</button>\r\n\t\t\t\t)}\r\n\t\t\t\t{(info.isStarted && noMatches) && (\r\n\t\t\t\t\t<div class=\"tournament-nomatches\">Waiting for battles to become available...</div>\r\n\t\t\t\t)}\r\n\t\t\t\t{!!info.challenges?.length && <div class=\"tournament-challenge\">\r\n\t\t\t\t\t<div class=\"tournament-challenge-user\">vs. {info.challenges[tour.selectedChallenge]}</div>\r\n\t\t\t\t\t<button type=\"submit\" class=\"button\"><strong>Ready!</strong></button>\r\n\t\t\t\t\t{info.challenges.length > 1 && <span class=\"tournament-challenge-user-menu\">\r\n\t\t\t\t\t\t<select onChange={this.selectChallengeUser}>\r\n\t\t\t\t\t\t\t{info.challenges.map((challenge, index) => (\r\n\t\t\t\t\t\t\t\t<option value={index} selected={index === tour.selectedChallenge}>{challenge}</option>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t</span>}\r\n\t\t\t\t</div>}\r\n\t\t\t\t{!!info.challengeBys?.length && <div class=\"tournament-challengeby\">\r\n\t\t\t\t\t{info.challenges?.length ? \"Or wait\" : \"Waiting\"} for {ChatTournament.arrayToPhrase(info.challengeBys, \"or\")} {}\r\n\t\t\t\t\tto challenge you.\r\n\t\t\t\t</div>}\r\n\t\t\t\t{!!info.challenging && <div class=\"tournament-challenging\">\r\n\t\t\t\t\t<div class=\"tournament-challenging-message\">Waiting for {info.challenging}...</div>\r\n\t\t\t\t\t<button data-cmd=\"/tournament cancelchallenge\" class=\"button\">Cancel</button>\r\n\t\t\t\t</div>}\r\n\t\t\t\t{!!info.challenged && <div class=\"tournament-challenged\">\r\n\t\t\t\t\t<div class=\"tournament-challenged-message\">vs. {info.challenged}</div>\r\n\t\t\t\t\t<button type=\"submit\" class=\"button\"><strong>Ready!</strong></button>\r\n\t\t\t\t</div>}\r\n\t\t\t</TeamForm>\r\n\t\t</div>;\r\n\t}\r\n\toverride render() {\r\n\t\tconst tour = this.props.tour;\r\n\t\tconst info = tour.info;\r\n\t\treturn <div class={`tournament-wrapper ${info.isActive ? 'active' : ''}`} style={{ left: this.props.left || 0 }}>\r\n\t\t\t<button class=\"tournament-title\" onClick={this.toggleBoxVisibility}>\r\n\t\t\t\t<span class=\"tournament-status\">{info.isStarted ? \"In Progress\" : \"Signups\"}</span>\r\n\t\t\t\t{tour.tournamentName()}\r\n\t\t\t\t{tour.boxVisible ? <i class=\"fa fa-caret-up\" aria-hidden></i> : <i class=\"fa fa-caret-down\" aria-hidden></i>}\r\n\t\t\t</button>\r\n\t\t\t<div class={`tournament-box ${tour.boxVisible ? 'active' : ''}`}>\r\n\t\t\t\t<TournamentBracket tour={tour} />\r\n\t\t\t\t{this.renderTournamentTools()}\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nexport class TournamentBracket extends preact.Component<{\r\n\ttour: ChatTournament, poppedOut?: boolean, abbreviated?: boolean,\r\n}> {\r\n\tsubscription!: PSSubscription;\r\n\trenderTableBracket(data: TournamentTableBracketData) {\r\n\t\tif (data.tableContents.length === 0)\r\n\t\t\treturn null;\r\n\r\n\t\tif (data.tableHeaders.rows.length > 4 && this.props.abbreviated) {\r\n\t\t\tlet rows = data.tableHeaders.rows.map((row, i) => ({\r\n\t\t\t\tname: row,\r\n\t\t\t\tscore: data.scores[i],\r\n\t\t\t}));\r\n\t\t\trows.sort((a, b) => b.score - a.score);\r\n\t\t\trows = rows.slice(0, 4);\r\n\t\t\treturn <div class=\"pad\"><table class=\"tournament-bracket-table\" style=\"border-bottom-width:0\">\r\n\t\t\t\t{rows.map((row, i) => (\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<th>{row.name}</th><td>{row.score}</td>\r\n\t\t\t\t\t\t<td class=\"tournament-bracket-table-cell-null\">{i < 3 ? (\r\n\t\t\t\t\t\t\t<i class=\"fa fa-trophy\" aria-hidden style={{ color: ['#d6c939', '#adb2bb', '#ca8530'][i] }}></i>\r\n\t\t\t\t\t\t) : null}</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t))}\r\n\t\t\t\t<tr><th colSpan={2}>...</th><td class=\"tournament-bracket-table-cell-null\"></td></tr>\r\n\t\t\t</table></div>;\r\n\t\t}\r\n\r\n\t\treturn <div class=\"pad\"><table class=\"tournament-bracket-table\">\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"empty\"></td>\r\n\t\t\t\t{data.tableHeaders.cols.map(name => <th>{name}</th>)}\r\n\t\t\t</tr>\r\n\t\t\t{data.tableHeaders.rows.map((name, r) => <tr>\r\n\t\t\t\t<th>{name}</th>\r\n\t\t\t\t{data.tableContents[r].map(cell => cell ? (\r\n\t\t\t\t\t<td\r\n\t\t\t\t\t\tclass={`tournament-bracket-table-cell-${cell.state}${cell.state === 'finished' ? (\r\n\t\t\t\t\t\t\t`tournament-bracket-table-cell-result-${cell.result}`\r\n\t\t\t\t\t\t) : ''}`}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{cell.state === 'unavailable' ? (\r\n\t\t\t\t\t\t\t\"Unavailable\"\r\n\t\t\t\t\t\t) : cell.state === 'available' ? (\r\n\t\t\t\t\t\t\t\"Waiting\"\r\n\t\t\t\t\t\t) : cell.state === 'challenging' ? (\r\n\t\t\t\t\t\t\t\"Challenging\"\r\n\t\t\t\t\t\t) : cell.state === 'inprogress' ? (\r\n\t\t\t\t\t\t\t<a href={toRoomid(cell.room)} class=\"ilink\">In-progress</a>\r\n\t\t\t\t\t\t) : cell.state === 'finished' ? (\r\n\t\t\t\t\t\t\tcell.score.join(\" - \")\r\n\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t</td>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<td class=\"tournament-bracket-table-cell-null\"></td>\r\n\t\t\t\t))}\r\n\t\t\t\t<th class=\"tournament-bracket-row-score\">{data.scores[r]}</th>\r\n\t\t\t</tr>)}\r\n\t\t</table></div>;\r\n\t}\r\n\tdragging: {\r\n\t\tx: number,\r\n\t\ty: number,\r\n\t} | null = null;\r\n\tonMouseDown = (ev: MouseEvent) => {\r\n\t\tconst elem = this.base!;\r\n\t\tconst canScrollVertically = elem.scrollHeight > elem.clientHeight;\r\n\t\tconst canScrollHorizontally = elem.scrollWidth > elem.clientWidth;\r\n\t\tif (!canScrollVertically && !canScrollHorizontally) return;\r\n\t\tif (ev.button) return;\r\n\r\n\t\tev.preventDefault();\r\n\t\t// in case mouse moves outside the element\r\n\t\twindow.addEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.addEventListener('mouseup', this.onMouseUp);\r\n\t\tthis.dragging = {\r\n\t\t\tx: ev.clientX,\r\n\t\t\ty: ev.clientY,\r\n\t\t};\r\n\t\telem.style.cursor = 'grabbing';\r\n\t};\r\n\tonMouseMove = (ev: MouseEvent) => {\r\n\t\tif (!this.dragging) return;\r\n\t\tconst dx = ev.clientX - this.dragging.x;\r\n\t\tconst dy = ev.clientY - this.dragging.y;\r\n\t\tthis.dragging.x = ev.clientX;\r\n\t\tthis.dragging.y = ev.clientY;\r\n\t\tconst elem = this.base!;\r\n\t\telem.scrollLeft -= dx;\r\n\t\telem.scrollTop -= dy;\r\n\t};\r\n\tonMouseUp = (ev: MouseEvent) => {\r\n\t\tif (!this.dragging) return;\r\n\t\tthis.dragging = null;\r\n\t\tconst elem = this.base!;\r\n\t\telem.style.cursor = 'grab';\r\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\r\n\t};\r\n\toverride componentWillUnmount(): void {\r\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\r\n\t}\r\n\toverride componentDidUpdate() {\r\n\t\tconst elem = this.base!;\r\n\t\tconst canScrollVertically = elem.scrollHeight > elem.clientHeight;\r\n\t\tconst canScrollHorizontally = elem.scrollWidth > elem.clientWidth;\r\n\t\tif (!canScrollVertically && !canScrollHorizontally) {\r\n\t\t\telem.style.cursor = 'default';\r\n\t\t} else {\r\n\t\t\telem.style.cursor = 'grab';\r\n\t\t}\r\n\t}\r\n\toverride componentDidMount() {\r\n\t\tthis.componentDidUpdate();\r\n\t}\r\n\tpopOut = (ev: Event) => {\r\n\t\tPS.join('tourpopout' as RoomID, {\r\n\t\t\tparentElem: ev.currentTarget as HTMLElement,\r\n\t\t\targs: { tour: this.props.tour },\r\n\t\t});\r\n\t\tev.stopImmediatePropagation();\r\n\t\tev.preventDefault();\r\n\t};\r\n\trender() {\r\n\t\tconst data = this.props.tour.info.bracketData;\r\n\t\treturn <div\r\n\t\t\tclass={`tournament-bracket${this.props.poppedOut ? ' tournament-popout-bracket' : ''}`}\r\n\t\t\tonMouseDown={this.onMouseDown} onMouseUp={this.onMouseUp} onMouseMove={this.onMouseMove}\r\n\t\t>\r\n\t\t\t{data?.type === 'table' ? this.renderTableBracket(data) :\r\n\t\t\tdata?.type === 'tree' ? <TournamentTreeBracket data={data} abbreviated={this.props.abbreviated} /> :\r\n\t\t\tnull}\r\n\t\t\t{this.props.poppedOut ? (\r\n\t\t\t\t<button class=\"tournament-close-link button\" data-cmd=\"/close\">\r\n\t\t\t\t\t<i class=\"fa fa-times\" aria-hidden></i> Close\r\n\t\t\t\t</button>\r\n\t\t\t) : (\r\n\t\t\t\t<button class=\"tournament-popout-link button\" onClick={this.popOut}>\r\n\t\t\t\t\t<i class=\"fa fa-arrows-alt\" aria-hidden></i> Pop-out\r\n\t\t\t\t</button>\r\n\t\t\t)}\r\n\t\t</div>;\r\n\t}\r\n}\r\nexport class TournamentTreeBracket extends preact.Component<{\r\n\tdata: TournamentTreeBracketData, abbreviated?: boolean,\r\n}> {\r\n\td3Loader: Promise<void> | null = null;\r\n\tforEachTreeNode<T extends TreeNode>(node: T, callback: (node: T, depth: number) => void, depth = 0) {\r\n\t\tcallback(node, depth);\r\n\t\tif (node.children) {\r\n\t\t\tfor (const child of node.children) {\r\n\t\t\t\tthis.forEachTreeNode(child as T, callback, depth + 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tcloneTree<T extends TreeNode>(node: T): T {\r\n\t\tconst clonedNode = { ...node };\r\n\t\tif (node.children) {\r\n\t\t\tclonedNode.children = node.children.map(child => this.cloneTree(child));\r\n\t\t}\r\n\t\treturn clonedNode;\r\n\t}\r\n\t/**\r\n\t * Customize tree size. Height is for a single player, a full node is double that.\r\n\t */\r\n\tstatic nodeSize = {\r\n\t\twidth: 160, height: 15,\r\n\t\tradius: 5,\r\n\t\tseparationX: 20, separationY: 10,\r\n\t\t// Safari bug: some issue with dominant-baseline. whatever, we can just manually v-align text\r\n\t\ttextOffset: 4,\r\n\t};\r\n\tgenerateTreeBracket(data: TournamentTreeBracketData, abbreviated?: boolean) {\r\n\t\tconst div = document.createElement('div');\r\n\t\tdiv.className = 'tournament-bracket-tree';\r\n\r\n\t\tif (!data.rootNode) {\r\n\t\t\tconst users = data.users;\r\n\t\t\tif (users?.length) {\r\n\t\t\t\tdiv.innerHTML = `<b>${users.length}</b> user${users.length !== 1 ? 's' : ''}:<br />${BattleLog.escapeHTML(users.join(\", \"))}`;\r\n\t\t\t} else {\r\n\t\t\t\tdiv.innerHTML = `<b>0</b> users`;\r\n\t\t\t}\r\n\t\t\treturn div;\r\n\t\t}\r\n\t\tif (!window.d3) {\r\n\t\t\tdiv.innerHTML = `<b>d3 not loaded yet</b>`;\r\n\t\t\tthis.d3Loader ||= PS.libsLoaded.then(() => {\r\n\t\t\t\tthis.forceUpdate();\r\n\t\t\t});\r\n\t\t\treturn div;\r\n\t\t}\r\n\t\tthis.d3Loader = null;\r\n\r\n\t\tlet name = PS.user.name;\r\n\r\n\t\t// Construct the visual tree from the real tree\r\n\r\n\t\tconst newTree = this.cloneTree(data.rootNode) as TournamentElimBracketNode;\r\n\t\tif (newTree.team) newTree.highlightLink = true;\r\n\t\tconst highlightName = newTree.team; // if we have a root winner, trace it through double elim brackets\r\n\r\n\t\tthis.forEachTreeNode(newTree, (node, depth) => {\r\n\t\t\tif (node.children?.length === 2) {\r\n\t\t\t\tnode.team1 = node.children[0].team;\r\n\t\t\t\tnode.team2 = node.children[1].team;\r\n\t\t\t\tconst shouldHaveChildren = node.children.some(child => child.children?.length === 2);\r\n\t\t\t\tif (!shouldHaveChildren) node.children = [];\r\n\t\t\t\tif (depth >= 2 && node.children?.length && abbreviated) {\r\n\t\t\t\t\tnode.children = [];\r\n\t\t\t\t\tnode.abbreviated = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (node.highlightLink) {\r\n\t\t\t\t\tfor (const child of node.children) {\r\n\t\t\t\t\t\tif (child.team === node.team) {\r\n\t\t\t\t\t\t\tchild.highlightLink = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (\r\n\t\t\t\t\tnode.state === 'inprogress' || node.state === 'available' || node.state === 'challenging' ||\r\n\t\t\t\t\tnode.state === 'unavailable'\r\n\t\t\t\t) {\r\n\t\t\t\t\tfor (const child of node.children) {\r\n\t\t\t\t\t\tif (child.team && !child.team.startsWith('(')) {\r\n\t\t\t\t\t\t\tchild.highlightLink = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (highlightName) {\r\n\t\t\t\t\tfor (const child of node.children) {\r\n\t\t\t\t\t\tif (child.team === highlightName) {\r\n\t\t\t\t\t\t\tchild.highlightLink = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Calculate dimensions\r\n\r\n\t\tlet numLeaves = 0;\r\n\t\tconst hasLeafAtDepth: boolean[] = [];\r\n\t\tthis.forEachTreeNode(newTree, (node, depth) => {\r\n\t\t\thasLeafAtDepth[depth] ||= false;\r\n\t\t\tif (!node.children?.length) {\r\n\t\t\t\tnumLeaves++;\r\n\t\t\t\thasLeafAtDepth[depth] = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Setting `breadthCompression` to 0.8 for 3+ depths with leaves is\r\n\t\t// an extremely approximate guess for how tall a double+ elim tree\r\n\t\t// should be. The old algorithm also approximated, but its\r\n\t\t// approximation was arguably worse. This one is basically perfect\r\n\t\t// for single elim and pretty good for double elim.\r\n\t\tconst depthsWithLeaves = hasLeafAtDepth.filter(Boolean).length;\r\n\t\tconst breadthCompression = depthsWithLeaves > 2 ? 0.8 : 2;\r\n\t\tconst maxBreadth = numLeaves - (depthsWithLeaves - 1) / breadthCompression;\r\n\t\tconst maxDepth = hasLeafAtDepth.length;\r\n\r\n\t\tconst nodeSize = TournamentTreeBracket.nodeSize;\r\n\t\tconst size = {\r\n\t\t\twidth: nodeSize.width * maxDepth + nodeSize.separationX * (maxDepth + 1),\r\n\t\t\theight: nodeSize.height * 2 * (maxBreadth + 0.5) + nodeSize.separationY * maxBreadth,\r\n\t\t};\r\n\r\n\t\t// Make d3 layout the tree\r\n\r\n\t\tconst tree = d3.layout.tree<TournamentElimBracketNode>()\r\n\t\t\t.size([size.height, size.width - nodeSize.width - nodeSize.separationX])\r\n\t\t\t.separation(() => 1)\r\n\t\t\t.children(node => (\r\n\t\t\t\tnode.children?.length ? node.children : null!\r\n\t\t\t));\r\n\t\tconst nodes = tree.nodes(newTree);\r\n\t\tconst links = tree.links(nodes);\r\n\r\n\t\t// Put the tree in the right place\r\n\r\n\t\tconst layoutRoot = d3.select(div)\r\n\t\t\t.append('svg:svg').attr('width', size.width).attr('height', size.height)\r\n\t\t\t.append('svg:g')\r\n\t\t\t.attr('transform', `translate(${-(nodeSize.width) / 2 - 6},0)`);\r\n\r\n\t\t// Style the links between the nodes\r\n\r\n\t\tconst diagonalLink = d3.svg.diagonal()\r\n\t\t\t.source(link => ({\r\n\t\t\t\tx: link.source.x, y: link.source.y + nodeSize.width / 2,\r\n\t\t\t}))\r\n\t\t\t.target(link => ({\r\n\t\t\t\tx: link.target.x, y: link.target.y - nodeSize.width / 2,\r\n\t\t\t}))\r\n\t\t\t.projection(link => [\r\n\t\t\t\tsize.width - link.y, link.x,\r\n\t\t\t]);\r\n\t\tlayoutRoot.selectAll('path.tournament-bracket-tree-link').data(links).enter()\r\n\t\t\t.append('svg:path')\r\n\t\t\t.attr('d', diagonalLink)\r\n\t\t\t.classed('tournament-bracket-tree-link', true)\r\n\t\t\t.classed('tournament-bracket-tree-link-active', link => (\r\n\t\t\t\t!!link.target.highlightLink\r\n\t\t\t));\r\n\r\n\t\t// Style the nodes themselves\r\n\r\n\t\tconst nodeGroup = layoutRoot.selectAll('g.tournament-bracket-tree-node').data(nodes).enter()\r\n\t\t\t.append('svg:g').classed('tournament-bracket-tree-node', true).attr('transform', node => (\r\n\t\t\t\t`translate(${size.width - node.y},${node.x})`\r\n\t\t\t));\r\n\t\tnodeGroup.each(function (this: EventTarget, node) {\r\n\t\t\tlet elem = d3.select(this);\r\n\t\t\tconst outerElem = elem;\r\n\r\n\t\t\tif (node.abbreviated) {\r\n\t\t\t\telem.append('svg:text').attr('y', -nodeSize.height / 2 + 4)\r\n\t\t\t\t\t.attr('x', -nodeSize.width / 2 - 7).classed('tournament-bracket-tree-abbreviated', true)\r\n\t\t\t\t\t.text('...');\r\n\t\t\t}\r\n\r\n\t\t\tif (node.state === 'inprogress') {\r\n\t\t\t\telem = elem.append('svg:a').attr('xlink:href', toRoomid(node.room)).classed('ilink', true)\r\n\t\t\t\t\t.on('click', () => {\r\n\t\t\t\t\t\tconst ev = d3.event as MouseEvent;\r\n\t\t\t\t\t\tif (ev.metaKey || ev.ctrlKey) return;\r\n\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\tev.stopPropagation();\r\n\t\t\t\t\t\tconst roomid = (ev.currentTarget as Element).getAttribute('href');\r\n\t\t\t\t\t\tPS.join(roomid as RoomID);\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\touterElem.classed('tournament-bracket-tree-node-match', true);\r\n\t\t\touterElem.classed('tournament-bracket-tree-node-match-' + node.state, true);\r\n\r\n\t\t\tif (node.team && !node.team1 && !node.team2) {\r\n\t\t\t\tconst rect = elem.append('svg:rect').classed('tournament-bracket-tree-draw', true)\r\n\t\t\t\t\t.attr('rx', nodeSize.radius)\r\n\t\t\t\t\t.attr('x', -nodeSize.width / 2).attr('width', nodeSize.width)\r\n\t\t\t\t\t.attr('y', -nodeSize.height / 2).attr('height', nodeSize.height);\r\n\t\t\t\tif (node.team === name) rect.attr('stroke-dasharray', '5,5').attr('stroke-width', 2);\r\n\r\n\t\t\t\telem.append('svg:text').classed('tournament-bracket-tree-node-team', true)\r\n\t\t\t\t\t.attr('y', nodeSize.textOffset)\r\n\t\t\t\t\t.classed('tournament-bracket-tree-node-team-draw', true)\r\n\t\t\t\t\t.text(node.team || '');\r\n\t\t\t} else {\r\n\t\t\t\tconst rect1 = elem.append('svg:rect')\r\n\t\t\t\t\t.attr('rx', nodeSize.radius)\r\n\t\t\t\t\t.attr('x', -nodeSize.width / 2).attr('width', nodeSize.width)\r\n\t\t\t\t\t.attr('y', -nodeSize.height).attr('height', nodeSize.height);\r\n\t\t\t\tconst rect2 = elem.append('svg:rect')\r\n\t\t\t\t\t.attr('rx', nodeSize.radius)\r\n\t\t\t\t\t.attr('x', -nodeSize.width / 2).attr('width', nodeSize.width)\r\n\t\t\t\t\t.attr('y', 0).attr('height', nodeSize.height);\r\n\t\t\t\tif (node.team1 === name) rect1.attr('stroke-dasharray', '5,5').attr('stroke-width', 2);\r\n\t\t\t\tif (node.team2 === name) rect2.attr('stroke-dasharray', '5,5').attr('stroke-width', 2);\r\n\r\n\t\t\t\tconst row1 = elem.append('svg:text').attr('y', -nodeSize.height / 2 + nodeSize.textOffset)\r\n\t\t\t\t\t.classed('tournament-bracket-tree-node-row1', true);\r\n\t\t\t\tconst row2 = elem.append('svg:text').attr('y', nodeSize.height / 2 + nodeSize.textOffset)\r\n\t\t\t\t\t.classed('tournament-bracket-tree-node-row2', true);\r\n\r\n\t\t\t\tconst team1 = row1.append('svg:tspan').classed('tournament-bracket-tree-team', true)\r\n\t\t\t\t\t.text(node.team1 || '');\r\n\t\t\t\tconst team2 = row2.append('svg:tspan').classed('tournament-bracket-tree-team', true)\r\n\t\t\t\t\t.text(node.team2 || '');\r\n\r\n\t\t\t\tif (node.state === 'available') {\r\n\t\t\t\t\telem.append('title').text(\"Waiting\");\r\n\t\t\t\t} else if (node.state === 'challenging') {\r\n\t\t\t\t\telem.append('title').text(\"Challenging\");\r\n\t\t\t\t} else if (node.state === 'inprogress') {\r\n\t\t\t\t\telem.append('title').text(\"In-progress\");\r\n\t\t\t\t} else if (node.state === 'finished') {\r\n\t\t\t\t\tif (node.result === 'win') {\r\n\t\t\t\t\t\trect1.classed('tournament-bracket-tree-win', true);\r\n\t\t\t\t\t\trect2.classed('tournament-bracket-tree-loss', true);\r\n\t\t\t\t\t\tteam1.classed('tournament-bracket-tree-team-win', true);\r\n\t\t\t\t\t\tteam2.classed('tournament-bracket-tree-team-loss', true);\r\n\t\t\t\t\t} else if (node.result === 'loss') {\r\n\t\t\t\t\t\trect1.classed('tournament-bracket-tree-loss', true);\r\n\t\t\t\t\t\trect2.classed('tournament-bracket-tree-win', true);\r\n\t\t\t\t\t\tteam1.classed('tournament-bracket-tree-team-loss', true);\r\n\t\t\t\t\t\tteam2.classed('tournament-bracket-tree-team-win', true);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trect1.classed('tournament-bracket-tree-draw', true);\r\n\t\t\t\t\t\trect2.classed('tournament-bracket-tree-draw', true);\r\n\t\t\t\t\t\tteam1.classed('tournament-bracket-tree-team-draw', true);\r\n\t\t\t\t\t\tteam2.classed('tournament-bracket-tree-team-draw', true);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telem.classed('tournament-bracket-tree-node-match-result-' + node.result, true);\r\n\t\t\t\t\trow1.append('svg:tspan').text(` (${node.score[0]})`).classed('tournament-bracket-tree-score', true);\r\n\t\t\t\t\trow2.append('svg:tspan').text(` (${node.score[1]})`).classed('tournament-bracket-tree-score', true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn div;\r\n\t};\r\n\toverride componentDidMount() {\r\n\t\tthis.base!.appendChild(this.generateTreeBracket(this.props.data, this.props.abbreviated));\r\n\t}\r\n\toverride shouldComponentUpdate(props: { data: TournamentTreeBracketData }) {\r\n\t\tif (props.data === this.props.data && !this.d3Loader) return false;\r\n\t\tthis.base!.replaceChild(this.generateTreeBracket(props.data), this.base!.children[0]);\r\n\t\treturn false;\r\n\t}\r\n\trender() {\r\n\t\treturn <div class=\"pad\"></div>;\r\n\t}\r\n}\r\n\r\nexport class TourPopOutPanel extends PSRoomPanel {\r\n\tstatic readonly id = 'tourpopout';\r\n\tstatic readonly routes = ['tourpopout'];\r\n\tstatic readonly location = 'semimodal-popup';\r\n\tstatic readonly noURL = true;\r\n\toverride componentDidMount() {\r\n\t\tconst tour = this.props.room.args?.tour as ChatTournament;\r\n\t\tif (tour) this.subscribeTo(tour);\r\n\t}\r\n\toverride render() {\r\n\t\tconst room = this.props.room;\r\n\t\tconst tour = room.args?.tour as ChatTournament;\r\n\t\treturn <PSPanelWrapper room={room} fullSize>\r\n\t\t\t{tour && <TournamentBracket tour={tour} poppedOut />}\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nPS.addRoomType(TourPopOutPanel);\r\n"],"mappings":"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","ignoreList":[]}